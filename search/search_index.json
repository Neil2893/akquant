{"config":{"lang":["en","zh"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"AKQuant","text":"<p>AKQuant \u662f\u4e00\u4e2a\u57fa\u4e8e Rust \u548c Python \u6784\u5efa\u7684\u9ad8\u6027\u80fd\u91cf\u5316\u6295\u7814\u6846\u67b6\u3002\u5b83\u65e8\u5728\u7ed3\u5408 Rust \u7684\u6781\u81f4\u6027\u80fd\u548c Python \u7684\u6613\u7528\u6027\uff0c\u4e3a\u91cf\u5316\u4ea4\u6613\u8005\u63d0\u4f9b\u5f3a\u5927\u7684\u56de\u6d4b\u548c\u7814\u7a76\u5de5\u5177\u3002</p> <p>\u6700\u65b0\u7248\u672c\u5f15\u5165\u4e86\u6a21\u5757\u5316\u8bbe\u8ba1\u3001\u72ec\u7acb\u7684\u6295\u8d44\u7ec4\u5408\u7ba1\u7406\u3001\u9ad8\u7ea7\u8ba2\u5355\u7c7b\u578b\u652f\u6301\u4ee5\u53ca\u4fbf\u6377\u7684\u6570\u636e\u52a0\u8f7d\u4e0e\u7f13\u5b58\u673a\u5236\u3002</p> <p>\ud83d\udcd6 \u8bbe\u8ba1\u4e0e\u5f00\u53d1\u6307\u5357 (DESIGN.md): \u5982\u679c\u4f60\u60f3\u6df1\u5165\u4e86\u89e3\u5185\u90e8\u67b6\u6784\u3001\u5b66\u4e60\u5982\u4f55\u8bbe\u8ba1\u6b64\u7c7b\u7cfb\u7edf\u6216\u8fdb\u884c\u4e8c\u6b21\u5f00\u53d1\uff0c\u8bf7\u9605\u8bfb\u6b64\u6587\u6863\u3002</p>"},{"location":"#_1","title":"\u6838\u5fc3\u7279\u6027","text":"<ul> <li>\u6781\u81f4\u6027\u80fd: \u6838\u5fc3\u56de\u6d4b\u5f15\u64ce\u91c7\u7528 Rust \u7f16\u5199\uff0c\u901a\u8fc7 PyO3 \u63d0\u4f9b Python \u63a5\u53e3\u3002<ul> <li>\u57fa\u51c6\u6d4b\u8bd5: \u5728 200k K\u7ebf\u6570\u636e\u7684 SMA \u7b56\u7565\u56de\u6d4b\u4e2d\uff0cAKQuant \u8017\u65f6\u4ec5 1.31s (\u541e\u5410\u91cf ~152k bars/sec)\uff0c\u76f8\u6bd4 Backtrader (26.55s) \u5feb\u7ea6 20\u500d\u3002</li> <li>Zero-Copy Access (New): \u5386\u53f2\u6570\u636e (<code>ctx.history</code>) \u901a\u8fc7 PyO3 Buffer Protocol / Numpy View \u76f4\u63a5\u6620\u5c04 Rust \u5185\u5b58\uff0c\u5b9e\u73b0\u96f6\u62f7\u8d1d\u8bbf\u95ee\uff0c\u5927\u5e45\u63d0\u5347 Python \u7aef\u6307\u6807\u8ba1\u7b97\u6027\u80fd\u3002</li> </ul> </li> <li>\u6a21\u5757\u5316\u67b6\u6784:<ul> <li>Engine: \u4e8b\u4ef6\u9a71\u52a8\u7684\u6838\u5fc3\u64ae\u5408\u5f15\u64ce\uff0c\u91c7\u7528\u4e8c\u8fdb\u5236\u5806 (BinaryHeap) \u7ba1\u7406\u4e8b\u4ef6\u961f\u5217\u3002</li> <li>Clock: \u7cbe\u786e\u7ba1\u7406\u4ea4\u6613\u65f6\u6bb5 (TradingSession) \u548c\u65f6\u95f4\u6d41\u901d\u3002</li> <li>Portfolio: \u72ec\u7acb\u7684\u6295\u8d44\u7ec4\u5408\u7ba1\u7406\uff0c\u652f\u6301\u5b9e\u65f6\u6743\u76ca\u8ba1\u7b97\u3002</li> <li>MarketModel: \u53ef\u63d2\u62d4\u7684\u5e02\u573a\u6a21\u578b\uff0c\u5185\u7f6e A \u80a1 T+1 \u548c\u671f\u8d27 T+0 \u89c4\u5219\u3002<ul> <li>T+1 \u4e25\u683c\u98ce\u63a7: \u9488\u5bf9\u80a1\u7968/\u57fa\u91d1\uff0c\u4e25\u683c\u6267\u884c T+1 \u53ef\u7528\u6301\u4ed3\u68c0\u67e5\uff0c\u9632\u6b62\u5f53\u65e5\u4e70\u5165\u5f53\u65e5\u5356\u51fa\uff08\u9664\u975e\u914d\u7f6e\u4e3a T+0 \u5e02\u573a\uff09\u3002</li> <li>\u53ef\u7528\u6301\u4ed3\u7ba1\u7406: \u81ea\u52a8\u7ef4\u62a4 <code>available_positions</code>\uff0c\u5e76\u6263\u9664\u672a\u6210\u4ea4\u7684\u5356\u5355\u51bb\u7ed3\u6570\u91cf\uff0c\u9632\u6b62\u8d85\u5356\u3002</li> </ul> </li> </ul> </li> <li>\u4e8b\u4ef6\u7cfb\u7edf:<ul> <li>Timer: \u652f\u6301 <code>schedule(timestamp, payload)</code> \u6ce8\u518c\u5b9a\u65f6\u4e8b\u4ef6\uff0c\u89e6\u53d1 <code>on_timer</code> \u56de\u8c03\uff0c\u5b9e\u73b0\u590d\u6742\u7684\u76d8\u4e2d\u5b9a\u65f6\u903b\u8f91\u3002</li> </ul> </li> <li>\u98ce\u63a7\u7cfb\u7edf (New):<ul> <li>\u72ec\u7acb\u62e6\u622a\u5c42: \u5185\u7f6e <code>RiskManager</code>\uff0c\u5728 Rust \u5f15\u64ce\u5c42\u76f4\u63a5\u62e6\u622a\u8fdd\u89c4\u8ba2\u5355\u3002</li> <li>\u53ef\u7528\u6301\u4ed3\u68c0\u67e5: \u4e0b\u5355\u524d\u5b9e\u65f6\u68c0\u67e5\u53ef\u7528\u6301\u4ed3\uff08Available - Pending Sell\uff09\uff0c\u9632\u6b62\u8d85\u5356\u8fdd\u89c4\u3002</li> <li>\u7075\u6d3b\u914d\u7f6e: \u901a\u8fc7 <code>RiskConfig</code> \u53ef\u914d\u7f6e\u6700\u5927\u5355\u7b14\u91d1\u989d\u3001\u6700\u5927\u6301\u4ed3\u6bd4\u4f8b\u3001\u9ed1\u540d\u5355\u7b49\u3002</li> </ul> </li> <li>\u6570\u636e\u751f\u6001:<ul> <li>Streaming CSV (New): \u652f\u6301\u6d41\u5f0f\u52a0\u8f7d\u8d85\u5927 CSV \u6587\u4ef6 (<code>DataFeed.from_csv</code>)\uff0c\u6781\u5927\u964d\u4f4e\u5185\u5b58\u5360\u7528\u3002</li> <li>Pandas \u96c6\u6210: \u652f\u6301\u76f4\u63a5\u52a0\u8f7d Pandas DataFrame \u6570\u636e\uff0c\u517c\u5bb9\u5404\u7c7b\u6570\u636e\u6e90\u3002</li> <li>\u667a\u80fd\u7f13\u5b58: \u652f\u6301\u6570\u636e\u672c\u5730\u7f13\u5b58 (Pickle)\uff0c\u907f\u514d\u91cd\u590d\u4e0b\u8f7d\uff0c\u52a0\u901f\u7b56\u7565\u8fed\u4ee3\u3002</li> </ul> </li> <li>\u673a\u5668\u5b66\u4e60 (New):<ul> <li>ML Framework: \u5185\u7f6e\u9ad8\u6027\u80fd\u673a\u5668\u5b66\u4e60\u8bad\u7ec3\u6846\u67b6\uff0c\u652f\u6301 Walk-forward Validation (\u6eda\u52a8\u8bad\u7ec3)\u3002</li> <li>Adapter Pattern: \u7edf\u4e00 Scikit-learn \u548c PyTorch \u63a5\u53e3\uff0c\u89e3\u8026\u6a21\u578b\u4e0e\u7b56\u7565\u903b\u8f91\u3002</li> <li>\ud83d\udcd6 \u673a\u5668\u5b66\u4e60\u6307\u5357: \u8be6\u7ec6\u4e86\u89e3\u5982\u4f55\u6784\u5efa AI \u9a71\u52a8\u7684\u7b56\u7565\u3002</li> </ul> </li> <li>\u7075\u6d3b\u914d\u7f6e:<ul> <li>StrategyConfig: \u5168\u5c40\u7b56\u7565\u914d\u7f6e\uff0c\u652f\u6301\u8d44\u91d1\u7ba1\u7406\u3001\u8d39\u7387\u6a21\u5f0f\u7b49\u8bbe\u7f6e\u3002</li> <li>ExecutionMode: \u652f\u6301 <code>CurrentClose</code> (\u4fe1\u53f7\u5f53\u6839K\u7ebf\u6536\u76d8\u6210\u4ea4) \u548c <code>NextOpen</code> (\u6b21\u65e5\u5f00\u76d8\u6210\u4ea4) \u6a21\u5f0f\u3002</li> </ul> </li> <li>\u4e30\u5bcc\u7684\u5206\u6790\u5de5\u5177:<ul> <li>PerformanceMetrics:<ul> <li>\u6536\u76ca: Total Return, Annualized Return, Alpha, Win Rate.</li> <li>\u98ce\u9669: Max Drawdown, Sharpe Ratio, Sortino Ratio, Ulcer Index, UPI (Ulcer Performance Index).</li> <li>\u62df\u5408: Equity R\u00b2 (\u7ebf\u6027\u56de\u5f52\u62df\u5408\u5ea6).</li> </ul> </li> <li>TradeAnalyzer: \u5305\u542b\u80dc\u7387\u3001\u76c8\u4e8f\u6bd4\u3001\u6700\u5927\u8fde\u7eed\u76c8\u4e8f\u7b49\u8be6\u7ec6\u4ea4\u6613\u7edf\u8ba1\uff0c\u652f\u6301\u672a\u7ed3\u76c8\u4e8f (Unrealized PnL) \u8ba1\u7b97\u3002</li> </ul> </li> <li>\u4eff\u771f\u589e\u5f3a:<ul> <li>\u6ed1\u70b9\u6a21\u578b (Slippage): \u652f\u6301 Fixed (\u56fa\u5b9a\u91d1\u989d) \u548c Percent (\u767e\u5206\u6bd4) \u6ed1\u70b9\u6a21\u578b\uff0c\u6a21\u62df\u771f\u5b9e\u4ea4\u6613\u6210\u672c\u3002</li> <li>\u6210\u4ea4\u91cf\u9650\u5236 (Volume Limit): \u652f\u6301\u6309 K \u7ebf\u6210\u4ea4\u91cf\u6bd4\u4f8b\u9650\u5236\u5355\u7b14\u64ae\u5408\u6570\u91cf\uff0c\u5e76\u5b9e\u73b0\u5206\u6279\u6210\u4ea4 (Partial Fill)\u3002</li> </ul> </li> </ul>"},{"location":"#akquant_1","title":"\u4e3a\u4ec0\u4e48\u9009\u62e9 AKQuant?","text":"<p>AKQuant \u65e8\u5728\u89e3\u51b3\u4f20\u7edf Python \u56de\u6d4b\u6846\u67b6\uff08\u5982 Backtrader\uff09\u6027\u80fd\u4e0d\u8db3\u548c\u7eaf C++/Rust \u6846\u67b6\u5f00\u53d1\u95e8\u69db\u8fc7\u9ad8\u7684\u95ee\u9898\u3002\u6211\u4eec\u901a\u8fc7\u6df7\u5408\u67b6\u6784\u5728\u4e94\u4e2a\u6838\u5fc3\u7ef4\u5ea6\u5b9e\u73b0\u4e86\u7a81\u7834\uff1a</p>"},{"location":"#1-rust-python","title":"1. \u6781\u81f4\u6027\u80fd\uff1aRust \u6838\u5fc3 + Python \u751f\u6001","text":"<ul> <li>\u6df7\u5408\u67b6\u6784: \u6838\u5fc3\u8ba1\u7b97\u5c42\uff08\u64ae\u5408\u3001\u8d44\u91d1\u3001\u98ce\u63a7\uff09\u91c7\u7528 Rust \u7f16\u5199\uff0c\u901a\u8fc7 PyO3 \u66b4\u9732\u7ed9 Python\u3002</li> <li>Zero-Copy Access: \u5229\u7528 Rust \u7684 <code>arrow</code> \u548c <code>numpy</code> \u89c6\u56fe\u6280\u672f\uff0cPython \u7aef\u8bbf\u95ee\u5386\u53f2\u6570\u636e\uff08OHLCV\u3001\u6307\u6807\uff09\u5b9e\u73b0 \u96f6\u62f7\u8d1d\uff0c\u907f\u514d\u4e86\u5927\u91cf\u5185\u5b58\u590d\u5236\u5f00\u9500\u3002</li> <li>\u57fa\u51c6\u6d4b\u8bd5: \u5728 200k K\u7ebf SMA \u7b56\u7565\u6d4b\u8bd5\u4e2d\uff0c\u8017\u65f6\u4ec5 1.31s (\u541e\u5410\u91cf ~152k bars/sec)\uff0c\u6bd4 Backtrader \u5feb 20\u500d\u3002</li> <li>\u589e\u91cf\u8ba1\u7b97: \u5185\u90e8\u6307\u6807\u8ba1\u7b97\u91c7\u7528\u589e\u91cf\u66f4\u65b0\u7b97\u6cd5\uff0c\u800c\u975e\u5168\u91cf\u91cd\u7b97\uff0c\u9002\u5408\u8d85\u957f\u5386\u53f2\u56de\u6d4b\u3002</li> </ul>"},{"location":"#2-machine-learning-first","title":"2. \u539f\u751f\u652f\u6301\u673a\u5668\u5b66\u4e60 (Machine Learning First)","text":"<ul> <li>\u5185\u7f6e\u8bad\u7ec3\u6846\u67b6: \u4e0d\u540c\u4e8e\u4f20\u7edf\u6846\u67b6\u4ec5\u652f\u6301\u7b80\u5355\u7684\u6280\u672f\u6307\u6807\uff0cAKQuant \u5185\u7f6e\u4e86\u5b8c\u6574\u7684 ML Pipeline\u3002</li> <li>Walk-forward Validation: \u539f\u751f\u652f\u6301\u6eda\u52a8\u7a97\u53e3\u8bad\u7ec3\uff08Walk-forward\uff09\uff0c\u6709\u6548\u9632\u6b62\u672a\u6765\u51fd\u6570\u548c\u8fc7\u62df\u5408\u3002</li> <li>Adapter Pattern: \u63d0\u4f9b\u4e86 Scikit-learn \u548c PyTorch \u7684\u7edf\u4e00\u9002\u914d\u5668 (<code>QuantModel</code>)\uff0c\u53ea\u9700\u51e0\u884c\u4ee3\u7801\u5373\u53ef\u5c06 AI \u6a21\u578b\u63a5\u5165\u7b56\u7565\u3002</li> <li>\u7279\u5f81\u5de5\u7a0b: <code>DataFeed</code> \u652f\u6301\u52a8\u6001\u7279\u5f81\u8ba1\u7b97\uff0c\u65b9\u4fbf\u63a5\u5165 Talib \u6216 Pandas \u8fdb\u884c\u7279\u5f81\u9884\u5904\u7406\u3002</li> </ul>"},{"location":"#3","title":"3. \u7cbe\u786e\u4e14\u7075\u6d3b\u7684\u4e8b\u4ef6\u9a71\u52a8\u5f15\u64ce","text":"<ul> <li>\u7cbe\u786e\u4eff\u771f: \u62e5\u6709\u7cbe\u786e\u7684\u65f6\u95f4\u6d41\u901d\u6a21\u578b\u548c\u8ba2\u5355\u751f\u547d\u5468\u671f\u7ba1\u7406\u3002</li> <li>\u590d\u6742\u8ba2\u5355\u652f\u6301: \u652f\u6301\u5e02\u4ef7\u5355 (Market)\u3001\u9650\u4ef7\u5355 (Limit)\u3001\u6b62\u635f\u5355 (Stop)\u3001\u6b62\u76c8\u5355 (TakeProfit) \u7b49\u591a\u79cd\u8ba2\u5355\u7c7b\u578b\u3002</li> <li>\u591a\u8d44\u4ea7\u6df7\u5408: \u652f\u6301\u80a1\u7968\u3001\u671f\u8d27\u3001ETF \u7b49\u591a\u8d44\u4ea7\u6df7\u5408\u56de\u6d4b\uff0c\u6bcf\u4e2a\u8d44\u4ea7\u53ef\u72ec\u7acb\u914d\u7f6e\u8d39\u7387\u3001\u6ed1\u70b9\u548c\u4ea4\u6613\u65f6\u6bb5\u3002</li> <li>\u76d8\u4e2d\u5b9a\u65f6\u4efb\u52a1: \u652f\u6301 <code>schedule</code> \u6ce8\u518c\u76d8\u4e2d\u5b9a\u65f6\u4e8b\u4ef6\uff08\u5982\uff1a\u6bcf\u5929 14:50 \u5e73\u4ed3\uff09\uff0c\u6bd4\u5355\u7eaf\u7684 <code>on_bar</code> \u66f4\u52a0\u7075\u6d3b\u3002</li> </ul>"},{"location":"#4","title":"4. \u751f\u4ea7\u7ea7\u98ce\u63a7\u4e0e\u5b9e\u76d8\u80fd\u529b","text":"<ul> <li>\u5185\u7f6e\u98ce\u63a7\u5668: \u5f15\u64ce\u5c42\u5185\u7f6e <code>RiskManager</code>\uff0c\u652f\u6301\u8d44\u91d1\u4e0a\u9650\u3001\u6301\u4ed3\u6bd4\u4f8b\u3001\u9ed1\u540d\u5355\u7b49\u786c\u6027\u98ce\u63a7\uff0c\u9632\u6b62\u7b56\u7565\u5931\u63a7\u3002</li> <li>\u65e0\u7f1d\u5b9e\u76d8\u5207\u6362: \u7b56\u7565\u4ee3\u7801\u4e0e\u5b9e\u76d8\u63a5\u53e3\u89e3\u8026\uff0c\u7406\u8bba\u4e0a\u53ea\u9700\u66ff\u6362 <code>Broker</code> \u548c <code>DataFeed</code> \u9002\u914d\u5668\u5373\u53ef\u5207\u6362\u81f3\u5b9e\u76d8\uff08\u5b9e\u76d8\u63a5\u53e3\u5f00\u53d1\u4e2d\uff09\u3002</li> <li>\u6570\u636e\u805a\u5408\u5668: <code>DataFeed</code> \u652f\u6301\u591a\u6570\u636e\u6e90\u805a\u5408\uff0c\u80fd\u591f\u5904\u7406\u4e0d\u540c\u9891\u7387\u7684\u6570\u636e\u5bf9\u9f50\u95ee\u9898\u3002</li> </ul>"},{"location":"#5","title":"5. \u6781\u81f4\u7684\u5f00\u53d1\u8005\u4f53\u9a8c","text":"<ul> <li>LLM \u53cb\u597d: \u4ee3\u7801\u7ed3\u6784\u6e05\u6670\uff0c\u6587\u6863\u8be6\u5c3d\uff0c\u7279\u522b\u4f18\u5316\u4e86\u7c7b\u578b\u63d0\u793a (Type Hints)\uff0c\u65b9\u4fbf Copilot \u6216 GPT \u8f85\u52a9\u7f16\u5199\u7b56\u7565\u3002</li> <li>\u53cc\u98ce\u683c API: \u540c\u65f6\u652f\u6301 \u7c7b (Class-based) \u548c \u51fd\u6570\u5f0f (Zipline-style) \u4e24\u79cd\u7b56\u7565\u7f16\u5199\u98ce\u683c\uff0c\u6ee1\u8db3\u4e0d\u540c\u7528\u6237\u4e60\u60ef\u3002</li> <li>\u4e25\u683c\u7c7b\u578b\u68c0\u67e5: \u6838\u5fc3\u903b\u8f91\u7ecf\u8fc7 Rust \u7f16\u8bd1\u5668\u4e25\u683c\u68c0\u67e5\uff0cPython \u7aef\u901a\u8fc7 <code>mypy</code> \u7c7b\u578b\u68c0\u67e5\uff0c\u6700\u5927\u9650\u5ea6\u51cf\u5c11\u8fd0\u884c\u65f6\u9519\u8bef\u3002</li> </ul>"},{"location":"#_2","title":"\u5b89\u88c5","text":"<p>\u8be6\u7ec6\u5b89\u88c5\u6b65\u9aa4\u8bf7\u53c2\u8003 \u5b89\u88c5\u6307\u5357\u3002</p>"},{"location":"#_3","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"#1-helper","title":"1. \u4f7f\u7528 helper \u5feb\u901f\u56de\u6d4b (\u63a8\u8350)","text":"<p><code>AKQuant</code> \u63d0\u4f9b\u4e86\u4e00\u4e2a\u7c7b\u4f3c Zipline \u7684\u4fbf\u6377\u5165\u53e3 <code>run_backtest</code>\uff0c\u53ef\u4ee5\u5feb\u901f\u8fd0\u884c\u7b56\u7565\u3002</p> <pre><code>import pandas as pd\nimport numpy as np\nfrom akquant import Strategy, run_backtest\n\n# 1. \u51c6\u5907\u6570\u636e (\u793a\u4f8b\u4f7f\u7528\u968f\u673a\u6570\u636e)\n# \u5b9e\u9645\u573a\u666f\u53ef\u4f7f\u7528 pd.read_csv(\"data.csv\")\ndef generate_data():\n    dates = pd.date_range(start=\"2023-01-01\", end=\"2023-12-31\")\n    n = len(dates)\n    price = 100 * np.cumprod(1 + np.random.normal(0.0005, 0.02, n))\n    return pd.DataFrame({\n        \"date\": dates,\n        \"open\": price, \"high\": price * 1.01, \"low\": price * 0.99, \"close\": price,\n        \"volume\": 10000,\n        \"symbol\": \"600000\"\n    })\n\n# 2. \u5b9a\u4e49\u7b56\u7565\nclass MyStrategy(Strategy):\n    def on_bar(self, bar):\n        # \u7b80\u5355\u7684\u7b56\u7565\u903b\u8f91 (\u793a\u4f8b)\n        # \u5b9e\u9645\u56de\u6d4b\u63a8\u8350\u4f7f\u7528 IndicatorSet \u8fdb\u884c\u5411\u91cf\u5316\u8ba1\u7b97\n        position = self.ctx.get_position(bar.symbol)\n        if position == 0:\n            self.buy(symbol=bar.symbol, quantity=100)\n        elif position &gt; 0:\n            self.sell(symbol=bar.symbol, quantity=100)\n\n# 3. \u8fd0\u884c\u56de\u6d4b\ndf = generate_data()\nresult = run_backtest(\n    strategy=MyStrategy,  # \u4f20\u9012\u7c7b\u6216\u5b9e\u4f8b\n    data=df,              # \u663e\u5f0f\u4f20\u5165\u6570\u636e\n    symbol=\"600000\",      # \u6d66\u53d1\u94f6\u884c\n    cash=500_000.0,       # \u521d\u59cb\u8d44\u91d1\n    commission=0.0003     # \u4e07\u4e09\u4f63\u91d1\n)\n\n# 4. \u67e5\u770b\u7ed3\u679c\nprint(f\"Total Return: {result.metrics.total_return_pct:.2f}%\")\nprint(f\"Sharpe Ratio: {result.metrics.sharpe_ratio:.2f}\")\nprint(f\"Max Drawdown: {result.metrics.max_drawdown_pct:.2f}%\")\n\n# 5. \u83b7\u53d6\u8be6\u7ec6\u6570\u636e (DataFrame)\n# \u7ee9\u6548\u6307\u6807\u8868\nprint(result.metrics_df)\n# \u4ea4\u6613\u8bb0\u5f55\u8868\nprint(result.trades_df)\n# \u6bcf\u65e5\u6301\u4ed3\u8868\nprint(result.daily_positions_df)\n</code></pre>"},{"location":"#2-api-zipline","title":"2. \u51fd\u6570\u5f0f API (Zipline \u98ce\u683c)","text":"<p>\u5982\u679c\u4f60\u4e60\u60ef Zipline \u6216 Backtrader \u7684\u51fd\u6570\u5f0f\u5199\u6cd5\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\uff1a</p> <pre><code>from akquant.backtest import run_backtest\n\ndef initialize(ctx):\n    ctx.stop_loss_pct = 0.05\n\ndef on_bar(ctx, bar):\n    position = ctx.get_position(bar.symbol)\n    if position == 0:\n        ctx.buy(symbol=bar.symbol, quantity=100)\n    elif position &gt; 0:\n        ctx.sell(symbol=bar.symbol, quantity=100)\n\nrun_backtest(\n    strategy=on_bar,\n    initialize=initialize,\n    data=df, # \u4f7f\u7528\u4e0a\u6587\u751f\u6210\u7684\u6570\u636e\n    symbol=\"600000\"\n)\n</code></pre>"},{"location":"#3-custom-factors","title":"3. \u4f7f\u7528\u81ea\u5b9a\u4e49\u56e0\u5b50\u6570\u636e (Custom Factors)","text":"<p>AKQuant \u652f\u6301\u5728 <code>DataFrame</code> \u4e2d\u4f20\u5165\u4efb\u610f\u6570\u91cf\u7684\u81ea\u5b9a\u4e49\u6570\u503c\u5b57\u6bb5\uff08\u5982\u56e0\u5b50\u3001\u4fe1\u53f7\u7b49\uff09\uff0c\u5e76\u5728 <code>on_bar</code> \u4e2d\u901a\u8fc7 <code>bar.extra</code> \u5b57\u5178\u8bbf\u95ee\u3002</p> <pre><code>import pandas as pd\nimport numpy as np\nfrom akquant import Strategy, run_backtest\n\n# 1. \u51c6\u5907\u6570\u636e\ndef generate_data():\n    dates = pd.date_range(start=\"2023-01-01\", end=\"2023-12-31\")\n    n = len(dates)\n    price = 100 * np.cumprod(1 + np.random.normal(0.0005, 0.02, n))\n    return pd.DataFrame({\n        \"date\": dates,\n        \"open\": price, \"high\": price * 1.01, \"low\": price * 0.99, \"close\": price,\n        \"volume\": 10000,\n        \"symbol\": \"600000\"\n    })\n\ndf = generate_data()\n\n# 2. \u589e\u52a0\u81ea\u5b9a\u4e49\u56e0\u5b50 (\u5fc5\u987b\u662f\u6570\u503c\u7c7b\u578b)\ndf[\"momentum\"] = df[\"close\"] / df[\"open\"]       # \u56e0\u5b50 1\ndf[\"volatility\"] = df[\"high\"] - df[\"low\"]       # \u56e0\u5b50 2\ndf[\"sentiment_score\"] = np.random.rand(len(df)) # \u56e0\u5b50 3\n\n# 3. \u5728\u7b56\u7565\u4e2d\u540c\u65f6\u8bbf\u95ee\u8fd9\u4e9b\u5b57\u6bb5\nclass MyStrategy(Strategy):\n    def on_bar(self, bar):\n        # \u901a\u8fc7\u952e\u540d\u8bbf\u95ee (\u8fd4\u56de float \u7c7b\u578b)\n        mom = bar.extra.get(\"momentum\", 0.0)\n        vol = bar.extra.get(\"volatility\", 0.0)\n        score = bar.extra.get(\"sentiment_score\", 0.0)\n\n        # \u7efc\u5408\u5224\u65ad\n        if mom &gt; 1.02 and score &gt; 0.8:\n            self.buy(bar.symbol, 100)\n\n# 4. \u8fd0\u884c\u56de\u6d4b\nrun_backtest(strategy=MyStrategy, data=df, symbol=\"600000\")\n</code></pre> <p>\u66f4\u591a\u793a\u4f8b\u8bf7\u53c2\u8003 <code>examples/</code> \u76ee\u5f55\u3002</p>"},{"location":"#_4","title":"\u5feb\u901f\u94fe\u63a5","text":""},{"location":"api/","title":"API \u53c2\u8003","text":"<p>\u672c API \u6587\u6863\u6db5\u76d6\u4e86 AKQuant \u7684\u6838\u5fc3\u7c7b\u548c\u65b9\u6cd5\u3002</p>"},{"location":"api/#1-high-level-api","title":"1. \u9ad8\u7ea7\u5165\u53e3 (High-Level API)","text":""},{"location":"api/#akquantrun_backtest","title":"<code>akquant.run_backtest</code>","text":"<p>\u6700\u5e38\u7528\u7684\u56de\u6d4b\u5165\u53e3\u51fd\u6570\uff0c\u5c01\u88c5\u4e86\u5f15\u64ce\u7684\u521d\u59cb\u5316\u548c\u914d\u7f6e\u8fc7\u7a0b\u3002</p> <pre><code>def run_backtest(\n    data: Optional[Union[pd.DataFrame, Dict[str, pd.DataFrame], List[Bar]]] = None,\n    strategy: Union[Type[Strategy], Strategy, Callable[[Any, Bar], None], None] = None,\n    symbol: Union[str, List[str]] = \"BENCHMARK\",\n    cash: float = 1_000_000.0,\n    commission: float = 0.0003,\n    instruments_config: Optional[Union[List[InstrumentConfig], Dict[str, InstrumentConfig]]] = None,\n    warmup_period: int = 0,\n    # ... \u5176\u4ed6\u53c2\u6570\n) -&gt; BacktestResult\n</code></pre> <p>\u5173\u952e\u53c2\u6570:</p> <ul> <li><code>data</code>: \u56de\u6d4b\u6570\u636e\u3002\u652f\u6301\u5355\u4e2a DataFrame\uff0c\u6216 <code>{symbol: DataFrame}</code> \u5b57\u5178\u3002</li> <li><code>warmup_period</code>: (\u65b0\u589e) \u7b56\u7565\u9884\u70ed\u671f\u3002\u6307\u5b9a\u9700\u8981\u9884\u52a0\u8f7d\u7684\u5386\u53f2\u6570\u636e\u957f\u5ea6\uff08Bar \u6570\u91cf\uff09\uff0c\u7528\u4e8e\u8ba1\u7b97\u6307\u6807\u3002</li> <li><code>instruments_config</code>: (\u65b0\u589e) \u6807\u7684\u914d\u7f6e\u3002\u7528\u4e8e\u8bbe\u7f6e\u671f\u8d27/\u671f\u6743\u7b49\u975e\u80a1\u7968\u8d44\u4ea7\u7684\u53c2\u6570\uff08\u5982\u4e58\u6570\u3001\u4fdd\u8bc1\u91d1\uff09\u3002<ul> <li>\u63a5\u6536 <code>List[InstrumentConfig]</code> \u6216 <code>{symbol: InstrumentConfig}</code>\u3002</li> </ul> </li> </ul>"},{"location":"api/#akquantinstrumentconfig","title":"<code>akquant.InstrumentConfig</code>","text":"<p>\u7528\u4e8e\u914d\u7f6e\u5355\u4e2a\u6807\u7684\u5c5e\u6027\u7684\u6570\u636e\u7c7b\u3002</p> <pre><code>@dataclass\nclass InstrumentConfig:\n    symbol: str\n    asset_type: str = \"STOCK\"  # \"STOCK\", \"FUTURES\", \"FUND\", \"OPTION\"\n    multiplier: float = 1.0    # \u5408\u7ea6\u4e58\u6570\n    margin_ratio: float = 1.0  # \u4fdd\u8bc1\u91d1\u7387 (0.1 \u8868\u793a 10% \u4fdd\u8bc1\u91d1)\n    tick_size: float = 0.01    # \u6700\u5c0f\u53d8\u52a8\u4ef7\u4f4d\n    lot_size: int = 1          # \u6700\u5c0f\u4ea4\u6613\u5355\u4f4d\n</code></pre>"},{"location":"api/#2-core","title":"2. \u6838\u5fc3\u5f15\u64ce (Core)","text":""},{"location":"api/#akquantengine","title":"<code>akquant.Engine</code>","text":"<p>\u56de\u6d4b\u5f15\u64ce\u7684\u4e3b\u5165\u53e3\u3002</p> <pre><code>engine = akquant.Engine()\n</code></pre> <p>\u914d\u7f6e\u65b9\u6cd5:</p> <ul> <li><code>set_timezone(offset: int)</code>: \u8bbe\u7f6e\u65f6\u533a\u504f\u79fb (\u79d2)\u3002\u4f8b\u5982 UTC+8 \u4e3a 28800\u3002</li> <li><code>use_simulated_execution()</code>: (\u9ed8\u8ba4) \u542f\u7528\u5185\u5b58\u64ae\u5408\u6a21\u62df\u6267\u884c\u3002</li> <li><code>use_realtime_execution()</code>: \u542f\u7528\u5b9e\u76d8/\u4eff\u771f\u6267\u884c (\u8ba2\u5355\u53d1\u9001\u81f3\u5916\u90e8 Broker)\u3002</li> <li><code>set_execution_mode(mode: ExecutionMode)</code>: \u8bbe\u7f6e\u64ae\u5408\u6a21\u5f0f\u3002<ul> <li><code>ExecutionMode.NextOpen</code>: \u4e0b\u4e00 Bar \u5f00\u76d8\u4ef7\u64ae\u5408 (\u9ed8\u8ba4)\u3002</li> <li><code>ExecutionMode.CurrentClose</code>: \u5f53\u524d Bar \u6536\u76d8\u4ef7\u64ae\u5408\u3002</li> </ul> </li> <li><code>set_history_depth(depth: int)</code>: \u8bbe\u7f6e\u5f15\u64ce\u5c42\u9762\u7684\u5386\u53f2\u6570\u636e\u7f13\u5b58\u957f\u5ea6\u3002</li> </ul> <p>\u5e02\u573a\u4e0e\u8d39\u7387\u914d\u7f6e:</p> <ul> <li><code>use_simple_market(commission_rate: float)</code>: \u542f\u7528\u7b80\u5355\u5e02\u573a (T+0, 7x24, \u65e0\u7a0e)\u3002</li> <li><code>use_china_market()</code>: \u542f\u7528\u4e2d\u56fd\u5e02\u573a (T+1/T+0, \u4ea4\u6613\u65f6\u6bb5, \u7a0e\u8d39)\u3002</li> <li><code>use_china_futures_market()</code>: \u542f\u7528\u4e2d\u56fd\u671f\u8d27\u5e02\u573a (T+0, \u9700\u624b\u52a8\u914d\u7f6e\u65f6\u6bb5)\u3002</li> <li><code>set_t_plus_one(enabled: bool)</code>: \u5f00\u542f/\u5173\u95ed T+1 \u89c4\u5219 (\u4ec5\u9650 ChinaMarket)\u3002</li> <li><code>set_stock_fee_rules(commission_rate, stamp_tax, transfer_fee, min_commission)</code>: \u8bbe\u7f6e\u80a1\u7968\u8d39\u7387\u3002</li> <li><code>set_slippage(type: str, value: float)</code>: \u8bbe\u7f6e\u6ed1\u70b9\u3002<code>type</code> \u53ef\u4e3a <code>\"fixed\"</code> (\u56fa\u5b9a\u91d1\u989d) \u6216 <code>\"percent\"</code> (\u767e\u5206\u6bd4)\u3002</li> </ul> <p>\u8fd0\u884c\u65b9\u6cd5:</p> <ul> <li><code>add_instrument(instrument: Instrument)</code>: \u6dfb\u52a0\u5408\u7ea6\u5b9a\u4e49\u3002</li> <li><code>add_data(feed: DataFeed)</code>: \u6dfb\u52a0\u6570\u636e\u6e90\u3002</li> <li><code>add_bars(bars: List[Bar])</code>: \u6279\u91cf\u6dfb\u52a0 Bar \u6570\u636e\u3002</li> <li><code>run(strategy: Strategy, show_progress: bool) -&gt; str</code>: \u8fd0\u884c\u56de\u6d4b\u3002</li> <li><code>get_results() -&gt; BacktestResult</code>: \u83b7\u53d6\u8be6\u7ec6\u56de\u6d4b\u7ed3\u679c\u3002</li> </ul>"},{"location":"api/#akquantdatafeed","title":"<code>akquant.DataFeed</code>","text":"<p>\u6570\u636e\u5bb9\u5668\u3002</p> <ul> <li><code>add_bars(bars: List[Bar])</code>: \u6dfb\u52a0\u6570\u636e\u3002</li> <li><code>sort()</code>: \u6309\u65f6\u95f4\u6233\u6392\u5e8f\u6570\u636e\u3002</li> </ul>"},{"location":"api/#akquantbaraggregator","title":"<code>akquant.BarAggregator</code>","text":"<p>\u5b9e\u65f6 Tick \u805a\u5408\u5668\uff0c\u7528\u4e8e\u5c06 Tick \u6d41\u8f6c\u6362\u4e3a Bar \u6570\u636e\u5e76\u81ea\u52a8\u6ce8\u5165 DataFeed\u3002</p> <pre><code>aggregator = akquant.BarAggregator(feed: DataFeed, interval_min: int = 1)\n</code></pre> <p>\u65b9\u6cd5:</p> <ul> <li><code>on_tick(symbol: str, price: float, volume: float, timestamp_ns: int)</code>: \u5904\u7406\u65b0\u7684 Tick \u6570\u636e\u3002<ul> <li><code>volume</code>: \u8fd9\u91cc\u7684 volume \u5e94\u8be5\u662f\u7d2f\u8ba1\u6210\u4ea4\u91cf (TotalVolume)\uff0c\u805a\u5408\u5668\u4f1a\u81ea\u52a8\u8ba1\u7b97\u589e\u91cf\u3002</li> </ul> </li> </ul>"},{"location":"api/#2-strategy","title":"2. \u7b56\u7565\u5f00\u53d1 (Strategy)","text":""},{"location":"api/#akquantstrategy","title":"<code>akquant.Strategy</code>","text":"<p>\u7b56\u7565\u57fa\u7c7b\u3002\u7528\u6237\u5e94\u7ee7\u627f\u6b64\u7c7b\u5e76\u91cd\u5199\u56de\u8c03\u65b9\u6cd5\u3002</p> <p>\u56de\u8c03\u65b9\u6cd5:</p> <ul> <li><code>on_start()</code>: \u7b56\u7565\u542f\u52a8\u65f6\u89e6\u53d1\u3002\u7528\u4e8e\u8ba2\u9605 (<code>subscribe</code>) \u548c\u6ce8\u518c\u6307\u6807\u3002</li> <li><code>on_bar(bar: Bar)</code>: K \u7ebf\u95ed\u5408\u65f6\u89e6\u53d1\u3002</li> <li><code>on_tick(tick: Tick)</code>: Tick \u5230\u8fbe\u65f6\u89e6\u53d1\u3002</li> <li><code>on_timer(payload: str)</code>: \u5b9a\u65f6\u5668\u89e6\u53d1\u3002</li> </ul> <p>\u4ea4\u6613\u65b9\u6cd5:</p> <ul> <li><code>buy(symbol, quantity, price=None, ...)</code>: \u4e70\u5165\u3002\u4e0d\u6307\u5b9a <code>price</code> \u5219\u4e3a\u5e02\u4ef7\u5355\u3002</li> <li><code>sell(symbol, quantity, price=None, ...)</code>: \u5356\u51fa\u3002</li> <li><code>short(symbol, quantity, price=None, ...)</code>: \u5356\u7a7a\u3002</li> <li><code>cover(symbol, quantity, price=None, ...)</code>: \u5e73\u7a7a\u3002</li> <li><code>stop_buy(symbol, trigger_price, quantity, ...)</code>: \u6b62\u635f\u4e70\u5165\u3002</li> <li><code>stop_sell(symbol, trigger_price, quantity, ...)</code>: \u6b62\u635f\u5356\u51fa\u3002</li> <li><code>order_target_value(target_value, symbol, price=None)</code>: \u8c03\u6574\u81f3\u76ee\u6807\u6301\u4ed3\u5e02\u503c\u3002</li> <li><code>order_target_percent(target_percent, symbol, price=None)</code>: \u8c03\u6574\u81f3\u76ee\u6807\u8d26\u6237\u5360\u6bd4\u3002</li> <li><code>close_position(symbol)</code>: \u5e73\u4ed3\u6307\u5b9a\u6807\u7684\u3002</li> <li><code>cancel_all_orders(symbol)</code>: \u53d6\u6d88\u6307\u5b9a\u6807\u7684\u7684\u6240\u6709\u6302\u5355\u3002</li> </ul> <p>\u6570\u636e\u8bbf\u95ee:</p> <ul> <li><code>get_history(count, symbol, field=\"close\") -&gt; np.ndarray</code>: \u83b7\u53d6\u5386\u53f2\u6570\u636e\u6570\u7ec4 (Zero-Copy)\u3002</li> <li><code>get_position(symbol) -&gt; float</code>: \u83b7\u53d6\u5f53\u524d\u6301\u4ed3\u91cf\u3002</li> <li><code>get_cash() -&gt; float</code>: \u83b7\u53d6\u5f53\u524d\u53ef\u7528\u8d44\u91d1\u3002</li> <li><code>subscribe(instrument_id: str)</code>: \u8ba2\u9605\u884c\u60c5\u3002</li> </ul>"},{"location":"api/#akquantbar","title":"<code>akquant.Bar</code>","text":"<p>K \u7ebf\u6570\u636e\u5bf9\u8c61\u3002</p> <ul> <li><code>timestamp</code>: Unix \u65f6\u95f4\u6233 (\u7eb3\u79d2)\u3002</li> <li><code>open</code>, <code>high</code>, <code>low</code>, <code>close</code>, <code>volume</code>: OHLCV \u6570\u636e\u3002</li> <li><code>symbol</code>: \u6807\u7684\u4ee3\u7801\u3002</li> </ul>"},{"location":"api/#3-trading-objects","title":"3. \u4ea4\u6613\u5bf9\u8c61 (Trading Objects)","text":""},{"location":"api/#akquantorder","title":"<code>akquant.Order</code>","text":"<p>\u8ba2\u5355\u5bf9\u8c61\u3002</p> <ul> <li><code>id</code>: \u8ba2\u5355 ID\u3002</li> <li><code>symbol</code>: \u6807\u7684\u4ee3\u7801\u3002</li> <li><code>side</code>: <code>OrderSide.Buy</code> \u6216 <code>OrderSide.Sell</code>\u3002</li> <li><code>order_type</code>: <code>OrderType.Market</code>, <code>OrderType.Limit</code>, <code>OrderType.StopMarket</code> \u7b49\u3002</li> <li><code>status</code>: <code>OrderStatus.New</code>, <code>Submitted</code>, <code>Filled</code>, <code>Cancelled</code>, <code>Rejected</code> \u7b49\u3002</li> <li><code>quantity</code>: \u59d4\u6258\u6570\u91cf\u3002</li> <li><code>filled_quantity</code>: \u5df2\u6210\u4ea4\u6570\u91cf\u3002</li> <li><code>average_filled_price</code>: \u6210\u4ea4\u5747\u4ef7\u3002</li> </ul>"},{"location":"api/#akquantinstrument","title":"<code>akquant.Instrument</code>","text":"<p>\u5408\u7ea6\u5b9a\u4e49\u3002</p> <pre><code>Instrument(\n    symbol=\"AAPL\",\n    asset_type=AssetType.Stock,\n    multiplier=1.0,\n    margin_ratio=1.0,\n    tick_size=0.01\n)\n</code></pre>"},{"location":"api/#4-portfolio-risk","title":"4. \u6295\u8d44\u7ec4\u5408\u4e0e\u98ce\u63a7 (Portfolio &amp; Risk)","text":""},{"location":"api/#akquantportfolio","title":"<code>akquant.Portfolio</code>","text":"<ul> <li><code>cash</code>: \u5f53\u524d\u73b0\u91d1\u3002</li> <li><code>positions</code>: \u6301\u4ed3\u5b57\u5178 <code>{symbol: quantity}</code>\u3002</li> <li><code>available_positions</code>: \u53ef\u7528\u6301\u4ed3 (\u8003\u8651 T+1 \u548c\u51bb\u7ed3)\u3002</li> </ul>"},{"location":"api/#akquantriskconfig","title":"<code>akquant.RiskConfig</code>","text":"<p>\u98ce\u63a7\u914d\u7f6e\u3002</p> <ul> <li><code>active</code>: \u662f\u5426\u542f\u7528\u3002</li> <li><code>max_order_size</code>: \u5355\u7b14\u6700\u5927\u6570\u91cf\u3002</li> <li><code>max_order_value</code>: \u5355\u7b14\u6700\u5927\u91d1\u989d\u3002</li> <li><code>max_position_size</code>: \u6700\u5927\u6301\u4ed3\u6570\u91cf\u3002</li> <li><code>restricted_list</code>: \u9650\u5236\u4ea4\u6613\u540d\u5355 (List[str])\u3002</li> </ul>"},{"location":"api/#5-analysis","title":"5. \u7ed3\u679c\u5206\u6790 (Analysis)","text":""},{"location":"api/#akquantbacktestresult","title":"<code>akquant.BacktestResult</code>","text":"<p>\u56de\u6d4b\u7ed3\u679c\u5bb9\u5668\u3002</p> <ul> <li><code>metrics_df</code>: \u5305\u542b\u5404\u9879\u7ee9\u6548\u6307\u6807\u7684 DataFrame (Total Return, Sharpe, Max Drawdown \u7b49)\u3002</li> <li><code>daily_positions_df</code>: \u6bcf\u65e5\u6301\u4ed3 DataFrame\u3002</li> <li><code>trades</code>: \u4ea4\u6613\u8bb0\u5f55\u5217\u8868 (<code>ClosedTrade</code> \u5bf9\u8c61)\u3002</li> <li><code>equity_curve</code>: \u6743\u76ca\u66f2\u7ebf\u6570\u636e\u3002</li> </ul>"},{"location":"api/#6-indicators","title":"6. \u5185\u7f6e\u6307\u6807 (Indicators)","text":"<p>\u4f4d\u4e8e <code>akquant.indicators</code> \u6a21\u5757\u3002</p> <ul> <li><code>SMA(period)</code></li> <li><code>EMA(period)</code></li> <li><code>MACD(fast, slow, signal)</code></li> <li><code>RSI(period)</code></li> <li><code>BollingerBands(period, multiplier)</code></li> <li><code>ATR(period)</code></li> </ul> <p>\u6240\u6709\u6307\u6807\u5747\u6709 <code>value</code> \u5c5e\u6027\u83b7\u53d6\u5f53\u524d\u503c\uff0c\u4e14\u5728\u6ce8\u518c\u5230 Strategy \u540e\u4f1a\u81ea\u52a8\u66f4\u65b0\u3002</p>"},{"location":"api/#7-machine-learning","title":"7. \u673a\u5668\u5b66\u4e60 (Machine Learning)","text":"<p>AKQuant \u63d0\u4f9b\u4e86\u4e13\u95e8\u7684\u673a\u5668\u5b66\u4e60\u652f\u6301\u6a21\u5757 <code>akquant.ml</code>\u3002\u8be6\u7ec6\u4f7f\u7528\u8bf4\u660e\u8bf7\u53c2\u8003 \u673a\u5668\u5b66\u4e60\u6307\u5357\u3002</p>"},{"location":"api/#_1","title":"\u6838\u5fc3\u7c7b","text":"<ul> <li><code>akquant.ml.QuantModel</code>: \u6240\u6709 ML \u6a21\u578b\u7684\u7edf\u4e00\u63a5\u53e3\u3002</li> <li><code>akquant.ml.SklearnAdapter</code>: \u7528\u4e8e\u9002\u914d Scikit-learn \u98ce\u683c\u7684\u6a21\u578b (\u5982 XGBoost, LightGBM)\u3002</li> <li><code>akquant.ml.PyTorchAdapter</code>: \u7528\u4e8e\u9002\u914d PyTorch \u6df1\u5ea6\u5b66\u4e60\u6a21\u578b\u3002</li> </ul> <p>\u4e3b\u8981\u65b9\u6cd5:</p> <ul> <li><code>set_validation(method='walk_forward', verbose=False, ...)</code>: \u914d\u7f6e\u6eda\u52a8\u9a8c\u8bc1/\u8bad\u7ec3\u53c2\u6570\u3002</li> <li><code>predict(X)</code>: \u6267\u884c\u9884\u6d4b\u3002</li> </ul>"},{"location":"architecture/","title":"AKQuant - \u9ad8\u6027\u80fd Rust/Python \u91cf\u5316\u6295\u7814\u6846\u67b6","text":""},{"location":"architecture/#1","title":"1. \u9879\u76ee\u6982\u89c8","text":"<p>AKQuant \u662f\u4e00\u4e2a\u4e13\u4e3a\u9ad8\u6027\u80fd\u56de\u6d4b\u8bbe\u8ba1\u7684\u6df7\u5408\u8bed\u8a00\u91cf\u5316\u6295\u7814\u6846\u67b6\u3002\u5b83\u5229\u7528 Rust \u5904\u7406\u7e41\u91cd\u7684\u8ba1\u7b97\u4efb\u52a1\uff08\u5982\u4e8b\u4ef6\u5faa\u73af\u3001\u6570\u503c\u8ba1\u7b97\u3001\u5185\u5b58\u7ba1\u7406\uff09\uff0c\u5e76\u4f7f\u7528 Python \u8fdb\u884c\u7b56\u7565\u5b9a\u4e49\u3001\u6570\u636e\u5206\u6790\u548c\u53ef\u89c6\u5316\u3002</p>"},{"location":"architecture/#2","title":"2. \u67b6\u6784\u8bbe\u8ba1","text":""},{"location":"architecture/#21","title":"2.1 \u7cfb\u7edf\u5206\u5c42","text":"<ol> <li>Rust \u6838\u5fc3\u5c42 (<code>akquant_core</code>):<ul> <li>\u6570\u636e\u5f15\u64ce: \u4f7f\u7528 <code>polars</code> (Arrow \u683c\u5f0f) \u7ba1\u7406 OHLCV \u6570\u636e\uff0c\u5c3d\u53ef\u80fd\u5b9e\u73b0\u96f6\u62f7\u8d1d\u5185\u5b58\u6620\u5c04\u3002</li> <li>\u56de\u6d4b\u5f15\u64ce: \u4e8b\u4ef6\u9a71\u52a8\u7684\u6267\u884c\u5f15\u64ce\u3002</li> <li>\u4e8b\u4ef6\u603b\u7ebf (Event Bus):<ul> <li>\u53c2\u8003\u6210\u719f\u7684\u4e8b\u4ef6\u9a71\u52a8\u6d88\u606f\u603b\u7ebf\u6982\u5ff5\uff0c\u57fa\u4e8e Rust Channel (<code>mpsc</code>) \u5b9e\u73b0\u3002</li> <li>\u89e3\u8026\u4e86\u7b56\u7565\u3001\u98ce\u63a7\u3001\u6267\u884c\u548c\u6570\u636e\u7ec4\u4ef6\u3002</li> <li>\u652f\u6301 <code>OrderRequest</code> (\u8bf7\u6c42), <code>OrderValidated</code> (\u98ce\u63a7\u901a\u8fc7), <code>ExecutionReport</code> (\u6267\u884c\u62a5\u544a) \u7b49\u4e8b\u4ef6\u7684\u5f02\u6b65\u6d41\u8f6c\u3002</li> <li>\u9ad8\u4f18\u5148\u7ea7\u5904\u7406\u63a7\u5236\u4e8b\u4ef6\uff0c\u652f\u6301\u672a\u6765\u6269\u5c55\u4e3a\u591a\u7b56\u7565\u5e76\u884c\u6216\u5f02\u6b65\u98ce\u63a7\u68c0\u67e5\u3002</li> </ul> </li> <li>\u8ba2\u5355\u64ae\u5408: \u6a21\u62df\u9650\u4ef7\u5355/\u5e02\u4ef7\u5355\u3001\u6ed1\u70b9\u548c\u624b\u7eed\u8d39\u3002</li> <li>\u98ce\u63a7\u6a21\u5757: \u5185\u7f6e <code>RiskManager</code>\uff0c\u652f\u6301\u9884\u4ea4\u6613\u98ce\u63a7\uff08T+1 \u53ef\u7528\u6301\u4ed3\u3001\u8d44\u91d1\u9650\u5236\u7b49\uff09\u3002</li> <li>\u6307\u6807\u8ba1\u7b97: \u5feb\u901f\u8ba1\u7b97\u590f\u666e\u6bd4\u7387\u3001\u6700\u5927\u56de\u64a4\u7b49\u6307\u6807\u3002</li> </ul> </li> <li>\u63a5\u53e3\u5c42 (PyO3):<ul> <li>\u5c06 Rust \u7ed3\u6784\u4f53 (<code>Engine</code>, <code>DataFeed</code>, <code>StrategyContext</code>) \u66b4\u9732\u4e3a Python \u7c7b\u3002</li> <li>\u5904\u7406\u7c7b\u578b\u8f6c\u6362\uff08\u4f8b\u5982\uff1aRust <code>DataFrame</code> &lt;-&gt; Python <code>pandas</code>/<code>polars</code>\uff09\u3002</li> </ul> </li> <li>Python \u7528\u6237\u5c42:<ul> <li>\u7b56\u7565 API: \u7528\u6237\u7ee7\u627f\u7684\u62bd\u8c61\u57fa\u7c7b\u3002</li> <li>\u6570\u636e API: \u8fde\u63a5 Tushare, AKShare, Parquet \u6587\u4ef6\u7684\u6570\u636e\u8fde\u63a5\u5668\u3002</li> <li>\u53ef\u89c6\u5316: \u96c6\u6210 Plotly/Matplotlib\u3002</li> </ul> </li> </ol>"},{"location":"architecture/#22","title":"2.2 \u76ee\u5f55\u7ed3\u6784","text":"<pre><code>akquant/\n\u251c\u2500\u2500 Cargo.toml          # Rust \u4f9d\u8d56\u7ba1\u7406\n\u251c\u2500\u2500 pyproject.toml      # Python \u6784\u5efa\u7cfb\u7edf (maturin)\n\u251c\u2500\u2500 src/                # Rust \u6e90\u4ee3\u7801\n\u2502   \u251c\u2500\u2500 lib.rs          # PyO3 \u5165\u53e3\u70b9\n\u2502   \u251c\u2500\u2500 model/          # \u6570\u636e\u6a21\u578b (Order, Trade, Instrument, Bar \u7b49)\n\u2502   \u251c\u2500\u2500 data.rs         # \u6570\u636e\u6e90 (DataFeed)\n\u2502   \u251c\u2500\u2500 engine.rs       # \u56de\u6d4b\u6838\u5fc3\u5f15\u64ce\n\u2502   \u251c\u2500\u2500 event.rs        # \u4e8b\u4ef6\u5b9a\u4e49\u4e0e\u603b\u7ebf\u6d88\u606f\n\u2502   \u251c\u2500\u2500 clock.rs        # \u4ea4\u6613\u65f6\u949f\n\u2502   \u251c\u2500\u2500 execution.rs    # \u4ea4\u6613\u6240\u6a21\u62df\u4e0e\u8ba2\u5355\u64ae\u5408\n\u2502   \u251c\u2500\u2500 market.rs       # \u5e02\u573a\u89c4\u5219 (\u8d39\u7387\u3001T+1/T+0)\n\u2502   \u251c\u2500\u2500 portfolio.rs    # \u8d44\u91d1\u4e0e\u6301\u4ed3\u7ba1\u7406\n\u2502   \u251c\u2500\u2500 risk.rs         # \u98ce\u63a7\u7ba1\u7406 (RiskManager)\n\u2502   \u251c\u2500\u2500 context.rs      # \u7b56\u7565\u4ea4\u4e92\u4e0a\u4e0b\u6587\n\u2502   \u251c\u2500\u2500 history.rs      # \u5386\u53f2\u6570\u636e\u7ba1\u7406 (Zero-Copy View)\n\u2502   \u251c\u2500\u2500 analysis.rs     # \u7ee9\u6548\u6307\u6807\u8ba1\u7b97\n\u2502   \u2514\u2500\u2500 indicators.rs   # \u9ad8\u6027\u80fd\u6307\u6807\u5b9e\u73b0\n\u251c\u2500\u2500 python/             # Python \u6e90\u4ee3\u7801\n\u2502   \u2514\u2500\u2500 akquant/\n\u2502       \u251c\u2500\u2500 ml/         # \u673a\u5668\u5b66\u4e60\u9002\u914d\u5668\n\u2502       \u251c\u2500\u2500 __init__.py\n\u2502       \u251c\u2500\u2500 akquant.pyi # \u7c7b\u578b\u63d0\u793a\u6587\u4ef6\n\u2502       \u251c\u2500\u2500 backtest.py # \u56de\u6d4b\u5165\u53e3\n\u2502       \u251c\u2500\u2500 strategy.py # \u7b56\u7565\u57fa\u7c7b\n\u2502       \u251c\u2500\u2500 indicator.py# \u6307\u6807\u5305\u88c5\n\u2502       \u251c\u2500\u2500 optimize.py # \u53c2\u6570\u4f18\u5316\n\u2502       \u2514\u2500\u2500 ...         # \u5176\u4ed6\u8f85\u52a9\u6a21\u5757\n\u2514\u2500\u2500 examples/           # \u4f7f\u7528\u793a\u4f8b\n</code></pre>"},{"location":"architecture/#23","title":"2.3 \u6838\u5fc3\u4ea4\u4e92\u6d41\u7a0b (\u4e8b\u4ef6\u603b\u7ebf)","text":"<ol> <li>\u7b56\u7565\u5c42: \u7b56\u7565\u8c03\u7528 <code>self.buy()</code>\uff0c\u5728 Rust \u5c42\u751f\u6210 <code>OrderRequest</code> \u4e8b\u4ef6\u5e76\u53d1\u9001\u5230 <code>event_tx</code> \u901a\u9053\u3002</li> <li>\u5f15\u64ce\u5c42:<ul> <li>\u4e3b\u5faa\u73af\u4f18\u5148\u68c0\u67e5 <code>event_rx</code> \u901a\u9053\u3002</li> <li>\u63a5\u6536\u5230 <code>OrderRequest</code> \u540e\uff0c\u8c03\u7528 \u98ce\u63a7\u6a21\u5757 (<code>RiskManager</code>) \u8fdb\u884c\u68c0\u67e5\u3002</li> <li>\u82e5\u98ce\u63a7\u901a\u8fc7\uff0c\u751f\u6210 <code>OrderValidated</code> \u4e8b\u4ef6\u5e76\u91cd\u65b0\u53d1\u9001\u5230\u901a\u9053\u3002</li> <li>\u82e5\u98ce\u63a7\u62d2\u7edd\uff0c\u751f\u6210\u62d2\u7edd\u72b6\u6001\u7684 <code>ExecutionReport</code> \u5e76\u53d1\u9001\u5230\u901a\u9053\u3002</li> </ul> </li> <li>\u6267\u884c\u5c42:<ul> <li>\u63a5\u6536 <code>OrderValidated</code> \u4e8b\u4ef6\u3002</li> <li>\u6a21\u62df\u6a21\u5f0f: \u7acb\u5373\u64ae\u5408\u6216\u52a0\u5165\u6302\u5355\u5217\u8868\uff0c\u751f\u6210 <code>ExecutionReport</code>\u3002</li> <li>\u5b9e\u76d8\u6a21\u5f0f: \u5c06\u8ba2\u5355\u53d1\u9001\u5230\u5916\u90e8\u7f51\u5173\uff0c\u5e76\u5728\u6536\u5230\u56de\u62a5\u65f6\u751f\u6210 <code>ExecutionReport</code>\u3002</li> </ul> </li> <li>\u7b56\u7565\u5c42: \u7b56\u7565\u901a\u8fc7\u56de\u8c03\u66f4\u65b0\u8ba2\u5355\u72b6\u6001 (<code>pending_orders</code>) \u548c\u6301\u4ed3\u3002</li> </ol>"},{"location":"architecture/#3","title":"3. \u6280\u672f\u6808\u9009\u578b","text":"<ul> <li>Rust:<ul> <li><code>pyo3</code>: \u751f\u6210 Python \u7ed1\u5b9a\u3002</li> <li><code>polars</code> / <code>arrow</code>: \u9ad8\u6027\u80fd\u5217\u5f0f\u6570\u636e\u5b58\u50a8\u3002</li> <li><code>rayon</code>: \u591a\u8d44\u4ea7\u56de\u6d4b\u7684\u5e76\u884c\u5904\u7406\u3002</li> <li><code>serde</code>: \u5e8f\u5217\u5316\u652f\u6301\u3002</li> </ul> </li> <li>Python:<ul> <li><code>maturin</code>: \u6784\u5efa\u540e\u7aef\u3002</li> <li><code>pandas</code> / <code>numpy</code>: \u9762\u5411\u7528\u6237\u7684\u6570\u636e\u5904\u7406\u3002</li> <li><code>plotly</code>: \u4ea4\u4e92\u5f0f\u53ef\u89c6\u5316\u3002</li> </ul> </li> </ul>"},{"location":"architecture/#4","title":"4. \u5f00\u53d1\u8def\u7ebf\u56fe","text":""},{"location":"architecture/#_1","title":"\u7b2c\u4e00\u9636\u6bb5\uff1a\u539f\u578b\u9a8c\u8bc1\uff08\u5f53\u524d\uff09","text":"<ul> <li> \u914d\u7f6e\u9879\u76ee\u6784\u5efa\u7cfb\u7edf (Maturin)\u3002</li> <li> \u5728 Rust \u4e2d\u5b9a\u4e49 <code>Candle</code> (K\u7ebf) \u548c <code>Feed</code> (\u6570\u636e\u6d41) \u7ed3\u6784\u4f53\u3002</li> <li> \u5411 Python \u66b4\u9732\u57fa\u7840\u7684\u6570\u636e\u52a0\u8f7d\u529f\u80fd\u3002</li> <li> \u4ece Rust \u8fd4\u56de Pandas DataFrame\u3002</li> </ul>"},{"location":"architecture/#_2","title":"\u7b2c\u4e8c\u9636\u6bb5\uff1a\u6838\u5fc3\u5f15\u64ce","text":"<ul> <li> \u5728 Rust \u4e2d\u5b9e\u73b0\u4e8b\u4ef6\u5faa\u73af\u3002</li> <li> \u5728 Rust \u4e2d\u521b\u5efa <code>Strategy</code> trait \u5e76\u5c06\u5176\u5c01\u88c5\u4ee5\u4f9b Python \u7ee7\u627f\u3002</li> <li> \u57fa\u7840\u8ba2\u5355\u64ae\u5408\uff08\u5e02\u4ef7\u5355/\u9650\u4ef7\u5355\uff09\u3002</li> </ul>"},{"location":"architecture/#_3","title":"\u7b2c\u4e09\u9636\u6bb5\uff1a\u5206\u6790\u4e0e\u53ef\u89c6\u5316","text":"<ul> <li> \u5b9e\u73b0\u7ee9\u6548\u6307\u6807\u8ba1\u7b97\uff08Rust \u7aef\uff09\u3002</li> <li> \u521b\u5efa\u53ef\u89c6\u5316\u6a21\u5757\uff08Python \u7aef\uff09\u3002</li> </ul>"},{"location":"architecture/#_4","title":"\u7b2c\u56db\u9636\u6bb5\uff1a\u751f\u4ea7\u5c31\u7eea","text":"<ul> <li> \u5bf9\u63a5\u5916\u90e8\u6570\u636e\u6e90 (Tushare/SQL)\u3002</li> <li> \u652f\u6301\u5e76\u884c\u56de\u6d4b\u3002</li> <li> \u5b8c\u5584\u6587\u6863\u3002</li> </ul>"},{"location":"design/","title":"AKQuant \u8bbe\u8ba1\u4e0e\u5f00\u53d1\u6307\u5357","text":"<p>\u672c\u6587\u6863\u8be6\u7ec6\u4ecb\u7ecd\u4e86 <code>AKQuant</code> \u7684\u5185\u90e8\u8bbe\u8ba1\u539f\u7406\u3001\u6838\u5fc3\u7ec4\u4ef6\u67b6\u6784\u4ee5\u53ca\u6269\u5c55\u5f00\u53d1\u6307\u5357\u3002\u65e8\u5728\u5e2e\u52a9\u5f00\u53d1\u8005\u6df1\u5165\u7406\u89e3\u9879\u76ee\u7ed3\u6784\uff0c\u4ee5\u4fbf\u8fdb\u884c\u4e8c\u6b21\u5f00\u53d1\u548c\u529f\u80fd\u6269\u5c55\u3002</p>"},{"location":"design/#1","title":"1. \u9879\u76ee\u6982\u89c8","text":""},{"location":"design/#11","title":"1.1 \u8bbe\u8ba1\u7406\u5ff5","text":"<p><code>AKQuant</code> \u9075\u5faa\u4ee5\u4e0b\u6838\u5fc3\u8bbe\u8ba1\u539f\u5219\uff1a</p> <ol> <li>\u6838\u5fc3\u8ba1\u7b97\u4e0b\u6c89 (Rust Core): \u6240\u6709\u7684\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\uff08\u4e8b\u4ef6\u5faa\u73af\u3001\u8ba2\u5355\u64ae\u5408\u3001\u98ce\u63a7\u68c0\u67e5\u3001\u6570\u636e\u7ba1\u7406\u3001\u7ee9\u6548\u8ba1\u7b97\u3001\u5386\u53f2\u6570\u636e\u7ef4\u62a4\uff09\u90fd\u5728 Rust \u5c42\u5b9e\u73b0\uff0c\u4ee5\u786e\u4fdd\u9ad8\u6027\u80fd\u548c\u5185\u5b58\u5b89\u5168\u3002</li> <li>\u7b56\u7565\u903b\u8f91\u4e0a\u6d6e (Python API): \u7b56\u7565\u7f16\u5199\u3001\u53c2\u6570\u914d\u7f6e\u3001\u6570\u636e\u5206\u6790\u3001\u673a\u5668\u5b66\u4e60\u6a21\u578b\u5b9a\u4e49\u7b49\u7528\u6237\u4ea4\u4e92\u5c42\u4fdd\u7559\u5728 Python \u4e2d\uff0c\u5229\u7528\u5176\u52a8\u6001\u7279\u6027\u548c\u4e30\u5bcc\u7684\u751f\u6001\u7cfb\u7edf (Pandas, Scikit-learn, PyTorch \u7b49)\u3002</li> <li>\u6a21\u5757\u5316\u4e0e\u89e3\u8026 (Modularity): \u501f\u9274\u6210\u719f\u7684\u91cf\u5316\u6846\u67b6\u8bbe\u8ba1\uff0c\u5c06\u6570\u636e\u3001\u6267\u884c\u3001\u7b56\u7565\u3001\u98ce\u63a7\u3001\u673a\u5668\u5b66\u4e60\u7b49\u6a21\u5757\u4e25\u683c\u5206\u79bb\uff0c\u901a\u8fc7\u6e05\u6670\u7684\u63a5\u53e3\uff08Traits\uff09\u4ea4\u4e92\u3002</li> </ol>"},{"location":"design/#12","title":"1.2 \u9879\u76ee\u76ee\u5f55\u7ed3\u6784","text":"<pre><code>akquant/\n\u251c\u2500\u2500 Cargo.toml              # Rust \u9879\u76ee\u4f9d\u8d56\u4e0e\u914d\u7f6e\n\u251c\u2500\u2500 pyproject.toml          # Python \u9879\u76ee\u6784\u5efa\u914d\u7f6e (Maturin)\n\u251c\u2500\u2500 Makefile                # \u9879\u76ee\u7ba1\u7406\u547d\u4ee4\n\u251c\u2500\u2500 src/                    # Rust \u6838\u5fc3\u6e90\u7801 (\u5e95\u5c42\u5b9e\u73b0)\n\u2502   \u251c\u2500\u2500 lib.rs              # PyO3 \u6a21\u5757\u5165\u53e3\uff0c\u6ce8\u518c Python \u6a21\u5757\n\u2502   \u251c\u2500\u2500 engine.rs           # \u56de\u6d4b\u5f15\u64ce\uff1a\u9a71\u52a8\u65f6\u95f4\u8f74\u4e0e\u4e8b\u4ef6\u5faa\u73af\n\u2502   \u251c\u2500\u2500 execution.rs        # \u6267\u884c\u5c42\uff1a\u6a21\u62df\u4ea4\u6613\u6240\u64ae\u5408\u903b\u8f91\n\u2502   \u251c\u2500\u2500 market.rs           # \u5e02\u573a\u5c42\uff1a\u5b9a\u4e49\u4f63\u91d1\u3001\u5370\u82b1\u7a0e\u3001T+1 \u89c4\u5219\n\u2502   \u251c\u2500\u2500 portfolio.rs        # \u8d26\u6237\u5c42\uff1a\u7ba1\u7406\u8d44\u91d1\u3001\u6301\u4ed3\u4e0e\u53ef\u7528\u5934\u5bf8\n\u2502   \u251c\u2500\u2500 data.rs             # \u6570\u636e\u5c42\uff1a\u7ba1\u7406 Bar/Tick \u6570\u636e\u6d41\n\u2502   \u251c\u2500\u2500 analysis.rs         # \u5206\u6790\u5c42\uff1a\u8ba1\u7b97\u7ee9\u6548\u6307\u6807 (Sharpe, Drawdown)\n\u2502   \u251c\u2500\u2500 context.rs          # \u4e0a\u4e0b\u6587\uff1a\u7528\u4e8e Python \u56de\u8c03\u7684\u6570\u636e\u5feb\u7167\n\u2502   \u251c\u2500\u2500 clock.rs            # \u65f6\u949f\u6a21\u5757\uff1a\u7edf\u4e00\u65f6\u95f4\u7ba1\u7406\n\u2502   \u251c\u2500\u2500 event.rs            # \u4e8b\u4ef6\u7cfb\u7edf\uff1a\u5b9a\u4e49\u7cfb\u7edf\u5185\u90e8\u4e8b\u4ef6\n\u2502   \u251c\u2500\u2500 history.rs          # \u5386\u53f2\u6570\u636e\uff1a\u9ad8\u6548\u7684\u73af\u5f62\u7f13\u51b2\u533a\u7ba1\u7406\n\u2502   \u251c\u2500\u2500 indicators.rs       # \u6280\u672f\u6307\u6807\uff1aRust \u539f\u751f\u6307\u6807\u5b9e\u73b0 (\u5982 SMA)\n\u2502   \u2514\u2500\u2500 model/              # \u6570\u636e\u6a21\u578b\uff1a\u5b9a\u4e49\u57fa\u7840\u6570\u636e\u7ed3\u6784\n\u2502       \u251c\u2500\u2500 mod.rs          # \u6a21\u578b\u6a21\u5757\u5b9a\u4e49\n\u2502       \u251c\u2500\u2500 order.rs        # \u8ba2\u5355 (Order) \u4e0e\u6210\u4ea4 (Trade)\n\u2502       \u251c\u2500\u2500 instrument.rs   # \u6807\u7684\u7269\u4fe1\u606f (Instrument)\n\u2502       \u251c\u2500\u2500 market_data.rs  # \u5e02\u573a\u6570\u636e (Bar, Tick)\n\u2502       \u251c\u2500\u2500 timer.rs        # \u5b9a\u65f6\u5668\u4e8b\u4ef6\n\u2502       \u2514\u2500\u2500 types.rs        # \u57fa\u7840\u679a\u4e3e (Side, Type, ExecutionMode)\n\u251c\u2500\u2500 python/\n\u2502   \u2514\u2500\u2500 akquant/            # Python \u5305\u6e90\u7801 (\u7528\u6237\u63a5\u53e3)\n\u2502       \u251c\u2500\u2500 __init__.py     # \u5bfc\u51fa\u516c\u5171 API\n\u2502       \u251c\u2500\u2500 strategy.py     # Strategy \u57fa\u7c7b\uff1a\u5c01\u88c5\u4e0a\u4e0b\u6587\uff0c\u63d0\u4f9b ML \u8bad\u7ec3\u4e0e\u4ea4\u6613\u63a5\u53e3\n\u2502       \u251c\u2500\u2500 backtest.py     # BacktestResult \u5206\u6790\u4e0e DataFrame \u8f6c\u6362\n\u2502       \u251c\u2500\u2500 config.py       # \u914d\u7f6e\u5b9a\u4e49\uff1aBacktestConfig, StrategyConfig, RiskConfig\n\u2502       \u251c\u2500\u2500 risk.py         # \u98ce\u63a7\u914d\u7f6e\u9002\u914d\u5c42\n\u2502       \u251c\u2500\u2500 data.py         # \u6570\u636e\u52a0\u8f7d\u4e0e\u76ee\u5f55\u670d\u52a1 (DataCatalog)\n\u2502       \u251c\u2500\u2500 sizer.py        # Sizer \u57fa\u7c7b\uff1a\u63d0\u4f9b\u591a\u79cd\u4ed3\u4f4d\u7ba1\u7406\u5b9e\u73b0\n\u2502       \u251c\u2500\u2500 indicator.py    # Python \u6307\u6807\u63a5\u53e3\n\u2502       \u251c\u2500\u2500 optimize.py     # \u53c2\u6570\u4f18\u5316\u5de5\u5177\n\u2502       \u251c\u2500\u2500 plot.py         # \u7ed8\u56fe\u5de5\u5177\n\u2502       \u251c\u2500\u2500 log.py          # \u65e5\u5fd7\u6a21\u5757\n\u2502       \u251c\u2500\u2500 utils.py        # \u5de5\u5177\u51fd\u6570\n\u2502       \u251c\u2500\u2500 ml/             # \u673a\u5668\u5b66\u4e60\u6846\u67b6 (New)\n\u2502       \u2502   \u251c\u2500\u2500 __init__.py\n\u2502       \u2502   \u2514\u2500\u2500 model.py    # QuantModel, SklearnAdapter, ValidationConfig\n\u2502       \u2514\u2500\u2500 akquant.pyi     # \u7c7b\u578b\u63d0\u793a\u6587\u4ef6 (IDE \u8865\u5168\u652f\u6301)\n\u251c\u2500\u2500 tests/                  # \u6d4b\u8bd5\u7528\u4f8b\n\u2514\u2500\u2500 examples/               # \u793a\u4f8b\u4ee3\u7801\n    \u251c\u2500\u2500 benchmark_akquant_multi.py  # \u591a\u7ebf\u7a0b Benchmark\n    \u251c\u2500\u2500 ml_framework_demo.py        # ML \u6846\u67b6\u57fa\u7840\u793a\u4f8b\n    \u251c\u2500\u2500 ml_walk_forward_demo.py     # \u6eda\u52a8\u8bad\u7ec3\u793a\u4f8b\n    \u251c\u2500\u2500 optimization_demo.py        # \u53c2\u6570\u4f18\u5316\u793a\u4f8b\n    \u2514\u2500\u2500 plot_demo.py                # \u7ed8\u56fe\u793a\u4f8b\n</code></pre>"},{"location":"design/#2","title":"2. \u6838\u5fc3\u7ec4\u4ef6\u67b6\u6784\u8be6\u89e3","text":""},{"location":"design/#21-srcmodel","title":"2.1 \u6570\u636e\u6a21\u578b\u5c42 (<code>src/model/</code>)","text":"<p>\u4e3a\u4e86\u4fdd\u8bc1\u8de8\u8bed\u8a00\u4ea4\u4e92\u7684\u6027\u80fd\u4e0e\u7c7b\u578b\u5b89\u5168\uff0c\u6838\u5fc3\u6570\u636e\u7ed3\u6784\u5747\u5728 Rust \u4e2d\u5b9a\u4e49\u5e76\u5bfc\u51fa\u3002</p> <ul> <li><code>types.rs</code>:<ul> <li><code>ExecutionMode</code>: <code>CurrentClose</code> (\u5f53\u524d\u6536\u76d8\u4ef7\u6210\u4ea4\uff0c\u5373 Cheat-on-Close) vs <code>NextOpen</code> (\u6b21\u65e5\u5f00\u76d8\u4ef7\u6210\u4ea4\uff0c\u66f4\u771f\u5b9e)\u3002</li> <li><code>OrderSide</code>: <code>Buy</code> / <code>Sell</code>\u3002</li> <li><code>OrderType</code>: <code>Market</code> (\u5e02\u4ef7), <code>Limit</code> (\u9650\u4ef7)\u3002</li> <li><code>TimeInForce</code>: <code>Day</code> (\u5f53\u65e5\u6709\u6548), <code>GTC</code> (\u64a4\u524d\u6709\u6548), <code>IOC</code>/<code>FOK</code>\u3002</li> </ul> </li> <li><code>instrument.rs</code>: <code>Instrument</code> \u5305\u542b <code>multiplier</code> (\u5408\u7ea6\u4e58\u6570) \u548c <code>tick_size</code>\u3002</li> <li><code>market_data.rs</code>: <code>Bar</code> (OHLCV) \u548c <code>Tick</code> (\u6700\u65b0\u4ef7/\u91cf)\u3002</li> </ul>"},{"location":"design/#22-srcexecutionrs","title":"2.2 \u6267\u884c\u5c42 (<code>src/execution.rs</code>)","text":"<p><code>ExchangeSimulator</code> \u662f\u56de\u6d4b\u51c6\u786e\u6027\u7684\u6838\u5fc3\uff0c\u8d1f\u8d23\u6a21\u62df\u4ea4\u6613\u6240\u7684\u64ae\u5408\u903b\u8f91\u3002</p> <ul> <li>\u64ae\u5408\u673a\u5236:<ul> <li>\u9650\u4ef7\u5355 (Limit): \u4e70\u5165\u9700 <code>Low &lt;= Price</code>\uff0c\u5356\u51fa\u9700 <code>High &gt;= Price</code>\u3002</li> <li>\u5e02\u4ef7\u5355 (Market): \u6839\u636e <code>ExecutionMode</code> \u51b3\u5b9a\u6309 <code>Close</code> \u6216 <code>Open</code> \u6210\u4ea4\u3002</li> </ul> </li> <li>\u89e6\u53d1\u673a\u5236: \u652f\u6301 <code>trigger_price</code> (\u6b62\u635f/\u6b62\u76c8\u5355)\u3002</li> </ul>"},{"location":"design/#23-srcmarketrs","title":"2.3 \u5e02\u573a\u89c4\u5219\u5c42 (<code>src/market.rs</code>)","text":"<p>\u901a\u8fc7 <code>MarketModel</code> Trait \u5b9e\u73b0\u4e0d\u540c\u5e02\u573a\u7684\u89c4\u5219\u9694\u79bb\u3002\u76ee\u524d\u5185\u7f6e <code>ChinaMarket</code> (A\u80a1\u5e02\u573a\u89c4\u5219)\uff1a</p> <ul> <li>\u4f63\u91d1\u8ba1\u7b97: \u652f\u6301\u80a1\u7968 (\u5370\u82b1\u7a0e\u3001\u8fc7\u6237\u8d39\u3001\u4f63\u91d1) \u548c\u671f\u8d27 (\u6309\u624b\u6216\u6309\u91d1\u989d)\u3002</li> <li>\u4ea4\u6613\u9650\u5236: \u4e25\u683c\u7684 T+1 (\u80a1\u7968) \u4e0e T+0 (\u671f\u8d27) \u53ef\u7528\u6301\u4ed3\u7ba1\u7406\u3002</li> </ul>"},{"location":"design/#24-srcriskrs","title":"2.4 \u98ce\u63a7\u5c42 (<code>src/risk.rs</code>)","text":"<p><code>RiskManager</code> \u72ec\u7acb\u4e8e\u6267\u884c\u5c42\uff0c\u62e6\u622a\u6bcf\u4e00\u7b14\u8ba2\u5355\uff1a</p> <ul> <li>\u68c0\u67e5\u89c4\u5219: \u9650\u5236\u540d\u5355\u3001\u6700\u5927\u5355\u7b14\u6570\u91cf/\u91d1\u989d\u3001\u6700\u5927\u6301\u4ed3\u6bd4\u4f8b\u3002</li> <li>\u914d\u7f6e: Python \u7aef <code>RiskConfig</code> \u81ea\u52a8\u6ce8\u5165 Rust \u5f15\u64ce\u3002</li> </ul>"},{"location":"design/#25-srcportfoliors","title":"2.5 \u8d26\u6237\u5c42 (<code>src/portfolio.rs</code>)","text":"<p><code>Portfolio</code> \u7ed3\u6784\u4f53\u7ef4\u62a4\u8d26\u6237\u72b6\u6001\uff1a</p> <ul> <li><code>cash</code>: \u53ef\u7528\u8d44\u91d1\u3002</li> <li><code>positions</code>: \u603b\u6301\u4ed3\u3002</li> <li><code>available_positions</code>: \u53ef\u5356\u6301\u4ed3 (T+1 \u903b\u8f91\u7684\u6838\u5fc3)\u3002</li> <li>\u6743\u76ca\u8ba1\u7b97: \u5b9e\u65f6 Mark-to-Market \u8ba1\u7b97\u3002</li> </ul>"},{"location":"design/#26-srcenginers-srchistoryrs","title":"2.6 \u5f15\u64ce\u5c42 (<code>src/engine.rs</code> &amp; <code>src/history.rs</code>)","text":"<p><code>Engine</code> \u662f\u7cfb\u7edf\u7684\u9a71\u52a8\u5668\uff1a</p> <ul> <li>\u4e8b\u4ef6\u5faa\u73af: \u6d88\u8d39 <code>Bar</code> \u6216 <code>Tick</code> \u4e8b\u4ef6\u3002</li> <li>\u5386\u53f2\u6570\u636e\u7ba1\u7406: <code>Engine</code> \u5185\u90e8\u7ef4\u62a4 <code>History</code> \u6a21\u5757\uff0c\u8fd9\u662f\u4e00\u4e2a\u9ad8\u6548\u7684\u73af\u5f62\u7f13\u51b2\u533a\uff0c\u7528\u4e8e\u5b58\u50a8\u6700\u8fd1 N \u4e2a Bar \u7684\u6570\u636e\uff0c\u4f9b\u7b56\u7565\u901a\u8fc7 <code>get_history</code> \u5feb\u901f\u8bbf\u95ee\uff0c\u65e0\u9700\u5728 Python \u7aef\u7d2f\u79ef\u6570\u636e\u3002</li> <li>\u65e5\u5207\u5904\u7406: \u89e6\u53d1 T+1 \u89e3\u9501\u3001\u8fc7\u671f\u8ba2\u5355\u6e05\u7406\u3002</li> </ul>"},{"location":"design/#27-srcanalysisrs","title":"2.7 \u5206\u6790\u5c42 (<code>src/analysis.rs</code>)","text":"<p>\u9075\u5faa\u6807\u51c6 PnL \u8ba1\u7b97\uff1a<code>Gross PnL</code> (\u6bdb\u5229), <code>Net PnL</code> (\u51c0\u5229), <code>Commission</code> (\u4f63\u91d1)\u3002</p>"},{"location":"design/#28-python-pythonakquant","title":"2.8 Python \u62bd\u8c61\u5c42 (<code>python/akquant/</code>)","text":"<ul> <li><code>Strategy</code> (<code>strategy.py</code>):<ul> <li>\u5386\u53f2\u6570\u636e\u8bbf\u95ee:<ul> <li><code>set_history_depth(depth)</code>: \u5f00\u542f Rust \u7aef\u5386\u53f2\u6570\u636e\u8bb0\u5f55\u3002</li> <li><code>get_history(count)</code> / <code>get_history_df(count)</code>: \u83b7\u53d6\u6700\u8fd1 N \u4e2a Bar \u7684 OHLCV \u6570\u636e (Numpy/DataFrame)\u3002</li> </ul> </li> <li>ML \u96c6\u6210:<ul> <li><code>set_rolling_window(train, step)</code>: \u914d\u7f6e\u6eda\u52a8\u8bad\u7ec3\u53c2\u6570\u3002</li> <li><code>on_train_signal(context)</code>: \u5468\u671f\u6027\u89e6\u53d1\u6a21\u578b\u8bad\u7ec3\u3002</li> <li><code>prepare_features(df)</code>: \u7279\u5f81\u5de5\u7a0b\u63a5\u53e3\u3002</li> </ul> </li> </ul> </li> <li><code>BacktestResult</code> (<code>backtest.py</code>):<ul> <li>\u5c01\u88c5 Rust \u8fd4\u56de\u7684 <code>BacktestResult</code>\u3002</li> <li>\u63d0\u4f9b <code>metrics_df</code>, <code>daily_positions_df</code> \u7b49\u4fbf\u6377\u5c5e\u6027\u3002</li> </ul> </li> <li><code>Sizer</code> (<code>sizer.py</code>): \u4ed3\u4f4d\u7ba1\u7406\u57fa\u7c7b\u3002</li> </ul>"},{"location":"design/#29-pythonakquantml","title":"2.9 \u673a\u5668\u5b66\u4e60\u6846\u67b6 (<code>python/akquant/ml/</code>)","text":"<p><code>AKQuant</code> \u63d0\u4f9b\u4e86\u4e00\u5957\u6807\u51c6\u5316\u7684 ML \u63a5\u53e3\uff0c\u65e8\u5728\u7b80\u5316\u201c\u6eda\u52a8\u8bad\u7ec3-\u9884\u6d4b\u201d\u6d41\u7a0b\u3002</p> <ul> <li><code>QuantModel</code> (<code>model.py</code>):<ul> <li>\u6240\u6709\u6a21\u578b\u7684\u62bd\u8c61\u57fa\u7c7b\u3002</li> <li>\u63a5\u53e3: <code>fit(X, y)</code>, <code>predict(X)</code>, <code>save(path)</code>, <code>load(path)</code>\u3002</li> <li><code>set_validation</code>: \u914d\u7f6e Walk-forward Validation \u53c2\u6570 (\u8bad\u7ec3\u7a97\u53e3\u3001\u6d4b\u8bd5\u7a97\u53e3\u3001\u6eda\u52a8\u6b65\u957f)\u3002</li> </ul> </li> <li><code>SklearnAdapter</code>:<ul> <li>\u5c01\u88c5 Scikit-learn \u98ce\u683c\u7684\u6a21\u578b (\u5982 RandomForest, LinearRegression)\uff0c\u4f7f\u5176\u9002\u914d <code>QuantModel</code> \u63a5\u53e3\u3002</li> </ul> </li> <li>\u5de5\u4f5c\u6d41:<ol> <li>\u7528\u6237\u5728\u7b56\u7565\u4e2d\u5b9a\u4e49\u6a21\u578b <code>self.model = SklearnAdapter(RandomForestClassifier())</code>\u3002</li> <li>\u8bbe\u7f6e\u6eda\u52a8\u53c2\u6570 <code>self.set_rolling_window(train_window=250, step=20)</code>\u3002</li> <li>\u91cd\u5199 <code>prepare_features</code> \u5c06\u539f\u59cb OHLCV \u8f6c\u6362\u4e3a\u7279\u5f81 (X) \u548c \u6807\u7b7e (y)\u3002</li> <li>\u56de\u6d4b\u8fc7\u7a0b\u4e2d\uff0c\u5f15\u64ce\u81ea\u52a8\u5728\u6307\u5b9a\u6b65\u957f\u89e6\u53d1 <code>on_train_signal</code>\uff0c\u7b56\u7565\u81ea\u52a8\u83b7\u53d6\u5386\u53f2\u6570\u636e\u5e76\u8bad\u7ec3\u6a21\u578b\u3002</li> <li>\u5728 <code>on_bar</code> \u4e2d\u8c03\u7528 <code>self.model.predict</code> \u751f\u6210\u4fe1\u53f7\u3002</li> </ol> </li> </ul>"},{"location":"design/#3","title":"3. \u5173\u952e\u5de5\u4f5c\u6d41\u8be6\u89e3","text":""},{"location":"design/#31","title":"3.1 \u56de\u6d4b\u4e3b\u5faa\u73af\u4e0e\u6267\u884c\u6a21\u5f0f","text":"<p><code>Engine::run</code> \u7684\u6d41\u7a0b\u4f9d\u8d56 <code>ExecutionMode</code>\uff1a</p> <ul> <li>NextOpen: \u63a8\u8350\u6a21\u5f0f\u3002Bar Close \u751f\u6210\u4fe1\u53f7 -&gt; Next Bar Open \u6210\u4ea4\u3002</li> <li>CurrentClose: \u7b80\u5316\u6a21\u5f0f\u3002Bar Close \u751f\u6210\u4fe1\u53f7 -&gt; Current Bar Close \u6210\u4ea4 (Cheat-on-Close)\u3002</li> </ul>"},{"location":"design/#32","title":"3.2 \u8ba2\u5355\u5168\u751f\u547d\u5468\u671f","text":"<p>Signal -&gt; Creation -&gt; Submission -&gt; Risk Check (Rust) -&gt; Matching (Rust) -&gt; Settlement (Rust) -&gt; Reporting\u3002</p>"},{"location":"design/#4","title":"4. \u6269\u5c55\u5f00\u53d1\u6307\u5357","text":""},{"location":"design/#41","title":"4.1 \u5982\u4f55\u6dfb\u52a0\u65b0\u7684\u8ba2\u5355\u7c7b\u578b","text":"<ol> <li><code>src/model/types.rs</code>: \u6dfb\u52a0\u679a\u4e3e\u3002</li> <li><code>src/model/order.rs</code>: \u66f4\u65b0\u7ed3\u6784\u4f53\u3002</li> <li><code>src/execution.rs</code>: \u5b9e\u73b0\u64ae\u5408\u903b\u8f91\u3002</li> <li><code>akquant.pyi</code>: \u66f4\u65b0\u7c7b\u578b\u63d0\u793a\u3002</li> </ol>"},{"location":"design/#42","title":"4.2 \u5982\u4f55\u81ea\u5b9a\u4e49\u6307\u6807","text":"<ol> <li>Python \u4fa7 (\u5feb\u901f\u539f\u578b): \u7ee7\u627f <code>akquant.Indicator</code>\uff0c\u5728 <code>on_bar</code> \u4e2d\u8ba1\u7b97\u3002</li> <li>Rust \u4fa7 (\u9ad8\u6027\u80fd):<ul> <li>\u5728 <code>src/indicators.rs</code> \u4e2d\u5b9e\u73b0 <code>Indicator</code> Trait\u3002</li> <li>\u901a\u8fc7 <code>#[pyclass]</code> \u5bfc\u51fa\u5230 Python\u3002</li> </ul> </li> </ol>"},{"location":"design/#43","title":"4.3 \u5982\u4f55\u63a5\u5165\u65b0\u7684\u6570\u636e\u6e90","text":"<p>\u5c06\u6570\u636e\u8f6c\u6362\u4e3a pandas DataFrame\uff0c\u6784\u9020 <code>akquant.Bar</code> \u5bf9\u8c61\u5217\u8868\uff0c\u8c03\u7528 <code>engine.add_feed</code> \u5373\u53ef\u3002</p>"},{"location":"design/#5-rust-python","title":"5. Rust \u4e0e Python \u4ea4\u4e92\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>GIL: Rust \u4ec5\u5728\u56de\u8c03 Python \u65f6\u83b7\u53d6 GIL\uff0c\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\u91ca\u653e GIL (\u89c6\u5b9e\u73b0\u800c\u5b9a\uff0c\u76ee\u524d\u4e3b\u8981\u662f\u5355\u7ebf\u7a0b\u6a21\u578b)\u3002</li> <li>\u6570\u636e\u62f7\u8d1d: \u5c3d\u91cf\u51cf\u5c11 Python \u4e0e Rust \u4e4b\u95f4\u7684\u5927\u89c4\u6a21\u6570\u636e\u4f20\u8f93\u3002<code>get_history</code> \u8fd4\u56de\u7684\u662f Numpy \u89c6\u56fe\u6216\u62f7\u8d1d\uff0c\u6548\u7387\u8fdc\u9ad8\u4e8e Python list\u3002</li> </ul>"},{"location":"env_guide/","title":"Python \u73af\u5883\u642d\u5efa\u6307\u5357 (Environment Setup Guide)","text":"<p>\u5de5\u6b32\u5584\u5176\u4e8b\uff0c\u5fc5\u5148\u5229\u5176\u5668\u3002\u5728\u5f00\u59cb\u91cf\u5316\u4ea4\u6613\u4e4b\u524d\uff0c\u4f60\u9700\u8981\u4e00\u4e2a\u5e72\u51c0\u3001\u7a33\u5b9a\u4e14\u72ec\u7acb\u7684 Python \u8fd0\u884c\u73af\u5883\u3002 \u672c\u6307\u5357\u5c06\u63d0\u4f9b\u4e24\u79cd\u4e3b\u6d41\u7684\u73af\u5883\u7ba1\u7406\u65b9\u6848\uff1aMiniconda (\u7ecf\u5178\u7a33\u5b9a) \u548c uv (\u6781\u901f\u73b0\u4ee3)\u3002</p>"},{"location":"env_guide/#miniconda","title":"\u65b9\u6848\u4e00\uff1aMiniconda (\u7ecf\u5178\u63a8\u8350)","text":"<p>Miniconda \u662f Anaconda \u7684\u7cbe\u7b80\u7248\uff0c\u662f\u6570\u636e\u79d1\u5b66\u9886\u57df\u7684\u884c\u4e1a\u6807\u51c6\u3002\u5b83\u80fd\u5e2e\u4f60\u8f7b\u677e\u7ba1\u7406 Python \u7248\u672c\u548c\u5404\u79cd\u4f9d\u8d56\u5305\u3002</p>"},{"location":"env_guide/#1-miniconda","title":"1. \u5b89\u88c5 Miniconda","text":"<p>\u63d0\u793a\uff1a\u56fd\u5185\u7528\u6237\u8bbf\u95ee\u5b98\u7f51\u53ef\u80fd\u8f83\u6162\uff0c\u63a8\u8350\u4f7f\u7528 \u6e05\u534e\u5927\u5b66\u5f00\u6e90\u8f6f\u4ef6\u955c\u50cf\u7ad9 \u4e0b\u8f7d\u5b89\u88c5\u5305\u3002</p> WindowsmacOSLinux <ol> <li>\u8bbf\u95ee Miniconda \u5b98\u7f51 \u6216 \u6e05\u534e\u955c\u50cf\u7ad9\u3002</li> <li>\u4e0b\u8f7d Windows 64-bit \u5b89\u88c5\u5305 (<code>.exe</code>)\u3002</li> <li>\u8fd0\u884c\u5b89\u88c5\u7a0b\u5e8f\uff0c\u5efa\u8bae\u52fe\u9009 \"Add Miniconda3 to my PATH environment variable\" (\u867d\u7136\u63d0\u793a\u4e0d\u63a8\u8350\uff0c\u4f46\u5bf9\u65b0\u624b\u66f4\u65b9\u4fbf)\u3002</li> <li>\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u6253\u5f00 Command Prompt (CMD) \u6216 PowerShell\u3002</li> </ol> <p>\u65b9\u6cd5 A\uff1a\u4f7f\u7528 Homebrew (\u63a8\u8350) \u6253\u5f00\u7ec8\u7aef (Terminal)\uff0c\u8fd0\u884c\uff1a <pre><code>brew install --cask miniconda\ninit conda\n</code></pre></p> <p>\u65b9\u6cd5 B\uff1a\u4f7f\u7528\u5b89\u88c5\u811a\u672c 1.  \u4e0b\u8f7d macOS \u5b89\u88c5\u811a\u672c (M1/M2/M3) \u6216 Intel \u7248\u3002     *   \u6216\u8005\u4ece \u6e05\u534e\u955c\u50cf \u4e0b\u8f7d\u5bf9\u5e94\u7684 <code>.sh</code> \u6587\u4ef6\u3002 2.  \u5728\u7ec8\u7aef\u8fd0\u884c\uff1a<code>bash Miniconda3-latest-MacOSX-arm64.sh</code>\u3002</p> <p>\u6253\u5f00\u7ec8\u7aef\uff0c\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a <pre><code>mkdir -p ~/miniconda3\n\n# \u65b9\u5f0f\u4e00\uff1a\u5b98\u65b9\u6e90\n# wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda3/miniconda.sh\n\n# \u65b9\u5f0f\u4e8c\uff1a\u6e05\u534e\u6e90 (\u63a8\u8350\u56fd\u5185\u7528\u6237)\nwget https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda3/miniconda.sh\n\nbash ~/miniconda3/miniconda.sh -b -u -p ~/miniconda3\nrm -rf ~/miniconda3/miniconda.sh\n~/miniconda3/bin/conda init bash\n</code></pre></p>"},{"location":"env_guide/#15","title":"1.5 \u914d\u7f6e\u56fd\u5185\u955c\u50cf\u6e90 (\u63a8\u8350)","text":"<p>\u56fd\u5185\u7528\u6237\u8bbf\u95ee\u5b98\u65b9\u6e90\u53ef\u80fd\u8f83\u6162\uff0c\u5efa\u8bae\u914d\u7f6e\u6e05\u534e\u5927\u5b66\u955c\u50cf\u6e90\u4ee5\u52a0\u901f\u4e0b\u8f7d\u3002</p> <pre><code># \u914d\u7f6e Conda \u955c\u50cf\u6e90\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/\nconda config --set show_channel_urls yes\n\n# \u914d\u7f6e Pip \u955c\u50cf\u6e90 (\u6c38\u4e45\u751f\u6548)\npip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple\n</code></pre>"},{"location":"env_guide/#2","title":"2. \u521b\u5efa\u865a\u62df\u73af\u5883","text":"<p>\u4e0d\u8981\u76f4\u63a5\u5728\u7cfb\u7edf Python \u4e2d\u5b89\u88c5\u5e93\uff01\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u4e13\u5c5e\u7684\u201c\u6c99\u76d2\u201d\u3002</p> <p>\u6253\u5f00\u7ec8\u7aef\uff08Windows \u7528\u6237\u6253\u5f00 CMD \u6216 Anaconda Prompt\uff09\uff0c\u8f93\u5165\uff1a</p> <pre><code># \u521b\u5efa\u4e00\u4e2a\u540d\u4e3a akquant \u7684\u73af\u5883\uff0c\u6307\u5b9a Python \u7248\u672c\u4e3a 3.10\nconda create -n akquant python=3.10 -y\n\n# \u6fc0\u6d3b\u73af\u5883\nconda activate akquant\n</code></pre> <p>\u6fc0\u6d3b\u6210\u529f\u540e\uff0c\u4f60\u7684\u547d\u4ee4\u884c\u524d\u7f00\u4f1a\u53d8\u6210 <code>(akquant)</code>\uff0c\u8bf4\u660e\u4f60\u5df2\u7ecf\u8fdb\u5165\u4e86\u6c99\u76d2\u3002</p>"},{"location":"env_guide/#uv","title":"\u65b9\u6848\u4e8c\uff1auv (\u6781\u901f\u73b0\u4ee3)","text":"<p>\u5982\u679c\u4f60\u8ffd\u6c42\u6781\u81f4\u7684\u901f\u5ea6\u548c\u8f7b\u91cf\u5316\uff0cuv \u662f\u76ee\u524d Python \u751f\u6001\u4e2d\u6700\u5feb\u7684\u5305\u7ba1\u7406\u5668\uff08\u7531 Rust \u7f16\u5199\uff09\u3002\u5b83\u53ef\u4ee5\u66ff\u4ee3 <code>pip</code> \u548c <code>virtualenv</code>\u3002</p>"},{"location":"env_guide/#1-uv","title":"1. \u5b89\u88c5 uv","text":"WindowsmacOS / Linux <p>\u5728 PowerShell \u4e2d\u8fd0\u884c\uff1a <pre><code>powershell -ExecutionPolicy ByPass -c \"irm https://astral.sh/uv/install.ps1 | iex\"\n</code></pre></p> <p>\u5728\u7ec8\u7aef\u8fd0\u884c\uff1a <pre><code>curl -LsSf https://astral.sh/uv/install.sh | sh\n</code></pre></p>"},{"location":"env_guide/#2_1","title":"2. \u521b\u5efa\u5e76\u7ba1\u7406\u73af\u5883","text":"<p>uv \u4e0d\u9700\u8981\u9884\u5148\u5b89\u88c5 Python\uff0c\u5b83\u4f1a\u81ea\u52a8\u5e2e\u4f60\u4e0b\u8f7d\u3002</p> <pre><code># 1. \u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u9879\u76ee\u76ee\u5f55\nmkdir my_strategy\ncd my_strategy\n\n# 2. \u521d\u59cb\u5316\u865a\u62df\u73af\u5883 (\u6307\u5b9a Python 3.10)\n# uv \u4f1a\u81ea\u52a8\u4e0b\u8f7d Python 3.10 \u5e76\u521b\u5efa .venv \u76ee\u5f55\nuv venv --python 3.10\n\n# 3. \u6fc0\u6d3b\u73af\u5883\n# Windows:\n.venv\\Scripts\\activate\n# macOS / Linux:\nsource .venv/bin/activate\n</code></pre>"},{"location":"env_guide/#3-akquant","title":"3. \u5b89\u88c5 AKQuant \u5e76\u9a8c\u8bc1","text":"<p>\u65e0\u8bba\u4f60\u4f7f\u7528\u4e86 Miniconda \u8fd8\u662f uv\uff0c\u73b0\u5728\u4f60\u90fd\u5e94\u8be5\u5904\u4e8e\u4e00\u4e2a\u6fc0\u6d3b\u7684\u865a\u62df\u73af\u5883\u4e2d\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u5b89\u88c5\u4ea4\u6613\u6846\u67b6\u3002</p>"},{"location":"env_guide/#_1","title":"\u5b89\u88c5","text":"<p>\u5982\u679c\u4f60\u4f7f\u7528 Miniconda: <pre><code># \u5982\u679c\u4e4b\u524d\u672a\u914d\u7f6e\u955c\u50cf\u6e90\uff0c\u53ef\u6dfb\u52a0 -i \u53c2\u6570\u4e34\u65f6\u52a0\u901f\npip install akquant -i https://pypi.tuna.tsinghua.edu.cn/simple\n</code></pre></p> <p>\u5982\u679c\u4f60\u4f7f\u7528 uv: <pre><code># \u4f7f\u7528\u6e05\u534e\u6e90\u52a0\u901f\nuv pip install akquant --index-url https://pypi.tuna.tsinghua.edu.cn/simple\n</code></pre></p>"},{"location":"env_guide/#_2","title":"\u9a8c\u8bc1","text":"<p>\u521b\u5efa\u4e00\u4e2a\u6d4b\u8bd5\u811a\u672c <code>verify.py</code>\uff1a</p> <pre><code>import akquant\nimport pandas as pd\n\nprint(f\"AKQuant Version: {akquant.__version__}\")\nprint(f\"Pandas Version: {pd.__version__}\")\nprint(\"\u73af\u5883\u642d\u5efa\u6210\u529f\uff01\u53ef\u4ee5\u5f00\u59cb\u5199\u7b56\u7565\u4e86\u3002\")\n</code></pre> <p>\u8fd0\u884c\u5b83\uff1a</p> <pre><code>python verify.py\n</code></pre> <p>\u5982\u679c\u770b\u5230\u201c\u73af\u5883\u642d\u5efa\u6210\u529f\u201d\uff0c\u606d\u559c\u4f60\uff0c\u4f60\u7684\u5175\u5668\u5e93\u5df2\u7ecf\u51c6\u5907\u5b8c\u6bd5\uff01 \u4e0b\u4e00\u6b65\uff0c\u8bf7\u524d\u5f80 Python \u91d1\u878d\u5165\u95e8 \u5b66\u4e60\u57fa\u7840\u8bed\u6cd5\uff0c\u6216\u76f4\u63a5\u67e5\u770b \u91cf\u5316\u65b0\u624b\u6307\u5357 \u5f00\u59cb\u5b9e\u6218\u3002</p>"},{"location":"examples/","title":"\u793a\u4f8b\u96c6\u5408","text":""},{"location":"examples/#1-basic-examples","title":"1. \u57fa\u7840\u793a\u4f8b (Basic Examples)","text":"<ul> <li>\u5feb\u901f\u5f00\u59cb (Quickstart): \u5305\u542b\u624b\u52a8\u6570\u636e\u56de\u6d4b\u548c AKShare \u6570\u636e\u56de\u6d4b\u7684\u5b8c\u6574\u6d41\u7a0b\u3002</li> <li>\u7b80\u5355\u7684\u5747\u7ebf\u7b56\u7565 (SMA Strategy): \u5c55\u793a\u4e86\u5982\u4f55\u4f7f\u7528\u7c7b\u98ce\u683c\u7f16\u5199\u7b56\u7565\uff0c\u5e76\u5728 <code>on_bar</code> \u4e2d\u8fdb\u884c\u7b80\u5355\u7684\u4ea4\u6613\u903b\u8f91\u3002</li> </ul>"},{"location":"examples/#2-advanced-examples","title":"2. \u8fdb\u9636\u793a\u4f8b (Advanced Examples)","text":"<ul> <li> <p>Zipline \u98ce\u683c\u7b56\u7565: \u5c55\u793a\u4e86\u5982\u4f55\u4f7f\u7528\u51fd\u6570\u5f0f API (<code>initialize</code>, <code>on_bar</code>) \u7f16\u5199\u7b56\u7565\uff0c\u9002\u5408\u4ece Zipline \u8fc1\u79fb\u7684\u7528\u6237\u3002</p> <ul> <li>\u53c2\u8003 \u7b56\u7565\u6307\u5357\u3002</li> </ul> </li> <li> <p>\u591a\u54c1\u79cd\u56de\u6d4b (Multi-Asset):</p> <ul> <li>\u671f\u8d27\u7b56\u7565: \u5c55\u793a\u671f\u8d27\u56de\u6d4b\u914d\u7f6e\uff08\u4fdd\u8bc1\u91d1\u3001\u4e58\u6570\uff09\u3002\u53c2\u8003 \u7b56\u7565\u6307\u5357\u3002</li> <li>\u671f\u6743\u7b56\u7565: \u5c55\u793a\u671f\u6743\u56de\u6d4b\u914d\u7f6e\uff08\u6743\u5229\u91d1\u3001\u6309\u5f20\u6536\u8d39\uff09\u3002\u53c2\u8003 \u7b56\u7565\u6307\u5357\u3002</li> </ul> </li> <li> <p>\u5411\u91cf\u5316\u6307\u6807 (Vectorized Indicators):</p> <ul> <li>\u5c55\u793a\u5982\u4f55\u4f7f\u7528 <code>IndicatorSet</code> \u9884\u8ba1\u7b97\u6307\u6807\u4ee5\u63d0\u9ad8\u56de\u6d4b\u901f\u5ea6\u3002\u53c2\u8003 \u7b56\u7565\u6307\u5357\u3002</li> </ul> </li> </ul>"},{"location":"examples/#3-common-strategies","title":"3. \u5e38\u7528\u7b56\u7565\u793a\u4f8b (Common Strategies)","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u7528\u91cf\u5316\u7b56\u7565\u7684\u5b9e\u73b0\u4ee3\u7801\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728\u60a8\u7684\u9879\u76ee\u4e2d\u4f7f\u7528\u3002\u6211\u4eec\u4e3a\u6bcf\u4e2a\u7b56\u7565\u63d0\u4f9b\u4e86\u8be6\u7ec6\u7684\u903b\u8f91\u8bf4\u660e\uff0c\u5e2e\u52a9\u60a8\u7406\u89e3\u5176\u6838\u5fc3\u601d\u60f3\u3002</p>"},{"location":"examples/#31-dual-moving-average","title":"3.1 \u53cc\u5747\u7ebf\u7b56\u7565 (Dual Moving Average)","text":"<p>\u6838\u5fc3\u601d\u60f3\uff1a \u53cc\u5747\u7ebf\u7b56\u7565\u5229\u7528\u4e24\u6761\u4e0d\u540c\u5468\u671f\u7684\u79fb\u52a8\u5e73\u5747\u7ebf\uff08SMA\uff09\u6765\u5224\u65ad\u5e02\u573a\u8d8b\u52bf\u3002 *   \u77ed\u671f\u5747\u7ebf\uff08\u5982 5 \u65e5\uff09\uff1a\u53cd\u5e94\u7075\u654f\uff0c\u7d27\u8ddf\u4ef7\u683c\u6ce2\u52a8\u3002 *   \u957f\u671f\u5747\u7ebf\uff08\u5982 20 \u65e5\uff09\uff1a\u53cd\u5e94\u8fdf\u949d\uff0c\u4ee3\u8868\u957f\u671f\u8d8b\u52bf\u3002</p> <p>\u4ea4\u6613\u4fe1\u53f7\uff1a *   \u91d1\u53c9 (Golden Cross)\uff1a\u5f53\u77ed\u671f\u5747\u7ebf \u4e0a\u7a7f \u957f\u671f\u5747\u7ebf\u65f6\uff0c\u8868\u660e\u77ed\u671f\u8d8b\u52bf\u8d70\u5f3a\uff0c\u662f \u4e70\u5165 \u4fe1\u53f7\u3002 *   \u6b7b\u53c9 (Death Cross)\uff1a\u5f53\u77ed\u671f\u5747\u7ebf \u4e0b\u7a7f \u957f\u671f\u5747\u7ebf\u65f6\uff0c\u8868\u660e\u77ed\u671f\u8d8b\u52bf\u8d70\u5f31\uff0c\u662f \u5356\u51fa \u4fe1\u53f7\u3002</p> <p>\u672c\u793a\u4f8b\u4f7f\u7528\u4e86 Rust \u5b9e\u73b0\u7684\u9ad8\u6027\u80fd\u589e\u91cf\u6307\u6807 <code>aq.SMA</code>\uff0c\u8ba1\u7b97\u901f\u5ea6\u6781\u5feb\u3002</p> <pre><code>import akquant as aq\n\nclass DualSMAStrategy(aq.Strategy):\n    def __init__(self, short_window=5, long_window=20):\n        # \u521d\u59cb\u5316\u4e24\u4e2a\u6307\u6807\uff1a\u77ed\u671f SMA \u548c \u957f\u671f SMA\n        # \u4f7f\u7528 Rust \u5b9e\u73b0\u7684\u9ad8\u6027\u80fd\u589e\u91cf SMA \u6307\u6807\n        self.sma_short = aq.SMA(short_window)\n        self.sma_long = aq.SMA(long_window)\n\n    def on_bar(self, bar: aq.Bar):\n        # 1. \u66f4\u65b0\u6307\u6807\u72b6\u6001\n        # update \u65b9\u6cd5\u63a5\u53d7\u5f53\u524d\u6536\u76d8\u4ef7\uff0c\u5e76\u8fd4\u56de\u6700\u65b0\u7684\u5747\u7ebf\u503c\n        short_val = self.sma_short.update(bar.close)\n        long_val = self.sma_long.update(bar.close)\n\n        # 2. \u5982\u679c\u6307\u6807\u6570\u636e\u4e0d\u8db3\uff08\u4f8b\u5982\u521a\u5f00\u59cb\u51e0\u5929\u65e0\u6cd5\u8ba1\u7b97 20 \u65e5\u5747\u7ebf\uff09\uff0c\u5219\u8df3\u8fc7\n        if short_val is None or long_val is None:\n            return\n\n        # \u83b7\u53d6\u5f53\u524d\u6301\u4ed3\u6570\u91cf\n        position = self.get_position(bar.symbol)\n\n        # 3. \u751f\u6210\u4ea4\u6613\u4fe1\u53f7\n\n        # \u91d1\u53c9 (\u77ed\u5747\u7ebf\u4e0a\u7a7f\u957f\u5747\u7ebf) -&gt; \u4e14\u5f53\u524d\u65e0\u6301\u4ed3 -&gt; \u4e70\u5165\n        if short_val &gt; long_val and position == 0:\n            self.buy(bar.symbol, 100)\n\n        # \u6b7b\u53c9 (\u77ed\u5747\u7ebf\u4e0b\u7a7f\u957f\u5747\u7ebf) -&gt; \u4e14\u5f53\u524d\u6301\u6709\u5934\u5bf8 -&gt; \u5356\u51fa\u5e73\u4ed3\n        elif short_val &lt; long_val and position &gt; 0:\n            self.sell(bar.symbol, 100)\n</code></pre>"},{"location":"examples/#32-rsi-rsi-mean-reversion","title":"3.2 RSI \u5747\u503c\u56de\u5f52\u7b56\u7565 (RSI Mean Reversion)","text":"<p>\u6838\u5fc3\u601d\u60f3\uff1a RSI (\u76f8\u5bf9\u5f3a\u5f31\u6307\u6807) \u662f\u4e00\u79cd\u52a8\u91cf\u6307\u6807\uff0c\u6570\u503c\u8303\u56f4\u5728 0 \u5230 100 \u4e4b\u95f4\uff0c\u7528\u4e8e\u8861\u91cf\u8fd1\u671f\u4ef7\u683c\u53d8\u5316\u7684\u5e45\u5ea6\u3002 *   \u5747\u503c\u56de\u5f52 (Mean Reversion)\uff1a\u8be5\u7b56\u7565\u5047\u8bbe\u4ef7\u683c\u4e0d\u4f1a\u4e00\u76f4\u6da8\u6216\u4e00\u76f4\u8dcc\uff0c\u8fc7\u5ea6\u504f\u79bb\u540e\u4f1a\u56de\u5f52\u6b63\u5e38\u6c34\u5e73\u3002 *   \u8d85\u5356 (Oversold)\uff1aRSI \u4f4e\u4e8e\u67d0\u4e2a\u9608\u503c\uff08\u5982 30\uff09\uff0c\u610f\u5473\u7740\u8fd1\u671f\u8dcc\u5e45\u8fc7\u5927\uff0c\u53ef\u80fd\u53cd\u5f39 -&gt; \u4e70\u5165\u3002 *   \u8d85\u4e70 (Overbought)\uff1aRSI \u9ad8\u4e8e\u67d0\u4e2a\u9608\u503c\uff08\u5982 70\uff09\uff0c\u610f\u5473\u7740\u8fd1\u671f\u6da8\u5e45\u8fc7\u5927\uff0c\u53ef\u80fd\u56de\u8c03 -&gt; \u5356\u51fa\u3002</p> <p>\u672c\u793a\u4f8b\u5c55\u793a\u4e86\u5982\u4f55\u5229\u7528 <code>get_history_df</code> \u83b7\u53d6\u5386\u53f2\u6570\u636e\uff0c\u5e76\u7ed3\u5408 <code>pandas</code> \u8ba1\u7b97\u590d\u6742\u6307\u6807\u3002</p> <pre><code>import akquant as aq\nimport pandas as pd\nimport numpy as np\n\nclass RSIStrategy(aq.Strategy):\n    def __init__(self, period=14, buy_threshold=30, sell_threshold=70):\n        self.period = period\n        self.buy_threshold = buy_threshold\n        self.sell_threshold = sell_threshold\n        # \u91cd\u8981\uff1a\u8bbe\u7f6e\u5386\u53f2\u6570\u636e\u56de\u6eaf\u6df1\u5ea6\n        # \u56e0\u4e3a\u8ba1\u7b97 RSI \u9700\u8981\u8fc7\u53bb N \u5929\u7684\u6570\u636e\uff0c\u5fc5\u987b\u9884\u7559\u8db3\u591f\u7684\u5386\u53f2\u7a97\u53e3\n        self.set_history_depth(period + 20)\n\n    def calculate_rsi(self, prices: pd.Series) -&gt; pd.Series:\n        \"\"\"\u4f7f\u7528 pandas \u8ba1\u7b97 RSI \u6307\u6807\"\"\"\n        delta = prices.diff()\n        # \u7b80\u5355\u7684 RSI \u7b97\u6cd5\u5b9e\u73b0\n        gain = (delta.where(delta &gt; 0, 0)).rolling(window=self.period).mean()\n        loss = (-delta.where(delta &lt; 0, 0)).rolling(window=self.period).mean()\n        rs = gain / loss\n        return 100 - (100 / (1 + rs))\n\n    def on_bar(self, bar: aq.Bar):\n        # 1. \u83b7\u53d6\u5386\u53f2\u6536\u76d8\u4ef7 DataFrame\n        # get_history_df \u4f1a\u8fd4\u56de\u8fc7\u53bb N \u6839 Bar \u7684\u6570\u636e\n        history = self.get_history_df(self.period + 20, bar.symbol)\n\n        # \u6570\u636e\u4e0d\u8db3\u65f6\u8fd4\u56de\n        if len(history) &lt; self.period + 1:\n            return\n\n        # 2. \u8ba1\u7b97 RSI\n        rsi_series = self.calculate_rsi(history['close'])\n        current_rsi = rsi_series.iloc[-1] # \u53d6\u6700\u65b0\u7684 RSI \u503c\n\n        if np.isnan(current_rsi):\n            return\n\n        position = self.get_position(bar.symbol)\n\n        # 3. \u4ea4\u6613\u903b\u8f91\n\n        # RSI &lt; 30 (\u8d85\u5356) -&gt; \u9884\u671f\u53cd\u5f39 -&gt; \u4e70\u5165\n        if current_rsi &lt; self.buy_threshold and position == 0:\n            self.buy(bar.symbol, 100)\n\n        # RSI &gt; 70 (\u8d85\u4e70) -&gt; \u9884\u671f\u4e0b\u8dcc -&gt; \u5356\u51fa\n        elif current_rsi &gt; self.sell_threshold and position &gt; 0:\n            self.sell(bar.symbol, 100)\n</code></pre>"},{"location":"examples/#33-bollinger-bands","title":"3.3 \u5e03\u6797\u5e26\u7b56\u7565 (Bollinger Bands)","text":"<p>\u6838\u5fc3\u601d\u60f3\uff1a \u5e03\u6797\u5e26\u7531\u4e09\u6761\u8f68\u9053\u7ebf\u7ec4\u6210\uff1a *   \u4e2d\u8f68\uff1aN \u65e5\u79fb\u52a8\u5e73\u5747\u7ebf\u3002 *   \u4e0a\u8f68\uff1a\u4e2d\u8f68 + K \u500d\u6807\u51c6\u5dee\u3002 *   \u4e0b\u8f68\uff1a\u4e2d\u8f68 - K \u500d\u6807\u51c6\u5dee\u3002</p> <p>\u6839\u636e\u7edf\u8ba1\u5b66\u539f\u7406\uff0c\u4ef7\u683c\u6709\u5f88\u5927\uff08\u5982 95%\uff09\u7684\u6982\u7387\u843d\u5728\u4e0a\u4e0b\u8f68\u4e4b\u95f4\u3002 *   \u5f53\u4ef7\u683c\u8dcc\u7834\u4e0b\u8f68\u65f6\uff0c\u901a\u5e38\u88ab\u89c6\u4e3a\u975e\u7406\u6027\u7684\u8d85\u5356\u72b6\u6001\uff0c\u4ef7\u683c\u53ef\u80fd\u4f1a\u56de\u5f52\u4e2d\u8f68 -&gt; \u4e70\u5165\u3002 *   \u5f53\u4ef7\u683c\u7a81\u7834\u4e0a\u8f68\u65f6\uff0c\u901a\u5e38\u88ab\u89c6\u4e3a\u975e\u7406\u6027\u7684\u8d85\u4e70\u72b6\u6001\uff0c\u4ef7\u683c\u53ef\u80fd\u4f1a\u56de\u8c03 -&gt; \u5356\u51fa\u3002</p> <pre><code>import akquant as aq\nimport pandas as pd\n\nclass BollingerStrategy(aq.Strategy):\n    def __init__(self, window=20, num_std=2):\n        self.window = window\n        self.num_std = num_std\n        # \u8bbe\u7f6e\u5386\u53f2\u6570\u636e\u56de\u6eaf\u6df1\u5ea6\uff0c\u786e\u4fdd\u6709\u8db3\u591f\u6570\u636e\u8ba1\u7b97\u5747\u503c\u548c\u6807\u51c6\u5dee\n        self.set_history_depth(window + 5)\n\n    def on_bar(self, bar: aq.Bar):\n        # 1. \u83b7\u53d6\u5386\u53f2\u6570\u636e\n        history = self.get_history_df(self.window, bar.symbol)\n        if len(history) &lt; self.window:\n            return\n\n        # 2. \u8ba1\u7b97\u5e03\u6797\u5e26\n        close_prices = history['close']\n        ma = close_prices.mean()          # \u4e2d\u8f68 (\u5747\u503c)\n        std = close_prices.std()          # \u6807\u51c6\u5dee\n        upper_band = ma + self.num_std * std # \u4e0a\u8f68\n        lower_band = ma - self.num_std * std # \u4e0b\u8f68\n\n        position = self.get_position(bar.symbol)\n        current_price = bar.close\n\n        # 3. \u4ea4\u6613\u903b\u8f91\n\n        # \u4ef7\u683c\u8dcc\u7834\u4e0b\u8f68 -&gt; \u89c6\u4e3a\u8d85\u5356\u53cd\u8f6c\u4fe1\u53f7 -&gt; \u4e70\u5165\n        if current_price &lt; lower_band and position == 0:\n            self.buy(bar.symbol, 100)\n\n        # \u4ef7\u683c\u7a81\u7834\u4e0a\u8f68 -&gt; \u89c6\u4e3a\u8d85\u4e70\u53cd\u8f6c\u4fe1\u53f7 -&gt; \u5356\u51fa\n        elif current_price &gt; upper_band and position &gt; 0:\n            self.sell(bar.symbol, 100)\n</code></pre>"},{"location":"examples/#mixed-asset","title":"3.4 \u6df7\u5408\u8d44\u4ea7\u56de\u6d4b (Mixed Asset Backtest)","text":"<p>\u6838\u5fc3\u601d\u60f3\uff1a \u5728\u5b9e\u9645\u4ea4\u6613\u4e2d\uff0c\u7b56\u7565\u53ef\u80fd\u540c\u65f6\u6d89\u53ca\u80a1\u7968\u3001\u671f\u8d27\u3001\u671f\u6743\u7b49\u591a\u79cd\u8d44\u4ea7\u3002\u4e0d\u540c\u8d44\u4ea7\u7684\u4ea4\u6613\u5c5e\u6027\u4e0d\u540c\uff1a *   \u80a1\u7968\uff1a\u901a\u5e38 1 \u624b = 100 \u80a1\uff0c\u5168\u989d\u4ea4\u6613\u3002 *   \u671f\u8d27\uff1a\u6709\u5408\u7ea6\u4e58\u6570\uff08\u5982 1 \u70b9 = 300 \u5143\uff09\u548c\u4fdd\u8bc1\u91d1\u6bd4\u4f8b\uff08\u5982 10% \u8d44\u91d1\u5373\u53ef\u4e70\u5165\u5408\u7ea6\uff09\u3002</p> <p>\u672c\u793a\u4f8b\u5c55\u793a\u4e86\u5982\u4f55\u4f7f\u7528 <code>InstrumentConfig</code> \u6765\u914d\u7f6e\u671f\u8d27\u7684\u7279\u6b8a\u5c5e\u6027\uff0c\u5e76\u5728\u540c\u4e00\u4e2a\u7b56\u7565\u4e2d\u6df7\u5408\u4ea4\u6613\u80a1\u7968\u548c\u671f\u8d27\u3002</p> <pre><code>import akquant as aq\nfrom akquant import InstrumentConfig\nimport pandas as pd\nimport numpy as np\n\n# 1. \u51c6\u5907\u6570\u636e (\u6a21\u62df\u6570\u636e)\ndef create_dummy_data(symbol, start_date, n_bars, price=100.0):\n    dates = pd.date_range(start_date, periods=n_bars, freq=\"B\")\n    np.random.seed(42)\n    changes = np.random.randn(n_bars)\n    prices = price + np.cumsum(changes)\n\n    df = pd.DataFrame({\n        \"open\": prices, \"high\": prices + 1, \"low\": prices - 1, \"close\": prices,\n        \"volume\": 1000, \"symbol\": symbol\n    }, index=dates)\n    return df\n\nclass TestStrategy(aq.Strategy):\n    def __init__(self):\n        self.count = 0\n\n    def on_bar(self, bar: aq.Bar):\n        # \u7b80\u5355\u903b\u8f91: \u524d\u4e24\u6839 Bar \u5206\u522b\u4e70\u5165\u80a1\u7968\u548c\u671f\u8d27\n        if self.count &lt; 2:\n            print(f\"[{bar.timestamp}] Buying {bar.symbol}\")\n            self.buy(bar.symbol, 1)\n        self.count += 1\n\n# 2. \u751f\u6210\u6570\u636e\ndf_stock = create_dummy_data(\"STOCK_A\", \"2023-01-01\", 100, 100.0)\ndf_future = create_dummy_data(\"FUTURE_B\", \"2023-01-01\", 100, 3500.0)\ndata = {\"STOCK_A\": df_stock, \"FUTURE_B\": df_future}\n\n# 3. \u914d\u7f6e\u671f\u8d27\u53c2\u6570\n# \u8fd9\u91cc\u544a\u8bc9\u56de\u6d4b\u5f15\u64ce\uff1aFUTURE_B \u662f\u4e00\u4e2a\u671f\u8d27\uff0c\u4e58\u6570 300\uff0c\u4fdd\u8bc1\u91d1 10%\nfuture_config = InstrumentConfig(\n    symbol=\"FUTURE_B\",\n    asset_type=\"FUTURES\",\n    multiplier=300, # \u80a1\u6307\u671f\u8d27\u4e58\u6570\n    margin_ratio=0.1 # 10% \u4fdd\u8bc1\u91d1\n)\n\n# 4. \u8fd0\u884c\nrun_backtest(\n    data=data,\n    strategy=TestStrategy,\n    instruments_config=[future_config]\n)\n</code></pre>"},{"location":"examples/#complex-orders","title":"4. \u590d\u6742\u8ba2\u5355\u4e0e\u98ce\u63a7 (Complex Orders)","text":"<p>\u6838\u5fc3\u601d\u60f3\uff1a \u9ad8\u7ea7\u4ea4\u6613\u901a\u5e38\u9700\u8981\u7cbe\u7ec6\u7684\u8ba2\u5355\u7ba1\u7406\u3002 *   Bracket Order (\u62ec\u53f7\u8ba2\u5355)\uff1a\u8fd9\u662f\u4e00\u79cd\u201c\u8fdb\u573a + \u6b62\u635f + \u6b62\u76c8\u201d\u7684\u7ec4\u5408\u5355\u3002\u5f53\u4f60\u5f00\u4ed3\uff08\u8fdb\u573a\uff09\u540e\uff0c\u7acb\u523b\u4e3a\u8fd9\u7b14\u6301\u4ed3\u8bbe\u7f6e\u201c\u6b62\u635f\u5355\u201d\u548c\u201c\u6b62\u76c8\u5355\u201d\uff0c\u50cf\u62ec\u53f7\u4e00\u6837\u628a\u4ef7\u683c\u5305\u5728\u4e2d\u95f4\u3002 *   OCO (One-Cancels-Other)\uff1a\u6307\u201c\u6b62\u635f\u5355\u201d\u548c\u201c\u6b62\u76c8\u5355\u201d\u4e4b\u95f4\u7684\u5173\u7cfb\u3002\u5982\u679c\u4ef7\u683c\u4e0a\u6da8\u89e6\u53d1\u4e86\u6b62\u76c8\uff0c\u90a3\u4e48\u6b62\u635f\u5355\u5c31\u5e94\u8be5\u81ea\u52a8\u53d6\u6d88\uff08\u56e0\u4e3a\u4ed3\u4f4d\u5df2\u7ecf\u5e73\u4e86\uff0c\u4e0d\u9700\u8981\u518d\u6b62\u635f\u4e86\uff09\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002</p> <p>\u867d\u7136 AKQuant \u7684\u6838\u5fc3\u64ae\u5408\u5f15\u64ce\u5c1a\u672a\u539f\u751f\u5185\u7f6e OCO \u8ba2\u5355\u7c7b\u578b\uff0c\u4f46\u4f60\u53ef\u4ee5\u901a\u8fc7\u7b56\u7565\u5c42\u7684\u56de\u8c03\u51fd\u6570 (<code>on_trade</code>, <code>on_order</code>) \u8f7b\u677e\u5b9e\u73b0\u8fd9\u4e9b\u9ad8\u7ea7\u903b\u8f91\u3002</p>"},{"location":"examples/#41-oco-bracket-order","title":"4.1 OCO \u4e0e Bracket Order \u5b9e\u73b0","text":"<p>\u903b\u8f91\u6d41\u7a0b\uff1a 1.  \u8fdb\u573a\uff1a\u7b56\u7565\u53d1\u51fa\u5f00\u4ed3\u4fe1\u53f7\u3002 2.  \u6210\u4ea4\u56de\u8c03 (<code>on_trade</code>)\uff1a\u4e00\u65e6\u5f00\u4ed3\u5355\u6210\u4ea4\uff0c\u7acb\u5373\u53d1\u51fa\u4e24\u7b14\u5e73\u4ed3\u5355\uff1a     *   \u6b62\u635f\u5355 (Stop Loss)\uff1a\u4ef7\u683c\u8dcc\u5230 X \u65f6\u5356\u51fa\uff08\u4fdd\u62a4\u672c\u91d1\uff09\u3002     *   \u6b62\u76c8\u5355 (Take Profit)\uff1a\u4ef7\u683c\u6da8\u5230 Y \u65f6\u5356\u51fa\uff08\u9501\u5b9a\u5229\u6da6\uff09\u3002 3.  \u540e\u7eed\u6210\u4ea4\uff1a     *   \u5982\u679c\u6b62\u635f\u5355\u6210\u4ea4 -&gt; \u7acb\u5373\u53d6\u6d88\u6b62\u76c8\u5355\u3002     *   \u5982\u679c\u6b62\u76c8\u5355\u6210\u4ea4 -&gt; \u7acb\u5373\u53d6\u6d88\u6b62\u635f\u5355\u3002</p> <pre><code>def on_trade(self, trade):\n    # 1. \u8fdb\u573a\u5355\u6210\u4ea4 -&gt; \u7acb\u5373\u6302\u6b62\u635f\u548c\u6b62\u76c8\n    if trade.order_id == self.entry_order_id:\n        # \u4e0b\u8fbe\u6b62\u635f\u5355 (Stop Market: \u8fbe\u5230\u89e6\u53d1\u4ef7\u540e\u4ee5\u5e02\u4ef7\u5356\u51fa)\n        self.stop_loss_id = self.sell(\n            trade.symbol, trade.quantity,\n            trigger_price=trade.price * 0.98, # \u6b62\u635f\u4ef7 (\u6210\u672c\u4ef7 - 2%)\n            price=None # None \u8868\u793a\u89e6\u53d1\u540e\u5e02\u4ef7\u5356\u51fa\n        )\n\n        # \u4e0b\u8fbe\u6b62\u76c8\u5355 (Limit Sell: \u8fbe\u5230\u6307\u5b9a\u4ef7\u683c\u5356\u51fa)\n        self.take_profit_id = self.sell(\n            trade.symbol, trade.quantity,\n            price=trade.price * 1.05 # \u6b62\u76c8\u4ef7 (\u6210\u672c\u4ef7 + 5%)\n        )\n\n    # 2. \u6b62\u635f\u6210\u4ea4 -&gt; \u53d6\u6d88\u6b62\u76c8\n    # \u8bf4\u660e\u6211\u4eec\u5df2\u7ecf\u6b62\u635f\u79bb\u573a\u4e86\uff0c\u4e4b\u524d\u6302\u7684\u6b62\u76c8\u5355\u9700\u8981\u64a4\u9500\n    elif trade.order_id == self.stop_loss_id:\n        self.cancel_order(self.take_profit_id)\n\n    # 3. \u6b62\u76c8\u6210\u4ea4 -&gt; \u53d6\u6d88\u6b62\u635f\n    # \u8bf4\u660e\u6211\u4eec\u5df2\u7ecf\u6b62\u76c8\u79bb\u573a\u4e86\uff0c\u4e4b\u524d\u6302\u7684\u6b62\u635f\u5355\u9700\u8981\u64a4\u9500\n    elif trade.order_id == self.take_profit_id:\n        self.cancel_order(self.stop_loss_id)\n</code></pre> <p>\u53c2\u6570\u4f18\u5316</p> <p>\u8be5\u7b56\u7565\u7684 <code>stop_loss_pct</code> \u548c <code>take_profit_pct</code> \u53c2\u6570\u53ef\u4ee5\u901a\u8fc7 <code>akquant.run_optimization</code> \u8fdb\u884c\u7f51\u683c\u641c\u7d22\u4f18\u5316\u3002</p> <pre><code>from akquant import run_optimization\nfrom examples.complex_orders import BracketStrategy\n\nparam_grid = {\n    \"stop_loss_pct\": [0.01, 0.02, 0.03],\n    \"take_profit_pct\": [0.03, 0.05, 0.08]\n}\n\nresults = run_optimization(BracketStrategy, param_grid, data=df)\n</code></pre> <p>\u5b8c\u6574\u4ee3\u7801\u8bf7\u53c2\u8003 examples/complex_orders.py\u3002</p> <p>\u6ce8\u610f: <code>buy</code> / <code>sell</code> / <code>stop_buy</code> / <code>stop_sell</code> \u65b9\u6cd5\u90fd\u4f1a\u8fd4\u56de\u552f\u4e00\u7684 <code>order_id</code> (str)\uff0c\u4f60\u53ef\u4ee5\u5229\u7528\u8fd9\u4e2a ID \u5728 <code>on_trade</code> \u548c <code>on_order</code> \u56de\u8c03\u4e2d\u7cbe\u786e\u8ffd\u8e2a\u6bcf\u4e2a\u8ba2\u5355\u7684\u72b6\u6001\u3002</p>"},{"location":"installation/","title":"\u5b89\u88c5\u6307\u5357","text":""},{"location":"installation/#_2","title":"\u524d\u7f6e\u8981\u6c42","text":"<p>\u5728\u5b89\u88c5 <code>AKQuant</code> \u4e4b\u524d\uff0c\u8bf7\u786e\u4fdd\u60a8\u7684\u7cfb\u7edf\u6ee1\u8db3\u4ee5\u4e0b\u8981\u6c42\uff1a</p> <ul> <li>Python: \u7248\u672c &gt;= 3.10\u3002</li> <li>Rust: \u5982\u679c\u9700\u8981\u4ece\u6e90\u7801\u7f16\u8bd1\uff0c\u8bf7\u5b89\u88c5\u6700\u65b0\u7a33\u5b9a\u7248 Rust\u3002\u5b89\u88c5 Rust</li> <li>\u64cd\u4f5c\u7cfb\u7edf: \u652f\u6301 macOS, Linux, Windows\u3002</li> </ul>"},{"location":"installation/#_3","title":"\u5b89\u88c5\u65b9\u5f0f","text":""},{"location":"installation/#1-pypi","title":"1. \u4ece PyPI \u5b89\u88c5 (\u63a8\u8350)","text":"<p><code>AKQuant</code> \u5df2\u53d1\u5e03\u5230 PyPI\uff0c\u60a8\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 <code>pip</code> \u5b89\u88c5\u9884\u7f16\u8bd1\u7684 Wheel \u5305\uff08\u65e0\u9700 Rust \u73af\u5883\uff09\uff1a</p> <pre><code>pip install akquant\n</code></pre>"},{"location":"installation/#2","title":"2. \u4ece\u6e90\u7801\u7f16\u8bd1\u5b89\u88c5 (\u5f00\u53d1\u6a21\u5f0f)","text":"<p>\u5982\u679c\u60a8\u5e0c\u671b\u53c2\u4e0e\u5f00\u53d1\u6216\u4f7f\u7528\u6700\u65b0\u529f\u80fd\uff0c\u53ef\u4ee5\u4ece\u6e90\u7801\u8fdb\u884c\u5b89\u88c5\u3002</p> <p>\u9996\u5148\uff0c\u514b\u9686\u4ee3\u7801\u4ed3\u5e93\uff1a</p> <pre><code>git clone https://github.com/yourusername/akquant.git\ncd akquant\n</code></pre> <p>\u521b\u5efa\u5e76\u6fc0\u6d3b\u865a\u62df\u73af\u5883\uff08\u53ef\u9009\u4f46\u63a8\u8350\uff09\uff1a</p> <pre><code>python3 -m venv .venv\nsource .venv/bin/activate  # macOS/Linux\n# .venv\\Scripts\\activate   # Windows\n</code></pre> <p>\u5b89\u88c5\u6784\u5efa\u5de5\u5177 <code>maturin</code>\uff1a</p> <pre><code>pip install maturin\n</code></pre> <p>\u6784\u5efa\u5e76\u5b89\u88c5\u5230\u5f53\u524d\u73af\u5883\uff1a</p> <pre><code>maturin develop\n</code></pre> <p>\u6216\u8005\u6784\u5efa release \u7248\u672c\uff08\u4f18\u5316\u6027\u80fd\uff09\uff1a</p> <pre><code>maturin develop --release\n</code></pre>"},{"location":"installation/#_4","title":"\u9a8c\u8bc1\u5b89\u88c5","text":"<p>\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u5728 Python \u4e2d\u5bfc\u5165 <code>akquant</code> \u8fdb\u884c\u9a8c\u8bc1\uff1a</p> <pre><code>import akquant\nprint(akquant.__version__)\n</code></pre> <p>\u5982\u679c\u6ca1\u6709\u62a5\u9519\uff0c\u8bf4\u660e\u5b89\u88c5\u6210\u529f\u3002</p>"},{"location":"llm_guide/","title":"LLM \u8f85\u52a9\u7f16\u7a0b\u6307\u5357","text":"<p>\u672c\u6587\u6863\u65e8\u5728\u5e2e\u52a9\u7528\u6237\u6784\u5efa\u9ad8\u6548\u7684 Prompt\uff0c\u4ee5\u4fbf\u5229\u7528 ChatGPT\u3001Claude \u6216\u5176\u4ed6\u5927\u6a21\u578b\uff08LLM\uff09\u81ea\u52a8\u751f\u6210 AKQuant \u7b56\u7565\u4ee3\u7801\u3002</p>"},{"location":"llm_guide/#1-prompt","title":"1. \u6838\u5fc3 Prompt \u6a21\u677f (\u57fa\u7840\u7b56\u7565)","text":"<p>\u4f60\u53ef\u4ee5\u5c06\u4ee5\u4e0b\u5185\u5bb9\u76f4\u63a5\u590d\u5236\u7ed9\u5927\u6a21\u578b\uff0c\u4f5c\u4e3a\"System Prompt\"\u6216\u5bf9\u8bdd\u7684\u5f00\u5934\uff0c\u8ba9\u6a21\u578b\u5feb\u901f\u7406\u89e3 AKQuant \u7684\u7f16\u7a0b\u89c4\u8303\u3002</p> <pre><code>You are an expert quantitative developer using the **AKQuant** framework (a high-performance Python/Rust backtesting engine).\nYour task is to write trading strategies or backtest scripts based on user requirements.\n\n### AKQuant Coding Rules\n\n1.  **Strategy Structure**:\n    *   Inherit from `akquant.Strategy`.\n    *   **Note**: Calling `super().__init__()` is **optional** (Strategy uses `__new__` for initialization), but harmless if called.\n    *   Define parameters in `__init__`.\n    *   **Subscribe (Optional but Recommended)**: Call `self.subscribe(symbol)` in `on_start` to explicitly declare interest. If omitted in backtest, it will be inferred from data.\n    *   Implement trading logic in `on_bar(self, bar: Bar)`.\n\n2.  **Data Access**:\n    *   **Setup (Recommended)**:\n        *   **Static**: `warmup_period = N` (Class Attribute).\n        *   **Dynamic**: `self.warmup_period = N` in `__init__` (Instance Attribute).\n        *   **Auto**: The framework will try to infer N via AST if you use standard indicators (e.g. `SMA(30)`).\n    *   **Setup (Legacy)**: Call `self.set_history_depth(N)` in `on_start`.\n    *   Current bar: `bar.close`, `bar.open`, `bar.high`, `bar.low`, `bar.volume`, `bar.timestamp_str` (Formatted time string).\n    *   History: `self.get_history(count=N, symbol=bar.symbol, field=\"close\")` returns a numpy array.\n    *   **Check Data Sufficiency**: Always check `if len(history) &lt; N: return` before calculating indicators.\n\n3.  **Trading API**:\n    *   Buy: `self.buy(symbol, quantity, price=None)`. `price=None` means Market Order.\n    *   Sell: `self.sell(symbol, quantity, price=None)`.\n    *   Position: `self.get_position(symbol)` returns float (0 if no position).\n    *   Target: `self.order_target_percent(target, symbol)` or `self.order_target_value(target, symbol)`.\n\n4.  **Indicators**:\n    *   Prefer using `akquant.indicators` (e.g., `SMA`, `RSI`) registered in `on_start`.\n    *   Example: `self.register_indicator(\"sma\", SMA(20))` -&gt; access via `self.sma.value`.\n\n5.  **Backtest Execution**:\n    *   Use `akquant.run_backtest` with direct arguments for simplicity.\n    *   Example: `run_backtest(data=df, strategy=MyStrat, cash=100_000.0, warmup_period=50)`.\n    *   **Execution Mode**: Default is `ExecutionMode.NextOpen` (trade on next bar open). Set `execution_mode=ExecutionMode.CurrentClose` to trade on current bar close.\n    *   Timezone: Default is \"Asia/Shanghai\".\n\n### Example Strategy (Reference)\n\n```python\nfrom akquant import Strategy, Bar\nimport numpy as np\n\nclass MovingAverageStrategy(Strategy):\n    # Declarative Warmup (Static Default)\n    warmup_period = 30\n\n    def __init__(self, fast_window=10, slow_window=20):\n        # super().__init__() is optional here\n        self.fast_window = fast_window\n        self.slow_window = slow_window\n\n        # Dynamic Warmup (Overrides Class Attribute)\n        # Useful when windows are parameters\n        self.warmup_period = slow_window + 10\n\n    def on_start(self):\n        # self.subscribe(\"600000\") # Optional in backtest if data provided\n        # self.set_history_depth(self.slow_window + 10) # No longer needed if warmup_period is set\n        # Alternatively, you can pass `warmup_period` to `run_backtest` function.\n        pass\n\n    def on_bar(self, bar: Bar):\n        # 1. Get History\n        closes = self.get_history(self.slow_window + 1, bar.symbol, \"close\")\n        if len(closes) &lt; self.slow_window + 1:\n            return\n\n        # 2. Calculate Indicators\n        fast_ma = np.mean(closes[-self.fast_window:])\n        slow_ma = np.mean(closes[-self.slow_window:])\n\n        # 3. Trading Logic\n        pos = self.get_position(bar.symbol)\n\n        if fast_ma &gt; slow_ma and pos == 0:\n            self.buy(bar.symbol, 1000)\n        elif fast_ma &lt; slow_ma and pos &gt; 0:\n            self.sell(bar.symbol, pos)\n```\n</code></pre>"},{"location":"llm_guide/#2-prompt","title":"2. \u6838\u5fc3 Prompt \u6a21\u677f (\u673a\u5668\u5b66\u4e60\u7b56\u7565)","text":"<p>\u5982\u679c\u7528\u6237\u9700\u8981\u751f\u6210\u673a\u5668\u5b66\u4e60\u7b56\u7565\uff0c\u8bf7\u4f7f\u7528\u6b64\u6a21\u677f\u3002</p> <pre><code>### AKQuant ML Strategy Rules\n\n1.  **Framework**: Use `akquant.ml` which provides `QuantModel`, `SklearnAdapter`, and `PyTorchAdapter`.\n2.  **Workflow**:\n    *   Initialize model in `__init__` (e.g., `self.model = SklearnAdapter(...)`).\n    *   Configure validation via `self.model.set_validation(method='walk_forward', ...)` to enable auto-retraining.\n    *   Implement `prepare_features(self, df)` to generate X, y for **training**.\n    *   In `on_bar`, perform **inference** using manual feature extraction (or carefully reused logic) and `self.model.predict(X)`.\n3.  **Data Handling**:\n    *   **Training**: The framework calls `prepare_features` automatically during rolling windows. `df` contains historical bars. You must return `(X, y)` where `y` is aligned with `X`. Typically, `y` is shifted (future return), so you must drop the last row of `X` and `y` to remove NaNs.\n    *   **Inference**: In `on_bar`, you need features for the *current* moment to predict the *next* step. You cannot use `prepare_features` directly if it drops the last row. You should manually construct `X_curr` from `self.get_history_df`.\n\n### Example ML Strategy (Reference)\n\n```python\nfrom akquant import Strategy, Bar\nfrom akquant.ml import SklearnAdapter\nfrom sklearn.linear_model import LogisticRegression\nimport pandas as pd\nimport numpy as np\n\nclass MLStrategy(Strategy):\n    def __init__(self):\n        # 1. Initialize Adapter\n        self.model = SklearnAdapter(LogisticRegression())\n\n        # 2. Configure Walk-Forward (Auto-Training)\n        self.model.set_validation(\n            method='walk_forward',\n            train_window=200, # Train on last 200 bars\n            rolling_step=50,  # Retrain every 50 bars\n            frequency='1d',\n            incremental=False, # Set True to use partial_fit (faster)\n            verbose=True      # Print training logs\n        )\n        # Ensure history depth covers training window\n        self.set_history_depth(250)\n\n    def prepare_features(self, df: pd.DataFrame):\n        \"\"\"Called by framework for TRAINING data preparation\"\"\"\n        X = pd.DataFrame()\n        X['ret1'] = df['close'].pct_change()\n        X['ret2'] = df['close'].pct_change(2)\n        X = X.fillna(0)\n\n        # Label: Next period return &gt; 0\n        future_ret = df['close'].pct_change().shift(-1)\n        y = (future_ret &gt; 0).astype(int)\n\n        # Align X and y (Drop last row where y is NaN)\n        return X.iloc[:-1], y.iloc[:-1]\n\n    def on_bar(self, bar: Bar):\n        # Wait for initial training\n        if self._bar_count &lt; 200:\n            return\n\n        # 3. Inference (Real-time)\n        # Get recent history to construct current features\n        hist_df = self.get_history_df(5)\n\n        # Manual Feature Extraction (Must match prepare_features logic)\n        curr_ret1 = (bar.close - hist_df['close'].iloc[-2]) / hist_df['close'].iloc[-2]\n        curr_ret2 = (bar.close - hist_df['close'].iloc[-3]) / hist_df['close'].iloc[-3]\n\n        X_curr = pd.DataFrame([[curr_ret1, curr_ret2]], columns=['ret1', 'ret2'])\n        X_curr = X_curr.fillna(0)\n\n        try:\n            # Predict\n            pred = self.model.predict(X_curr)[0] # SklearnAdapter returns proba for class 1 or label\n\n            if pred &gt; 0.55:\n                self.buy(bar.symbol, 100)\n            elif pred &lt; 0.45:\n                self.sell(bar.symbol, 100)\n        except:\n            pass # Model might not be ready\n```\n</code></pre>"},{"location":"llm_guide/#3-prompt","title":"3. \u5e38\u89c1\u573a\u666f Prompt \u793a\u4f8b","text":""},{"location":"llm_guide/#a","title":"\u573a\u666f A\uff1a\u7f16\u5199\u4e00\u4e2a\u53cc\u5747\u7ebf\u7b56\u7565","text":"<p>\u7528\u6237\u63d0\u95ee:</p> <p>\u8bf7\u5e2e\u6211\u5199\u4e00\u4e2a AKQuant \u7b56\u7565\uff0c\u4f7f\u7528 5\u65e5\u548c 20\u65e5\u5747\u7ebf\u91d1\u53c9\u4e70\u5165\uff0c\u6b7b\u53c9\u5356\u51fa\uff0c\u6807\u7684\u662f \"AAPL\"\u3002</p> <p>\u63a8\u8350\u8865\u5145\u4fe1\u606f:</p> <p>(\u5c06\u4e0a\u9762\u7684 Core Prompt \u7c98\u8d34\u5728\u6700\u524d\u9762\uff0c\u6216\u8005\u4f5c\u4e3a\u7cfb\u7edf\u63d0\u793a\u8bcd)</p>"},{"location":"llm_guide/#b","title":"\u573a\u666f B\uff1a\u7f16\u5199\u56de\u6d4b\u8fd0\u884c\u811a\u672c","text":"<p>\u7528\u6237\u63d0\u95ee:</p> <p>\u6211\u5df2\u7ecf\u6709\u4e86 <code>MyStrategy</code> \u7c7b\uff0c\u8bf7\u5e2e\u6211\u5199\u4e00\u4e2a\u8fd0\u884c\u56de\u6d4b\u7684\u811a\u672c\uff0c\u6570\u636e\u4f7f\u7528 pandas DataFrame\uff0c\u65f6\u95f4\u8303\u56f4\u662f 2023 \u5e74\u5168\u5e74\u3002</p> <p>\u6a21\u578b\u751f\u6210\u7684\u9884\u671f\u4ee3\u7801:</p> <pre><code>import pandas as pd\nfrom akquant import run_backtest, BacktestConfig\n\n# 1. \u51c6\u5907\u6570\u636e (Mock Data for example)\n# AKQuant requires columns: timestamp, open, high, low, close, volume, symbol\ndates = pd.date_range(\"2023-01-01\", \"2023-12-31\", freq=\"D\")\ndf = pd.DataFrame({\n    \"timestamp\": dates,\n    \"open\": 100.0,\n    \"high\": 105.0,\n    \"low\": 95.0,\n    \"close\": 102.0,\n    \"volume\": 10000.0,\n    \"symbol\": \"AAPL\"\n})\n\n# 2. \u914d\u7f6e\u4e0e\u8fd0\u884c\u56de\u6d4b (Simpler Approach)\n# \u76f4\u63a5\u901a\u8fc7 arguments \u4f20\u9012\u53c2\u6570\uff0c\u65e0\u9700\u6784\u5efa\u590d\u6742\u7684 Config \u5bf9\u8c61\nresult = run_backtest(\n    data=df,               # \u652f\u6301 DataFrame, Dict[str, DataFrame] \u6216 CSV \u8def\u5f84\n    strategy=MyStrategy,   # \u7b56\u7565\u7c7b\n    strategy_params={\"fast_window\": 5, \"slow_window\": 20}, # \u7b56\u7565\u53c2\u6570\n    cash=100_000.0,        # \u521d\u59cb\u8d44\u91d1\n    commission=0.0003,     # \u4f63\u91d1\u7387\n    show_progress=True     # \u663e\u793a\u8fdb\u5ea6\u6761\n)\n\n# 3. \u67e5\u770b\u7ed3\u679c\nprint(result)\nresult.plot() # \u53ef\u89c6\u5316\n</code></pre>"},{"location":"llm_guide/#4-llm","title":"4. \u6ce8\u610f\u4e8b\u9879 (\u7ed9 LLM \u7684\u201c\u8d1f\u9762\u7ea6\u675f\u201d)","text":"<p>\u5728\u4f7f\u7528\u5927\u6a21\u578b\u65f6\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u4ee5\u4e0b\u5e7b\u89c9\uff08Hallucinations\uff09\uff0c\u53ef\u4ee5\u5728 Prompt \u4e2d\u663e\u5f0f\u7981\u6b62\uff1a</p> <ol> <li>\u5173\u4e8e <code>super().__init__()</code>: AKQuant \u7684 <code>Strategy</code> \u4f7f\u7528\u4e86 <code>__new__</code> \u94a9\u5b50\u5904\u7406\u521d\u59cb\u5316\u3002\u867d\u7136\u8c03\u7528 <code>super().__init__</code> \u662f\u5b89\u5168\u7684\uff08\u7a7a\u64cd\u4f5c\uff09\uff0c\u4f46\u5728\u672c\u6846\u67b6\u4e2d\u5e76\u975e\u5fc5\u987b\u3002</li> <li>\u7981\u6b62\u4f7f\u7528 <code>context.portfolio</code> \u8fd9\u79cd\u8fc7\u65f6\u7684\u5199\u6cd5: \u867d\u7136\u5185\u90e8\u652f\u6301\uff0c\u4f46\u63a8\u8350\u4f7f\u7528 <code>self.get_position()</code> \u7b49\u9876\u5c42 API\u3002</li> <li>\u6ce8\u610f <code>get_history</code> \u7684\u8fd4\u56de\u503c: \u5b83\u8fd4\u56de\u7684\u662f <code>numpy.ndarray</code>\uff0c\u4e0d\u662f <code>pandas.Series</code>\uff08\u9664\u975e\u4f7f\u7528 <code>get_history_df</code>\uff09\u3002\u76f4\u63a5\u5bf9 <code>ndarray</code> \u505a\u8fd0\u7b97\u6027\u80fd\u66f4\u9ad8\u3002</li> <li>ML \u7b56\u7565\u4e2d\u7684\u7279\u5f81\u4e00\u81f4\u6027: \u8bad\u7ec3\u65f6 <code>prepare_features</code> \u901a\u5e38\u4f1a <code>shift(-1)</code> \u5bfc\u81f4\u6700\u540e\u4e00\u884c\u65e0\u6548\u88ab\u4e22\u5f03\uff1b\u4f46\u5728 <code>on_bar</code> \u9884\u6d4b\u65f6\uff0c\u6211\u4eec\u9700\u8981\u7528\u5f53\u524d\u6700\u65b0\u7684\u884c\u60c5\u8ba1\u7b97\u7279\u5f81\u3002\u76f4\u63a5\u590d\u7528 <code>prepare_features</code> \u53ef\u80fd\u4f1a\u5bfc\u81f4\u9884\u6d4b\u65f6\u53d6\u4e0d\u5230\u6700\u65b0\u7684\u7279\u5f81\uff08\u56e0\u4e3a\u5b83\u4ee5\u4e3a\u90a3\u662f\u201c\u6700\u540e\u4e00\u884c\u201d\u800c\u4e22\u5f03\u4e86\uff09\uff0c\u6216\u8005\u9700\u8981\u7279\u6b8a\u7684\u53c2\u6570\u63a7\u5236\u3002\u5efa\u8bae\u5728 <code>on_bar</code> \u4e2d\u663e\u5f0f\u8ba1\u7b97\u5f53\u524d\u7279\u5f81\u3002</li> </ol>"},{"location":"llm_guide/#5-realtime-ctp","title":"5. \u5b9e\u65f6\u6570\u636e\u5904\u7406 (Realtime / CTP)","text":"<p>AKQuant \u63d0\u4f9b\u4e86 <code>LiveRunner</code> \u7c7b\u6765\u7b80\u5316\u5b9e\u76d8/\u4eff\u771f\u4ea4\u6613\u7684\u542f\u52a8\u6d41\u7a0b\u3002</p> <p>Prompt \u793a\u4f8b:</p> <p>\u6211\u9700\u8981\u7f16\u5199\u4e00\u4e2a CTP \u5b9e\u76d8\u7b56\u7565\u542f\u52a8\u811a\u672c\uff0c\u4f7f\u7528 1 \u5206\u949f K \u7ebf\u805a\u5408\uff0c\u5e76\u5728\u8fd0\u884c 1 \u5c0f\u65f6\u540e\u81ea\u52a8\u505c\u6b62\u3002</p> <p>\u6a21\u578b\u5e94\u751f\u6210\u7684\u4ee3\u7801\u7247\u6bb5:</p> <pre><code>from akquant.live import LiveRunner\nfrom akquant import AssetType, Instrument\n\n# 1. \u5b9a\u4e49\u5408\u7ea6\ninstruments = [\n    Instrument(symbol=\"rb2505\", asset_type=AssetType.Futures, multiplier=10.0, margin_ratio=0.1, tick_size=1.0)\n]\n\n# 2. \u521b\u5efa\u8fd0\u884c\u5668\nrunner = LiveRunner(\n    strategy_cls=MyStrategy,\n    instruments=instruments,\n    md_front=\"tcp://182.254.243.31:40011\",\n    use_aggregator=True  # \u5173\u952e\u53c2\u6570\n)\n\n# 3. \u8fd0\u884c (\u652f\u6301 duration \u81ea\u52a8\u505c\u6b62)\n# show_progress=False \u5728\u5b9e\u76d8\u4e2d\u63a8\u8350\uff0c\u907f\u514d\u8fdb\u5ea6\u6761\u5e72\u6270\u65e5\u5fd7\nrunner.run(cash=500_000, show_progress=False, duration=\"1h\")\n</code></pre>"},{"location":"llm_guide/#use_aggregator","title":"\u6a21\u5f0f\u9009\u62e9 (<code>use_aggregator</code>)","text":"<ul> <li><code>use_aggregator=True</code> (\u9ed8\u8ba4):<ul> <li>\u542f\u7528\u5185\u7f6e\u7684 Rust \u9ad8\u6027\u80fd\u805a\u5408\u5668 (<code>BarAggregator</code>)\u3002</li> <li>\u7b56\u7565\u7684 <code>on_bar</code> \u6bcf 1 \u5206\u949f\u89e6\u53d1\u4e00\u6b21\uff08\u6807\u51c6 OHLCV\uff09\u3002</li> <li>\u9002\u7528\u4e8e\u8d8b\u52bf\u8ddf\u8e2a\u3001\u6280\u672f\u6307\u6807\u7b56\u7565\u3002</li> </ul> </li> <li><code>use_aggregator=False</code>:<ul> <li>Tick-as-Bar \u6a21\u5f0f\u3002\u7f51\u5173\u6536\u5230\u6bcf\u4e2a Tick \u90fd\u4f1a\u76f4\u63a5\u5c01\u88c5\u6210 Bar \u63a8\u9001\u3002</li> <li>\u7b56\u7565\u7684 <code>on_bar</code> \u9891\u7387\u6781\u9ad8\uff08\u540c Tick \u9891\u7387\uff09\u3002</li> <li>\u9002\u7528\u4e8e\u9ad8\u9891\u7b56\u7565\u3001\u505a\u5e02\u7b56\u7565\u6216\u6d4b\u8bd5\u6570\u636e\u8fde\u63a5\u3002</li> </ul> </li> </ul>"},{"location":"llm_guide/#_1","title":"\u5173\u952e\u533a\u522b\u8bf4\u660e","text":"<ul> <li>Gateway \u5c42 (<code>on_tick</code>): \u8d1f\u8d23\u63a5\u6536\u5916\u90e8\u63a5\u53e3\uff08\u5982 CTP, Binance\uff09\u7684\u539f\u59cb Tick \u6570\u636e\u3002</li> <li>Strategy \u5c42 (<code>on_bar</code>): \u7b56\u7565\u903b\u8f91\u7684\u6838\u5fc3\u5165\u53e3\u3002<ul> <li>\u65e0\u8bba\u6570\u636e\u6e90\u662f\u805a\u5408\u540e\u7684\u5206\u949f\u7ebf\uff0c\u8fd8\u662f Tick \u5feb\u7167\uff0c\u7b56\u7565\u59cb\u7ec8\u901a\u8fc7 <code>on_bar</code> \u63a5\u6536\u6570\u636e\u3002</li> <li>AKQuant \u5f15\u64ce\u6807\u51c6\u5316\u4e86\u6570\u636e\u6d41\uff0c\u7b56\u7565\u4e0d\u9700\u8981\u611f\u77e5\u4e0a\u6e38\u662f Tick \u8fd8\u662f Bar\uff0c\u53ea\u9700\u8981\u5904\u7406 <code>Bar</code> \u5bf9\u8c61\u3002</li> </ul> </li> </ul>"},{"location":"ml_guide/","title":"\u673a\u5668\u5b66\u4e60\u4e0e\u6eda\u52a8\u8bad\u7ec3\u6307\u5357 (ML Guide)","text":"<p>AKQuant \u5185\u7f6e\u4e86\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684\u673a\u5668\u5b66\u4e60\u8bad\u7ec3\u6846\u67b6\uff0c\u4e13\u4e3a\u91cf\u5316\u4ea4\u6613\u8bbe\u8ba1\u3002\u5b83\u89e3\u51b3\u4e86\u4f20\u7edf\u6846\u67b6\u4e2d\u5e38\u89c1\u7684\u201c\u672a\u6765\u51fd\u6570\u201d\u6cc4\u9732\u95ee\u9898\uff0c\u5e76\u63d0\u4f9b\u4e86\u5f00\u7bb1\u5373\u7528\u7684 Walk-forward Validation\uff08\u6eda\u52a8/\u524d\u5411\u9a8c\u8bc1\uff09\u652f\u6301\u3002</p>"},{"location":"ml_guide/#_1","title":"\u6838\u5fc3\u8bbe\u8ba1\u7406\u5ff5","text":""},{"location":"ml_guide/#1-signal-action","title":"1. Signal (\u4fe1\u53f7) \u4e0e Action (\u51b3\u7b56) \u5206\u79bb","text":"<p>\u5f88\u591a\u521d\u5b66\u8005\u5bb9\u6613\u72af\u7684\u9519\u8bef\u662f\u8ba9\u6a21\u578b\u76f4\u63a5\u8f93\u51fa\u201c\u4e70/\u5356\u201d\u6307\u4ee4\u3002\u5728 AKQuant \u4e2d\uff0c\u6211\u4eec\u5c06\u8fd9\u4e00\u8fc7\u7a0b\u89e3\u8026\uff1a</p> <ul> <li>Model (\u6a21\u578b\u5c42): \u53ea\u8d1f\u8d23\u6839\u636e\u5386\u53f2\u6570\u636e\u9884\u6d4b\u672a\u6765\u7684\u6982\u7387\u6216\u6570\u503c (Signal)\u3002\u5b83\u4e0d\u77e5\u9053\u8d26\u6237\u6709\u591a\u5c11\u94b1\uff0c\u4e5f\u4e0d\u77e5\u9053\u73b0\u5728\u7684\u5e02\u573a\u98ce\u9669\u5982\u4f55\u3002</li> <li>Strategy (\u7b56\u7565\u5c42): \u63a5\u6536\u6a21\u578b\u7684 Signal\uff0c\u7ed3\u5408\u98ce\u63a7\u89c4\u5219\u3001\u8d44\u91d1\u7ba1\u7406\u3001\u5e02\u573a\u72b6\u6001\uff0c\u6700\u7ec8\u505a\u51fa\u4e70\u5356\u51b3\u7b56 (Action)\u3002</li> </ul>"},{"location":"ml_guide/#2-adapter","title":"2. Adapter \u6a21\u5f0f (\u9002\u914d\u5668)","text":"<p>\u4e3a\u4e86\u7edf\u4e00 Scikit-learn\uff08\u4f20\u7edf\u673a\u5668\u5b66\u4e60\uff09\u548c PyTorch\uff08\u6df1\u5ea6\u5b66\u4e60\uff09\u622a\u7136\u4e0d\u540c\u7684\u7f16\u7a0b\u8303\u5f0f\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u9002\u914d\u5668\u5c42\uff1a</p> <ul> <li>SklearnAdapter: \u9002\u914d XGBoost, LightGBM, RandomForest \u7b49\u3002</li> <li>PyTorchAdapter: \u9002\u914d LSTM, Transformer \u7b49\u6df1\u5ea6\u7f51\u7edc\uff0c\u81ea\u52a8\u5904\u7406 DataLoader \u548c\u8bad\u7ec3\u5faa\u73af\u3002</li> </ul> <p>\u7528\u6237\u53ea\u9700\u8981\u9762\u5bf9\u7edf\u4e00\u7684 <code>QuantModel</code> \u63a5\u53e3\u3002</p>"},{"location":"ml_guide/#3-walk-forward-validation","title":"3. Walk-forward Validation (\u6eda\u52a8\u9a8c\u8bc1)","text":"<p>\u5728\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u4e0a\uff0c\u968f\u673a\u7684 K-Fold \u4ea4\u53c9\u9a8c\u8bc1\u662f\u9519\u8bef\u7684\uff0c\u56e0\u4e3a\u5b83\u4f1a\u5229\u7528\u672a\u6765\u6570\u636e\u9884\u6d4b\u8fc7\u53bb\u3002\u6b63\u786e\u7684\u505a\u6cd5\u662f Walk-forward\uff1a</p> <ol> <li>Window 1: \u7528 2020 \u5e74\u6570\u636e\u8bad\u7ec3\uff0c\u9884\u6d4b 2021 Q1\u3002</li> <li>Window 2: \u7528 2020 Q2 - 2021 Q1 \u6570\u636e\u8bad\u7ec3\uff0c\u9884\u6d4b 2021 Q2\u3002</li> <li>... \u50cf\u6eda\u8f6e\u4e00\u6837\u4e0d\u65ad\u5411\u524d\u63a8\u8fdb\u3002</li> </ol>"},{"location":"ml_guide/#4-look-ahead-bias","title":"4. \u9632\u6b62\u672a\u6765\u51fd\u6570 (Look-ahead Bias)","text":"<p>\u5728\u91cf\u5316 ML \u4e2d\uff0c\u6700\u5371\u9669\u7684\u9519\u8bef\u662f\u4f7f\u7528\u672a\u6765\u6570\u636e\u3002AKQuant \u5efa\u8bae\u9075\u5faa\u4ee5\u4e0b\u539f\u5219\uff1a</p> <ul> <li>\u7279\u5f81 (X): \u53ea\u80fd\u4f7f\u7528\u5f53\u524d\u65f6\u523b \\(t\\) \u53ca\u4e4b\u524d\u7684\u6570\u636e\u3002</li> <li>\u6807\u7b7e (y): \u63cf\u8ff0 \\(t+1\\) \u65f6\u523b\u7684\u72b6\u6001\uff08\u5982\u672a\u6765\u7684\u6da8\u8dcc\uff09\uff0c\u4f46\u5728 \\(t\\) \u65f6\u523b\u8bad\u7ec3\u65f6\uff0c\u6211\u4eec\u5b9e\u9645\u4e0a\u662f\u62ff \\(t\\) \u65f6\u523b\u7684 \\(X\\) \u53bb\u62df\u5408 \\(t+1\\) \u65f6\u523b\u7684 \\(y\\)\u3002</li> <li>\u4ee3\u7801\u5b9e\u73b0: \u6784\u9020 \\(y\\) \u65f6\u901a\u5e38\u9700\u8981 <code>shift(-1)</code>\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u6700\u540e\u4e00\u884c\u6570\u636e\u6ca1\u6709\u6807\u7b7e\uff08\u56e0\u4e3a\u6ca1\u6709\u672a\u6765\uff09\uff0c\u5fc5\u987b\u5728\u8bad\u7ec3\u524d\u5254\u9664\u3002</li> </ul>"},{"location":"ml_guide/#5-pipeline","title":"5. \u9632\u6b62\u6570\u636e\u6cc4\u9732\uff1a\u4f7f\u7528 Pipeline","text":"<p>\u7279\u5f81\u9884\u5904\u7406\uff08\u5982\u6807\u51c6\u5316\u3001\u5f52\u4e00\u5316\uff09\u4e5f\u53ef\u80fd\u5f15\u5165 Look-ahead Bias\u3002\u4f8b\u5982\uff0c\u5982\u679c\u5728\u5168\u91cf\u6570\u636e\u4e0a\u4f7f\u7528 <code>StandardScaler</code>\uff0c\u90a3\u4e48\u8bad\u7ec3\u96c6\u5c31\u9690\u542b\u4e86\u672a\u6765\u6d4b\u8bd5\u96c6\u7684\u5747\u503c\u548c\u65b9\u5dee\u4fe1\u606f\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a\u5c06\u9884\u5904\u7406\u6b65\u9aa4\u5c01\u88c5\u5728 <code>sklearn.pipeline.Pipeline</code> \u4e2d\u3002</p> <ul> <li>\u5c01\u88c5: Pipeline \u5c06 Scaler \u548c Model \u89c6\u4e3a\u4e00\u4e2a\u6574\u4f53\u3002</li> <li>\u9694\u79bb: \u5728 Walk-forward \u8bad\u7ec3\u65f6\uff0cPipeline \u53ea\u4f1a\u5728\u5f53\u524d\u7684\u8bad\u7ec3\u7a97\u53e3\u6570\u636e\u4e0a\u8c03\u7528 <code>fit</code>\uff08\u8ba1\u7b97\u5747\u503c/\u65b9\u5dee\uff09\uff0c\u7136\u540e\u5e94\u7528\u5230\u9a8c\u8bc1\u96c6\u4e0a\u3002</li> <li>\u4e00\u81f4\u6027: \u5728\u63a8\u7406\u9636\u6bb5\uff0cPipeline \u4f1a\u81ea\u52a8\u5e94\u7528\u8bad\u7ec3\u597d\u7684\u7edf\u8ba1\u91cf\uff0c\u65e0\u9700\u7528\u6237\u624b\u52a8\u7ef4\u62a4\u3002</li> </ul>"},{"location":"ml_guide/#_2","title":"\u5b8c\u6574\u53ef\u8fd0\u884c\u793a\u4f8b","text":"<p>\u4ee5\u4e0b\u4ee3\u7801\u5c55\u793a\u4e86\u5982\u4f55\u7ed3\u5408 Pipeline \u548c Walk-forward Validation \u6784\u5efa\u4e00\u4e2a\u7a33\u5065\u7684\u7b56\u7565\u3002</p> <pre><code>import numpy as np\nimport pandas as pd\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.pipeline import Pipeline\nfrom akquant.strategy import Strategy\nfrom akquant.ml import SklearnAdapter\nfrom akquant.backtest import run_backtest\n\nclass WalkForwardStrategy(Strategy):\n    \"\"\"\n    \u6f14\u793a\u7b56\u7565\uff1a\u4f7f\u7528\u903b\u8f91\u56de\u5f52\u9884\u6d4b\u6da8\u8dcc (\u96c6\u6210 Pipeline \u9884\u5904\u7406)\n    \"\"\"\n\n    def __init__(self):\n        # 1. \u521d\u59cb\u5316\u6a21\u578b (\u4f7f\u7528 Pipeline \u5c01\u88c5\u9884\u5904\u7406\u548c\u6a21\u578b)\n        # StandardScaler: \u786e\u4fdd\u4f7f\u7528\u8bad\u7ec3\u96c6\u7edf\u8ba1\u91cf\u8fdb\u884c\u6807\u51c6\u5316\uff0c\u9632\u6b62\u6570\u636e\u6cc4\u9732\n        pipeline = Pipeline([\n            ('scaler', StandardScaler()),\n            ('model', LogisticRegression())\n        ])\n\n        self.model = SklearnAdapter(pipeline)\n\n        # 2. \u914d\u7f6e Walk-forward Validation\n        # \u6846\u67b6\u4f1a\u81ea\u52a8\u63a5\u7ba1\u6570\u636e\u7684\u5207\u5272\u3001\u6a21\u578b\u7684\u91cd\u8bad\n        self.model.set_validation(\n            method='walk_forward',\n            train_window=50,   # \u4f7f\u7528\u8fc7\u53bb 50 \u4e2a bar \u8bad\u7ec3\n            rolling_step=10,   # \u6bcf 10 \u4e2a bar \u91cd\u8bad\u4e00\u6b21\n            frequency='1m',    # \u6570\u636e\u9891\u7387\n            verbose=True       # \u6253\u5370\u8bad\u7ec3\u65e5\u5fd7\n        )\n\n        # \u786e\u4fdd\u5386\u53f2\u6570\u636e\u957f\u5ea6\u8db3\u591f (\u8bad\u7ec3\u7a97\u53e3 + \u7279\u5f81\u8ba1\u7b97\u6240\u9700\u7a97\u53e3)\n        self.set_history_depth(60)\n\n    def prepare_features(self, df: pd.DataFrame, mode: str = \"training\"):\n        \"\"\"\n        [\u5fc5\u987b\u5b9e\u73b0] \u7279\u5f81\u5de5\u7a0b\u903b\u8f91\n        \u8be5\u51fd\u6570\u4f1a\u88ab\u7528\u4e8e\u8bad\u7ec3\u9636\u6bb5\uff08\u751f\u6210 X, y\uff09\u548c\u9884\u6d4b\u9636\u6bb5\uff08\u751f\u6210 X\uff09\n        \"\"\"\n        X = pd.DataFrame()\n        # \u7279\u5f81 1: 1\u5468\u671f\u6536\u76ca\u7387\n        X['ret1'] = df['close'].pct_change()\n        # \u7279\u5f81 2: 2\u5468\u671f\u6536\u76ca\u7387\n        X['ret2'] = df['close'].pct_change(2)\n        X = X.fillna(0)\n\n        if mode == 'inference':\n            # \u63a8\u7406\u6a21\u5f0f\uff1a\u53ea\u8fd4\u56de\u6700\u540e\u4e00\u884c\u7279\u5f81\uff0c\u4e0d\u9700\u8981 y\n            return X.iloc[-1:]\n\n        # \u8bad\u7ec3\u6a21\u5f0f\uff1a\u6784\u9020\u6807\u7b7e y (\u9884\u6d4b\u4e0b\u4e00\u671f\u7684\u6da8\u8dcc)\n        # shift(-1) \u628a\u672a\u6765\u7684\u6536\u76ca\u632a\u5230\u5f53\u524d\u884c\u4f5c\u4e3a label\n        future_ret = df['close'].pct_change().shift(-1)\n        y = (future_ret &gt; 0).astype(int)\n\n        # \u6ce8\u610f\uff1a\u8bad\u7ec3\u65f6\u6846\u67b6\u4f1a\u81ea\u52a8\u5904\u7406\u6700\u540e\u4e00\u884c NaN \u7684\u95ee\u9898\n        # \u4f46\u4e3a\u4e86\u4e25\u8c28\uff0c\u6211\u4eec\u8fd4\u56de\u5bf9\u9f50\u7684 X \u548c y\n        # \u5728\u9884\u6d4b\u9636\u6bb5\uff0cy \u4e2d\u7684\u6700\u540e\u4e00\u884c\u662f NaN (\u56e0\u4e3a\u4e0d\u77e5\u9053\u672a\u6765)\uff0c\u8fd9\u662f\u6b63\u5e38\u7684\n        return X.iloc[:-1], y.iloc[:-1]\n\n    def on_bar(self, bar):\n        # 3. \u5b9e\u65f6\u9884\u6d4b\u4e0e\u4ea4\u6613\n\n        # \u7b80\u5355\u5224\u65ad\u6a21\u578b\u662f\u5426\u5df2\u5b8c\u6210\u9996\u6b21\u8bad\u7ec3\n        if self._bar_count &lt; 50:\n            return\n\n        # \u83b7\u53d6\u6700\u8fd1\u7684\u6570\u636e\u8fdb\u884c\u7279\u5f81\u63d0\u53d6\n        # \u6ce8\u610f\uff1a\u9700\u8981\u8db3\u591f\u7684\u5386\u53f2\u957f\u5ea6\u6765\u8ba1\u7b97\u7279\u5f81 (\u4f8b\u5982 pct_change(2) \u9700\u8981\u81f3\u5c113\u6839bar)\n        hist_df = self.get_history_df(10)\n\n        # \u590d\u7528\u7279\u5f81\u8ba1\u7b97\u903b\u8f91\uff01\n        # \u76f4\u63a5\u8c03\u7528 prepare_features \u83b7\u53d6\u5f53\u524d\u7279\u5f81\n        X_curr = self.prepare_features(hist_df, mode='inference')\n\n        try:\n            # \u83b7\u53d6\u9884\u6d4b\u4fe1\u53f7 (\u6982\u7387)\n            # SklearnAdapter \u5bf9\u4e8e\u4e8c\u5206\u7c7b\u8fd4\u56de Class 1 \u7684\u6982\u7387\n            signal = self.model.predict(X_curr)[0]\n\n            # \u6253\u5370\u4fe1\u53f7\u65b9\u4fbf\u89c2\u5bdf\n            # print(f\"Time: {bar.timestamp}, Signal: {signal:.4f}\")\n\n            # \u7ed3\u5408\u98ce\u63a7\u89c4\u5219\u4e0b\u5355\n            if signal &gt; 0.55:\n                self.buy(bar.symbol, 100)\n            elif signal &lt; 0.45:\n                self.sell(bar.symbol, 100)\n\n        except Exception:\n            # \u6a21\u578b\u53ef\u80fd\u5c1a\u672a\u521d\u59cb\u5316\u6216\u8bad\u7ec3\u5931\u8d25\n            pass\n\nif __name__ == \"__main__\":\n    # 1. \u751f\u6210\u5408\u6210\u6570\u636e\n    print(\"\u751f\u6210\u6d4b\u8bd5\u6570\u636e...\")\n    dates = pd.date_range(start=\"2023-01-01\", periods=500, freq=\"1min\")\n    # \u968f\u673a\u6f2b\u6b65\u4ef7\u683c\n    price = 100 + np.cumsum(np.random.randn(500))\n    df = pd.DataFrame({\n        \"timestamp\": dates,\n        \"open\": price,\n        \"high\": price + 1,\n        \"low\": price - 1,\n        \"close\": price,\n        \"volume\": 1000,\n        \"symbol\": \"TEST\"\n    })\n\n    # 2. \u8fd0\u884c\u56de\u6d4b\n    print(\"\u5f00\u59cb\u8fd0\u884c\u673a\u5668\u5b66\u4e60\u56de\u6d4b...\")\n    result = run_backtest(\n        data=df,\n        strategy=WalkForwardStrategy,\n        symbol=\"TEST\",\n        lot_size=1,\n        execution_mode=\"current_close\", # \u5728\u5f53\u6839 bar \u7ed3\u675f\u65f6\u64ae\u5408\n        history_depth=60\n    )\n    print(\"\u56de\u6d4b\u7ed3\u675f\u3002\")\n\n    # 3. \u6253\u5370\u7ed3\u679c\n    print(result)\n</code></pre>"},{"location":"ml_guide/#_3","title":"\u8fd0\u884c\u7ed3\u679c\u793a\u4f8b","text":"<p>\u4e0a\u8ff0\u4ee3\u7801\u8fd0\u884c\u540e\uff0c\u4f60\u5c06\u770b\u5230\u7c7b\u4f3c\u5982\u4e0b\u7684\u8f93\u51fa\uff1a</p> <pre><code>\u751f\u6210\u6d4b\u8bd5\u6570\u636e...\n\u5f00\u59cb\u8fd0\u884c\u673a\u5668\u5b66\u4e60\u56de\u6d4b...\n2026-02-09 15:58:29 | INFO | Running backtest via run_backtest()...\n[########################################] 500/500 (0s)\n\u56de\u6d4b\u7ed3\u675f\u3002\nBacktestResult:\n                             Value\nannualized_return     2.424312e+05\nend_market_value      1.011841e+06\nequity_r2             1.000000e+00\ninitial_market_value  1.000000e+06\nmax_drawdown          0.000000e+00\nmax_drawdown_pct      0.000000e+00\nsharpe_ratio          0.000000e+00\nsortino_ratio         0.000000e+00\nstd_error             0.000000e+00\ntotal_return          1.184056e-02\ntotal_return_pct      1.184056e+00\nulcer_index           0.000000e+00\nupi                   0.000000e+00\nvolatility            0.000000e+00\nwin_rate              9.101124e-01\n</code></pre>"},{"location":"ml_guide/#_4","title":"\u8fdb\u9636\u6307\u5357","text":""},{"location":"ml_guide/#1","title":"1. \u7279\u5f81\u5de5\u7a0b\u5efa\u8bae","text":"<p>\u4f18\u79c0\u7684\u7279\u5f81\u662f ML \u6210\u529f\u7684\u5173\u952e\u3002\u9664\u4e86\u7b80\u5355\u7684\u6536\u76ca\u7387\uff0c\u4f60\u53ef\u4ee5\u8003\u8651\uff1a</p> <ul> <li>\u6280\u672f\u6307\u6807: RSI, MACD, Bollinger Bands (\u63a8\u8350\u4f7f\u7528 <code>talib</code> \u6216 <code>pandas_ta</code>)\u3002</li> <li>\u6ce2\u52a8\u7387\u7279\u5f81: \u5386\u53f2\u6ce2\u52a8\u7387, ATR\u3002</li> <li>\u5e02\u573a\u5fae\u89c2\u7ed3\u6784: \u4e70\u5356\u538b\u529b, \u91cf\u4ef7\u5173\u7cfb\u3002</li> <li>\u65f6\u95f4\u7279\u5f81: \u5c0f\u65f6, \u661f\u671f\u51e0 (\u6ce8\u610f\u8fd9\u662f\u7c7b\u522b\u7279\u5f81\uff0c\u53ef\u80fd\u9700\u8981 One-hot \u7f16\u7801)\u3002</li> </ul>"},{"location":"ml_guide/#2-saveload","title":"2. \u6a21\u578b\u6301\u4e45\u5316 (Save/Load)","text":"<p>\u8bad\u7ec3\u597d\u7684\u6a21\u578b\u53ef\u4ee5\u4fdd\u5b58\u4e0b\u6765\uff0c\u7528\u4e8e\u5b9e\u76d8\u6216\u540e\u7eed\u5206\u6790\u3002</p> <pre><code># \u4fdd\u5b58\nstrategy.model.save(\"my_model.pkl\")\n\n# \u52a0\u8f7d (\u5728 __init__ \u4e2d)\nself.model.load(\"my_model.pkl\")\n</code></pre>"},{"location":"ml_guide/#3-pytorch","title":"3. \u6df1\u5ea6\u5b66\u4e60\u652f\u6301 (PyTorch)","text":"<p>\u4f7f\u7528 <code>PyTorchAdapter</code> \u53ef\u4ee5\u8f7b\u677e\u96c6\u6210\u6df1\u5ea6\u5b66\u4e60\u6a21\u578b\u3002\u4f60\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a\u6807\u51c6\u7684 <code>nn.Module</code>\u3002</p> <pre><code>from akquant.ml import PyTorchAdapter\nimport torch.nn as nn\nimport torch.optim as optim\n\n# \u5b9a\u4e49\u7f51\u7edc\nclass SimpleNet(nn.Module):\n    def __init__(self):\n        super().__init__()\n        self.fc = nn.Sequential(\n            nn.Linear(10, 32),\n            nn.ReLU(),\n            nn.Linear(32, 1),\n            nn.Sigmoid()\n        )\n\n    def forward(self, x):\n        return self.fc(x)\n\n# \u5728\u7b56\u7565\u4e2d\u4f7f\u7528\nself.model = PyTorchAdapter(\n    network=SimpleNet(),\n    criterion=nn.BCELoss(),\n    optimizer_cls=optim.Adam,\n    lr=0.001,\n    epochs=20,\n    batch_size=64,\n    device='cuda'  # \u652f\u6301 GPU \u52a0\u901f\n)\n</code></pre>"},{"location":"ml_guide/#api","title":"API \u53c2\u8003","text":""},{"location":"ml_guide/#modelset_validation","title":"<code>model.set_validation</code>","text":"<p>\u914d\u7f6e\u6a21\u578b\u7684\u9a8c\u8bc1\u548c\u8bad\u7ec3\u65b9\u5f0f\u3002</p> <pre><code>def set_validation(\n    self,\n    method: str = 'walk_forward',\n    train_window: str | int = '1y',\n    test_window: str | int = '3m',\n    rolling_step: str | int = '3m',\n    frequency: str = '1d',\n    incremental: bool = False,\n    verbose: bool = False\n)\n</code></pre> <ul> <li><code>method</code>: \u76ee\u524d\u4ec5\u652f\u6301 <code>'walk_forward'</code>\u3002</li> <li><code>train_window</code>: \u8bad\u7ec3\u7a97\u53e3\u957f\u5ea6\u3002\u652f\u6301 <code>'1y'</code> (1\u5e74), <code>'6m'</code> (6\u4e2a\u6708), <code>'50d'</code> (50\u5929) \u6216\u6574\u6570 (Bar\u6570\u91cf)\u3002</li> <li><code>rolling_step</code>: \u6eda\u52a8\u6b65\u957f\uff0c\u5373\u6bcf\u9694\u591a\u4e45\u91cd\u8bad\u4e00\u6b21\u6a21\u578b\u3002</li> <li><code>frequency</code>: \u6570\u636e\u7684\u9891\u7387\uff0c\u7528\u4e8e\u5c06\u65f6\u95f4\u5b57\u7b26\u4e32\u6b63\u786e\u8f6c\u6362\u4e3a Bar \u6570\u91cf (\u4f8b\u5982 '1d' \u4e0b 1y=252 bars)\u3002</li> <li><code>incremental</code>: \u662f\u5426\u4f7f\u7528\u589e\u91cf\u5b66\u4e60\uff08\u5728\u4e0a\u6b21\u8bad\u7ec3\u7684\u57fa\u7840\u4e0a\u7ee7\u7eed\u8bad\u7ec3\uff09\u8fd8\u662f\u4ece\u5934\u91cd\u8bad\u3002\u9ed8\u8ba4\u4e3a <code>False</code>\u3002</li> <li><code>verbose</code>: \u662f\u5426\u6253\u5370\u8bad\u7ec3\u65e5\u5fd7\uff0c\u9ed8\u8ba4\u4e3a <code>False</code>\u3002</li> </ul>"},{"location":"ml_guide/#strategyprepare_features","title":"<code>strategy.prepare_features</code>","text":"<p>\u7528\u6237\u5fc5\u987b\u5b9e\u73b0\u7684\u56de\u8c03\u51fd\u6570\uff0c\u7528\u4e8e\u7279\u5f81\u5de5\u7a0b\u3002</p> <pre><code>def prepare_features(self, df: pd.DataFrame, mode: str = \"training\") -&gt; Tuple[Any, Any]\n</code></pre> <ul> <li>\u8f93\u5165:<ul> <li><code>df</code>: \u5386\u53f2\u6570\u636e DataFrame\u3002</li> <li><code>mode</code>: <code>\"training\"</code> (\u8bad\u7ec3\u6a21\u5f0f) \u6216 <code>\"inference\"</code> (\u63a8\u7406\u6a21\u5f0f)\u3002</li> </ul> </li> <li>\u8f93\u51fa:<ul> <li><code>mode=\"training\"</code>: \u8fd4\u56de <code>(X, y)</code>\u3002</li> <li><code>mode=\"inference\"</code>: \u8fd4\u56de <code>X</code> (\u901a\u5e38\u662f\u6700\u540e\u4e00\u884c)\u3002</li> </ul> </li> <li>\u6ce8\u610f: \u8fd9\u662f\u4e00\u4e2a\u7eaf\u51fd\u6570\uff0c\u4e0d\u5e94\u4f9d\u8d56\u5916\u90e8\u72b6\u6001\u3002</li> </ul>"},{"location":"py_guide/","title":"\u91d1\u878d Python \u6781\u7b80\u5165\u95e8 (Python for Finance 101)","text":"<p>\u5f88\u591a\u91cf\u5316\u65b0\u624b\u770b\u5230\u4ee3\u7801\u5c31\u5934\u75bc\u3002\u522b\u62c5\u5fc3\uff0c\u5728 AKQuant \u4e2d\uff0c\u4f60\u4e0d\u9700\u8981\u6210\u4e3a\u8ba1\u7b97\u673a\u4e13\u5bb6\uff0c\u53ea\u9700\u8981\u638c\u63e1\u6700\u6838\u5fc3\u7684 20% \u8bed\u6cd5\uff0c\u5c31\u80fd\u8986\u76d6 80% \u7684\u7b56\u7565\u5f00\u53d1\u9700\u6c42\u3002</p> <p>\u672c\u6307\u5357\u5c06\u5b8c\u5168\u4ece\u91d1\u878d\u4ea4\u6613\u7684\u89c6\u89d2\uff0c\u5e26\u4f60\u5feb\u901f\u4e0a\u624b Python\u3002</p>"},{"location":"py_guide/#1","title":"1. \u53d8\u91cf\u4e0e\u6570\u636e\u7c7b\u578b\uff1a\u5b9a\u4e49\u4f60\u7684\u8d44\u4ea7","text":"<p>\u5728 Python \u4e2d\uff0c\u53d8\u91cf\u5c31\u50cf\u662f\u4e00\u4e2a\u4e2a\u8d34\u4e86\u6807\u7b7e\u7684\u76d2\u5b50\uff0c\u7528\u6765\u5b58\u6570\u636e\u3002</p>"},{"location":"py_guide/#_1","title":"\u57fa\u7840\u53d8\u91cf","text":"<ul> <li>\u6574\u6570 (int)\uff1a\u7528\u4e8e\u8868\u793a\u624b\u6570\u3001\u4ea4\u6613\u91cf\u3002</li> <li>\u6d6e\u70b9\u6570 (float)\uff1a\u7528\u4e8e\u8868\u793a\u4ef7\u683c\u3001\u6536\u76ca\u7387\u3002</li> <li>\u5b57\u7b26\u4e32 (str)\uff1a\u7528\u4e8e\u8868\u793a\u80a1\u7968\u4ee3\u7801\u3002</li> </ul> <pre><code># \u5b9a\u4e49\u53d8\u91cf\nsymbol = \"000001\"      # \u80a1\u7968\u4ee3\u7801 (\u5b57\u7b26\u4e32)\nprice = 10.5           # \u5f53\u524d\u4ef7\u683c (\u6d6e\u70b9\u6570)\nvolume = 100           # \u4e70\u5165\u6570\u91cf (\u6574\u6570)\nis_holding = True      # \u662f\u5426\u6301\u4ed3 (\u5e03\u5c14\u503c)\n\n# \u6253\u5370\u51fa\u6765\u770b\u770b\nprint(f\"\u6b63\u5728\u4ea4\u6613 {symbol}\uff0c\u4ef7\u683c\uff1a{price}\")\n</code></pre>"},{"location":"py_guide/#list","title":"\u5217\u8868 (List)\uff1a\u4e00\u4e32\u4ef7\u683c\u5e8f\u5217","text":"<p>\u60f3\u8c61\u4f60\u5728\u770b K \u7ebf\u56fe\uff0c\u8fc7\u53bb5\u5929\u7684\u6536\u76d8\u4ef7\u5c31\u662f\u4e00\u4e2a\u5217\u8868\u3002</p> <pre><code># \u6700\u8fd15\u5929\u7684\u6536\u76d8\u4ef7\ncloses = [10.1, 10.2, 10.0, 10.5, 10.8]\n\n# \u8bbf\u95ee\u6570\u636e\nprint(closes[0])   # \u83b7\u53d6\u7b2c1\u5929\u4ef7\u683c (Python\u4ece0\u5f00\u59cb\u8ba1\u6570\uff01) -&gt; 10.1\nprint(closes[-1])  # \u83b7\u53d6\u6700\u540e1\u5929\u4ef7\u683c (\u6700\u65b0\u4ef7) -&gt; 10.8\nprint(closes[:3])  # \u83b7\u53d6\u524d3\u5929\u4ef7\u683c -&gt; [10.1, 10.2, 10.0]\n\n# \u8ba1\u7b97\u5747\u4ef7\navg_price = sum(closes) / len(closes)\nprint(f\"5\u65e5\u5747\u4ef7: {avg_price}\")\n</code></pre>"},{"location":"py_guide/#dictionary","title":"\u5b57\u5178 (Dictionary)\uff1a\u4f60\u7684\u6301\u4ed3\u7ec4\u5408","text":"<p>\u5b57\u5178\u5c31\u50cf\u4e00\u4e2a\u8d26\u672c\uff0c\u5de6\u8fb9\u662f\u540d\u5b57\uff08Key\uff09\uff0c\u53f3\u8fb9\u662f\u6570\u503c\uff08Value\uff09\u3002</p> <pre><code># \u5f53\u524d\u6301\u4ed3\uff1a\u80a1\u7968\u4ee3\u7801 -&gt; \u6301\u80a1\u6570\nportfolio = {\n    \"AAPL\": 100,\n    \"TSLA\": 50,\n    \"GOOG\": 0\n}\n\n# \u67e5\u8be2\u6301\u4ed3\nprint(portfolio[\"AAPL\"]) # -&gt; 100\n\n# \u66f4\u65b0\u6301\u4ed3\nportfolio[\"TSLA\"] += 10  # \u52a0\u4ed310\u80a1\n</code></pre>"},{"location":"py_guide/#2","title":"2. \u903b\u8f91\u63a7\u5236\uff1a\u4ea4\u6613\u7684\u51b3\u7b56\u6838\u5fc3","text":"<p>\u91cf\u5316\u7b56\u7565\u7684\u672c\u8d28\u5c31\u662f\u4e00\u5806 <code>if...else</code>\uff1a\u5982\u679c\u53d1\u751f\u4ec0\u4e48\uff0c\u5c31\u505a\u4ec0\u4e48\u3002</p>"},{"location":"py_guide/#ifelse","title":"\u6761\u4ef6\u5224\u65ad (If/Else)","text":"<p>\u8fd9\u662f\u7b56\u7565\u7684\u201c\u6273\u673a\u201d\u3002</p> <pre><code>ma5 = 10.5  # \u77ed\u671f\u5747\u7ebf\nma20 = 10.0 # \u957f\u671f\u5747\u7ebf\ncash = 5000 # \u53ef\u7528\u8d44\u91d1\n\n# \u91d1\u53c9\u7b56\u7565\u903b\u8f91\nif ma5 &gt; ma20:\n    print(\"\u4fe1\u53f7\uff1a\u91d1\u53c9\u51fa\u73b0\uff01\")\n    if cash &gt; 1000:\n        print(\"\u8d44\u91d1\u5145\u8db3\uff0c\u6267\u884c\u4e70\u5165\uff01\")\n    else:\n        print(\"\u8d44\u91d1\u4e0d\u8db3\uff0c\u65e0\u6cd5\u4e70\u5165\u3002\")\nelse:\n    print(\"\u65e0\u4fe1\u53f7\uff0c\u7ee7\u7eed\u89c2\u671b\u3002\")\n</code></pre>"},{"location":"py_guide/#loop","title":"\u5faa\u73af (Loop)","text":"<p>\u56de\u6d4b\u5c31\u662f\u5728\u4e00\u4e2a\u5927\u5faa\u73af\u91cc\uff0c\u4e00\u5929\u4e00\u5929\u5730\u904d\u5386\u5386\u53f2\u6570\u636e\u3002</p> <pre><code># \u6a21\u62df\u56de\u6d4b\uff1a\u904d\u5386\u6bcf\u4e00\u5929\u7684\u4ef7\u683c\nprices = [10, 11, 9, 12, 13]\n\nfor p in prices:\n    if p &gt; 12:\n        print(f\"\u4ef7\u683c {p} \u7a81\u7834 12\u5143\uff0c\u89e6\u53d1\u6b62\u76c8\uff01\")\n    else:\n        print(f\"\u4ef7\u683c {p} \u6b63\u5e38\u6ce2\u52a8\")\n</code></pre>"},{"location":"py_guide/#3-pandas","title":"3. Pandas \u901f\u6210\uff1a\u91cf\u5316\u795e\u5668","text":"<p>\u5728 AKQuant \u4e2d\uff0c99% \u7684\u6570\u636e\uff08\u5982 <code>history_data</code>\uff09\u90fd\u662f\u4ee5 <code>DataFrame</code> \u7684\u5f62\u5f0f\u5b58\u5728\u7684\u3002\u4f60\u53ef\u4ee5\u628a\u5b83\u60f3\u8c61\u6210\u4e00\u4e2a\u8d85\u7ea7 Excel \u8868\u683c\u3002</p>"},{"location":"py_guide/#dataframe","title":"DataFrame \u7ed3\u6784","text":"<p>\u4e00\u4e2a DataFrame \u5305\u542b\u884c\uff08Index\uff0c\u901a\u5e38\u662f\u65f6\u95f4\uff09\u548c\u5217\uff08Columns\uff0c\u5982 Open/Close\uff09\u3002</p> <pre><code>import pandas as pd\n\n# \u6a21\u62df\u4e00\u4e2a OHLCV \u8868\u683c\ndata = {\n    \"close\": [10, 11, 12, 11, 13],\n    \"volume\": [100, 150, 200, 120, 300]\n}\ndf = pd.DataFrame(data)\n\n# 1. \u83b7\u53d6\u6574\u5217\u6570\u636e (Series)\nprint(df[\"close\"])\n\n# 2. \u8ba1\u7b97\u6280\u672f\u6307\u6807 (\u5411\u91cf\u5316\u8fd0\u7b97\uff0c\u6781\u5feb)\n# \u8ba1\u7b97\u6536\u76d8\u4ef7\u7684\u5e73\u5747\u503c\nma_price = df[\"close\"].mean()\n\n# 3. \u83b7\u53d6\u6700\u65b0\u4e00\u884c\u6570\u636e\nlast_bar = df.iloc[-1]\nprint(f\"\u6700\u65b0\u6536\u76d8\u4ef7: {last_bar['close']}\")\n</code></pre>"},{"location":"py_guide/#4","title":"4. \u7c7b\u4e0e\u5bf9\u8c61\uff1a\u8bfb\u61c2\u7b56\u7565\u6a21\u677f","text":"<p>\u5728\u5199\u7b56\u7565\u65f6\uff0c\u4f60\u4f1a\u770b\u5230 <code>class MyStrategy(Strategy):</code>\u3002\u8fd9\u662f\u4ec0\u4e48\u610f\u601d\uff1f</p> <ul> <li>Class (\u7c7b)\uff1a\u7b56\u7565\u7684\u56fe\u7eb8\u3002\u5b9a\u4e49\u4e86\u8fd9\u4e2a\u7b56\u7565\u957f\u4ec0\u4e48\u6837\uff0c\u6709\u4ec0\u4e48\u529f\u80fd\u3002</li> <li>Object (\u5bf9\u8c61)\uff1a\u6839\u636e\u56fe\u7eb8\u9020\u51fa\u6765\u7684\u5b9e\u4f8b\u3002\u56de\u6d4b\u8fd0\u884c\u65f6\uff0c\u7cfb\u7edf\u4f1a\u521b\u5efa\u4e00\u4e2a\u7b56\u7565\u5b9e\u4f8b\u3002</li> <li>self\uff1a\u4ee3\u8868\u7b56\u7565\u5b9e\u4f8b\u81ea\u5df1\u3002<ul> <li><code>self.buy()</code>: \u6211\u8981\u4e70\u3002</li> <li><code>self.cash</code>: \u6211\u7684\u73b0\u91d1\u3002</li> <li><code>self.position</code>: \u6211\u7684\u6301\u4ed3\u3002</li> </ul> </li> </ul> <pre><code>class MyStrategy:\n    def __init__(self, initial_cash):\n        # \u521d\u59cb\u5316\uff1a\u7b56\u7565\u542f\u52a8\u65f6\u6267\u884c\u4e00\u6b21\n        self.cash = initial_cash\n        self.name = \"\u5747\u7ebf\u7b56\u7565\"\n\n    def on_bar(self, price):\n        # \u6bcf\u6839K\u7ebf\u8d70\u5b8c\u65f6\u6267\u884c\u4e00\u6b21\n        if price &lt; 10:\n            self.buy()\n\n    def buy(self):\n        self.cash -= 10\n        print(f\"{self.name} \u6267\u884c\u4e70\u5165\uff0c\u5269\u4f59\u8d44\u91d1: {self.cash}\")\n\n# \u4f7f\u7528\u7b56\u7565\nstrategy = MyStrategy(1000) # \u521b\u5efa\u5b9e\u4f8b\uff0c\u521d\u59cb\u8d44\u91d11000\nstrategy.on_bar(9)          # \u4ef7\u683c\u8dcc\u52309\uff0c\u89e6\u53d1\u4e70\u5165\n</code></pre>"},{"location":"py_guide/#5-akquant","title":"5. \u603b\u7ed3\uff1aAKQuant \u5e38\u7528\u8bed\u901f\u67e5","text":"<p>\u5728 AKQuant \u5199\u7b56\u7565\u65f6\uff0c\u4f60\u6700\u5e38\u7528\u7684\u5c31\u662f\u4e0b\u9762\u8fd9\u51e0\u53e5\uff1a</p> \u573a\u666f Python \u4ee3\u7801 \u542b\u4e49 \u83b7\u53d6\u6570\u636e <code>hist = self.history_data(n=20)</code> \u62ff\u8fc7\u53bb20\u6839K\u7ebf\u6570\u636e (DataFrame) \u8ba1\u7b97\u5747\u7ebf <code>ma = hist['close'].mean()</code> \u8ba1\u7b97\u6536\u76d8\u4ef7\u5e73\u5747\u503c \u53d6\u6700\u65b0\u4ef7 <code>current_price = bar.close</code> \u83b7\u53d6\u5f53\u524dK\u7ebf\u7684\u6536\u76d8\u4ef7 \u5224\u65ad\u4fe1\u53f7 <code>if ma_short &gt; ma_long:</code> \u5982\u679c\u77ed\u671f\u5747\u7ebf\u5927\u4e8e\u957f\u671f\u5747\u7ebf \u67e5\u6301\u4ed3 <code>pos = self.get_position(bar.symbol)</code> \u6211\u73b0\u5728\u6301\u6709\u591a\u5c11\u80a1\uff1f \u4e0b\u5355 <code>self.buy(bar.symbol, 100)</code> \u4e70\u5165 100 \u80a1 <p>\u638c\u63e1\u4e86\u8fd9\u4e9b\uff0c\u4f60\u5c31\u53ef\u4ee5\u5f00\u59cb\u5199\u51fa\u4f60\u7684\u7b2c\u4e00\u4e2a\u91cf\u5316\u7b56\u7565\u4e86\uff01\u53bb Quant Guide \u8bd5\u8bd5\u5427\u3002</p>"},{"location":"quant_guide/","title":"\u91cf\u5316\u4ea4\u6613\u65b0\u624b\u6307\u5357 (Zero to Hero)","text":"<p>\u6b22\u8fce\u6765\u5230\u91cf\u5316\u4ea4\u6613\u7684\u4e16\u754c\uff01\u672c\u6307\u5357\u4e13\u4e3a\u96f6\u57fa\u7840\u7528\u6237\u8bbe\u8ba1\uff0c\u65e8\u5728\u5e2e\u52a9\u4f60\u4ece\u7406\u8bba\u6982\u5ff5\u5230\u4ee3\u7801\u5b9e\u6218\uff0c\u7cfb\u7edf\u6027\u5730\u638c\u63e1\u4f7f\u7528 AKQuant \u6846\u67b6\u8fdb\u884c\u91cf\u5316\u7b56\u7565\u5f00\u53d1\u7684\u5168\u8fc7\u7a0b\u3002</p>"},{"location":"quant_guide/#0-vs","title":"0. \u4e3a\u4ec0\u4e48\u9009\u62e9\u91cf\u5316\uff1f(\u91cf\u5316 vs \u4e3b\u89c2)","text":"<p>\u6295\u8d44\u7684\u4e16\u754c\u4e3b\u8981\u5206\u4e3a\u4e24\u6d3e\uff1a\u4e3b\u89c2\u6295\u8d44 (Discretionary) \u548c \u91cf\u5316\u6295\u8d44 (Quantitative)\u3002</p> <ul> <li>\u4e3b\u89c2\u6295\u8d44\u50cf\u662f\u4e00\u95e8\u827a\u672f\u3002\u4ea4\u6613\u5458\u4f9d\u9760\u4e2a\u4eba\u7684\u7ecf\u9a8c\u3001\u76f4\u89c9\u548c\u5bf9\u5e02\u573a\u7684\u5b9a\u6027\u5206\u6790\uff08\u5982\u65b0\u95fb\u3001\u5b8f\u89c2\u653f\u7b56\uff09\u6765\u505a\u51b3\u7b56\u3002\u5df4\u83f2\u7279\u3001\u7d22\u7f57\u65af\u662f\u8fd9\u65b9\u9762\u7684\u5b97\u5e08\u3002</li> <li>\u91cf\u5316\u6295\u8d44\u5219\u662f\u4e00\u95e8\u79d1\u5b66\u3002\u5b83\u901a\u8fc7\u6570\u5b66\u6a21\u578b\u548c\u8ba1\u7b97\u673a\u7a0b\u5e8f\uff0c\u4ece\u6d77\u91cf\u5386\u53f2\u6570\u636e\u4e2d\u5bfb\u627e\u6982\u7387\u4f18\u52bf\uff0c\u5e76\u4e25\u683c\u6267\u884c\u3002\u897f\u8499\u65af\uff08\u5927\u5956\u7ae0\u57fa\u91d1\uff09\u662f\u91cf\u5316\u7684\u4ee3\u8868\u3002</li> </ul>"},{"location":"quant_guide/#_1","title":"\u6838\u5fc3\u5bf9\u6bd4","text":"\u7ef4\u5ea6 \u4e3b\u89c2\u4ea4\u6613 (Discretionary) \u91cf\u5316\u4ea4\u6613 (Quantitative) \u51b3\u7b56\u4f9d\u636e \u7ecf\u9a8c\u3001\u76f4\u89c9\u3001\u6d88\u606f\u3001\u5b9a\u6027\u5206\u6790 \u6570\u636e\u3001\u7edf\u8ba1\u6a21\u578b\u3001\u4ee3\u7801\u903b\u8f91 \u6267\u884c\u529b \u6613\u53d7\u60c5\u7eea\uff08\u8d2a\u5a6a/\u6050\u60e7\uff09\u5e72\u6270\uff0c\u77e5\u884c\u5408\u4e00\u96be \u673a\u5668\u81ea\u52a8\u6267\u884c\uff0c\u51b7\u9177\u65e0\u60c5\uff0c100% \u7eaa\u5f8b \u8986\u76d6\u8303\u56f4 \u4eba\u7684\u7cbe\u529b\u6709\u9650\uff0c\u53ea\u80fd\u5173\u6ce8\u51e0\u5341\u53ea\u80a1\u7968 \u8ba1\u7b97\u673a\u53ef\u540c\u65f6\u76d1\u63a7\u51e0\u5343\u53ea\u80a1\u7968\u3001\u51e0\u767e\u4e2a\u5e02\u573a \u53ef\u9a8c\u8bc1\u6027 \u96be\u4ee5\u9a8c\u8bc1\uff08\"\u611f\u89c9\"\u65e0\u6cd5\u56de\u6d4b\uff09 \u9ad8\u5ea6\u53ef\u9a8c\u8bc1\uff08\u901a\u8fc7\u56de\u6d4b\u68c0\u9a8c\u5386\u53f2\u8868\u73b0\uff09 \u7f3a\u70b9 \u96be\u4ee5\u590d\u5236\uff0c\u72b6\u6001\u4e0d\u7a33\u5b9a\uff0c\u5bb9\u6613\u72af\u9519 \u5b58\u5728\u6a21\u578b\u5931\u6548\u98ce\u9669\uff0c\u5bf9\u7a81\u53d1\u4e8b\u4ef6\uff08\u9ed1\u5929\u9e45\uff09\u53cd\u5e94\u53ef\u80fd\u6ede\u540e <p>\u9009\u62e9\u91cf\u5316\u7684\u7406\u7531\uff1a \u5982\u679c\u4f60\u4e0d\u60f3\u6bcf\u5929\u76ef\u7740\u76d8\u9762\u5fc3\u60ca\u8089\u8df3\uff0c\u5982\u679c\u4f60\u76f8\u4fe1\u6570\u636e\u80dc\u8fc7\u76f4\u89c9\uff0c\u5982\u679c\u4f60\u5e0c\u671b\u901a\u8fc7\u4ee3\u7801\u6784\u5efa\u4e00\u4e2a\u80fd\u957f\u671f\u4e3a\u4f60\u5de5\u4f5c\u7684\"\u8d5a\u94b1\u673a\u5668\"\uff0c\u90a3\u4e48\u91cf\u5316\u6295\u8d44\u5c31\u662f\u4e3a\u4f60\u51c6\u5907\u7684\u3002</p>"},{"location":"quant_guide/#1-k","title":"1. \u91cf\u5316\u4ea4\u6613\u57fa\u7840\u6982\u5ff5\uff1a\u963fK\u7684\u89c9\u9192\u4e4b\u8def","text":"<p>\u4e3a\u4e86\u8ba9\u4f60\u66f4\u76f4\u89c2\u5730\u7406\u89e3\u91cf\u5316\u4ea4\u6613\uff0c\u6211\u4eec\u6765\u8bb2\u4e00\u4e2a\u540d\u4e3a\u201c\u963fK\u201d\u7684\u4ea4\u6613\u5458\u7684\u6545\u4e8b\u3002\u901a\u8fc7\u4ed6\u7684\u7ecf\u5386\uff0c\u6211\u4eec\u5c06\u89e3\u9501\u91cf\u5316\u4ea4\u6613\u7684\u6838\u5fc3\u6982\u5ff5\u3002</p>"},{"location":"quant_guide/#vs","title":"\u7b2c\u4e00\u5e55\uff1a\u60c5\u7eea\u7684\u5974\u96b6 vs \u673a\u5668\u7684\u7eaa\u5f8b","text":"<p>\u6545\u4e8b\uff1a \u963fK \u66fe\u7ecf\u662f\u4e00\u4e2a\u5178\u578b\u7684\u624b\u52a8\u4ea4\u6613\u5458\u3002\u6bcf\u5929\u76ef\u7740\u5c4f\u5e55\uff0c\u5fc3\u60c5\u968f\u7740\u7ea2\u7eff\u67f1\u5b50\u8d77\u4f0f\u3002 *   \u4e0a\u534810\u70b9\uff0c\u770b\u5230\u80a1\u4ef7\u731b\u6da8\uff1a\u201c\u5feb\u8ffd\uff01\u4e0d\u7136\u8e0f\u7a7a\u4e86\uff01\u201d \u2014\u2014 \u7ed3\u679c\u9ad8\u4f4d\u63a5\u76d8\u3002 *   \u4e0b\u53482\u70b9\uff0c\u80a1\u4ef7\u8df3\u6c34\uff1a\u201c\u5b8c\u4e86\uff01\u8981\u8dcc\u505c\u4e86\uff0c\u5feb\u8dd1\uff01\u201d \u2014\u2014 \u7ed3\u679c\u4f4e\u4f4d\u5272\u8089\u3002 \u4e00\u5929\u4e0b\u6765\uff0c\u963fK \u7b4b\u75b2\u529b\u5c3d\uff0c\u8d26\u6237\u8fd8\u4e8f\u4e86\u94b1\u3002\u4ed6\u53d1\u73b0\u81ea\u5df1\u6700\u5927\u7684\u654c\u4eba\u4e0d\u662f\u5e02\u573a\uff0c\u800c\u662f\u8d2a\u5a6a\u4e0e\u6050\u60e7\u3002</p> <p>\u91cf\u5316\u89c6\u70b9\uff1a \u91cf\u5316\u4ea4\u6613\u7684\u7b2c\u4e00\u5927\u4f18\u52bf\u662f\u7eaa\u5f8b\u6027 (Discipline)\u3002 \u6211\u4eec\u5c06\u4ea4\u6613\u903b\u8f91\u5199\u6210\u4ee3\u7801\uff08\u5373\u7b56\u7565\uff09\uff0c\u8ba9\u8ba1\u7b97\u673a\u81ea\u52a8\u6267\u884c\u3002\u673a\u5668\u6ca1\u6709\u60c5\u7eea\uff0c\u5b83\u4e0d\u4f1a\u56e0\u4e3a\u66b4\u6da8\u800c\u5174\u594b\uff0c\u4e5f\u4e0d\u4f1a\u56e0\u4e3a\u66b4\u8dcc\u800c\u6050\u614c\u3002\u5b83\u53ea\u4f1a\u51b7\u9177\u5730\u6267\u884c\uff1a\u201c\u5982\u679c A \u53d1\u751f\uff0c\u6211\u5c31\u505a B\u201d\u3002</p>"},{"location":"quant_guide/#_2","title":"\u7b2c\u4e8c\u5e55\uff1a\u795e\u79d8\u7684\u201c\u65f6\u5149\u673a\u201d (\u56de\u6d4b)","text":"<p>\u6545\u4e8b\uff1a \u963fK \u603b\u7ed3\u4e86\u4e00\u4e2a\u89c4\u5f8b\uff1a\u201c\u6211\u53d1\u73b0\u6bcf\u6b21\u8fde\u7eed\u8dcc\u4e09\u5929\uff0c\u7b2c\u56db\u5929\u5927\u6982\u7387\u4f1a\u53cd\u5f39\u3002\u201d \u4ed6\u60f3\u7528\u771f\u91d1\u767d\u94f6\u53bb\u8d4c\u8fd9\u4e2a\u89c4\u5f8b\uff0c\u4f46\u5fc3\u91cc\u6ca1\u5e95\uff1a\u201c\u8fd9\u4e2a\u89c4\u5f8b\u57282018\u5e74\u718a\u5e02\u7ba1\u7528\u5417\uff1f\u57282020\u5e74\u725b\u5e02\u53c8\u5982\u4f55\uff1f\u201d \u4ed6\u5e0c\u671b\u80fd\u6709\u4e00\u53f0\u65f6\u5149\u673a\uff0c\u56de\u5230\u8fc7\u53bb\uff0c\u7528\u8fd9\u4e2a\u89c4\u5219\u6a21\u62df\u4ea4\u6613\u4e00\u904d\uff0c\u770b\u770b\u80fd\u8d5a\u591a\u5c11\u94b1\u3002</p> <p>\u91cf\u5316\u89c6\u70b9\uff1a \u8fd9\u53f0\u65f6\u5149\u673a\u5c31\u662f\u56de\u6d4b (Backtesting)\u3002 \u56de\u6d4b\u662f\u6307\u4f7f\u7528\u5386\u53f2\u6570\u636e\u6765\u9a8c\u8bc1\u4ea4\u6613\u7b56\u7565\u5728\u8fc7\u53bb\u8868\u73b0\u7684\u8fc7\u7a0b\u3002 *   \u8f93\u5165\uff1a\u4f60\u7684\u7b56\u7565\u903b\u8f91\uff08\u5982\u201c\u8fde\u8dcc\u4e09\u5929\u4e70\u5165\u201d\uff09\u3002 *   \u6570\u636e\uff1a\u8fc7\u53bb\u51e0\u5e74\u7684 K \u7ebf\u6570\u636e\uff08OHLCV - \u5f00\u9ad8\u4f4e\u6536\u91cf\uff09\u3002 *   \u8f93\u51fa\uff1a\u5982\u679c\u6309\u6b64\u64cd\u4f5c\uff0c\u4f60\u7684\u6700\u7ec8\u6536\u76ca\u3001\u6700\u5927\u4e8f\u635f\u662f\u591a\u5c11\u3002</p>"},{"location":"quant_guide/#_3","title":"\u7b2c\u4e09\u5e55\uff1a\u5173\u4e8e\u201c\u6d3b\u4e0b\u53bb\u201d\u7684\u6559\u8bad (\u98ce\u63a7)","text":"<p>\u6545\u4e8b\uff1a \u963fK \u66fe\u7ecf\u8fd0\u6c14\u7206\u68da\uff0c\u91cd\u4ed3\u62bc\u6ce8\u4e00\u53ea\u80a1\u7968\uff0c\u4e00\u4e2a\u6708\u7ffb\u500d\u3002\u4ed6\u89c9\u5f97\u81ea\u5df1\u662f\u80a1\u795e\uff0c\u4e8e\u662f\u501f\u94b1\u52a0\u6760\u6746\u7ee7\u7eed\u6ee1\u4ed3\u3002 \u7ed3\u679c\u5e02\u573a\u7a81\u53d1\u201c\u9ed1\u5929\u9e45\u201d\u4e8b\u4ef6\uff0c\u80a1\u4ef7\u8170\u65a9\u3002\u963fK \u4e0d\u4ec5\u5229\u6da6\u56de\u5410\uff0c\u672c\u91d1\u4e5f\u4e8f\u5149\u4e86\u3002 \u91cf\u5316\u524d\u8f88\u544a\u8bc9\u4ed6\uff1a\u201c\u5728\u8fd9\u4e2a\u5e02\u573a\uff0c\u6d3b\u5f97\u4e45\u6bd4\u8d5a\u5f97\u5feb\u66f4\u91cd\u8981\u3002\u201d</p> <p>\u91cf\u5316\u89c6\u70b9\uff1a \u8fd9\u5c31\u662f\u98ce\u9669\u63a7\u5236 (Risk Management)\u3002\u5728\u91cf\u5316\u62a5\u544a\u4e2d\uff0c\u6211\u4eec\u4e0d\u4ec5\u770b\u8d5a\u4e86\u591a\u5c11\uff08\u6536\u76ca\u7387\uff09\uff0c\u66f4\u770b\u5192\u4e86\u591a\u5927\u98ce\u9669\u3002 *   \u6700\u5927\u56de\u64a4 (Max Drawdown)\uff1a\u7b56\u7565\u4ece\u5386\u53f2\u6700\u9ad8\u70b9\u8dcc\u4e0b\u6765\u7684\u6700\u5927\u5e45\u5ea6\u3002\u5982\u679c\u6700\u5927\u56de\u64a4\u662f -50%\uff0c\u610f\u5473\u7740\u4f60\u7684\u8d44\u4ea7\u53ef\u80fd\u8170\u65a9\u3002 *   \u590f\u666e\u6bd4\u7387 (Sharpe Ratio)\uff1a\u8861\u91cf\u6027\u4ef7\u6bd4\u7684\u6307\u6807\u3002\u6bcf\u627f\u62c5\u4e00\u4efd\u98ce\u9669\uff0c\u80fd\u6362\u6765\u591a\u5c11\u8d85\u989d\u6536\u76ca\u3002</p>"},{"location":"quant_guide/#_4","title":"\u7b2c\u56db\u5e55\uff1a\u523b\u821f\u6c42\u5251\u7684\u9677\u9631 (\u8fc7\u62df\u5408)","text":"<p>\u6545\u4e8b\uff1a \u963fK \u5b66\u4f1a\u4e86\u7f16\u7a0b\uff0c\u4ed6\u8bd5\u56fe\u627e\u5230\u4e00\u6761\u5b8c\u7f8e\u7684\u66f2\u7ebf\u3002\u4ed6\u4e0d\u65ad\u4fee\u6539\u53c2\u6570\uff0c\u7ec8\u4e8e\u51d1\u51fa\u4e86\u4e00\u4e2a\u5728\u8fc7\u53bb\u4e00\u5e74\u6536\u76ca\u7387 500% \u7684\u7b56\u7565\uff01 \u4ed6\u5174\u594b\u5730\u5f00\u542f\u5b9e\u76d8\uff0c\u7ed3\u679c\u4e00\u5468\u5c31\u4e8f\u4e86 10%\u3002 \u539f\u6765\uff0c\u4ed6\u7684\u7b56\u7565\u4ee3\u7801\u91cc\u9690\u542b\u7740\uff1a\u201c\u5982\u679c\u57282023\u5e741\u67085\u65e5\uff0c\u5c31\u4e70\u5165\u201d\u3002\u8fd9\u5c31\u50cf\u80cc\u4e0b\u4e86\u53bb\u5e74\u8003\u8bd5\u7684\u7b54\u6848\uff0c\u4f46\u4eca\u5e74\u7684\u9898\u76ee\u53d8\u4e86\u3002</p> <p>\u91cf\u5316\u89c6\u70b9\uff1a \u8fd9\u53eb\u8fc7\u62df\u5408 (Overfitting)\u3002\u7b56\u7565\u53ea\u662f\u8bb0\u4f4f\u4e86\u5386\u53f2\u6570\u636e\u7684\u566a\u58f0\uff0c\u800c\u6ca1\u6709\u638c\u63e1\u771f\u6b63\u7684\u5e02\u573a\u89c4\u5f8b\u3002\u4f18\u79c0\u7684\u91cf\u5316\u7b56\u7565\u5e94\u5f53\u662f\u903b\u8f91\u7b80\u5355\u3001\u666e\u9002\u6027\u5f3a\u7684\uff0c\u800c\u4e0d\u662f\u5bf9\u5386\u53f2\u6570\u636e\u7684\u751f\u642c\u786c\u5957\u3002</p>"},{"location":"quant_guide/#15-ohlcv","title":"1.5 \u6838\u5fc3\u6570\u636e\u683c\u5f0f (OHLCV)","text":"<p>\u56de\u5230\u6280\u672f\u5c42\u9762\uff0c\u91cf\u5316\u4ea4\u6613\u4e2d\u6700\u57fa\u7840\u7684\u6570\u636e\u5355\u5143\u662f K \u7ebf\uff08Bar\uff09\uff0c\u901a\u5e38\u5305\u542b\u4ee5\u4e0b\u5b57\u6bb5\uff1a *   Open: \u5f00\u76d8\u4ef7 *   High: \u6700\u9ad8\u4ef7 *   Low: \u6700\u4f4e\u4ef7 *   Close: \u6536\u76d8\u4ef7 *   Volume: \u6210\u4ea4\u91cf</p>"},{"location":"quant_guide/#2","title":"2. \u73af\u5883\u51c6\u5907\u4e0e\u6846\u67b6\u5b89\u88c5","text":""},{"location":"quant_guide/#21-akquant","title":"2.1 \u5b89\u88c5 AKQuant","text":"<p>\u786e\u4fdd\u4f60\u7684\u7535\u8111\u4e0a\u5b89\u88c5\u4e86 Python 3.10 \u6216\u4ee5\u4e0a\u7248\u672c\u3002\u6253\u5f00\u7ec8\u7aef\uff08Terminal \u6216 CMD\uff09\uff0c\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>pip install akquant\n</code></pre>"},{"location":"quant_guide/#22","title":"2.2 \u9a8c\u8bc1\u5b89\u88c5","text":"<p>\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a <code>check_env.py</code> \u7684\u6587\u4ef6\uff0c\u8f93\u5165\u4ee5\u4e0b\u4ee3\u7801\u5e76\u8fd0\u884c\uff1a</p> <pre><code>import akquant\nprint(f\"AKQuant version: {akquant.__version__}\")\nprint(\"\u5b89\u88c5\u6210\u529f\uff01\")\n</code></pre>"},{"location":"quant_guide/#3","title":"3. \u5b9e\u6218\u6f14\u7ec3\uff1a\u5f00\u53d1\u7b2c\u4e00\u4e2a\u7b56\u7565\uff08\u53cc\u5747\u7ebf\u4ea4\u53c9\uff09","text":"<p>\u6211\u4eec\u5c06\u5b9e\u73b0\u4e00\u4e2a\u7ecf\u5178\u7684\u53cc\u5747\u7ebf\u7b56\u7565 (Dual Moving Average)\u3002 *   \u4e70\u5165\u4fe1\u53f7\uff1a\u77ed\u671f\u5747\u7ebf\uff08\u5982 5\u65e5\u7ebf\uff09\u4e0a\u7a7f\u957f\u671f\u5747\u7ebf\uff08\u5982 20\u65e5\u7ebf\uff09 -&gt; \u91d1\u53c9\u3002 *   \u5356\u51fa\u4fe1\u53f7\uff1a\u77ed\u671f\u5747\u7ebf\u4e0b\u7a7f\u957f\u671f\u5747\u7ebf -&gt; \u6b7b\u53c9\u3002</p>"},{"location":"quant_guide/#31","title":"3.1 \u5b8c\u6574\u4ee3\u7801\u793a\u4f8b","text":"<p>\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a <code>first_strategy.py</code> \u7684\u6587\u4ef6\uff1a</p> <pre><code>import pandas as pd\nimport numpy as np\nfrom akquant import Strategy, run_backtest\n\nclass DualMovingAverageStrategy(Strategy):\n    def __init__(self):\n        # \u5b9a\u4e49\u7b56\u7565\u53c2\u6570\uff1a\u77ed\u671f\u7a97\u53e35\uff0c\u957f\u671f\u7a97\u53e320\n        self.short_window = 5\n        self.long_window = 20\n\n    def on_bar(self, bar):\n        # \u83b7\u53d6\u5386\u53f2\u6536\u76d8\u4ef7\u6570\u636e\n        # history_data \u8fd4\u56de\u7684\u662f\u4e00\u4e2a DataFrame\n        hist = self.history_data(n=self.long_window + 1)\n\n        # \u5982\u679c\u6570\u636e\u4e0d\u8db3\uff0c\u65e0\u6cd5\u8ba1\u7b97\u5747\u7ebf\uff0c\u76f4\u63a5\u8fd4\u56de\n        if len(hist) &lt; self.long_window:\n            return\n\n        # \u8ba1\u7b97\u77ed\u671f\u548c\u957f\u671f\u5747\u7ebf\n        closes = hist['close'].values\n        ma_short = np.mean(closes[-self.short_window:])\n        ma_long = np.mean(closes[-self.long_window:])\n\n        # \u83b7\u53d6\u4e0a\u4e00\u65f6\u523b\u7684\u5747\u7ebf\u503c\uff08\u7528\u4e8e\u5224\u65ad\u4ea4\u53c9\uff09\n        prev_ma_short = np.mean(closes[-self.short_window-1 : -1])\n        prev_ma_long = np.mean(closes[-self.long_window-1 : -1])\n\n        # \u83b7\u53d6\u5f53\u524d\u6301\u4ed3\n        position = self.get_position(bar.symbol)\n\n        # \u4ea4\u6613\u903b\u8f91\n        # 1. \u91d1\u53c9\uff1a\u77ed\u671f\u5747\u7ebf\u4e0a\u7a7f\u957f\u671f\u5747\u7ebf\uff0c\u4e14\u5f53\u524d\u65e0\u6301\u4ed3 -&gt; \u4e70\u5165\n        if prev_ma_short &lt;= prev_ma_long and ma_short &gt; ma_long:\n            if position == 0:\n                self.buy(bar.symbol, 100) # \u4e70\u5165100\u80a1\n                print(f\"[{bar.datetime}] \u91d1\u53c9\u4e70\u5165 {bar.symbol} @ {bar.close:.2f}\")\n\n        # 2. \u6b7b\u53c9\uff1a\u77ed\u671f\u5747\u7ebf\u4e0b\u7a7f\u957f\u671f\u5747\u7ebf\uff0c\u4e14\u6301\u6709\u4ed3\u4f4d -&gt; \u5356\u51fa\n        elif prev_ma_short &gt;= prev_ma_long and ma_short &lt; ma_long:\n            if position &gt; 0:\n                self.sell(bar.symbol, 100) # \u5356\u51fa100\u80a1\n                print(f\"[{bar.datetime}] \u6b7b\u53c9\u5356\u51fa {bar.symbol} @ {bar.close:.2f}\")\n\n# ------------------------------\n# \u51c6\u5907\u6d4b\u8bd5\u6570\u636e\u5e76\u8fd0\u884c\n# ------------------------------\nif __name__ == \"__main__\":\n    # \u751f\u6210\u6a21\u62df\u6570\u636e\n    dates = pd.date_range(start=\"2023-01-01\", end=\"2023-12-31\")\n    price = 100 + np.cumsum(np.random.randn(len(dates))) # \u968f\u673a\u6e38\u8d70\u4ef7\u683c\n\n    df = pd.DataFrame({\n        \"date\": dates,\n        \"open\": price, \"high\": price + 1, \"low\": price - 1, \"close\": price,\n        \"volume\": 10000,\n        \"symbol\": \"DEMO\"\n    })\n\n    # \u8fd0\u884c\u56de\u6d4b\n    print(\"\u5f00\u59cb\u56de\u6d4b...\")\n    result = run_backtest(\n        strategy_class=DualMovingAverageStrategy,\n        data=df,\n        initial_capital=10000.0 # \u521d\u59cb\u8d44\u91d1 1\u4e07\n    )\n\n    # \u6253\u5370\u7b80\u8981\u7ed3\u679c\n    print(\"\\n\u56de\u6d4b\u7ed3\u675f\uff01\")\n    print(f\"\u6700\u7ec8\u6743\u76ca: {result.final_value:.2f}\")\n    print(f\"\u603b\u6536\u76ca\u7387: {result.total_return * 100:.2f}%\")\n</code></pre>"},{"location":"quant_guide/#32","title":"3.2 \u8fdb\u9636\uff1a\u5982\u4f55\u83b7\u53d6\u771f\u5b9e\u6570\u636e\uff1f","text":"<p>\u4e0a\u9762\u7684\u4f8b\u5b50\u4f7f\u7528\u4e86\u6a21\u62df\u6570\u636e\u3002\u5728\u5b9e\u6218\u4e2d\uff0c\u4f60\u9700\u8981\u83b7\u53d6\u771f\u5b9e\u7684\u80a1\u7968\u6570\u636e\u3002 \u6211\u4eec\u63a8\u8350\u4f7f\u7528 AKShare\uff0c\u5b83\u662f\u76ee\u524d\u6700\u6d41\u884c\u7684\u5f00\u6e90\u4e2d\u6587\u91d1\u878d\u6570\u636e\u63a5\u53e3\u5e93\uff0c\u6570\u636e\u8986\u76d6\u9762\u6781\u5e7f\u3002</p> <p>\u793a\u4f8b\uff1a\u4f7f\u7528 AKShare \u83b7\u53d6\u5e73\u5b89\u94f6\u884c (000001) \u6570\u636e</p> <pre><code>pip install akshare\n</code></pre> <pre><code>import akshare as ak\nimport pandas as pd\n\n# \u4e0b\u8f7d A \u80a1\u5386\u53f2\u6570\u636e (\u5e73\u5b89\u94f6\u884c)\n# adjust=\"qfq\" \u8868\u793a\u4f7f\u7528\u524d\u590d\u6743\u6570\u636e\uff0c\u8fd9\u5728\u56de\u6d4b\u4e2d\u975e\u5e38\u91cd\u8981\n# period=\"daily\" \u8868\u793a\u65e5\u7ebf\u6570\u636e\ndf = ak.stock_zh_a_hist(symbol=\"000001\", period=\"daily\", start_date=\"20230101\", end_date=\"20231231\", adjust=\"qfq\")\n\n# \u6570\u636e\u6e05\u6d17\uff1a\u5c06 AKShare \u7684\u4e2d\u6587\u5217\u540d\u8f6c\u6362\u4e3a AKQuant \u9700\u8981\u7684\u82f1\u6587\u6807\u51c6\u683c\u5f0f\ndf = df.rename(columns={\n    \"\u65e5\u671f\": \"date\",\n    \"\u5f00\u76d8\": \"open\",\n    \"\u6700\u9ad8\": \"high\",\n    \"\u6700\u4f4e\": \"low\",\n    \"\u6536\u76d8\": \"close\",\n    \"\u6210\u4ea4\u91cf\": \"volume\"\n})\n\n# \u683c\u5f0f\u8f6c\u6362\uff1a\u786e\u4fdd date \u5217\u662f datetime \u7c7b\u578b\ndf['date'] = pd.to_datetime(df['date'])\ndf['symbol'] = \"000001\" # \u6dfb\u52a0\u4ee3\u7801\u5217\n\n# \u7b5b\u9009\u9700\u8981\u7684\u5217\uff08\u53ef\u9009\uff0cAKQuant \u4f1a\u81ea\u52a8\u5ffd\u7565\u591a\u4f59\u5217\uff09\ndf = df[[\"date\", \"open\", \"high\", \"low\", \"close\", \"volume\", \"symbol\"]]\n\n# \u76f4\u63a5\u4f20\u5165 run_backtest\nresult = run_backtest(\n    strategy_class=DualMovingAverageStrategy,\n    data=df,\n    initial_capital=10000.0\n)\n</code></pre>"},{"location":"quant_guide/#4","title":"4. \u8bfb\u61c2\u56de\u6d4b\u62a5\u544a\uff1a\u6838\u5fc3\u6307\u6807\u89e3\u8bfb","text":"<p>\u8fd0\u884c\u56de\u6d4b\u540e\uff0cAKQuant \u4f1a\u8f93\u51fa\u4e00\u7cfb\u5217\u6307\u6807\u3002\u4ee5\u4e0b\u662f\u6838\u5fc3\u6307\u6807\u7684\u542b\u4e49\uff1a</p> \u6307\u6807\u540d\u79f0 \u82f1\u6587 \u542b\u4e49\u4e0e\u89e3\u8bfb \u603b\u6536\u76ca\u7387 Total Return \u7b56\u7565\u671f\u672b\u76f8\u5bf9\u4e8e\u671f\u521d\u8d5a\u4e86\u767e\u5206\u4e4b\u591a\u5c11\u3002\u5982\u679c\u662f\u8d1f\u6570\uff0c\u8bf4\u660e\u4e8f\u635f\u3002 \u5e74\u5316\u6536\u76ca\u7387 Annualized Return \u5047\u8bbe\u7b56\u7565\u8fd0\u884c\u4e00\u5e74\u80fd\u8d5a\u591a\u5c11\u3002\u65b9\u4fbf\u4e0d\u540c\u65f6\u957f\u7684\u7b56\u7565\u8fdb\u884c\u6bd4\u8f83\u3002 \u6700\u5927\u56de\u64a4 Max Drawdown \u7b56\u7565\u4ece\u5386\u53f2\u6700\u9ad8\u70b9\u8dcc\u4e0b\u6765\u7684\u6700\u5927\u5e45\u5ea6\u3002\u8861\u91cf\u98ce\u9669\u7684\u91cd\u8981\u6307\u6807\u3002\u4f8b\u5982 -20% \u610f\u5473\u7740\u4f60\u53ef\u80fd\u5728\u6700\u574f\u60c5\u51b5\u4e0b\u4e8f\u635f20%\u3002 \u590f\u666e\u6bd4\u7387 Sharpe Ratio \u8861\u91cf\"\u6027\u4ef7\u6bd4\"\u3002\u5373\u6bcf\u627f\u62c5\u4e00\u5355\u4f4d\u98ce\u9669\uff0c\u80fd\u83b7\u5f97\u591a\u5c11\u8d85\u989d\u6536\u76ca\u3002\u901a\u5e38 &gt;1 \u4e3a\u826f\u597d\uff0c&gt;2 \u4e3a\u4f18\u79c0\u3002 \u80dc\u7387 Win Rate \u76c8\u5229\u4ea4\u6613\u6b21\u6570\u5360\u603b\u4ea4\u6613\u6b21\u6570\u7684\u6bd4\u4f8b\u3002\u9ad8\u80dc\u7387\u4e0d\u4e00\u5b9a\u4ee3\u8868\u9ad8\u6536\u76ca\uff08\u53ef\u80fd\u8d5a\u5c0f\u94b1\u4e8f\u5927\u94b1\uff09\u3002"},{"location":"quant_guide/#5","title":"5. \u5e38\u89c1\u9519\u8bef\u6392\u67e5\u4e0e\u8c03\u8bd5\u6280\u5de7","text":"<p>\u65b0\u624b\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u5e38\u9047\u5230\u4ee5\u4e0b\u95ee\u9898\uff0c\u8bf7\u5bf9\u7167\u68c0\u67e5\uff1a</p>"},{"location":"quant_guide/#51-data-not-enough","title":"5.1 \u6570\u636e\u4e0d\u8db3 (Data Not Enough)","text":"<ul> <li>\u73b0\u8c61\uff1a\u7a0b\u5e8f\u62a5\u9519 <code>IndexError</code> \u6216\u5747\u7ebf\u8ba1\u7b97\u7ed3\u679c\u4e3a <code>NaN</code>\u3002</li> <li>\u539f\u56e0\uff1a\u8ba1\u7b9720\u65e5\u5747\u7ebf\u81f3\u5c11\u9700\u898120\u6761\u5386\u53f2\u6570\u636e\u3002\u5728\u56de\u6d4b\u521a\u5f00\u59cb\u7684\u524d\u51e0\u5929\uff0c\u6570\u636e\u7d2f\u79ef\u4e0d\u8db3\u3002</li> <li>\u89e3\u51b3\uff1a\u5728 <code>on_bar</code> \u5f00\u5934\u6dfb\u52a0\u68c0\u67e5\uff1a     <pre><code>if len(self.history_data(n=20)) &lt; 20:\n    return\n</code></pre></li> </ul>"},{"location":"quant_guide/#52-look-ahead-bias","title":"5.2 \u524d\u89c6\u504f\u5dee (Look-ahead Bias)","text":"<ul> <li>\u73b0\u8c61\uff1a\u56de\u6d4b\u6536\u76ca\u7387\u9ad8\u5f97\u79bb\u8c31\uff08\u4f8b\u5982\u5e74\u5316 1000%\uff09\u3002</li> <li>\u539f\u56e0\uff1a\u5728\u8ba1\u7b97\u4fe1\u53f7\u65f6\u4f7f\u7528\u4e86\u672a\u6765\u7684\u6570\u636e\u3002\u4f8b\u5982\u5728 <code>on_bar</code> \u5904\u7406\u4eca\u5929\u7684\u6570\u636e\u65f6\uff0c\u5374\u53d6\u5230\u4e86\u660e\u5929\u7684\u6536\u76d8\u4ef7\u3002</li> <li>\u89e3\u51b3\uff1a\u786e\u4fdd\u53ea\u4f7f\u7528\u5f53\u524d <code>bar</code> \u53ca\u4e4b\u524d\u7684\u6570\u636e\u3002AKQuant \u7684 <code>history_data</code> \u9ed8\u8ba4\u662f\u5b89\u5168\u7684\u3002</li> </ul>"},{"location":"quant_guide/#53","title":"5.3 \u4ea4\u6613\u672a\u6267\u884c","text":"<ul> <li>\u73b0\u8c61\uff1a\u65e5\u5fd7\u663e\u793a\u53d1\u51fa\u4e86\u4e70\u5355\uff0c\u4f46\u6301\u4ed3\u6ca1\u6709\u53d8\u5316\u3002</li> <li>\u539f\u56e0\uff1a\u53ef\u80fd\u662f\u8d44\u91d1\u4e0d\u8db3\uff08Cash\u4e0d\u591f\u4e701\u624b\uff09\u6216\u672a\u8fbe\u5230\u6700\u5c0f\u4ea4\u6613\u5355\u4f4d\u3002</li> <li>\u89e3\u51b3\uff1a\u6253\u5370 <code>self.cash</code> \u67e5\u770b\u53ef\u7528\u8d44\u91d1\uff1b\u68c0\u67e5 <code>self.buy</code> \u7684\u6570\u91cf\u662f\u5426\u5408\u7406\u3002</li> </ul>"},{"location":"quant_guide/#6","title":"6. \u4e0b\u4e00\u6b65\u5b66\u4e60\u5efa\u8bae","text":"<p>\u606d\u559c\u4f60\u5b8c\u6210\u4e86\u5165\u95e8\u6559\u7a0b\uff01\u60f3\u8981\u6210\u4e3a\u66f4\u4e13\u4e1a\u7684\u91cf\u5316\u4ea4\u6613\u5458\uff0c\u4f60\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0b\u8def\u5f84\u7ee7\u7eed\u4fee\u70bc\uff1a</p>"},{"location":"quant_guide/#61","title":"6.1 \u6280\u80fd\u6811\u70b9\u4eae\u987a\u5e8f","text":"<ol> <li>Python \u8fdb\u9636\uff1a\u719f\u7ec3\u638c\u63e1 <code>pandas</code> \u548c <code>numpy</code>\u3002\u91cf\u5316\u4ea4\u6613 80% \u7684\u65f6\u95f4\u5728\u5904\u7406\u6570\u636e\uff0c\u8fd9\u4e24\u5927\u5e93\u662f\u5904\u7406\u6570\u636e\u7684\u795e\u5175\u5229\u5668\u3002</li> <li>\u7ecf\u5178\u7b56\u7565\u7814\u7a76\uff1a<ul> <li>\u6d77\u9f9f\u4ea4\u6613\u6cd5\u5219 (Turtle Trading)\uff1a\u5b66\u4e60\u8d8b\u52bf\u8ddf\u8e2a\u7cfb\u7edf\u7684\u5b8c\u6574\u6784\u5efa\u3002</li> <li>\u7f51\u683c\u4ea4\u6613 (Grid Trading)\uff1a\u5b66\u4e60\u9707\u8361\u5e02\u7684\u81ea\u52a8\u5316\u5957\u5229\u3002</li> <li>\u591a\u56e0\u5b50\u6a21\u578b (Multi-Factor)\uff1a\u5b66\u4e60\u673a\u6784\u4e3b\u6d41\u7684\u9009\u80a1\u903b\u8f91\u3002</li> </ul> </li> <li>\u98ce\u9669\u7ba1\u7406\uff1a\u6df1\u5165\u7406\u89e3\u51ef\u5229\u516c\u5f0f (Kelly Criterion)\u3001\u6ce2\u52a8\u7387\u63a7\u5236\u7b49\u8d44\u91d1\u7ba1\u7406\u65b9\u6cd5\u3002</li> <li>\u673a\u5668\u5b66\u4e60\uff1a\u5c1d\u8bd5\u7528\u673a\u5668\u5b66\u4e60\u6a21\u578b\uff08\u5982\u968f\u673a\u68ee\u6797\u3001LSTM\uff09\u6765\u9884\u6d4b\u4ef7\u683c\u6216\u6ce2\u52a8\u7387\uff08\u53c2\u8003 ML Guide\uff09\u3002</li> </ol>"},{"location":"quant_guide/#62","title":"6.2 \u63a8\u8350\u8d44\u6e90","text":"<ul> <li>\u4e66\u7c4d\uff1a\u300a\u6253\u5f00\u91cf\u5316\u6295\u8d44\u7684\u9ed1\u7bb1\u300b\u3001\u300a\u6d77\u9f9f\u4ea4\u6613\u6cd5\u5219\u300b\u3001\u300aPython for Finance\u300b\u3002</li> <li>\u5b9e\u6218\uff1a\u591a\u770b Examples \u4e2d\u7684\u4ee3\u7801\uff0c\u5c1d\u8bd5\u4fee\u6539\u53c2\u6570\uff0c\u89c2\u5bdf\u7ed3\u679c\u53d8\u5316\u3002</li> </ul> <p>\u5e0c\u671b\u8fd9\u4efd\u6307\u5357\u80fd\u5e2e\u4f60\u987a\u5229\u5f00\u542f\u91cf\u5316\u4e4b\u65c5\uff01\u66f4\u591a\u8fdb\u9636\u529f\u80fd\u8bf7\u53c2\u8003 API \u6587\u6863\u3002</p>"},{"location":"quickstart/","title":"\u5feb\u901f\u5f00\u59cb","text":"<p>\u6b22\u8fce\u4f7f\u7528 AKQuant\uff01\u8ba9\u6211\u4eec\u7528\u6700\u5feb\u7684\u901f\u5ea6\u8fd0\u884c\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u7b56\u7565\u3002</p>"},{"location":"quickstart/#1","title":"1. \u5b89\u88c5","text":"<p>\u6253\u5f00\u7ec8\u7aef\uff0c\u8fd0\u884c\uff1a</p> <pre><code>pip install akquant\n</code></pre>"},{"location":"quickstart/#2","title":"2. \u6781\u7b80\u793a\u4f8b\uff1a\u4e70\u5165\u5e76\u6301\u6709","text":"<p>\u590d\u5236\u4e0b\u9762\u7684\u4ee3\u7801\u5230 <code>quickstart.py</code> \u5e76\u8fd0\u884c\u3002\u8fd9\u4e2a\u7b56\u7565\u975e\u5e38\u7b80\u5355\uff1a\u5728\u7b2c\u4e00\u5929\u4e70\u5165 100 \u80a1\uff0c\u7136\u540e\u4e00\u76f4\u6301\u6709\u3002</p> <pre><code>import pandas as pd\nfrom akquant import Strategy, run_backtest\n\n# 1. \u7b56\u7565\u5b9a\u4e49\nclass BuyAndHold(Strategy):\n    def on_bar(self, bar):\n        # \u5982\u679c\u5f53\u524d\u6ca1\u6709\u6301\u4ed3\uff0c\u5c31\u4e70\u5165 100 \u80a1\n        if self.get_position(bar.symbol) == 0:\n            print(f\"[{bar.timestamp_str}] \u4e70\u5165 {bar.symbol}\")\n            self.buy(bar.symbol, 100)\n\n# 2. \u51c6\u5907\u6570\u636e (\u8fd9\u91cc\u751f\u6210\u4e00\u4e2a\u7b80\u5355\u7684\u6a21\u62df\u6570\u636e)\ndates = pd.date_range(\"2023-01-01\", periods=100)\ndf = pd.DataFrame({\n    \"date\": dates,\n    \"open\": 10.0, \"high\": 11.0, \"low\": 9.0, \"close\": 10.0, # \u5047\u8bbe\u4ef7\u683c\u4e00\u76f4\u6a2a\u76d8\n    \"volume\": 1000,\n    \"symbol\": \"DEMO\"\n})\n\n# 3. \u8fd0\u884c\u56de\u6d4b\nprint(\"\u5f00\u59cb\u56de\u6d4b...\")\nresult = run_backtest(\n    data=df,\n    strategy=BuyAndHold,\n    cash=10000.0\n)\n\n# 4. \u67e5\u770b\u7ed3\u679c\nprint(result)\n</code></pre> <p>\u8fd0\u884c\u7ed3\u679c\u4e2d\uff0c\u4f60\u4f1a\u770b\u5230 <code>total_return</code> (\u603b\u6536\u76ca), <code>max_drawdown</code> (\u6700\u5927\u56de\u64a4) \u7b49\u6838\u5fc3\u6307\u6807\u3002</p>"},{"location":"quickstart/#3","title":"3. \u8fdb\u9636\u5b66\u4e60","text":"<p>\u521a\u624d\u7684\u4f8b\u5b50\u592a\u7b80\u5355\u4e86\uff1f\u60f3\u8981\u5b66\u4e60\u5982\u4f55\u7f16\u5199\u771f\u6b63\u7684\u91cf\u5316\u7b56\u7565\uff08\u5982\u53cc\u5747\u7ebf\u3001MACD \u7b49\uff09\uff1f</p> <p>\ud83d\udc49 \u8bf7\u9605\u8bfb \u624b\u628a\u624b\u6559\u7a0b\uff1a\u7f16\u5199\u4f60\u7684\u7b2c\u4e00\u4e2a\u91cf\u5316\u7b56\u7565</p> <p>\u8be5\u6559\u7a0b\u5c06\u8be6\u7ec6\u8bb2\u89e3\uff1a</p> <ul> <li>\u5982\u4f55\u83b7\u53d6\u5386\u53f2\u6570\u636e (<code>get_history</code>)</li> <li>\u5982\u4f55\u8ba1\u7b97\u6280\u672f\u6307\u6807 (MA, RSI)</li> <li>\u5982\u4f55\u6b62\u76c8\u6b62\u635f</li> </ul>"},{"location":"strategy_guide/","title":"\u7b56\u7565\u7f16\u5199\u6307\u5357","text":"<p>\u672c\u6587\u6863\u65e8\u5728\u5e2e\u52a9\u7b56\u7565\u5f00\u53d1\u8005\u5feb\u901f\u638c\u63e1 AKQuant \u7684\u7b56\u7565\u7f16\u5199\u65b9\u6cd5\u3002</p>"},{"location":"strategy_guide/#1-glossary","title":"1. \u6838\u5fc3\u6982\u5ff5 (Glossary)","text":"<p>\u5bf9\u4e8e\u91cf\u5316\u4ea4\u6613\u7684\u65b0\u624b\uff0c\u8fd9\u91cc\u6709\u4e00\u4e9b\u57fa\u7840\u672f\u8bed\u7684\u89e3\u91ca\uff1a</p> <ul> <li>Bar (K\u7ebf): \u5305\u542b\u4e86\u67d0\u4e00\u6bb5\u65f6\u95f4\uff08\u59821\u5206\u949f\u30011\u5929\uff09\u5185\u7684\u5e02\u573a\u884c\u60c5\uff0c\u4e3b\u8981\u5305\u542b 5 \u4e2a\u6570\u636e\uff1a<ul> <li>Open: \u5f00\u76d8\u4ef7</li> <li>High: \u6700\u9ad8\u4ef7</li> <li>Low: \u6700\u4f4e\u4ef7</li> <li>Close: \u6536\u76d8\u4ef7</li> <li>Volume: \u6210\u4ea4\u91cf</li> </ul> </li> <li>Strategy (\u7b56\u7565): \u4f60\u7684\u4ea4\u6613\u673a\u5668\u4eba\u3002\u5b83\u7684\u6838\u5fc3\u5de5\u4f5c\u5c31\u662f\u4e0d\u65ad\u5730\u770b\u884c\u60c5 (on_bar)\uff0c\u7136\u540e\u51b3\u5b9a\u4e70 (buy) \u8fd8\u662f\u5356 (sell)\u3002</li> <li>Context (\u4e0a\u4e0b\u6587): \u673a\u5668\u4eba\u7684\u201c\u8bb0\u4e8b\u672c\u201d\u548c\u201c\u5de5\u5177\u7bb1\u201d\u3002\u91cc\u9762\u8bb0\u5f55\u4e86\u5f53\u524d\u6709\u591a\u5c11\u94b1 (cash)\u3001\u6709\u591a\u5c11\u80a1\u7968 (positions)\uff0c\u4e5f\u63d0\u4f9b\u4e86\u4e0b\u5355\u7684\u5de5\u5177\u3002</li> <li>Position (\u6301\u4ed3): \u4f60\u5f53\u524d\u6301\u6709\u7684\u80a1\u7968\u6216\u671f\u8d27\u6570\u91cf\u3002\u6b63\u6570\u8868\u793a\u591a\u5934\uff08\u4e70\u5165\u6301\u6709\uff09\uff0c\u8d1f\u6570\u8868\u793a\u7a7a\u5934\uff08\u501f\u5238\u5356\u51fa\uff09\u3002</li> <li>Backtest (\u56de\u6d4b): \u5386\u53f2\u6a21\u62df\u3002\u7528\u8fc7\u53bb\u7684\u6570\u636e\u6765\u6d4b\u8bd5\u4f60\u7684\u7b56\u7565\uff0c\u770b\u770b\u5982\u679c\u8fc7\u53bb\u8fd9\u4e48\u505a\uff0c\u80fd\u8d5a\u591a\u5c11\u94b1\u3002</li> </ul>"},{"location":"strategy_guide/#2","title":"2. \u7b56\u7565\u751f\u547d\u5468\u671f","text":"<p>\u4e00\u4e2a\u7b56\u7565\u4ece\u5f00\u59cb\u5230\u7ed3\u675f\uff0c\u4f1a\u7ecf\u5386\u4ee5\u4e0b\u51e0\u4e2a\u9636\u6bb5\uff1a</p> <ul> <li><code>__init__</code>: Python \u5bf9\u8c61\u521d\u59cb\u5316\uff0c\u9002\u5408\u5b9a\u4e49\u53c2\u6570\u3002</li> <li><code>on_start</code>: \u7b56\u7565\u542f\u52a8\u65f6\u8c03\u7528\uff0c\u5fc5\u987b\u5728\u6b64\u5904\u4f7f\u7528 <code>self.subscribe()</code> \u8ba2\u9605\u6570\u636e\uff0c\u4e5f\u53ef\u5728\u6b64\u6ce8\u518c\u6307\u6807\u3002</li> <li><code>on_bar</code>: \u6bcf\u4e00\u6839 K \u7ebf\u95ed\u5408\u65f6\u89e6\u53d1 (\u6838\u5fc3\u4ea4\u6613\u903b\u8f91)\u3002</li> <li><code>on_tick</code>: \u6bcf\u4e00\u4e2a Tick \u5230\u8fbe\u65f6\u89e6\u53d1 (\u9ad8\u9891/\u76d8\u53e3\u7b56\u7565)\u3002</li> <li><code>on_order</code>: \u8ba2\u5355\u72b6\u6001\u53d8\u5316\u65f6\u89e6\u53d1 (\u5982\u63d0\u4ea4\u3001\u6210\u4ea4\u3001\u53d6\u6d88)\u3002</li> <li><code>on_trade</code>: \u6536\u5230\u6210\u4ea4\u56de\u62a5\u65f6\u89e6\u53d1\u3002</li> <li><code>on_timer</code>: \u5b9a\u65f6\u5668\u89e6\u53d1\u65f6\u8c03\u7528 (\u9700\u624b\u52a8\u6ce8\u518c)\u3002</li> <li><code>on_stop</code>: \u7b56\u7565\u505c\u6b62\u65f6\u8c03\u7528\uff0c\u9002\u5408\u8fdb\u884c\u8d44\u6e90\u6e05\u7406\u6216\u7ed3\u679c\u7edf\u8ba1 (\u53c2\u8003 Backtrader <code>stop</code> / Nautilus <code>on_stop</code>)\u3002</li> <li><code>on_train_signal</code>: \u6eda\u52a8\u8bad\u7ec3\u89e6\u53d1\u4fe1\u53f7 (\u4ec5\u5728 ML \u6a21\u5f0f\u4e0b\u89e6\u53d1)\u3002</li> </ul>"},{"location":"strategy_guide/#style-selection","title":"3. \u7b56\u7565\u98ce\u683c\u9009\u62e9","text":"<p>AKQuant \u63d0\u4f9b\u4e86\u4e24\u79cd\u98ce\u683c\u7684\u7b56\u7565\u5f00\u53d1\u63a5\u53e3\uff1a</p> \u7279\u6027 \u7c7b\u98ce\u683c (\u63a8\u8350) \u51fd\u6570\u98ce\u683c \u5b9a\u4e49\u65b9\u5f0f \u7ee7\u627f <code>akquant.Strategy</code> \u5b9a\u4e49 <code>initialize</code> \u548c <code>on_bar</code> \u51fd\u6570 \u9002\u7528\u573a\u666f \u590d\u6742\u7b56\u7565\u3001\u9700\u8981\u7ef4\u62a4\u5185\u90e8\u72b6\u6001\u3001\u751f\u4ea7\u73af\u5883 \u5feb\u901f\u539f\u578b\u9a8c\u8bc1\u3001\u8fc1\u79fb Zipline/Backtrader \u7b56\u7565 \u4ee3\u7801\u7ed3\u6784 \u9762\u5411\u5bf9\u8c61\uff0c\u903b\u8f91\u5c01\u88c5\u6027\u597d \u811a\u672c\u5316\uff0c\u7b80\u5355\u76f4\u89c2 API \u8c03\u7528 <code>self.buy()</code>, <code>self.ctx</code> <code>ctx.buy()</code>, <code>ctx</code> \u4f5c\u4e3a\u53c2\u6570\u4f20\u9012"},{"location":"strategy_guide/#class-based","title":"4. \u7f16\u5199\u7c7b\u98ce\u683c\u7b56\u7565 (Class-based)","text":"<p>\u8fd9\u662f AKQuant \u63a8\u8350\u7684\u7b56\u7565\u7f16\u5199\u65b9\u5f0f\uff0c\u7ed3\u6784\u6e05\u6670\uff0c\u6613\u4e8e\u6269\u5c55\u3002</p> <pre><code>from akquant import Strategy, Bar\nimport numpy as np\n\nclass MyStrategy(Strategy):\n    def __init__(self, ma_window=20):\n        # \u6ce8\u610f: Strategy \u7c7b\u4f7f\u7528\u4e86 __new__ \u8fdb\u884c\u521d\u59cb\u5316\uff0c\u5b50\u7c7b\u4e0d\u518d\u9700\u8981\u8c03\u7528 super().__init__()\n        self.ma_window = ma_window\n\n    def on_start(self):\n        # \u663e\u5f0f\u8ba2\u9605\u6570\u636e\n        self.subscribe(\"600000\")\n\n    def on_bar(self, bar: Bar):\n        # 1. \u83b7\u53d6\u5386\u53f2\u6570\u636e (Online \u6a21\u5f0f)\n        # \u83b7\u53d6\u6700\u8fd1 N \u4e2a\u6536\u76d8\u4ef7\n        history = self.get_history(count=self.ma_window, symbol=bar.symbol, field=\"close\")\n\n        # \u68c0\u67e5\u6570\u636e\u662f\u5426\u8db3\u591f\n        if len(history) &lt; self.ma_window:\n            return\n\n        # \u8ba1\u7b97\u5747\u7ebf\n        ma_value = np.mean(history)\n\n        # 2. \u4ea4\u6613\u903b\u8f91\n        # \u83b7\u53d6\u5f53\u524d\u6301\u4ed3\n        pos = self.get_position(bar.symbol)\n\n        if bar.close &gt; ma_value and pos == 0:\n            self.buy(symbol=bar.symbol, quantity=100)\n        elif bar.close &lt; ma_value and pos &gt; 0:\n            self.sell(symbol=bar.symbol, quantity=100)\n</code></pre>"},{"location":"strategy_guide/#5-orders-execution","title":"5. \u8ba2\u5355\u4e0e\u4ea4\u6613\u8be6\u89e3 (Orders &amp; Execution)","text":""},{"location":"strategy_guide/#51","title":"5.1 \u8ba2\u5355\u751f\u547d\u5468\u671f","text":"<p>\u5728 AKQuant \u4e2d\uff0c\u8ba2\u5355\u72b6\u6001\u6d41\u8f6c\u5982\u4e0b\uff1a</p> <ol> <li>New: \u8ba2\u5355\u5bf9\u8c61\u88ab\u521b\u5efa\u3002</li> <li>Submitted: \u8ba2\u5355\u5df2\u53d1\u9001\u7ed9\u4ea4\u6613\u6240/\u4eff\u771f\u64ae\u5408\u5f15\u64ce\u3002</li> <li>Accepted: (\u5b9e\u76d8\u6a21\u5f0f) \u4ea4\u6613\u6240\u786e\u8ba4\u63a5\u6536\u8ba2\u5355\u3002</li> <li>Filled: \u8ba2\u5355\u5168\u90e8\u6210\u4ea4\u3002<ul> <li>PartiallyFilled: \u90e8\u5206\u6210\u4ea4 (\u76ee\u524d\u72b6\u6001\u7801\u7edf\u4e00\u4e3a Filled\uff0c\u9700\u901a\u8fc7 <code>filled_quantity</code> \u5224\u65ad)\u3002</li> </ul> </li> <li>Cancelled: \u8ba2\u5355\u5df2\u53d6\u6d88\u3002</li> <li>Rejected: \u8ba2\u5355\u88ab\u98ce\u63a7\u6216\u4ea4\u6613\u6240\u62d2\u7edd (\u5982\u8d44\u91d1\u4e0d\u8db3\u3001\u8d85\u51fa\u6da8\u8dcc\u505c)\u3002</li> </ol>"},{"location":"strategy_guide/#52","title":"5.2 \u5e38\u7528\u4ea4\u6613\u6307\u4ee4","text":"<ul> <li>\u5e02\u4ef7\u5355 (Market Order):     <pre><code>self.buy(symbol=\"AAPL\", quantity=100) # \u5e02\u4ef7\u4e70\u5165\nself.sell(symbol=\"AAPL\", quantity=100) # \u5e02\u4ef7\u5356\u51fa\n</code></pre></li> <li>\u9650\u4ef7\u5355 (Limit Order):     \u6307\u5b9a\u4ef7\u683c\u6210\u4ea4\uff0c\u53ea\u6709\u5f53\u5e02\u573a\u4ef7\u683c\u8fbe\u5230\u6216\u4f18\u4e8e\u6307\u5b9a\u4ef7\u683c\u65f6\u624d\u6210\u4ea4\u3002     <pre><code>self.buy(symbol=\"AAPL\", quantity=100, price=150.0) # \u9650\u4ef7 150 \u4e70\u5165\n</code></pre></li> <li>\u6b62\u635f\u5355 (Stop Order):     \u5f53\u5e02\u4ef7\u89e6\u53ca\u89e6\u53d1\u4ef7 (<code>trigger_price</code>) \u65f6\uff0c\u8f6c\u5316\u4e3a\u5e02\u4ef7\u5355\u3002     <pre><code># \u5f53\u4ef7\u683c\u8dcc\u7834 140 \u65f6\uff0c\u5e02\u4ef7\u5356\u51fa\u6b62\u635f\nself.stop_sell(symbol=\"AAPL\", quantity=100, trigger_price=140.0)\n</code></pre></li> <li>\u76ee\u6807\u4ed3\u4f4d (Target Orders):     \u81ea\u52a8\u8ba1\u7b97\u4e70\u5356\u6570\u91cf\uff0c\u5c06\u4ed3\u4f4d\u8c03\u6574\u5230\u76ee\u6807\u503c\u3002     <pre><code># \u8c03\u6574\u4ed3\u4f4d\u5230\u603b\u8d44\u4ea7\u7684 50%\nself.order_target_percent(target_percent=0.5, symbol=\"AAPL\", price=None)\n\n# \u8c03\u6574\u6301\u4ed3\u5230 1000 \u80a1 (\u5982\u679c\u662f 0 \u5219\u4e70\u5165 1000\uff0c\u5982\u679c\u662f 2000 \u5219\u5356\u51fa 1000)\nself.order_target_value(target_value=1000 * price, symbol=\"AAPL\") # \u6ce8\u610f\u8fd9\u91cc API \u6682\u672a\u76f4\u63a5\u652f\u6301 target_share\uff0c\u53ef\u7528 value \u6a21\u62df\n</code></pre></li> </ul>"},{"location":"strategy_guide/#53","title":"5.3 \u64ae\u5408\u6a21\u5f0f","text":"<p>\u901a\u8fc7 <code>engine.set_execution_mode(mode)</code> \u8bbe\u7f6e\uff08\u6216\u5728 <code>run_backtest</code> \u4e2d\u4f20\u5165 <code>execution_mode</code> \u53c2\u6570\uff09\uff1a</p> <ul> <li>NextOpen (\u9ed8\u8ba4): \u4fe1\u53f7\u5728\u4e0b\u4e00\u4e2a Bar \u7684\u5f00\u76d8\u65f6\u64ae\u5408\u3002\u8fd9\u662f\u66f4\u4e25\u8c28\u7684\u56de\u6d4b\u65b9\u5f0f\uff0c\u7b26\u5408\u5b9e\u76d8\u903b\u8f91\uff08\u4eca\u6536\u76d8\u540e\u6302\u5355\uff0c\u660e\u5f00\u76d8\u64ae\u5408\uff09\u3002</li> <li>CurrentClose: \u4fe1\u53f7\u5728\u5f53\u524d Bar \u6536\u76d8\u65f6\u7acb\u5373\u64ae\u5408\u3002\u9002\u5408\u5229\u7528\u6536\u76d8\u4ef7\u8fdb\u884c\u7ed3\u7b97\u7684\u7279\u6b8a\u7b56\u7565\uff0c\u6216\u8005\u65e0\u6cd5\u83b7\u53d6\u6b21\u65e5\u6570\u636e\u7684\u573a\u666f\u3002</li> </ul>"},{"location":"strategy_guide/#callbacks","title":"5.4 \u4e8b\u4ef6\u56de\u8c03 (Event Callbacks)","text":"<p>AKQuant \u63d0\u4f9b\u4e86\u7c7b\u4f3c Backtrader \u7684\u56de\u8c03\u673a\u5236\uff0c\u7528\u4e8e\u8ffd\u8e2a\u8ba2\u5355\u72b6\u6001\u548c\u6210\u4ea4\u8bb0\u5f55\u3002</p>"},{"location":"strategy_guide/#541-on_order","title":"5.4.1 \u8ba2\u5355\u72b6\u6001\u56de\u8c03 (<code>on_order</code>)","text":"<p>\u5f53\u8ba2\u5355\u72b6\u6001\u53d1\u751f\u53d8\u5316\uff08\u5982\u4ece <code>New</code> \u53d8\u4e3a <code>Submitted</code>\uff0c\u6216\u53d8\u4e3a <code>Filled</code>\uff09\u65f6\u89e6\u53d1\u3002</p> <pre><code>from akquant import OrderStatus\n\ndef on_order(self, order):\n    if order.status == OrderStatus.Filled:\n        print(f\"\u8ba2\u5355\u6210\u4ea4: {order.symbol} \u65b9\u5411: {order.side} \u6570\u91cf: {order.filled_quantity}\")\n    elif order.status == OrderStatus.Cancelled:\n        print(f\"\u8ba2\u5355\u5df2\u53d6\u6d88: {order.id}\")\n</code></pre>"},{"location":"strategy_guide/#542-on_trade","title":"5.4.2 \u6210\u4ea4\u56de\u62a5\u56de\u8c03 (<code>on_trade</code>)","text":"<p>\u5f53\u53d1\u751f\u771f\u5b9e\u6210\u4ea4\u65f6\u89e6\u53d1\u3002\u4e0e <code>on_order</code> \u4e0d\u540c\uff0c<code>on_trade</code> \u5305\u542b\u5177\u4f53\u7684\u6210\u4ea4\u4ef7\u683c\u3001\u6570\u91cf\u548c\u624b\u7eed\u8d39\u4fe1\u606f\u3002</p> <pre><code>def on_trade(self, trade):\n    print(f\"\u6210\u4ea4\u56de\u62a5: {trade.symbol} \u4ef7\u683c: {trade.price} \u6570\u91cf: {trade.quantity} \u624b\u7eed\u8d39: {trade.commission}\")\n</code></pre>"},{"location":"strategy_guide/#6-risk-management","title":"6. \u98ce\u9669\u63a7\u5236 (Risk Management)","text":"<p>AKQuant \u5185\u7f6e\u4e86 Rust \u5c42\u9762\u7684\u98ce\u63a7\u7ba1\u7406\u5668\uff0c\u53ef\u4ee5\u5728\u56de\u6d4b\u4e2d\u6a21\u62df\u4ea4\u6613\u6240\u6216\u5238\u5546\u7684\u98ce\u63a7\u89c4\u5219\u3002</p> <pre><code>from akquant import RiskConfig\n\n# \u5728 Engine \u521d\u59cb\u5316\u540e\u8bbe\u7f6e\nrisk_config = RiskConfig()\nrisk_config.active = True\nrisk_config.max_order_value = 1_000_000.0  # \u5355\u7b14\u6700\u5927 100\u4e07\nrisk_config.max_position_size = 5000       # \u5355\u6807\u7684\u6700\u5927\u6301\u4ed3 5000 \u80a1\nrisk_config.restricted_list = [\"ST\u80a1\u7968\"]    # \u9ed1\u540d\u5355 (Symbol)\n\nengine.risk_manager.config = risk_config # \u5e94\u7528\u914d\u7f6e\n</code></pre> <p>\u5982\u679c\u8ba2\u5355\u8fdd\u53cd\u98ce\u63a7\u89c4\u5219\uff0c<code>self.buy()</code> \u7b49\u51fd\u6570\u4f1a\u8fd4\u56de <code>None</code> \u6216\u751f\u6210\u7684\u8ba2\u5355\u72b6\u6001\u76f4\u63a5\u4e3a <code>Rejected</code>\uff0c\u5e76\u4f1a\u5728\u65e5\u5fd7\u4e2d\u8bb0\u5f55\u539f\u56e0\u3002</p>"},{"location":"strategy_guide/#indicatorset","title":"7. \u4f7f\u7528\u9ad8\u6027\u80fd\u6307\u6807 (Built-in Indicators)","text":"<p>AKQuant \u5728 Rust \u5c42\u5185\u7f6e\u4e86\u5e38\u7528\u7684\u6280\u672f\u6307\u6807\uff0c\u901a\u8fc7\u589e\u91cf\u8ba1\u7b97 (Incremental Calculation) \u907f\u514d\u4e86\u91cd\u590d\u7684\u5168\u91cf\u8ba1\u7b97\uff0c\u6027\u80fd\u6781\u9ad8\u3002</p> <p>\u652f\u6301\u7684\u6307\u6807: <code>SMA</code>, <code>EMA</code>, <code>MACD</code>, <code>RSI</code>, <code>BollingerBands</code>, <code>ATR</code>.</p>"},{"location":"strategy_guide/#71","title":"7.1 \u6ce8\u518c\u4e0e\u4f7f\u7528","text":"<pre><code>from akquant import Strategy\nfrom akquant.indicators import SMA, RSI\n\nclass IndicatorStrategy(Strategy):\n    def on_start(self):\n        self.subscribe(\"AAPL\")\n\n        # \u6ce8\u518c\u6307\u6807: \u81ea\u52a8\u5904\u7406\u6570\u636e\u66f4\u65b0\n        # \u53c2\u6570: period=20\n        self.register_indicator(\"sma20\", SMA(20))\n\n        # \u6ce8\u518c RSI\n        self.register_indicator(\"rsi14\", RSI(14))\n\n    def on_bar(self, bar):\n        # \u76f4\u63a5\u8bbf\u95ee\u6307\u6807\u503c\n        # \u6ce8\u610f: \u5982\u679c\u6307\u6807\u5c1a\u672a\u51c6\u5907\u597d (\u6570\u636e\u4e0d\u8db3)\uff0cvalue \u53ef\u80fd\u4e3a None\n        sma_val = self.sma20.value\n        rsi_val = self.rsi14.value\n\n        if sma_val is None or rsi_val is None:\n            return\n\n        if bar.close &gt; sma_val and rsi_val &lt; 30:\n            self.buy(bar.symbol, 100)\n</code></pre>"},{"location":"strategy_guide/#8-cookbook","title":"8. \u5e38\u7528\u7b56\u7565\u6a21\u5f0f (Cookbook)","text":""},{"location":"strategy_guide/#81-trailing-stop","title":"8.1 \u79fb\u52a8\u6b62\u635f (Trailing Stop)","text":"<pre><code>class TrailingStopStrategy(Strategy):\n    def __init__(self):\n        self.highest_price = 0.0\n        self.trailing_percent = 0.05 # 5% \u56de\u64a4\u6b62\u635f\n\n    def on_bar(self, bar):\n        pos = self.get_position(bar.symbol)\n\n        if pos &gt; 0:\n            # \u66f4\u65b0\u6700\u9ad8\u4ef7\n            self.highest_price = max(self.highest_price, bar.high)\n\n            # \u68c0\u67e5\u56de\u64a4\n            drawdown = (self.highest_price - bar.close) / self.highest_price\n            if drawdown &gt; self.trailing_percent:\n                print(f\"\u89e6\u53d1\u79fb\u52a8\u6b62\u635f: \u6700\u9ad8 {self.highest_price}, \u5f53\u524d {bar.close}\")\n                self.close_position(bar.symbol)\n                self.highest_price = 0.0 # \u91cd\u7f6e\n        else:\n            # \u5f00\u4ed3\u903b\u8f91 (\u793a\u4f8b)\n            if bar.close &gt; 100:\n                self.buy(bar.symbol, 100)\n                self.highest_price = bar.close # \u521d\u59cb\u5316\u6700\u9ad8\u4ef7\n</code></pre>"},{"location":"strategy_guide/#82-intraday-exit","title":"8.2 \u5b9a\u65f6\u5e73\u4ed3 (Intraday Exit)","text":"<pre><code>class IntradayStrategy(Strategy):\n    def on_bar(self, bar):\n        # \u5047\u8bbe bar.timestamp \u662f\u7eb3\u79d2\u65f6\u95f4\u6233\n        # \u8f6c\u6362\u4e3a datetime (\u9700\u8981 import datetime)\n        dt = datetime.fromtimestamp(bar.timestamp / 1e9)\n\n        # \u6bcf\u5929 14:55 \u5f3a\u5236\u5e73\u4ed3\n        if dt.hour == 14 and dt.minute &gt;= 55:\n            if self.get_position(bar.symbol) != 0:\n                self.close_position(bar.symbol)\n            return\n\n        # \u5176\u4ed6\u4ea4\u6613\u903b\u8f91...\n</code></pre>"},{"location":"strategy_guide/#multi-asset","title":"8.3 \u591a\u54c1\u79cd\u8f6e\u52a8","text":"<pre><code>class RotationStrategy(Strategy):\n    def on_bar(self, bar):\n        # \u6ce8\u610f: on_bar \u662f\u9488\u5bf9\u6bcf\u4e2a symbol \u89e6\u53d1\u7684\n        # \u5982\u679c\u9700\u8981\u5168\u5e02\u573a\u6a2a\u622a\u9762\u6bd4\u8f83\uff0c\u5efa\u8bae\u5728 on_timer \u6216 \u6536\u96c6\u5b8c\u6240\u6709 bar \u540e\u5904\u7406\n        # \u8fd9\u91cc\u5c55\u793a\u7b80\u5355\u7684\u72ec\u7acb\u5904\u7406\n        pass\n\n    def on_timer(self, payload):\n        # \u5047\u8bbe\u6ce8\u518c\u4e86\u4e00\u4e2a\u6bcf\u65e5\u5b9a\u65f6\u5668\n        # \u83b7\u53d6\u6240\u6709\u8ba2\u9605\u6807\u7684\u7684\u5f53\u524d\u4ef7\u683c\n        scores = {}\n        for symbol in self.ctx.portfolio.positions.keys(): # \u4ec5\u793a\u4f8b\uff0c\u5b9e\u9645\u5e94\u904d\u5386\u5173\u6ce8\u5217\u8868\n             hist = self.get_history(20, symbol)\n             scores[symbol] = hist[-1] / hist[0] # 20\u65e5\u52a8\u91cf\n\n        # \u6392\u5e8f\u5e76\u8c03\u4ed3...\n</code></pre>"},{"location":"strategy_guide/#9-mixed-asset-configuration","title":"9. \u591a\u8d44\u4ea7\u6df7\u5408\u56de\u6d4b\u914d\u7f6e (Mixed Asset Configuration)","text":"<p>AKQuant \u652f\u6301\u5728\u540c\u4e00\u4e2a\u7b56\u7565\u4e2d\u6df7\u5408\u4ea4\u6613\u80a1\u7968\u3001\u671f\u8d27\u3001\u671f\u6743\u7b49\u591a\u79cd\u8d44\u4ea7\u3002\u4e0d\u540c\u8d44\u4ea7\u901a\u5e38\u5177\u6709\u4e0d\u540c\u7684\u5c5e\u6027\uff08\u5982\u5408\u7ea6\u4e58\u6570\u3001\u4fdd\u8bc1\u91d1\u7387\u3001\u6700\u5c0f\u53d8\u52a8\u4ef7\u4f4d\uff09\u3002</p> <p>\u4f7f\u7528 <code>InstrumentConfig</code> \u53ef\u4ee5\u65b9\u4fbf\u5730\u4e3a\u6bcf\u4e2a\u6807\u7684\u914d\u7f6e\u8fd9\u4e9b\u5c5e\u6027\u3002</p>"},{"location":"strategy_guide/#91","title":"9.1 \u914d\u7f6e\u6b65\u9aa4","text":"<ol> <li>\u51c6\u5907\u6570\u636e: \u4e3a\u6bcf\u4e2a\u6807\u7684\u51c6\u5907\u6570\u636e (DataFrame \u6216 CSV)\u3002</li> <li>\u521b\u5efa\u914d\u7f6e: \u4f7f\u7528 <code>InstrumentConfig</code> \u5b9a\u4e49\u975e\u80a1\u7968\u8d44\u4ea7\u7684\u53c2\u6570\u3002</li> <li>\u8fd0\u884c\u56de\u6d4b: \u5c06\u914d\u7f6e\u4f20\u9012\u7ed9 <code>run_backtest</code> \u7684 <code>instruments_config</code> \u53c2\u6570\u3002</li> </ol>"},{"location":"strategy_guide/#92","title":"9.2 \u914d\u7f6e\u793a\u4f8b","text":"<p>\u5047\u8bbe\u6211\u4eec\u8981\u56de\u6d4b\u4e00\u4e2a\u5305\u542b \"\u80a1\u7968 A\" \u548c \"\u80a1\u6307\u671f\u8d27 IF\" \u7684\u6295\u8d44\u7ec4\u5408\uff1a</p> <pre><code>from akquant import InstrumentConfig, run_backtest\n\n# 1. \u5b9a\u4e49\u671f\u8d27\u914d\u7f6e\nfuture_config = InstrumentConfig(\n    symbol=\"IF2301\",          # \u6807\u7684\u4ee3\u7801\n    asset_type=\"FUTURES\",     # \u8d44\u4ea7\u7c7b\u578b: STOCK, FUTURES, OPTION\n    multiplier=300.0,         # \u5408\u7ea6\u4e58\u6570 (1\u70b9 300\u5143)\n    margin_ratio=0.1,         # \u4fdd\u8bc1\u91d1\u7387 (10%)\n    tick_size=0.2             # \u6700\u5c0f\u53d8\u52a8\u4ef7\u4f4d\n)\n\n# 2. \u8fd0\u884c\u56de\u6d4b\n# \u6ce8\u610f: \u672a\u914d\u7f6e\u7684\u6807\u7684 (\u5982 STOCK_A) \u5c06\u4f7f\u7528\u9ed8\u8ba4\u53c2\u6570 (\u80a1\u7968, \u4e58\u65701, \u4fdd\u8bc1\u91d1100%)\nrun_backtest(\n    data=data_dict,\n    strategy=MyStrategy,\n    instruments_config=[future_config], # \u4f20\u5165\u914d\u7f6e\u5217\u8868\n    # ...\n)\n</code></pre> <p>\u8be6\u7ec6\u4ee3\u7801\u8bf7\u53c2\u8003 \u6df7\u5408\u8d44\u4ea7\u56de\u6d4b\u793a\u4f8b\u3002</p>"},{"location":"timezone/","title":"\u65f6\u533a\u5904\u7406\u6307\u5357 (Timezone Handling Guide)","text":"<p>AKQuant \u662f\u4e00\u4e2a\u652f\u6301\u591a\u5e02\u573a\u3001\u591a\u54c1\u79cd\u7684\u56de\u6d4b\u6846\u67b6\u3002\u4e3a\u4e86\u4fdd\u8bc1\u65f6\u95f4\u5e8f\u5217\u7684\u7cbe\u786e\u5bf9\u9f50\uff0c\u6846\u67b6\u5185\u90e8\u6838\u5fc3\u7edf\u4e00\u4f7f\u7528 UTC \u65f6\u95f4\u6233\uff08\u7eb3\u79d2\uff09\u3002\u4f46\u5728\u5904\u7406\u7279\u5b9a\u5e02\u573a\uff08\u5982\u4e2d\u56fd A \u80a1\uff09\u65f6\uff0c\u6b63\u786e\u7684\u65f6\u533a\u8bbe\u7f6e\u5bf9\u4e8e\u6570\u636e\u5bf9\u9f50\u548c\u65e5\u5fd7\u9605\u8bfb\u81f3\u5173\u91cd\u8981\u3002</p> <p>\u672c\u6587\u6863\u5c06\u6307\u5bfc\u4f60\u5982\u4f55\u6b63\u786e\u5904\u7406\u6570\u636e\u65f6\u533a\u3001\u56de\u6d4b\u914d\u7f6e\u4ee5\u53ca\u7b56\u7565\u4e2d\u7684\u65f6\u95f4\u8f6c\u6362\u3002</p>"},{"location":"timezone/#1","title":"1. \u6838\u5fc3\u539f\u5219","text":"<ol> <li>\u5185\u90e8\u7edf\u4e00 UTC\uff1a\u5f15\u64ce\u5e95\u5c42 (<code>Rust</code>) \u548c Python \u5c42\u7684\u4ea4\u4e92\u5168\u90e8\u57fa\u4e8e UTC \u65f6\u95f4\u6233\u3002</li> <li>\u8f93\u5165\u81ea\u52a8\u8f6c\u6362\uff1a\u7528\u6237\u4f20\u5165\u7684 DataFrame \u6570\u636e\uff0cAKQuant \u4f1a\u6839\u636e\u914d\u7f6e\u7684 <code>timezone</code> \u81ea\u52a8\u5c06\u5176\u8f6c\u6362\u4e3a UTC \u5b58\u50a8\u3002</li> <li>\u8f93\u51fa\u672c\u5730\u5316\uff1a\u56de\u6d4b\u7ed3\u679c\u548c\u65e5\u5fd7\u5c55\u793a\u65f6\uff0c\u4f1a\u5c1d\u8bd5\u8f6c\u6362\u56de\u7528\u6237\u914d\u7f6e\u7684 <code>timezone</code>\uff08\u9ed8\u8ba4\u4e3a <code>Asia/Shanghai</code>\uff09\u3002</li> </ol>"},{"location":"timezone/#2","title":"2. \u6570\u636e\u51c6\u5907\u4e0e\u65f6\u533a","text":"<p>\u5728\u51c6\u5907\u56de\u6d4b\u6570\u636e\uff08DataFrame\uff09\u65f6\uff0c\u4f60\u6709\u4e24\u79cd\u9009\u62e9\uff1a</p>"},{"location":"timezone/#anaive-datetime-","title":"\u65b9\u5f0f A\uff1a\u4f7f\u7528\u65e0\u65f6\u533a\u65f6\u95f4\uff08Naive Datetime\uff09 - \u63a8\u8350","text":"<p>\u5982\u679c\u4f60\u7684\u6570\u636e\u662f\u672c\u5730\u65f6\u95f4\uff08\u4f8b\u5982\u5317\u4eac\u65f6\u95f4\uff09\uff0c\u4e14\u6ca1\u6709\u65f6\u533a\u4fe1\u606f\uff08tz-naive\uff09\uff0c\u4f60\u53ea\u9700\u8981\u5728\u56de\u6d4b\u914d\u7f6e\u4e2d\u6307\u5b9a <code>timezone=\"Asia/Shanghai\"</code>\u3002AKQuant \u4f1a\u81ea\u52a8\u8ba4\u4e3a\u8fd9\u4e9b\u6570\u636e\u5c5e\u4e8e\u8be5\u65f6\u533a\uff0c\u5e76\u8fdb\u884c\u8f6c\u6362\u3002</p> <p>\u793a\u4f8b\uff1a\u6784\u9020 A \u80a1 1 \u5206\u949f\u7ebf\u6570\u636e</p> <pre><code>import pandas as pd\nfrom datetime import timedelta\n\n# \u751f\u6210\u65e0\u65f6\u533a\u7684\u65f6\u95f4\u5e8f\u5217\uff08\u9ed8\u8ba4\u4e3a\u5317\u4eac\u65f6\u95f4\uff09\n# \u4f8b\u5982\uff1a2023-01-01 09:31:00\nrng = pd.date_range(\n    start=\"2023-01-01 09:31\",\n    end=\"2023-01-01 11:30\",\n    freq=\"1min\"\n)\n\n# \u521b\u5efa DataFrame\n# \u7d22\u5f15\u5fc5\u987b\u662f datetime \u7c7b\u578b\ndf = pd.DataFrame({\n    \"open\": 10.0, \"high\": 11.0, \"low\": 9.0, \"close\": 10.5, \"volume\": 1000\n}, index=rng)\n\n# \u6b64\u65f6 df.index.tz \u662f None\n</code></pre>"},{"location":"timezone/#baware-datetime","title":"\u65b9\u5f0f B\uff1a\u4f7f\u7528\u5e26\u65f6\u533a\u65f6\u95f4\uff08Aware Datetime\uff09","text":"<p>\u5982\u679c\u4f60\u7684\u6570\u636e\u5df2\u7ecf\u5e26\u6709\u65f6\u533a\u4fe1\u606f\uff08\u4f8b\u5982\u4ece\u67d0\u4e9b API \u83b7\u53d6\u7684\u6570\u636e\uff09\uff0cAKQuant \u4f1a\u76f4\u63a5\u5c06\u5176\u8f6c\u6362\u4e3a UTC\u3002\u8bf7\u786e\u4fdd\u65f6\u533a\u4fe1\u606f\u662f\u6b63\u786e\u7684\u3002</p> <pre><code># \u5e26\u6709\u65f6\u533a\u7684\u65f6\u95f4\u5e8f\u5217\nrng = pd.date_range(\n    start=\"2023-01-01 09:31\",\n    periods=100,\n    freq=\"1min\",\n    tz=\"Asia/Shanghai\"  # \u663e\u5f0f\u6307\u5b9a\u65f6\u533a\n)\n</code></pre>"},{"location":"timezone/#_1","title":"\u91cd\u8981\uff1a\u65e5\u7ebf\u6570\u636e\u7684\u65f6\u95f4\u6233\u8bbe\u7f6e","text":"<p>\u5bf9\u4e8e\u65e5\u7ebf\u6570\u636e\uff081D\uff09\uff0c\u4e3a\u4e86\u4e0e\u5206\u949f\u7ebf\u6570\u636e\uff081m\uff09\u5728\u56de\u6d4b\u4e2d\u6b63\u786e\u5bf9\u9f50\uff08\u907f\u514d\u672a\u6765\u51fd\u6570\uff09\uff0c\u5f3a\u70c8\u5efa\u8bae\u5c06\u65e5\u7ebf\u65f6\u95f4\u6233\u8bbe\u7f6e\u4e3a\u5f53\u5929\u7684\u6536\u76d8\u65f6\u95f4\uff08A \u80a1\u4e3a 15:00\uff09\u3002</p> <ul> <li>\u5982\u679c\u8bbe\u7f6e\u4e3a 00:00\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u65e5\u7ebf\u6570\u636e\u5728\u5f53\u5929\u7684\u5206\u949f\u7ebf\u4e4b\u524d\u5c31\u201c\u51fa\u73b0\u201d\uff0c\u6216\u8005\u5728\u5bf9\u9f50\u65f6\u4ea7\u751f\u6df7\u6dc6\u3002</li> <li>\u8bbe\u7f6e\u4e3a 15:00 \u53ef\u4ee5\u786e\u4fdd\u65e5\u7ebf Bar \u5728\u5f53\u5929\u7684\u4ea4\u6613\u7ed3\u675f\u540e\u624d\u5b8c\u6210\u3002</li> </ul> <pre><code># \u65e5\u7ebf\u6570\u636e\u7d22\u5f15\u793a\u4f8b\nts_daily = pd.Timestamp(\"2023-01-01 15:00:00\")  # \u5317\u4eac\u65f6\u95f4 15:00\n</code></pre>"},{"location":"timezone/#3","title":"3. \u56de\u6d4b\u914d\u7f6e","text":"<p>\u5728 <code>run_backtest</code> \u6216 <code>BacktestEngine</code> \u521d\u59cb\u5316\u65f6\uff0c\u901a\u8fc7 <code>timezone</code> \u53c2\u6570\u6307\u5b9a\u56de\u6d4b\u7684\u9ed8\u8ba4\u65f6\u533a\u3002</p> <pre><code>from akquant.backtest import run_backtest\n\nresults = run_backtest(\n    data=data_feed,\n    strategy=MyStrategy,\n    timezone=\"Asia/Shanghai\",  # \u6307\u5b9a\u4e3a\u4e0a\u6d77\u65f6\u95f4\n    # ...\n)\n</code></pre>"},{"location":"timezone/#4","title":"4. \u7b56\u7565\u4e2d\u7684\u65f6\u95f4\u5904\u7406","text":"<p>\u5728\u7b56\u7565\u7684 <code>on_bar</code> \u56de\u8c03\u4e2d\uff0c<code>bar.timestamp</code> \u662f\u4e00\u4e2a\u6574\u6570\uff08int64\uff09\uff0c\u8868\u793a UTC \u7eb3\u79d2\u65f6\u95f4\u6233\u3002\u5982\u679c\u4f60\u9700\u8981\u5728\u65e5\u5fd7\u4e2d\u6253\u5370\u5f53\u524d\u65f6\u95f4\uff0c\u6216\u8005\u6839\u636e\u65f6\u95f4\u505a\u903b\u8f91\u5224\u65ad\uff08\u5982\uff1a\u53ea\u5728\u4e0b\u5348\u4ea4\u6613\uff09\uff0c\u9700\u8981\u5c06\u5176\u8f6c\u6362\u4e3a\u672c\u5730\u65f6\u95f4\u3002</p>"},{"location":"timezone/#2-strategy","title":"\u65b9\u5f0f 2\uff1a\u4f7f\u7528 Strategy \u8f85\u52a9\u65b9\u6cd5\uff08\u63a8\u8350\uff09","text":"<p>AKQuant \u5728 <code>Strategy</code> \u57fa\u7c7b\u4e2d\u63d0\u4f9b\u4e86\u4fbf\u6377\u7684\u8f85\u52a9\u65b9\u6cd5\uff0c\u81ea\u52a8\u4f7f\u7528\u56de\u6d4b\u914d\u7f6e\u7684\u65f6\u533a\u8fdb\u884c\u8f6c\u6362\u3002</p> <pre><code>class MyStrategy(Strategy):\n    def on_bar(self, bar: Bar):\n        # 1. \u83b7\u53d6\u672c\u5730\u65f6\u95f4\u5bf9\u8c61 (pd.Timestamp)\n        ts = self.to_local_time(bar.timestamp)\n\n        # 2. \u76f4\u63a5\u83b7\u53d6\u683c\u5f0f\u5316\u5b57\u7b26\u4e32 (\u9ed8\u8ba4 \"%Y-%m-%d %H:%M:%S\")\n        ts_str = self.format_time(bar.timestamp)\n        self.log(f\"Current time: {ts_str}\")\n\n        # 3. \u83b7\u53d6\u5f53\u524d\u7b56\u7565\u65f6\u95f4 (now)\n        # \u81ea\u52a8\u6839\u636e\u5f53\u524d\u5904\u7406\u7684 bar/tick \u8fd4\u56de\u672c\u5730\u65f6\u95f4\n        if self.now:\n             print(f\"Now: {self.now}\")\n</code></pre>"},{"location":"timezone/#3_1","title":"\u65b9\u5f0f 3\uff1a\u624b\u52a8\u8f6c\u6362\uff08\u5e95\u5c42\u539f\u7406\uff09","text":"<p>\u5982\u679c\u4f60\u9700\u8981\u66f4\u5e95\u5c42\u7684\u63a7\u5236\uff0c\u53ef\u4ee5\u624b\u52a8\u8fdb\u884c\u8f6c\u6362\uff1a</p> <pre><code>import pandas as pd\nfrom akquant.strategy import Strategy\nfrom akquant.akquant import Bar\n\nclass MyStrategy(Strategy):\n    def on_bar(self, bar: Bar):\n        # 1. \u5c06 UTC \u7eb3\u79d2\u65f6\u95f4\u6233\u8f6c\u6362\u4e3a UTC datetime\n        ts_utc = pd.to_datetime(bar.timestamp, unit=\"ns\", utc=True)\n\n        # 2. \u8f6c\u6362\u4e3a\u5317\u4eac\u65f6\u95f4\n        ts_bj = ts_utc.tz_convert(\"Asia/Shanghai\")\n\n        # ...\n</code></pre>"},{"location":"timezone/#5-faq","title":"5. \u5e38\u89c1\u95ee\u9898 (FAQ)","text":"<p>Q: \u4e3a\u4ec0\u4e48\u6211\u5728\u65e5\u5fd7\u91cc\u770b\u5230\u7684\u65f6\u95f4\u662f 01:31 \u800c\u4e0d\u662f 09:31\uff1f A: \u8fd9\u662f\u56e0\u4e3a\u76f4\u63a5\u6253\u5370 <code>bar.timestamp</code> \u8f6c\u6362\u51fa\u6765\u7684\u9ed8\u8ba4\u53ef\u80fd\u662f UTC \u65f6\u95f4\uff08\u5317\u4eac\u65f6\u95f4 09:31 \u5bf9\u5e94 UTC 01:31\uff09\u3002\u63a8\u8350\u4f7f\u7528 <code>self.format_time(bar.timestamp)</code> \u6216 <code>self.to_local_time(bar.timestamp)</code> \u6765\u83b7\u53d6\u914d\u7f6e\u65f6\u533a\u540e\u7684\u65f6\u95f4\u3002</p> <p>Q: <code>AttributeError: 'float' object has no attribute 'quantity'</code> \u662f\u4ec0\u4e48\uff1f A: \u8fd9\u901a\u5e38\u662f\u5728\u8bbf\u95ee\u6301\u4ed3\u65f6\u53d1\u751f\u7684\u9519\u8bef\u3002<code>self.ctx.get_position(symbol)</code> \u8fd4\u56de\u7684\u662f\u6301\u4ed3\u6570\u91cf\uff08float\uff09\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u5bf9\u8c61\u3002\u8bf7\u76f4\u63a5\u4f7f\u7528\u8fd4\u56de\u503c\u4f5c\u4e3a\u6570\u91cf\u3002</p> <p>Q: \u6df7\u5408\u9891\u7387\u56de\u6d4b\u65f6\uff0c\u65e5\u7ebf\u548c\u5206\u949f\u7ebf\u600e\u4e48\u5bf9\u9f50\uff1f A: AKQuant \u662f\u4e8b\u4ef6\u9a71\u52a8\u7684\uff0c\u6309\u65f6\u95f4\u6233\u987a\u5e8f\u5904\u7406 Bar\u3002</p> <ul> <li>09:31 -&gt; \u5904\u7406\u5206\u949f Bar</li> <li>...</li> <li>15:00 -&gt; \u5904\u7406\u5206\u949f Bar</li> <li>15:00 -&gt; \u5904\u7406\u65e5\u7ebf Bar (\u5047\u8bbe\u65e5\u7ebf\u65f6\u95f4\u6233\u8bbe\u4e3a 15:00) \u786e\u4fdd\u65e5\u7ebf\u7684\u65f6\u95f4\u6233 &gt;= \u5f53\u5929\u6700\u540e\u4e00\u6839\u5206\u949f\u7ebf\u7684\u65f6\u95f4\u6233\uff0c\u5373\u53ef\u4fdd\u8bc1\u903b\u8f91\u987a\u5e8f\u6b63\u786e\u3002</li> </ul>"},{"location":"tutorial/","title":"\u624b\u628a\u624b\u6559\u7a0b\uff1a\u7f16\u5199\u4f60\u7684\u7b2c\u4e00\u4e2a\u91cf\u5316\u7b56\u7565","text":"<p>\u672c\u6559\u7a0b\u5c06\u5e26\u4f60\u4e00\u6b65\u6b65\u7f16\u5199\u4e00\u4e2a\u7ecf\u5178\u7684\u53cc\u5747\u7ebf\u7b56\u7565 (Dual Moving Average)\u3002\u8fd9\u901a\u5e38\u662f\u91cf\u5316\u4ea4\u6613\u5458\u7684\"Hello World\"\u3002</p> <p>\u6211\u4eec\u5c06\u6db5\u76d6\u4ece\u6570\u636e\u51c6\u5907\u3001\u7b56\u7565\u7f16\u5199\u5230\u56de\u6d4b\u5206\u6790\u7684\u5168\u8fc7\u7a0b\u3002</p>"},{"location":"tutorial/#1","title":"1. \u7b56\u7565\u601d\u8def","text":"<p>\u53cc\u5747\u7ebf\u7b56\u7565\u7684\u903b\u8f91\u975e\u5e38\u76f4\u89c2\uff1a</p> <ul> <li>\u91d1\u53c9 (Golden Cross): \u5f53\u77ed\u671f\u5747\u7ebf\uff08\u5982 10\u65e5\u7ebf\uff09\u7531\u4e0b\u5411\u4e0a\u7a7f\u8fc7\u957f\u671f\u5747\u7ebf\uff08\u5982 30\u65e5\u7ebf\uff09\u65f6\uff0c\u8ba4\u4e3a\u8d8b\u52bf\u5411\u4e0a\uff0c\u4e70\u5165\u3002</li> <li>\u6b7b\u53c9 (Death Cross): \u5f53\u77ed\u671f\u5747\u7ebf\u7531\u4e0a\u5411\u4e0b\u7a7f\u8fc7\u957f\u671f\u5747\u7ebf\u65f6\uff0c\u8ba4\u4e3a\u8d8b\u52bf\u5411\u4e0b\uff0c\u5356\u51fa\u3002</li> </ul>"},{"location":"tutorial/#2","title":"2. \u5b8c\u6574\u4ee3\u7801","text":"<p>\u4e3a\u4e86\u65b9\u4fbf\u4f60\u76f4\u63a5\u8fd0\u884c\uff0c\u6211\u4eec\u5c06\u6240\u6709\u4ee3\u7801\u653e\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\u3002\u4f60\u53ef\u4ee5\u590d\u5236\u4ee5\u4e0b\u4ee3\u7801\u5230 <code>my_first_strategy.py</code> \u5e76\u8fd0\u884c\u3002</p> <pre><code>import pandas as pd\nimport numpy as np\nfrom akquant import Strategy, run_backtest\n\n# --------------------------\n# \u7b2c\u4e00\u6b65\uff1a\u51c6\u5907\u6570\u636e\n# --------------------------\n# \u5728\u771f\u5b9e\u573a\u666f\u4e2d\uff0c\u4f60\u4f1a\u4f7f\u7528 pd.read_csv(\"stock_data.csv\")\n# \u8fd9\u91cc\u4e3a\u4e86\u6f14\u793a\u65b9\u4fbf\uff0c\u6211\u4eec\u751f\u6210\u4e00\u4e9b\u6a21\u62df\u6570\u636e\ndef generate_mock_data():\n    dates = pd.date_range(start=\"2023-01-01\", end=\"2023-12-31\")\n    n = len(dates)\n\n    # \u751f\u6210\u4e00\u6761\u968f\u673a\u8d70\u52bf\n    np.random.seed(42) # \u56fa\u5b9a\u968f\u673a\u79cd\u5b50\uff0c\u4fdd\u8bc1\u6bcf\u6b21\u8fd0\u884c\u7ed3\u679c\u4e00\u81f4\n    returns = np.random.normal(0.0005, 0.02, n)\n    price = 100 * np.cumprod(1 + returns)\n\n    # \u6784\u9020 DataFrame\n    df = pd.DataFrame({\n        \"date\": dates,\n        \"open\": price,\n        \"high\": price * 1.01,\n        \"low\": price * 0.99,\n        \"close\": price,\n        \"volume\": 10000,\n        \"symbol\": \"AAPL\" # \u5047\u8bbe\u8fd9\u662f\u82f9\u679c\u516c\u53f8\u7684\u80a1\u7968\n    })\n    return df\n\n# --------------------------\n# \u7b2c\u4e8c\u6b65\uff1a\u7f16\u5199\u7b56\u7565\n# --------------------------\nclass DualMAStrategy(Strategy):\n    \"\"\"\n    \u7ee7\u627f akquant.Strategy \u7c7b\uff0c\u8fd9\u662f\u6240\u6709\u7b56\u7565\u7684\u57fa\u7c7b\u3002\n    \"\"\"\n\n    # \u65b0\u589e (\u63a8\u8350): \u58f0\u660e\u5f0f\u8bbe\u7f6e\u5386\u53f2\u6570\u636e\u9884\u70ed\u671f\n    # \u8fd9\u6837\u6846\u67b6\u4f1a\u81ea\u52a8\u4e3a\u4f60\u5904\u7406 set_history_depth\uff0c\u65e0\u9700\u5728 on_start \u4e2d\u624b\u52a8\u8c03\u7528\n    # \u4f18\u5148\u7ea7: \u52a8\u6001\u5c5e\u6027 (self.warmup_period) &gt; \u7c7b\u5c5e\u6027 (warmup_period) &gt; AST \u81ea\u52a8\u63a8\u65ad\n    warmup_period = 40 # 30\u65e5\u5747\u7ebf + 10 \u5b89\u5168\u4f59\u91cf\n\n    def __init__(self, fast_window=10, slow_window=30):\n        # \u5b9a\u4e49\u7b56\u7565\u53c2\u6570\uff1a\u5feb\u7ebf\u5468\u671f\u548c\u6162\u7ebf\u5468\u671f\n        self.fast_window = fast_window\n        self.slow_window = slow_window\n\n        # \u8fdb\u9636\u6280\u5de7\uff1a\u52a8\u6001\u8bbe\u7f6e\u9884\u70ed\u671f\n        # \u5982\u679c\u5747\u7ebf\u5468\u671f\u662f\u52a8\u6001\u4f20\u5165\u7684\uff0c\u5efa\u8bae\u5728\u8fd9\u91cc\u6839\u636e\u53c2\u6570\u8986\u76d6 warmup_period\n        self.warmup_period = slow_window + 10\n\n    def on_start(self):\n        \"\"\"\n        \u7b56\u7565\u542f\u52a8\u65f6\u6267\u884c\u4e00\u6b21\u3002\n        \u5728\u8fd9\u91cc\u544a\u8bc9\u7cfb\u7edf\u6211\u4eec\u8981\u5173\u6ce8\u54ea\u4e9b\u80a1\u7968\u3002\n        \"\"\"\n        print(\"\u7b56\u7565\u542f\u52a8...\")\n        self.subscribe(\"AAPL\")\n\n        # \u65b9\u5f0f 1 (\u63a8\u8350)\uff1a\u4f7f\u7528 warmup_period (\u652f\u6301 \u7c7b\u5c5e\u6027 / \u5b9e\u4f8b\u5c5e\u6027 / AST\u81ea\u52a8\u63a8\u65ad)\n        # \u65b9\u5f0f 2 (\u65e7\u7248)\uff1a\u624b\u52a8\u8c03\u7528 self.set_history_depth(self.slow_window + 10)\n\n        # \u7531\u4e8e\u6211\u4eec\u5df2\u7ecf\u914d\u7f6e\u4e86 warmup_period\uff0c\u8fd9\u91cc\u65e0\u9700\u505a\u4efb\u4f55\u64cd\u4f5c\n        # \u6846\u67b6\u4f1a\u81ea\u52a8\u53d6 max(warmup_period, ast_inferred_value, run_backtest_history_depth)\n\n    def on_bar(self, bar):\n        \"\"\"\n        \u6838\u5fc3\u903b\u8f91\uff1a\u6bcf\u4e00\u6839 K \u7ebf\u8d70\u5b8c\u65f6\uff0c\u90fd\u4f1a\u89e6\u53d1\u4e00\u6b21\u8fd9\u4e2a\u51fd\u6570\u3002\n        bar \u53c2\u6570\u5305\u542b\u4e86\u5f53\u524d\u7684\u884c\u60c5\u6570\u636e (bar.close, bar.high \u7b49)\u3002\n        \"\"\"\n\n        # 1. \u83b7\u53d6\u5386\u53f2\u6536\u76d8\u4ef7\n        # get_history \u8fd4\u56de\u7684\u662f\u4e00\u4e2a numpy \u6570\u7ec4\uff0c\u5305\u542b\u6700\u8fd1 N \u5929\u7684\u6570\u636e\n        closes = self.get_history(count=self.slow_window, symbol=bar.symbol, field=\"close\")\n\n        # \u5982\u679c\u6570\u636e\u8fd8\u4e0d\u591f\u8ba1\u7b97\u957f\u5747\u7ebf\uff08\u6bd4\u5982\u521a\u5f00\u59cb\u56de\u6d4b\u7684\u524d\u51e0\u5929\uff09\uff0c\u5c31\u76f4\u63a5\u8fd4\u56de\uff0c\u4e0d\u64cd\u4f5c\n        if len(closes) &lt; self.slow_window:\n            return\n\n        # 2. \u8ba1\u7b97\u5747\u7ebf\n        # \u4f7f\u7528 numpy \u8ba1\u7b97\u5e73\u5747\u503c\n        fast_ma = np.mean(closes[-self.fast_window:]) # \u53d6\u6700\u540e fast_window \u4e2a\u6570\u636e\u6c42\u5e73\u5747\n        slow_ma = np.mean(closes[-self.slow_window:]) # \u53d6\u6700\u540e slow_window \u4e2a\u6570\u636e\u6c42\u5e73\u5747\n\n        # 3. \u83b7\u53d6\u5f53\u524d\u6301\u4ed3\n        # \u5982\u679c\u6ca1\u6301\u4ed3\u8fd4\u56de 0\uff0c\u6301\u6709 1000 \u80a1\u8fd4\u56de 1000\n        position = self.get_position(bar.symbol)\n\n        # 4. \u4ea4\u6613\u4fe1\u53f7\u5224\u65ad\n        # \u91d1\u53c9\uff1a\u77ed\u7ebf &gt; \u957f\u7ebf\uff0c\u4e14\u5f53\u524d\u7a7a\u4ed3 -&gt; \u4e70\u5165\n        if fast_ma &gt; slow_ma and position == 0:\n            print(f\"[{bar.timestamp_str}] \u91d1\u53c9\u4e70\u5165! \u4ef7\u683c: {bar.close:.2f}\")\n            self.buy(symbol=bar.symbol, quantity=1000)\n\n        # \u6b7b\u53c9\uff1a\u77ed\u7ebf &lt; \u957f\u7ebf\uff0c\u4e14\u5f53\u524d\u6301\u4ed3 -&gt; \u5356\u51fa\n        elif fast_ma &lt; slow_ma and position &gt; 0:\n            print(f\"[{bar.timestamp_str}] \u6b7b\u53c9\u5356\u51fa! \u4ef7\u683c: {bar.close:.2f}\")\n            self.sell(symbol=bar.symbol, quantity=position) # \u5356\u51fa\u6240\u6709\u6301\u4ed3\n\n# --------------------------\n# \u7b2c\u4e09\u6b65\uff1a\u8fd0\u884c\u56de\u6d4b\n# --------------------------\nif __name__ == \"__main__\":\n    # 1. \u83b7\u53d6\u6570\u636e\n    df = generate_mock_data()\n\n    # 2. \u8fd0\u884c\u56de\u6d4b\n    print(\"\u5f00\u59cb\u56de\u6d4b...\")\n    result = run_backtest(\n        data=df,\n        strategy=DualMAStrategy, # \u4f20\u5165\u6211\u4eec\u7684\u7b56\u7565\u7c7b\n        strategy_params={\"fast_window\": 10, \"slow_window\": 30}, # \u8c03\u6574\u53c2\u6570\n        cash=100_000.0,    # \u521d\u59cb\u8d44\u91d1 10\u4e07\n        commission=0.0003  # \u4f63\u91d1\u4e07\u5206\u4e4b\u4e09\n    )\n\n    # 3. \u6253\u5370\u7ed3\u679c\n    print(\"\\n\" + \"=\"*30)\n    print(result) # \u6253\u5370\u8be6\u7ec6\u7684\u7ee9\u6548\u62a5\u8868\n    print(\"=\"*30)\n</code></pre>"},{"location":"tutorial/#3","title":"3. \u4ee3\u7801\u8be6\u7ec6\u89e3\u6790","text":""},{"location":"tutorial/#31","title":"3.1 \u7b56\u7565\u7ed3\u6784","text":"<p>\u6bcf\u4e00\u4e2a AKQuant \u7b56\u7565\u90fd\u662f\u4e00\u4e2a Python \u7c7b\uff0c\u7ee7\u627f\u81ea <code>Strategy</code>\u3002\u4f60\u9700\u8981\u5173\u6ce8\u4e09\u4e2a\u4e3b\u8981\u65b9\u6cd5\uff1a</p> <ul> <li><code>__init__</code>: \u8bbe\u7f6e\u7b56\u7565\u7684\u53c2\u6570\uff08\u5982\u5747\u7ebf\u5468\u671f\uff09\u3002</li> <li><code>on_start</code>: \u521d\u59cb\u5316\u5de5\u4f5c\u3002<ul> <li>\u6570\u636e\u9884\u70ed (\u65b0\u7248\u63a8\u8350)\uff1a\u8bbe\u7f6e <code>warmup_period</code>\u3002<ul> <li>\u9759\u6001\u8bbe\u7f6e: \u7c7b\u5c5e\u6027 <code>warmup_period = 40</code>\u3002</li> <li>\u52a8\u6001\u8bbe\u7f6e: \u5728 <code>__init__</code> \u4e2d <code>self.warmup_period = slow_window + 10</code>\u3002</li> <li>\u81ea\u52a8\u63a8\u65ad: \u5982\u679c\u4ee3\u7801\u4e2d\u6709 <code>SMA(30)</code>\uff0c\u6846\u67b6\u4e5f\u4f1a\u5c1d\u8bd5\u81ea\u52a8\u63a8\u65ad (AST)\u3002</li> </ul> </li> <li>\u6570\u636e\u9884\u70ed (\u65e7\u7248\u517c\u5bb9)\uff1a\u8c03\u7528 <code>self.set_history_depth(40)</code>\u3002\u5982\u679c\u4e0d\u8bbe\u7f6e\uff0c<code>get_history</code> \u4f1a\u62a5\u9519\u3002</li> </ul> </li> <li><code>on_bar</code>: \u8fd9\u662f\u4e00\u4e2a\u6b7b\u5faa\u73af\uff0c\u7cfb\u7edf\u4f1a\u6309\u65f6\u95f4\u987a\u5e8f\u628a\u6bcf\u4e00\u6839 K \u7ebf\u4f20\u7ed9\u4f60\u3002\u4f60\u5728\u8fd9\u91cc\u505a\u51b3\u7b56\uff1a\u4e70\u8fd8\u662f\u5356\uff1f</li> </ul>"},{"location":"tutorial/#32","title":"3.2 \u83b7\u53d6\u6570\u636e","text":"<ul> <li><code>bar.close</code>: \u5f53\u524d\u8fd9\u6839 K \u7ebf\u7684\u6536\u76d8\u4ef7\u3002</li> <li><code>self.get_history(N, symbol, \"close\")</code>: \u83b7\u53d6\u8fc7\u53bb N \u5929\u7684\u6536\u76d8\u4ef7\u6570\u7ec4\u3002\u8fd9\u662f\u6700\u9ad8\u6548\u7684\u6570\u636e\u8bbf\u95ee\u65b9\u5f0f\u3002</li> </ul>"},{"location":"tutorial/#33","title":"3.3 \u4e0b\u5355\u4ea4\u6613","text":"<ul> <li><code>self.buy(symbol, quantity)</code>: \u53d1\u51fa\u4e70\u5355\u3002\u9ed8\u8ba4\u662f\u5e02\u4ef7\u5355\uff08\u6309\u5f53\u524d\u4ef7\u683c\u6210\u4ea4\uff09\u3002</li> <li><code>self.sell(symbol, quantity)</code>: \u53d1\u51fa\u5356\u5355\u3002</li> </ul>"},{"location":"tutorial/#4-faq","title":"4. \u5e38\u89c1\u95ee\u9898 (FAQ)","text":"<p>Q: \u4e3a\u4ec0\u4e48\u7a0b\u5e8f\u62a5\u9519 <code>RuntimeError: History tracking is not enabled</code>\uff1f A: \u8fd9\u662f\u56e0\u4e3a\u4f60\u8c03\u7528\u4e86 <code>get_history</code> \u4f46\u672a\u8bbe\u7f6e\u5386\u53f2\u6570\u636e\u957f\u5ea6\u3002\u8bf7\u786e\u4fdd\u5728\u7b56\u7565\u7c7b\u4e2d\u8bbe\u7f6e\u4e86 <code>warmup_period</code> \u5c5e\u6027\uff08\u63a8\u8350\uff09\uff0c\u6216\u8005\u5728 <code>on_start</code> \u4e2d\u8c03\u7528 <code>self.set_history_depth()</code>\u3002\u7cfb\u7edf\u9ed8\u8ba4\u4e3a\u4e86\u6027\u80fd\u4e0d\u5f00\u542f\u5386\u53f2\u7f13\u5b58\uff0c\u5fc5\u987b\u663e\u5f0f\u5f00\u542f\u3002</p> <p>Q: \u4e3a\u4ec0\u4e48 <code>get_history</code> \u8fd4\u56de\u4e86\u5f88\u591a <code>NaN</code>\uff1f A: \u8fd9\u901a\u5e38\u53d1\u751f\u5728\u56de\u6d4b\u521a\u5f00\u59cb\u9636\u6bb5\u3002\u6bd4\u5982\u4f60\u8bbe\u7f6e\u4e86 depth=30\uff0c\u4f46\u5728\u7b2c 5 \u5929\u5c31\u8c03\u7528\u4e86 <code>get_history(30)</code>\u3002\u6b64\u65f6\u6570\u636e\u4e0d\u8db3\uff0c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u5728\u524d\u9762\u586b\u5145 <code>NaN</code> \u4ee5\u4fdd\u8bc1\u8fd4\u56de\u6570\u7ec4\u957f\u5ea6\u4e00\u81f4\u3002\u5efa\u8bae\u5728 <code>on_bar</code> \u5f00\u5934\u5224\u65ad <code>if len(closes) &lt; N: return</code>\u3002</p> <p>Q: \u56de\u6d4b\u7ed3\u679c\u91cc\u7684 <code>sharpe_ratio</code> \u662f\u4ec0\u4e48\uff1f A: \u590f\u666e\u6bd4\u7387\uff0c\u8861\u91cf\u7b56\u7565\u6027\u4ef7\u6bd4\u7684\u6307\u6807\u3002\u5927\u4e8e 1 \u901a\u5e38\u88ab\u8ba4\u4e3a\u662f\u8fd8\u53ef\u4ee5\u7684\u7b56\u7565\uff0c\u5927\u4e8e 2 \u662f\u975e\u5e38\u4f18\u79c0\u7684\u7b56\u7565\u3002</p> <p>Q: \u5982\u4f55\u6362\u6210\u6211\u81ea\u5df1\u7684\u6570\u636e\uff1f A: \u53ea\u8981\u5c06 <code>data=df</code> \u66ff\u6362\u4e3a\u4f60\u81ea\u5df1\u7684 DataFrame \u5373\u53ef\u3002\u786e\u4fdd\u4f60\u7684 DataFrame \u5305\u542b <code>date</code>, <code>open</code>, <code>high</code>, <code>low</code>, <code>close</code>, <code>volume</code>, <code>symbol</code> \u8fd9\u51e0\u5217\u3002</p>"},{"location":"tutorial/#5","title":"5. \u8fdb\u9636\uff1a\u53c2\u6570\u4f18\u5316","text":"<p>\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u5f80\u5f80\u9700\u8981\u5bfb\u627e\u7b56\u7565\u7684\u6700\u4f18\u53c2\u6570\uff08\u4f8b\u5982\uff1a\u5747\u7ebf\u5468\u671f\u5230\u5e95\u9009 10/30 \u597d\uff0c\u8fd8\u662f 5/20 \u597d\uff1f\uff09\u3002AKQuant \u63d0\u4f9b\u4e86\u5185\u7f6e\u7684\u7f51\u683c\u641c\u7d22\u5de5\u5177\u3002</p> <pre><code>from akquant import run_optimization\n\n# \u5b9a\u4e49\u53c2\u6570\u7f51\u683c\nparam_grid = {\n    \"fast_window\": range(5, 30, 5),   # [5, 10, 15, 20, 25]\n    \"slow_window\": range(20, 60, 10), # [20, 30, 40, 50]\n}\n\n# \u8fd0\u884c\u4f18\u5316\nresults_df = run_optimization(\n    strategy=DualMAStrategy,\n    param_grid=param_grid,\n    data=df,\n    cash=100_000.0,\n    commission=0.0003,\n    sort_by=\"total_return\", # \u6309\u6536\u76ca\u7387\u6392\u5e8f\n    ascending=False\n)\n\n# \u6253\u5370\u524d 5 \u540d\nprint(results_df.head(5))\n</code></pre> <p><code>run_optimization</code> \u4f1a\u81ea\u52a8\u5229\u7528\u591a\u6838 CPU \u5e76\u884c\u52a0\u901f\u56de\u6d4b\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u6240\u6709\u53c2\u6570\u7ec4\u5408\u53ca\u5bf9\u5e94\u7ee9\u6548\u6307\u6807\u7684 DataFrame\u3002</p>"},{"location":"en/","title":"AKQuant","text":"<p>AKQuant is a high-performance quantitative research framework built on Rust and Python. It combines the extreme performance of Rust with the ease of use of Python, providing powerful backtesting and research tools for quantitative traders.</p> <p>The latest version features a modular design, independent portfolio management, advanced order type support, and convenient data loading and caching mechanisms.</p> <p>\ud83d\udcd6 Design and Development Guide (DESIGN.md): If you want to understand the internal architecture, learn how to design such systems, or contribute to development, please read this document.</p>"},{"location":"en/#core-features","title":"Core Features","text":"<ul> <li>Extreme Performance: The core backtesting engine is written in Rust and exposed to Python via PyO3.<ul> <li>Benchmark: In an SMA strategy backtest with 200k bars, AKQuant took only 1.31s (~152k bars/sec), about 20x faster than Backtrader (26.55s).</li> <li>Zero-Copy Access (New): Historical data (<code>ctx.history</code>) maps directly to Rust memory via PyO3 Buffer Protocol / Numpy View, enabling zero-copy access and significantly boosting indicator calculation performance in Python.</li> </ul> </li> <li>Modular Architecture:<ul> <li>Engine: Event-driven core matching engine using BinaryHeap for event queue management.</li> <li>Clock: Trading clock precisely managing TradingSessions and time flow.</li> <li>Portfolio: Independent portfolio management supporting real-time equity calculation.</li> <li>MarketModel: Pluggable market models with built-in A-share T+1 and Futures T+0 rules.<ul> <li>T+1 Strict Risk Control: For stocks/funds, strictly enforces T+1 available position checks to prevent day trading (unless configured as T+0 market).</li> <li>Available Position Management: Automatically maintains <code>available_positions</code> and deducts frozen quantities from pending sell orders to prevent overselling.</li> </ul> </li> </ul> </li> <li>Event System:<ul> <li>Timer: Supports <code>schedule(timestamp, payload)</code> to register timed events, triggering <code>on_timer</code> callbacks for complex intraday timing logic.</li> </ul> </li> <li>Risk Control System (New):<ul> <li>Independent Interception Layer: Built-in <code>RiskManager</code> intercepts violating orders directly at the Rust engine layer.</li> <li>Available Position Check: Checks available positions (Available - Pending Sell) in real-time before ordering.</li> <li>Flexible Configuration: <code>RiskConfig</code> allows configuring max order amount, max position ratio, blocklists, etc.</li> </ul> </li> <li>Data Ecosystem:<ul> <li>Streaming CSV (New): Supports streaming loading of large CSV files (<code>DataFeed.from_csv</code>) to minimize memory usage.</li> <li>Pandas Integration: Supports loading Pandas DataFrame directly.</li> <li>Smart Caching: Supports local data caching (Pickle) to avoid repeated downloads and accelerate strategy iteration.</li> </ul> </li> <li>Machine Learning (New):<ul> <li>ML Framework: Built-in high-performance ML training framework supporting Walk-forward Validation.</li> <li>Adapter Pattern: Unifies Scikit-learn and PyTorch interfaces.</li> <li>\ud83d\udcd6 Machine Learning Guide: Learn how to build AI-driven strategies.</li> </ul> </li> <li>Flexible Configuration:<ul> <li>StrategyConfig: Global strategy configuration.</li> <li>ExecutionMode: Supports <code>CurrentClose</code> and <code>NextOpen</code> modes.</li> </ul> </li> <li>Rich Analysis Tools:<ul> <li>PerformanceMetrics:<ul> <li>Return: Total Return, Annualized Return, Alpha, Win Rate.</li> <li>Risk: Max Drawdown, Sharpe Ratio, Sortino Ratio, Ulcer Index, UPI.</li> <li>Fit: Equity R\u00b2.</li> </ul> </li> <li>TradeAnalyzer: Detailed trade statistics including win rate, PnL ratio, max consecutive PnL, etc.</li> </ul> </li> <li>Simulation Enhancements:<ul> <li>Slippage Model: Supports Fixed and Percent slippage models.</li> <li>Volume Limit: Supports limiting order fill quantity by bar volume ratio and partial fills.</li> </ul> </li> </ul>"},{"location":"en/#why-choose-akquant","title":"Why Choose AKQuant?","text":"<p>AKQuant aims to solve the performance bottlenecks of traditional Python backtesting frameworks (like Backtrader) and the high development barriers of pure C++/Rust frameworks. We have achieved breakthroughs in five core dimensions through our hybrid architecture:</p>"},{"location":"en/#1-extreme-performance-rust-core-python-ecosystem","title":"1. Extreme Performance: Rust Core + Python Ecosystem","text":"<ul> <li>Hybrid Architecture: The core computation layer (matching, capital, risk control) is written in Rust and exposed to Python via PyO3.</li> <li>Zero-Copy Access: Leveraging Rust's <code>arrow</code> and <code>numpy</code> view technologies, Python access to historical data (OHLCV, indicators) achieves zero-copy, avoiding massive memory copying overhead.</li> <li>Benchmark: In a 200k bar SMA strategy test, it took only 1.31s (~152k bars/sec), 20x faster than Backtrader.</li> <li>Incremental Calculation: Internal indicator calculations use incremental update algorithms instead of full recalculation, suitable for ultra-long history backtesting.</li> </ul>"},{"location":"en/#2-machine-learning-first","title":"2. Machine Learning First","text":"<ul> <li>Built-in Training Framework: Unlike traditional frameworks that only support simple technical indicators, AKQuant features a built-in full ML Pipeline.</li> <li>Walk-forward Validation: Natively supports rolling window training (Walk-forward) to effectively prevent look-ahead bias and overfitting.</li> <li>Adapter Pattern: Provides unified adapters (<code>QuantModel</code>) for Scikit-learn and PyTorch, allowing AI model integration into strategies with just a few lines of code.</li> <li>Feature Engineering: <code>DataFeed</code> supports dynamic feature calculation, facilitating integration with Talib or Pandas for feature preprocessing.</li> </ul>"},{"location":"en/#3-precise-and-flexible-event-driven-engine","title":"3. Precise and Flexible Event-Driven Engine","text":"<ul> <li>Precise Simulation: Featuring a precise time flow model and order lifecycle management.</li> <li>Complex Order Support: Supports Market, Limit, Stop, TakeProfit, and other order types.</li> <li>Multi-Asset Mixing: Supports mixed backtesting of stocks, futures, ETFs, etc., with independent fee, slippage, and trading session configurations for each asset.</li> <li>Intraday Scheduled Tasks: Supports <code>schedule</code> to register intraday timed events (e.g., close positions daily at 14:50), offering more flexibility than simple <code>on_bar</code>.</li> </ul>"},{"location":"en/#4-production-grade-risk-control-and-live-trading","title":"4. Production-Grade Risk Control and Live Trading","text":"<ul> <li>Built-in Risk Manager: The engine layer includes a <code>RiskManager</code> supporting hard limits on capital, position ratios, blocklists, etc., to prevent runaway strategies.</li> <li>Seamless Live Trading Switch: Strategy code is decoupled from live trading interfaces. Theoretically, switching to live trading only requires replacing <code>Broker</code> and <code>DataFeed</code> adapters (live interface under development).</li> <li>Data Aggregator: <code>DataFeed</code> supports multi-source aggregation, handling data alignment issues for different frequencies.</li> </ul>"},{"location":"en/#5-ultimate-developer-experience","title":"5. Ultimate Developer Experience","text":"<ul> <li>LLM Friendly: Clear code structure, detailed documentation, and optimized Type Hints facilitate strategy writing with Copilot or GPT.</li> <li>Dual-Style API: Supports both Class-based and Functional (Zipline-style) strategy writing styles to suit different user habits.</li> <li>Strict Type Checking: Core logic is strictly checked by the Rust compiler, and Python code is checked via <code>mypy</code>, minimizing runtime errors.</li> </ul>"},{"location":"en/#installation","title":"Installation","text":"<p>For detailed installation steps, please refer to the Installation Guide.</p>"},{"location":"en/#quick-start","title":"Quick Start","text":""},{"location":"en/#1-quick-backtest-using-helper-recommended","title":"1. Quick Backtest using helper (Recommended)","text":"<p><code>AKQuant</code> provides a convenient entry point <code>run_backtest</code> similar to Zipline.</p> <pre><code>import pandas as pd\nimport numpy as np\nfrom akquant import Strategy, run_backtest\n\n# 1. Prepare data (example using random data)\n# Real scenario: pd.read_csv(\"data.csv\")\ndef generate_data():\n    dates = pd.date_range(start=\"2023-01-01\", end=\"2023-12-31\")\n    n = len(dates)\n    price = 100 * np.cumprod(1 + np.random.normal(0.0005, 0.02, n))\n    return pd.DataFrame({\n        \"date\": dates,\n        \"open\": price, \"high\": price * 1.01, \"low\": price * 0.99, \"close\": price,\n        \"volume\": 10000,\n        \"symbol\": \"600000\"\n    })\n\n# 2. Define Strategy\nclass MyStrategy(Strategy):\n    def on_bar(self, bar):\n        # Simple strategy logic (example)\n        # For real backtests, using IndicatorSet for vectorized calculation is recommended\n        position = self.ctx.get_position(bar.symbol)\n        if position == 0:\n            self.buy(symbol=bar.symbol, quantity=100)\n        elif position &gt; 0:\n            self.sell(symbol=bar.symbol, quantity=100)\n\n# 3. Run Backtest\ndf = generate_data()\nresult = run_backtest(\n    strategy=MyStrategy,  # Pass class or instance\n    data=df,              # Explicitly pass data\n    symbol=\"600000\",      # SPD Bank\n    cash=500_000.0,       # Initial cash\n    commission=0.0003     # 0.03% commission\n)\n\n# 4. View Results\nprint(f\"Total Return: {result.metrics.total_return_pct:.2f}%\")\nprint(f\"Sharpe Ratio: {result.metrics.sharpe_ratio:.2f}\")\nprint(f\"Max Drawdown: {result.metrics.max_drawdown_pct:.2f}%\")\n\n# 5. Get Detailed Data (DataFrame)\n# Performance metrics table\nprint(result.metrics_df)\n# Trade record table\nprint(result.trades_df)\n# Daily position table\nprint(result.daily_positions_df)\n</code></pre>"},{"location":"en/#2-functional-api-zipline-style","title":"2. Functional API (Zipline Style)","text":"<p>If you are used to Zipline or Backtrader's functional style, you can also use:</p> <pre><code>from akquant.backtest import run_backtest\n\ndef initialize(ctx):\n    ctx.stop_loss_pct = 0.05\n\ndef on_bar(ctx, bar):\n    position = ctx.get_position(bar.symbol)\n    if position == 0:\n        ctx.buy(symbol=bar.symbol, quantity=100)\n    elif position &gt; 0:\n        ctx.sell(symbol=bar.symbol, quantity=100)\n\nrun_backtest(\n    strategy=on_bar,\n    initialize=initialize,\n    data=df, # Use data generated above\n    symbol=\"600000\"\n)\n</code></pre>"},{"location":"en/#3-using-custom-factors","title":"3. Using Custom Factors","text":"<p>AKQuant supports passing any number of custom numeric fields (such as factors, signals, etc.) in the <code>DataFrame</code>, which can be accessed via the <code>bar.extra</code> dictionary in <code>on_bar</code>.</p> <pre><code>import pandas as pd\nimport numpy as np\nfrom akquant import Strategy, run_backtest\n\n# 1. Prepare data\ndef generate_data():\n    dates = pd.date_range(start=\"2023-01-01\", end=\"2023-12-31\")\n    n = len(dates)\n    price = 100 * np.cumprod(1 + np.random.normal(0.0005, 0.02, n))\n    return pd.DataFrame({\n        \"date\": dates,\n        \"open\": price, \"high\": price * 1.01, \"low\": price * 0.99, \"close\": price,\n        \"volume\": 10000,\n        \"symbol\": \"600000\"\n    })\n\ndf = generate_data()\n\n# 2. Add custom factors (must be numeric)\ndf[\"momentum\"] = df[\"close\"] / df[\"open\"]       # Factor 1\ndf[\"volatility\"] = df[\"high\"] - df[\"low\"]       # Factor 2\ndf[\"sentiment_score\"] = np.random.rand(len(df)) # Factor 3\n\n# 3. Access these fields simultaneously in the strategy\nclass MyStrategy(Strategy):\n    def on_bar(self, bar):\n        # Access by key name (returns float type)\n        mom = bar.extra.get(\"momentum\", 0.0)\n        vol = bar.extra.get(\"volatility\", 0.0)\n        score = bar.extra.get(\"sentiment_score\", 0.0)\n\n        # Comprehensive judgment\n        if mom &gt; 1.02 and score &gt; 0.8:\n            self.buy(bar.symbol, 100)\n\n# 4. Run Backtest\nrun_backtest(strategy=MyStrategy, data=df, symbol=\"600000\")\n</code></pre> <p>For more examples, please refer to the <code>examples/</code> directory.</p>"},{"location":"en/#quick-links","title":"Quick Links","text":""},{"location":"en/api/","title":"API Reference","text":"<p>This API documentation covers the core classes and methods of AKQuant.</p>"},{"location":"en/api/#1-high-level-api","title":"1. High-Level API","text":""},{"location":"en/api/#akquantrun_backtest","title":"<code>akquant.run_backtest</code>","text":"<p>The most commonly used backtest entry function, encapsulating the initialization and configuration process of the engine.</p> <pre><code>def run_backtest(\n    data: Optional[Union[pd.DataFrame, Dict[str, pd.DataFrame], List[Bar]]] = None,\n    strategy: Union[Type[Strategy], Strategy, Callable[[Any, Bar], None], None] = None,\n    symbol: Union[str, List[str]] = \"BENCHMARK\",\n    cash: float = 1_000_000.0,\n    commission: float = 0.0003,\n    instruments_config: Optional[Union[List[InstrumentConfig], Dict[str, InstrumentConfig]]] = None,\n    warmup_period: int = 0,\n    # ... other parameters\n) -&gt; BacktestResult\n</code></pre> <p>Key Parameters:</p> <ul> <li><code>data</code>: Backtest data. Supports a single DataFrame, or a <code>{symbol: DataFrame}</code> dictionary.</li> <li><code>warmup_period</code>: (New) Strategy warmup period. Specifies the length of historical data (number of Bars) to preload for indicator calculation.</li> <li><code>instruments_config</code>: (New) Instrument configuration. Used to set parameters for non-stock assets like futures/options (e.g., multiplier, margin ratio).<ul> <li>Accepts <code>List[InstrumentConfig]</code> or <code>{symbol: InstrumentConfig}</code>.</li> </ul> </li> </ul>"},{"location":"en/api/#akquantinstrumentconfig","title":"<code>akquant.InstrumentConfig</code>","text":"<p>A data class used to configure the properties of a single instrument.</p> <pre><code>@dataclass\nclass InstrumentConfig:\n    symbol: str\n    asset_type: str = \"STOCK\"  # \"STOCK\", \"FUTURES\", \"FUND\", \"OPTION\"\n    multiplier: float = 1.0    # Contract multiplier\n    margin_ratio: float = 1.0  # Margin ratio (0.1 means 10% margin)\n    tick_size: float = 0.01    # Minimum price variation\n    lot_size: int = 1          # Minimum trading unit\n</code></pre>"},{"location":"en/api/#2-core-engine","title":"2. Core Engine","text":""},{"location":"en/api/#akquantengine","title":"<code>akquant.Engine</code>","text":"<p>The main entry point for the backtesting engine.</p> <pre><code>engine = akquant.Engine()\n</code></pre> <p>Configuration Methods:</p> <ul> <li><code>set_timezone(offset: int)</code>: Set timezone offset (seconds). E.g., 28800 for UTC+8.</li> <li><code>use_simulated_execution()</code>: (Default) Enable in-memory matching simulation execution.</li> <li><code>use_realtime_execution()</code>: Enable real-time/paper trading execution (orders sent to external Broker).</li> <li><code>set_execution_mode(mode: ExecutionMode)</code>: Set matching mode.<ul> <li><code>ExecutionMode.NextOpen</code>: Match at next Bar Open (Default).</li> <li><code>ExecutionMode.CurrentClose</code>: Match at current Bar Close.</li> </ul> </li> <li><code>set_history_depth(depth: int)</code>: Set the history data cache length at the engine level.</li> </ul> <p>Market &amp; Fee Configuration:</p> <ul> <li><code>use_simple_market(commission_rate: float)</code>: Enable simple market (T+0, 7x24, no tax).</li> <li><code>use_china_market()</code>: Enable China market (T+1/T+0, trading sessions, taxes).</li> <li><code>use_china_futures_market()</code>: Enable China futures market (T+0, manual session config required).</li> <li><code>set_t_plus_one(enabled: bool)</code>: Enable/Disable T+1 rule (ChinaMarket only).</li> <li><code>set_stock_fee_rules(commission_rate, stamp_tax, transfer_fee, min_commission)</code>: Set stock fee rules.</li> <li><code>set_slippage(type: str, value: float)</code>: Set slippage. <code>type</code> can be <code>\"fixed\"</code> (fixed amount) or <code>\"percent\"</code> (percentage).</li> </ul> <p>Runtime Methods:</p> <ul> <li><code>add_instrument(instrument: Instrument)</code>: Add instrument definition.</li> <li><code>add_data(feed: DataFeed)</code>: Add data source.</li> <li><code>add_bars(bars: List[Bar])</code>: Batch add Bar data.</li> <li><code>run(strategy: Strategy, show_progress: bool) -&gt; str</code>: Run backtest.</li> <li><code>get_results() -&gt; BacktestResult</code>: Get detailed backtest results.</li> </ul>"},{"location":"en/api/#akquantdatafeed","title":"<code>akquant.DataFeed</code>","text":"<p>Data container.</p> <ul> <li><code>add_bars(bars: List[Bar])</code>: Add data.</li> <li><code>sort()</code>: Sort data by timestamp.</li> </ul>"},{"location":"en/api/#akquantbaraggregator","title":"<code>akquant.BarAggregator</code>","text":"<p>Real-time Tick aggregator, used to convert Tick streams into Bar data and automatically inject into DataFeed.</p> <pre><code>aggregator = akquant.BarAggregator(feed: DataFeed, interval_min: int = 1)\n</code></pre> <p>Methods:</p> <ul> <li><code>on_tick(symbol: str, price: float, volume: float, timestamp_ns: int)</code>: Process new Tick data.<ul> <li><code>volume</code>: Here volume should be accumulated volume (TotalVolume), the aggregator will automatically calculate the increment.</li> </ul> </li> </ul>"},{"location":"en/api/#2-strategy-development-strategy","title":"2. Strategy Development (Strategy)","text":""},{"location":"en/api/#akquantstrategy","title":"<code>akquant.Strategy</code>","text":"<p>Strategy base class. Users should inherit from this class and override callback methods.</p> <p>Callback Methods:</p> <ul> <li><code>on_start()</code>: Triggered when the strategy starts. Used for subscription (<code>subscribe</code>) and indicator registration.</li> <li><code>on_bar(bar: Bar)</code>: Triggered when a Bar closes.</li> <li><code>on_tick(tick: Tick)</code>: Triggered when a Tick arrives.</li> <li><code>on_timer(payload: str)</code>: Triggered by timer.</li> </ul> <p>Trading Methods:</p> <ul> <li><code>buy(symbol, quantity, price=None, ...)</code>: Buy. Market order if <code>price</code> is not specified.</li> <li><code>sell(symbol, quantity, price=None, ...)</code>: Sell.</li> <li><code>short(symbol, quantity, price=None, ...)</code>: Short sell.</li> <li><code>cover(symbol, quantity, price=None, ...)</code>: Buy to cover.</li> <li><code>stop_buy(symbol, trigger_price, quantity, ...)</code>: Stop buy.</li> <li><code>stop_sell(symbol, trigger_price, quantity, ...)</code>: Stop sell.</li> <li><code>order_target_value(target_value, symbol, price=None)</code>: Adjust position to target value.</li> <li><code>order_target_percent(target_percent, symbol, price=None)</code>: Adjust position to target account percentage.</li> <li><code>close_position(symbol)</code>: Close position for a specific instrument.</li> <li><code>cancel_all_orders(symbol)</code>: Cancel all pending orders for a specific instrument.</li> </ul> <p>Data Access:</p> <ul> <li><code>get_history(count, symbol, field=\"close\") -&gt; np.ndarray</code>: Get history data array (Zero-Copy).</li> <li><code>get_position(symbol) -&gt; float</code>: Get current position size.</li> <li><code>get_cash() -&gt; float</code>: Get current available cash.</li> <li><code>subscribe(instrument_id: str)</code>: Subscribe to market data.</li> </ul>"},{"location":"en/api/#akquantbar","title":"<code>akquant.Bar</code>","text":"<p>Bar data object.</p> <ul> <li><code>timestamp</code>: Unix timestamp (nanoseconds).</li> <li><code>open</code>, <code>high</code>, <code>low</code>, <code>close</code>, <code>volume</code>: OHLCV data.</li> <li><code>symbol</code>: Instrument symbol.</li> </ul>"},{"location":"en/api/#3-trading-objects","title":"3. Trading Objects","text":""},{"location":"en/api/#akquantorder","title":"<code>akquant.Order</code>","text":"<p>Order object.</p> <ul> <li><code>id</code>: Order ID.</li> <li><code>symbol</code>: Instrument symbol.</li> <li><code>side</code>: <code>OrderSide.Buy</code> or <code>OrderSide.Sell</code>.</li> <li><code>order_type</code>: <code>OrderType.Market</code>, <code>OrderType.Limit</code>, <code>OrderType.StopMarket</code> etc.</li> <li><code>status</code>: <code>OrderStatus.New</code>, <code>Submitted</code>, <code>Filled</code>, <code>Cancelled</code>, <code>Rejected</code> etc.</li> <li><code>quantity</code>: Order quantity.</li> <li><code>filled_quantity</code>: Filled quantity.</li> <li><code>average_filled_price</code>: Average filled price.</li> </ul>"},{"location":"en/api/#akquantinstrument","title":"<code>akquant.Instrument</code>","text":"<p>Contract definition.</p> <pre><code>Instrument(\n    symbol=\"AAPL\",\n    asset_type=AssetType.Stock,\n    multiplier=1.0,\n    margin_ratio=1.0,\n    tick_size=0.01\n)\n</code></pre>"},{"location":"en/api/#4-portfolio-risk","title":"4. Portfolio &amp; Risk","text":""},{"location":"en/api/#akquantportfolio","title":"<code>akquant.Portfolio</code>","text":"<ul> <li><code>cash</code>: Current cash.</li> <li><code>positions</code>: Position dictionary <code>{symbol: quantity}</code>.</li> <li><code>available_positions</code>: Available positions (considering T+1 and frozen).</li> </ul>"},{"location":"en/api/#akquantriskconfig","title":"<code>akquant.RiskConfig</code>","text":"<p>Risk configuration.</p> <ul> <li><code>active</code>: Whether enabled.</li> <li><code>max_order_size</code>: Max single order size.</li> <li><code>max_order_value</code>: Max single order value.</li> <li><code>max_position_size</code>: Max position size.</li> <li><code>restricted_list</code>: Restricted trading list (List[str]).</li> </ul>"},{"location":"en/api/#5-analysis","title":"5. Analysis","text":""},{"location":"en/api/#akquantbacktestresult","title":"<code>akquant.BacktestResult</code>","text":"<p>Backtest result container.</p> <ul> <li><code>metrics_df</code>: DataFrame containing performance metrics (Total Return, Sharpe, Max Drawdown, etc.).</li> <li><code>daily_positions_df</code>: Daily position DataFrame.</li> <li><code>trades</code>: List of trade records (<code>ClosedTrade</code> objects).</li> <li><code>equity_curve</code>: Equity curve data.</li> </ul>"},{"location":"en/api/#6-built-in-indicators","title":"6. Built-in Indicators","text":"<p>Located in <code>akquant.indicators</code> module.</p> <ul> <li><code>SMA(period)</code></li> <li><code>EMA(period)</code></li> <li><code>MACD(fast, slow, signal)</code></li> <li><code>RSI(period)</code></li> <li><code>BollingerBands(period, multiplier)</code></li> <li><code>ATR(period)</code></li> </ul> <p>All indicators have a <code>value</code> property to get the current value, and will automatically update after being registered to a Strategy.</p>"},{"location":"en/api/#7-machine-learning","title":"7. Machine Learning","text":"<p>AKQuant provides a dedicated machine learning support module <code>akquant.ml</code>. For detailed usage, please refer to the Machine Learning Guide.</p>"},{"location":"en/api/#core-classes","title":"Core Classes","text":"<ul> <li><code>akquant.ml.QuantModel</code>: Unified interface for all ML models.</li> <li><code>akquant.ml.SklearnAdapter</code>: Adapter for Scikit-learn style models (e.g., XGBoost, LightGBM).</li> <li><code>akquant.ml.PyTorchAdapter</code>: Adapter for PyTorch deep learning models.</li> </ul> <p>Key Methods:</p> <ul> <li><code>set_validation(method='walk_forward', verbose=False, ...)</code>: Configure rolling validation/training parameters.</li> <li><code>predict(X)</code>: Execute prediction.</li> </ul>"},{"location":"en/architecture/","title":"AKQuant - High-Performance Rust/Python Quantitative Research Framework","text":""},{"location":"en/architecture/#1-project-overview","title":"1. Project Overview","text":"<p>AKQuant is a hybrid language quantitative research framework designed for high-performance backtesting. It leverages Rust to handle heavy computational tasks (such as event loops, numerical calculations, and memory management) while using Python for strategy definition, data analysis, and visualization.</p>"},{"location":"en/architecture/#2-architecture-design","title":"2. Architecture Design","text":""},{"location":"en/architecture/#21-system-layering","title":"2.1 System Layering","text":"<ol> <li>Rust Core Layer (<code>akquant_core</code>):<ul> <li>Data Engine: Uses <code>polars</code> (Arrow format) to manage OHLCV data, aiming for zero-copy memory mapping.</li> <li>Backtest Engine: Event-driven execution engine.</li> <li>Event Bus:<ul> <li>Inspired by mature event-driven message bus concepts, implemented based on Rust Channel (<code>mpsc</code>).</li> <li>Decouples strategy, risk control, execution, and data components.</li> <li>Supports asynchronous flow of events like <code>OrderRequest</code> (request), <code>OrderValidated</code> (risk passed), <code>ExecutionReport</code> (execution report).</li> <li>Handles control events with high priority, supporting future expansion to multi-strategy parallelism or asynchronous risk checks.</li> </ul> </li> <li>Order Matching: Simulates limit/market orders, slippage, and commissions.</li> <li>Risk Control Module: Built-in <code>RiskManager</code> supporting pre-trade risk control (T+1 available positions, fund limits, etc.).</li> <li>Indicator Calculation: Rapid calculation of metrics like Sharpe ratio and Max Drawdown.</li> </ul> </li> <li>Interface Layer (PyO3):<ul> <li>Exposes Rust structs (<code>Engine</code>, <code>DataFeed</code>, <code>StrategyContext</code>) as Python classes.</li> <li>Handles type conversion (e.g., Rust <code>DataFrame</code> &lt;-&gt; Python <code>pandas</code>/<code>polars</code>).</li> </ul> </li> <li>Python User Layer:<ul> <li>Strategy API: Abstract base class inherited by users.</li> <li>Data API: Data connectors for Tushare, AKShare, and Parquet files.</li> <li>Visualization: Integration with Plotly/Matplotlib.</li> </ul> </li> </ol>"},{"location":"en/architecture/#22-directory-structure","title":"2.2 Directory Structure","text":"<pre><code>akquant/\n\u251c\u2500\u2500 Cargo.toml          # Rust dependency management\n\u251c\u2500\u2500 pyproject.toml      # Python build system (maturin)\n\u251c\u2500\u2500 src/                # Rust source code\n\u2502   \u251c\u2500\u2500 lib.rs          # PyO3 entry point\n\u2502   \u251c\u2500\u2500 model/          # Data models (Order, Trade, Instrument, Bar, etc.)\n\u2502   \u251c\u2500\u2500 data.rs         # Data source (DataFeed)\n\u2502   \u251c\u2500\u2500 engine.rs       # Core backtest engine\n\u2502   \u251c\u2500\u2500 event.rs        # Event definitions and bus messages\n\u2502   \u251c\u2500\u2500 clock.rs        # Trading clock\n\u2502   \u251c\u2500\u2500 execution.rs    # Exchange simulation and order matching\n\u2502   \u251c\u2500\u2500 market.rs       # Market rules (Fees, T+1/T+0)\n\u2502   \u251c\u2500\u2500 portfolio.rs    # Fund and position management\n\u2502   \u251c\u2500\u2500 risk.rs         # Risk management (RiskManager)\n\u2502   \u251c\u2500\u2500 context.rs      # Strategy interaction context\n\u2502   \u251c\u2500\u2500 history.rs      # Historical data management (Zero-Copy View)\n\u2502   \u251c\u2500\u2500 analysis.rs     # Performance metric calculation\n\u2502   \u2514\u2500\u2500 indicators.rs   # High-performance indicator implementation\n\u251c\u2500\u2500 python/             # Python source code\n\u2502   \u2514\u2500\u2500 akquant/\n\u2502       \u251c\u2500\u2500 ml/         # Machine Learning adapters\n\u2502       \u251c\u2500\u2500 __init__.py\n\u2502       \u251c\u2500\u2500 akquant.pyi # Type hint file\n\u2502       \u251c\u2500\u2500 backtest.py # Backtest entry\n\u2502       \u251c\u2500\u2500 strategy.py # Strategy base class\n\u2502       \u251c\u2500\u2500 indicator.py# Indicator wrapper\n\u2502       \u251c\u2500\u2500 optimize.py # Parameter optimization\n\u2502       \u2514\u2500\u2500 ...         # Other helper modules\n\u2514\u2500\u2500 examples/           # Usage examples\n</code></pre>"},{"location":"en/architecture/#23-core-interaction-flow-event-bus","title":"2.3 Core Interaction Flow (Event Bus)","text":"<ol> <li>Strategy Layer: Strategy calls <code>self.buy()</code>, generating an <code>OrderRequest</code> event in the Rust layer and sending it to the <code>event_tx</code> channel.</li> <li>Engine Layer:<ul> <li>The main loop prioritizes checking the <code>event_rx</code> channel.</li> <li>Upon receiving <code>OrderRequest</code>, calls Risk Module (<code>RiskManager</code>) for checking.</li> <li>If risk check passes, generates <code>OrderValidated</code> event and resends to the channel.</li> <li>If risk check fails, generates <code>ExecutionReport</code> with rejected status and sends to the channel.</li> </ul> </li> <li>Execution Layer:<ul> <li>Receives <code>OrderValidated</code> event.</li> <li>Simulation Mode: Immediately matches or adds to order book, generating <code>ExecutionReport</code>.</li> <li>Live Mode: Sends order to external gateway and generates <code>ExecutionReport</code> upon receiving return.</li> </ul> </li> <li>Strategy Layer: Strategy updates order status (<code>pending_orders</code>) and positions via callbacks.</li> </ol>"},{"location":"en/architecture/#3-technology-stack-selection","title":"3. Technology Stack Selection","text":"<ul> <li>Rust:<ul> <li><code>pyo3</code>: Generates Python bindings.</li> <li><code>polars</code> / <code>arrow</code>: High-performance columnar data storage.</li> <li><code>rayon</code>: Parallel processing for multi-asset backtesting.</li> <li><code>serde</code>: Serialization support.</li> </ul> </li> <li>Python:<ul> <li><code>maturin</code>: Backend build system.</li> <li><code>pandas</code> / <code>numpy</code>: User-facing data processing.</li> <li><code>plotly</code>: Interactive visualization.</li> </ul> </li> </ul>"},{"location":"en/architecture/#4-development-roadmap","title":"4. Development Roadmap","text":""},{"location":"en/architecture/#phase-1-prototype-verification-current","title":"Phase 1: Prototype Verification (Current)","text":"<ul> <li> Configure project build system (Maturin).</li> <li> Define <code>Candle</code> (K-line) and <code>Feed</code> (Data Stream) structs in Rust.</li> <li> Expose basic data loading functions to Python.</li> <li> Return Pandas DataFrame from Rust.</li> </ul>"},{"location":"en/architecture/#phase-2-core-engine","title":"Phase 2: Core Engine","text":"<ul> <li> Implement event loop in Rust.</li> <li> Create <code>Strategy</code> trait in Rust and wrap it for Python inheritance.</li> <li> Basic order matching (Market/Limit orders).</li> </ul>"},{"location":"en/architecture/#phase-3-analysis-visualization","title":"Phase 3: Analysis &amp; Visualization","text":"<ul> <li> Implement performance metric calculation (Rust side).</li> <li> Create visualization module (Python side).</li> </ul>"},{"location":"en/architecture/#phase-4-production-ready","title":"Phase 4: Production Ready","text":"<ul> <li> Connect to external data sources (Tushare/SQL).</li> <li> Support parallel backtesting.</li> <li> Refine documentation.</li> </ul>"},{"location":"en/design/","title":"AKQuant Design and Development Guide","text":"<p>This document details the internal design principles, core component architecture, and extension development guide of <code>AKQuant</code>. It aims to help developers deeply understand the project structure for secondary development and functional expansion.</p>"},{"location":"en/design/#1-project-overview","title":"1. Project Overview","text":""},{"location":"en/design/#11-design-philosophy","title":"1.1 Design Philosophy","text":"<p><code>AKQuant</code> follows these core design principles:</p> <ol> <li>Core Calculation Sinking (Rust Core): All computationally intensive tasks (event loop, order matching, risk checks, data management, performance calculation, historical data maintenance) are implemented in the Rust layer to ensure high performance and memory safety.</li> <li>Strategy Logic Floating (Python API): User interaction layers such as strategy writing, parameter configuration, data analysis, and machine learning model definition remain in Python, leveraging its dynamic features and rich ecosystem (Pandas, Scikit-learn, PyTorch, etc.).</li> <li>Modularity &amp; Decoupling: Drawing from mature quantitative framework designs, modules such as data, execution, strategy, risk control, and machine learning are strictly separated and interact through clear interfaces (Traits).</li> </ol>"},{"location":"en/design/#12-project-directory-structure","title":"1.2 Project Directory Structure","text":"<pre><code>akquant/\n\u251c\u2500\u2500 Cargo.toml              # Rust project dependencies and config\n\u251c\u2500\u2500 pyproject.toml          # Python project build config (Maturin)\n\u251c\u2500\u2500 Makefile                # Project management commands\n\u251c\u2500\u2500 src/                    # Rust core source (Low-level implementation)\n\u2502   \u251c\u2500\u2500 lib.rs              # PyO3 module entry, registers Python module\n\u2502   \u251c\u2500\u2500 engine.rs           # Backtest engine: drives timeline and event loop\n\u2502   \u251c\u2500\u2500 execution.rs        # Execution layer: simulates exchange matching logic\n\u2502   \u251c\u2500\u2500 market.rs           # Market layer: defines commissions, stamp tax, T+1 rules\n\u2502   \u251c\u2500\u2500 portfolio.rs        # Account layer: manages funds, positions, and available positions\n\u2502   \u251c\u2500\u2500 data.rs             # Data layer: manages Bar/Tick data streams\n\u2502   \u251c\u2500\u2500 analysis.rs         # Analysis layer: calculates performance metrics (Sharpe, Drawdown)\n\u2502   \u251c\u2500\u2500 context.rs          # Context: data snapshot for Python callbacks\n\u2502   \u251c\u2500\u2500 clock.rs            # Clock module: unified time management\n\u2502   \u251c\u2500\u2500 event.rs            # Event system: defines internal system events\n\u2502   \u251c\u2500\u2500 history.rs          # Historical data: efficient ring buffer management\n\u2502   \u251c\u2500\u2500 indicators.rs       # Technical indicators: Rust native implementation (e.g., SMA)\n\u2502   \u2514\u2500\u2500 model/              # Data model: defines basic data structures\n\u2502       \u251c\u2500\u2500 mod.rs          # Model module definition\n\u2502       \u251c\u2500\u2500 order.rs        # Order and Trade\n\u2502       \u251c\u2500\u2500 instrument.rs   # Instrument information\n\u2502       \u251c\u2500\u2500 market_data.rs  # Market data (Bar, Tick)\n\u2502       \u251c\u2500\u2500 timer.rs        # Timer events\n\u2502       \u2514\u2500\u2500 types.rs        # Basic enums (Side, Type, ExecutionMode)\n\u251c\u2500\u2500 python/\n\u2502   \u2514\u2500\u2500 akquant/            # Python package source (User Interface)\n\u2502       \u251c\u2500\u2500 __init__.py     # Exports public API\n\u2502       \u251c\u2500\u2500 strategy.py     # Strategy base class: encapsulates context, provides ML training &amp; trading interface\n\u2502       \u251c\u2500\u2500 backtest.py     # BacktestResult analysis &amp; DataFrame conversion\n\u2502       \u251c\u2500\u2500 config.py       # Config definitions: BacktestConfig, StrategyConfig, RiskConfig\n\u2502       \u251c\u2500\u2500 risk.py         # Risk config adapter layer\n\u2502       \u251c\u2500\u2500 data.py         # Data loading &amp; catalog service (DataCatalog)\n\u2502       \u251c\u2500\u2500 sizer.py        # Sizer base class: provides various position sizing implementations\n\u2502       \u251c\u2500\u2500 indicator.py    # Python indicator interface\n\u2502       \u251c\u2500\u2500 optimize.py     # Parameter optimization tool\n\u2502       \u251c\u2500\u2500 plot.py         # Plotting tool\n\u2502       \u251c\u2500\u2500 log.py          # Logging module\n\u2502       \u251c\u2500\u2500 utils.py        # Utility functions\n\u2502       \u251c\u2500\u2500 ml/             # Machine Learning framework (New)\n\u2502       \u2502   \u251c\u2500\u2500 __init__.py\n\u2502       \u2502   \u2514\u2500\u2500 model.py    # QuantModel, SklearnAdapter, ValidationConfig\n\u2502       \u2514\u2500\u2500 akquant.pyi     # Type hint file (IDE completion support)\n\u251c\u2500\u2500 tests/                  # Test cases\n\u2514\u2500\u2500 examples/               # Example code\n    \u251c\u2500\u2500 benchmark_akquant_multi.py  # Multi-threaded Benchmark\n    \u251c\u2500\u2500 ml_framework_demo.py        # ML framework basic example\n    \u251c\u2500\u2500 ml_walk_forward_demo.py     # Walk-forward training example\n    \u251c\u2500\u2500 optimization_demo.py        # Parameter optimization example\n    \u2514\u2500\u2500 plot_demo.py                # Plotting example\n</code></pre>"},{"location":"en/design/#2-core-component-architecture-details","title":"2. Core Component Architecture Details","text":""},{"location":"en/design/#21-data-model-layer-srcmodel","title":"2.1 Data Model Layer (<code>src/model/</code>)","text":"<p>To ensure cross-language interaction performance and type safety, core data structures are defined in Rust and exported.</p> <ul> <li><code>types.rs</code>:<ul> <li><code>ExecutionMode</code>: <code>CurrentClose</code> (Match on current close, i.e., Cheat-on-Close) vs <code>NextOpen</code> (Match on next open, more realistic).</li> <li><code>OrderSide</code>: <code>Buy</code> / <code>Sell</code>.</li> <li><code>OrderType</code>: <code>Market</code>, <code>Limit</code>.</li> <li><code>TimeInForce</code>: <code>Day</code>, <code>GTC</code>, <code>IOC</code>/<code>FOK</code>.</li> </ul> </li> <li><code>instrument.rs</code>: <code>Instrument</code> contains <code>multiplier</code> (contract multiplier) and <code>tick_size</code>.</li> <li><code>market_data.rs</code>: <code>Bar</code> (OHLCV) and <code>Tick</code> (Last Price/Volume).</li> </ul>"},{"location":"en/design/#22-execution-layer-srcexecutionrs","title":"2.2 Execution Layer (<code>src/execution.rs</code>)","text":"<p><code>ExchangeSimulator</code> is the core of backtest accuracy, responsible for simulating exchange matching logic.</p> <ul> <li>Matching Mechanism:<ul> <li>Limit Order: Buy requires <code>Low &lt;= Price</code>, Sell requires <code>High &gt;= Price</code>.</li> <li>Market Order: Matches at <code>Close</code> or <code>Open</code> based on <code>ExecutionMode</code>.</li> </ul> </li> <li>Trigger Mechanism: Supports <code>trigger_price</code> (Stop Loss/Take Profit orders).</li> </ul>"},{"location":"en/design/#23-market-rule-layer-srcmarketrs","title":"2.3 Market Rule Layer (<code>src/market.rs</code>)","text":"<p>Isolates rules of different markets via <code>MarketModel</code> Trait. Currently built-in <code>ChinaMarket</code> (A-share market rules):</p> <ul> <li>Commission Calculation: Supports stocks (Stamp Tax, Transfer Fee, Commission) and Futures (Per Lot or Per Amount).</li> <li>Trading Restrictions: Strict T+1 (Stocks) and T+0 (Futures) available position management.</li> </ul>"},{"location":"en/design/#24-risk-control-layer-srcriskrs","title":"2.4 Risk Control Layer (<code>src/risk.rs</code>)","text":"<p><code>RiskManager</code> is independent of the execution layer, intercepting every order:</p> <ul> <li>Check Rules: Restricted list, max single order size/value, max position ratio.</li> <li>Configuration: Python side <code>RiskConfig</code> automatically injected into Rust engine.</li> </ul>"},{"location":"en/design/#25-account-layer-srcportfoliors","title":"2.5 Account Layer (<code>src/portfolio.rs</code>)","text":"<p><code>Portfolio</code> struct maintains account status:</p> <ul> <li><code>cash</code>: Available funds.</li> <li><code>positions</code>: Total positions.</li> <li><code>available_positions</code>: Sellable positions (Core of T+1 logic).</li> <li>Equity Calculation: Real-time Mark-to-Market calculation.</li> </ul>"},{"location":"en/design/#26-engine-layer-srcenginers-srchistoryrs","title":"2.6 Engine Layer (<code>src/engine.rs</code> &amp; <code>src/history.rs</code>)","text":"<p><code>Engine</code> is the system driver:</p> <ul> <li>Event Loop: Consumes <code>Bar</code> or <code>Tick</code> events.</li> <li>History Data Management: <code>Engine</code> internally maintains a <code>History</code> module, an efficient ring buffer storing data for the last N bars, allowing strategies fast access via <code>get_history</code> without accumulating data on the Python side.</li> <li>Day Cut Processing: Triggers T+1 unlocking, expired order cleanup.</li> </ul>"},{"location":"en/design/#27-analysis-layer-srcanalysisrs","title":"2.7 Analysis Layer (<code>src/analysis.rs</code>)","text":"<p>Follows standard PnL calculation: <code>Gross PnL</code>, <code>Net PnL</code>, <code>Commission</code>.</p>"},{"location":"en/design/#28-python-abstraction-layer-pythonakquant","title":"2.8 Python Abstraction Layer (<code>python/akquant/</code>)","text":"<ul> <li><code>Strategy</code> (<code>strategy.py</code>):<ul> <li>History Data Access:<ul> <li><code>set_history_depth(depth)</code>: Enable Rust side history recording.</li> <li><code>get_history(count)</code> / <code>get_history_df(count)</code>: Get OHLCV data for the last N bars (Numpy/DataFrame).</li> </ul> </li> <li>ML Integration:<ul> <li><code>set_rolling_window(train, step)</code>: Configure rolling training parameters.</li> <li><code>on_train_signal(context)</code>: Periodically trigger model training.</li> <li><code>prepare_features(df)</code>: Feature engineering interface.</li> </ul> </li> </ul> </li> <li><code>BacktestResult</code> (<code>backtest.py</code>):<ul> <li>Encapsulates <code>BacktestResult</code> returned by Rust.</li> <li>Provides convenient properties like <code>metrics_df</code>, <code>daily_positions_df</code>.</li> </ul> </li> <li><code>Sizer</code> (<code>sizer.py</code>): Position sizing base class.</li> </ul>"},{"location":"en/design/#29-machine-learning-framework-pythonakquantml","title":"2.9 Machine Learning Framework (<code>python/akquant/ml/</code>)","text":"<p><code>AKQuant</code> provides a standardized ML interface aimed at simplifying the \"Rolling Train-Predict\" workflow.</p> <ul> <li><code>QuantModel</code> (<code>model.py</code>):<ul> <li>Abstract base class for all models.</li> <li>Interface: <code>fit(X, y)</code>, <code>predict(X)</code>, <code>save(path)</code>, <code>load(path)</code>.</li> <li><code>set_validation</code>: Configure Walk-forward Validation parameters (Train window, Test window, Rolling step).</li> </ul> </li> <li><code>SklearnAdapter</code>:<ul> <li>Encapsulates Scikit-learn style models (e.g., RandomForest, LinearRegression) to adapt to <code>QuantModel</code> interface.</li> </ul> </li> <li>Workflow:<ol> <li>User defines model in strategy <code>self.model = SklearnAdapter(RandomForestClassifier())</code>.</li> <li>Set rolling parameters <code>self.set_rolling_window(train_window=250, step=20)</code>.</li> <li>Override <code>prepare_features</code> to convert raw OHLCV to Features (X) and Labels (y).</li> <li>During backtest, engine automatically triggers <code>on_train_signal</code> at specified steps, strategy retrieves history data and trains model.</li> <li>Call <code>self.model.predict</code> in <code>on_bar</code> to generate signals.</li> </ol> </li> </ul>"},{"location":"en/design/#3-key-workflow-details","title":"3. Key Workflow Details","text":""},{"location":"en/design/#31-backtest-main-loop-execution-mode","title":"3.1 Backtest Main Loop &amp; Execution Mode","text":"<p><code>Engine::run</code> flow depends on <code>ExecutionMode</code>:</p> <ul> <li>NextOpen: Recommended mode. Bar Close generates signal -&gt; Next Bar Open matches.</li> <li>CurrentClose: Simplified mode. Bar Close generates signal -&gt; Current Bar Close matches (Cheat-on-Close).</li> </ul>"},{"location":"en/design/#32-order-lifecycle","title":"3.2 Order Lifecycle","text":"<p>Signal -&gt; Creation -&gt; Submission -&gt; Risk Check (Rust) -&gt; Matching (Rust) -&gt; Settlement (Rust) -&gt; Reporting.</p>"},{"location":"en/design/#4-extension-development-guide","title":"4. Extension Development Guide","text":""},{"location":"en/design/#41-how-to-add-new-order-types","title":"4.1 How to Add New Order Types","text":"<ol> <li><code>src/model/types.rs</code>: Add enum.</li> <li><code>src/model/order.rs</code>: Update struct.</li> <li><code>src/execution.rs</code>: Implement matching logic.</li> <li><code>akquant.pyi</code>: Update type hints.</li> </ol>"},{"location":"en/design/#42-how-to-customize-indicators","title":"4.2 How to Customize Indicators","text":"<ol> <li>Python Side (Rapid Prototype): Inherit <code>akquant.Indicator</code>, calculate in <code>on_bar</code>.</li> <li>Rust Side (High Performance):<ul> <li>Implement <code>Indicator</code> Trait in <code>src/indicators.rs</code>.</li> <li>Export to Python via <code>#[pyclass]</code>.</li> </ul> </li> </ol>"},{"location":"en/design/#43-how-to-access-new-data-sources","title":"4.3 How to Access New Data Sources","text":"<p>Convert data to pandas DataFrame, construct <code>akquant.Bar</code> object list, call <code>engine.add_feed</code>.</p>"},{"location":"en/design/#5-rust-python-interaction-notes","title":"5. Rust &amp; Python Interaction Notes","text":"<ul> <li>GIL: Rust only acquires GIL when calling back into Python; computationally intensive tasks release GIL (implementation dependent, currently mainly single-threaded model).</li> <li>Data Copying: Minimize large-scale data transfer between Python and Rust. <code>get_history</code> returns Numpy view or copy, far more efficient than Python list.</li> </ul>"},{"location":"en/env_guide/","title":"Environment Setup Guide","text":"<p>Before starting quantitative trading, you need a clean, stable, and isolated Python environment. This guide provides two mainstream solutions: Miniconda (Classic &amp; Stable) and uv (Fast &amp; Modern).</p>"},{"location":"en/env_guide/#option-a-miniconda-classic","title":"Option A: Miniconda (Classic)","text":"<p>Miniconda is a minimal installer for conda. It is the industry standard for data science, making it easy to manage Python versions and dependencies.</p>"},{"location":"en/env_guide/#1-install-miniconda","title":"1. Install Miniconda","text":"<p>Tip: Users in China can download from Tsinghua Mirror for faster speeds.</p> WindowsmacOSLinux <ol> <li>Visit Miniconda Website (or Tsinghua Mirror).</li> <li>Download the Windows 64-bit installer (<code>.exe</code>).</li> <li>Run the installer. It is recommended to check \"Add Miniconda3 to my PATH environment variable\" (convenient for beginners).</li> <li>After installation, open Command Prompt (CMD) or PowerShell.</li> </ol> <p>Method A: Via Homebrew (Recommended) Open Terminal and run: <pre><code>brew install --cask miniconda\ninit conda\n</code></pre></p> <p>Method B: Via Installer Script 1.  Download script for Apple Silicon or Intel. 2.  Run in terminal: <code>bash Miniconda3-latest-MacOSX-arm64.sh</code>.</p> <p>Open terminal and run: <pre><code>mkdir -p ~/miniconda3\nwget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda3/miniconda.sh\nbash ~/miniconda3/miniconda.sh -b -u -p ~/miniconda3\nrm -rf ~/miniconda3/miniconda.sh\n~/miniconda3/bin/conda init bash\n</code></pre></p>"},{"location":"en/env_guide/#15-configure-mirrors-for-users-in-china","title":"1.5 Configure Mirrors (For Users in China)","text":"<p>If you are located in China, download speeds might be slow. It is recommended to use the Tsinghua University mirror.</p> <pre><code># Configure Conda Mirror\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/\nconda config --set show_channel_urls yes\n\n# Configure Pip Mirror\npip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple\n</code></pre>"},{"location":"en/env_guide/#2-create-virtual-environment","title":"2. Create Virtual Environment","text":"<p>Do not install libraries directly into your system Python! We need a dedicated \"sandbox\".</p> <p>Open your terminal (or CMD/Anaconda Prompt on Windows) and type:</p> <pre><code># Create an environment named 'akquant' with Python 3.10\nconda create -n akquant python=3.10 -y\n\n# Activate the environment\nconda activate akquant\n</code></pre> <p>Once activated, your command prompt prefix will change to <code>(akquant)</code>, indicating you are inside the sandbox.</p>"},{"location":"en/env_guide/#option-b-uv-fast-modern","title":"Option B: uv (Fast &amp; Modern)","text":"<p>If you want extreme speed and lightweight management, uv is the fastest package manager in the Python ecosystem (written in Rust). It replaces <code>pip</code> and <code>virtualenv</code>.</p>"},{"location":"en/env_guide/#1-install-uv","title":"1. Install uv","text":"WindowsmacOS / Linux <p>Run in PowerShell: <pre><code>powershell -ExecutionPolicy ByPass -c \"irm https://astral.sh/uv/install.ps1 | iex\"\n</code></pre></p> <p>Run in Terminal: <pre><code>curl -LsSf https://astral.sh/uv/install.sh | sh\n</code></pre></p>"},{"location":"en/env_guide/#2-create-manage-environment","title":"2. Create &amp; Manage Environment","text":"<p>uv does not require pre-installed Python; it manages Python versions for you.</p> <pre><code># 1. Create a project directory\nmkdir my_strategy\ncd my_strategy\n\n# 2. Initialize virtual env (Specify Python 3.10)\n# uv will automatically download Python 3.10 and create .venv folder\nuv venv --python 3.10\n\n# 3. Activate environment\n# Windows:\n.venv\\Scripts\\activate\n# macOS / Linux:\nsource .venv/bin/activate\n</code></pre>"},{"location":"en/env_guide/#3-install-akquant-verify","title":"3. Install AKQuant &amp; Verify","text":"<p>Whether you used Miniconda or uv, you should now be in an activated virtual environment.</p>"},{"location":"en/env_guide/#install","title":"Install","text":"<p>If using Miniconda: <pre><code>pip install akquant\n\n# Users in China can use the Tsinghua mirror for speed:\n# pip install akquant -i https://pypi.tuna.tsinghua.edu.cn/simple\n</code></pre></p> <p>If using uv: <pre><code>uv pip install akquant\n\n# Users in China:\n# uv pip install akquant --index-url https://pypi.tuna.tsinghua.edu.cn/simple\n</code></pre></p>"},{"location":"en/env_guide/#verify","title":"Verify","text":"<p>Create a test script <code>verify.py</code>:</p> <pre><code>import akquant\nimport pandas as pd\n\nprint(f\"AKQuant Version: {akquant.__version__}\")\nprint(f\"Pandas Version: {pd.__version__}\")\nprint(\"Environment setup successful! Ready to trade.\")\n</code></pre> <p>Run it:</p> <pre><code>python verify.py\n</code></pre> <p>If you see the success message, your arsenal is ready! Next, go to Python for Finance to learn syntax, or jump to Quant Guide to start coding strategies.</p>"},{"location":"en/examples/","title":"Examples Collection","text":""},{"location":"en/examples/#1-basic-examples","title":"1. Basic Examples","text":"<ul> <li>Quick Start: Complete workflow covering manual data backtesting and AKShare data backtesting.</li> <li>Simple SMA Strategy: Demonstrates how to write a strategy in class style and perform simple trading logic in <code>on_bar</code>.</li> </ul>"},{"location":"en/examples/#2-advanced-examples","title":"2. Advanced Examples","text":"<ul> <li> <p>Zipline Style Strategy: Demonstrates how to write strategies using functional API (<code>initialize</code>, <code>on_bar</code>), suitable for users migrating from Zipline.</p> <ul> <li>Refer to Strategy Guide.</li> </ul> </li> <li> <p>Multi-Asset Backtest:</p> <ul> <li>Futures Strategy: Demonstrates futures backtest configuration (margin, multiplier). Refer to Strategy Guide.</li> <li>Option Strategy: Demonstrates option backtest configuration (premium, per contract fee). Refer to Strategy Guide.</li> </ul> </li> <li> <p>Vectorized Indicators:</p> <ul> <li>Demonstrates how to use <code>IndicatorSet</code> to pre-calculate indicators to improve backtest speed. Refer to Strategy Guide.</li> </ul> </li> </ul>"},{"location":"en/examples/#3-common-strategies","title":"3. Common Strategies","text":"<p>Here are some common quantitative strategy implementations that you can use directly in your projects. We provide detailed logic explanations for each strategy to help you understand the core concepts.</p>"},{"location":"en/examples/#31-dual-moving-average-strategy","title":"3.1 Dual Moving Average Strategy","text":"<p>Core Concept: The Dual Moving Average strategy uses two moving averages (SMA) with different periods to determine market trends. *   Short-term SMA (e.g., 5 days): Sensitive, closely follows price fluctuations. *   Long-term SMA (e.g., 20 days): Lagging, represents the long-term trend.</p> <p>Trading Signals: *   Golden Cross: When the short-term SMA crosses above the long-term SMA, it indicates a strengthening short-term trend, which is a Buy signal. *   Death Cross: When the short-term SMA crosses below the long-term SMA, it indicates a weakening short-term trend, which is a Sell signal.</p> <p>This example uses high-performance incremental indicators <code>aq.SMA</code> implemented in Rust.</p> <pre><code>import akquant as aq\n\nclass DualSMAStrategy(aq.Strategy):\n    def __init__(self, short_window=5, long_window=20):\n        # Initialize two indicators: Short SMA and Long SMA\n        # Use Rust implemented high-performance incremental SMA indicators\n        self.sma_short = aq.SMA(short_window)\n        self.sma_long = aq.SMA(long_window)\n\n    def on_bar(self, bar: aq.Bar):\n        # 1. Update indicator status\n        # The update method accepts the current closing price and returns the latest MA value\n        short_val = self.sma_short.update(bar.close)\n        long_val = self.sma_long.update(bar.close)\n\n        # 2. Skip if indicator data is insufficient (e.g., cannot calculate 20-day MA at the start)\n        if short_val is None or long_val is None:\n            return\n\n        # Get current position quantity\n        position = self.get_position(bar.symbol)\n\n        # 3. Generate Trading Signals\n\n        # Golden Cross (Short MA crosses above Long MA) -&gt; And no position -&gt; Buy\n        if short_val &gt; long_val and position == 0:\n            self.buy(bar.symbol, 100)\n\n        # Death Cross (Short MA crosses below Long MA) -&gt; And holding position -&gt; Sell to Close\n        elif short_val &lt; long_val and position &gt; 0:\n            self.sell(bar.symbol, 100)\n</code></pre>"},{"location":"en/examples/#32-rsi-mean-reversion-strategy","title":"3.2 RSI Mean Reversion Strategy","text":"<p>Core Concept: RSI (Relative Strength Index) is a momentum indicator ranging from 0 to 100, measuring the magnitude of recent price changes. *   Mean Reversion: This strategy assumes that prices will not rise or fall indefinitely and will eventually revert to a normal level after excessive deviation. *   Oversold: RSI below a threshold (e.g., 30) implies the recent drop is excessive, suggesting a potential rebound -&gt; Buy. *   Overbought: RSI above a threshold (e.g., 70) implies the recent rise is excessive, suggesting a potential pullback -&gt; Sell.</p> <p>This example demonstrates how to use <code>get_history_df</code> to retrieve historical data and combine it with <code>pandas</code> to calculate complex indicators.</p> <pre><code>import akquant as aq\nimport pandas as pd\nimport numpy as np\n\nclass RSIStrategy(aq.Strategy):\n    def __init__(self, period=14, buy_threshold=30, sell_threshold=70):\n        self.period = period\n        self.buy_threshold = buy_threshold\n        self.sell_threshold = sell_threshold\n        # IMPORTANT: Set historical data lookback depth\n        # Since calculating RSI requires past N days of data, sufficient history window must be reserved\n        self.set_history_depth(period + 20)\n\n    def calculate_rsi(self, prices: pd.Series) -&gt; pd.Series:\n        \"\"\"Calculate RSI using pandas.\"\"\"\n        delta = prices.diff()\n        # Simple RSI algorithm implementation\n        gain = (delta.where(delta &gt; 0, 0)).rolling(window=self.period).mean()\n        loss = (-delta.where(delta &lt; 0, 0)).rolling(window=self.period).mean()\n        rs = gain / loss\n        return 100 - (100 / (1 + rs))\n\n    def on_bar(self, bar: aq.Bar):\n        # 1. Get historical closing price DataFrame\n        # get_history_df returns data for the past N bars\n        history = self.get_history_df(self.period + 20, bar.symbol)\n\n        # Return if data is insufficient\n        if len(history) &lt; self.period + 1:\n            return\n\n        # 2. Calculate RSI\n        rsi_series = self.calculate_rsi(history['close'])\n        current_rsi = rsi_series.iloc[-1] # Get the latest RSI value\n\n        if np.isnan(current_rsi):\n            return\n\n        position = self.get_position(bar.symbol)\n\n        # 3. Trading Logic\n\n        # RSI &lt; 30 (Oversold) -&gt; Expect Rebound -&gt; Buy\n        if current_rsi &lt; self.buy_threshold and position == 0:\n            self.buy(bar.symbol, 100)\n\n        # RSI &gt; 70 (Overbought) -&gt; Expect Drop -&gt; Sell\n        elif current_rsi &gt; self.sell_threshold and position &gt; 0:\n            self.sell(bar.symbol, 100)\n</code></pre>"},{"location":"en/examples/#33-bollinger-bands-strategy","title":"3.3 Bollinger Bands Strategy","text":"<p>Core Concept: Bollinger Bands consist of three lines: *   Middle Band: N-day Moving Average. *   Upper Band: Middle Band + K * Standard Deviation. *   Lower Band: Middle Band - K * Standard Deviation.</p> <p>According to statistical principles, prices have a high probability (e.g., 95%) of falling between the upper and lower bands. *   When price breaks below the lower band, it is often seen as an irrational oversold state, and price may revert to the middle band -&gt; Buy. *   When price breaks above the upper band, it is often seen as an irrational overbought state, and price may pullback -&gt; Sell.</p> <pre><code>import akquant as aq\nimport pandas as pd\n\nclass BollingerStrategy(aq.Strategy):\n    def __init__(self, window=20, num_std=2):\n        self.window = window\n        self.num_std = num_std\n        # Set history depth to ensure enough data for mean and std calculation\n        self.set_history_depth(window + 5)\n\n    def on_bar(self, bar: aq.Bar):\n        # 1. Get historical data\n        history = self.get_history_df(self.window, bar.symbol)\n        if len(history) &lt; self.window:\n            return\n\n        # 2. Calculate Bollinger Bands\n        close_prices = history['close']\n        ma = close_prices.mean()          # Middle Band (Mean)\n        std = close_prices.std()          # Standard Deviation\n        upper_band = ma + self.num_std * std # Upper Band\n        lower_band = ma - self.num_std * std # Lower Band\n\n        position = self.get_position(bar.symbol)\n        current_price = bar.close\n\n        # 3. Trading Logic\n\n        # Price breaks below lower band -&gt; Oversold reversal signal -&gt; Buy\n        if current_price &lt; lower_band and position == 0:\n            self.buy(bar.symbol, 100)\n\n        # Price breaks above upper band -&gt; Overbought reversal signal -&gt; Sell\n        elif current_price &gt; upper_band and position &gt; 0:\n            self.sell(bar.symbol, 100)\n</code></pre>"},{"location":"en/examples/#mixed-asset","title":"3.4 Mixed Asset Backtest","text":"<p>Core Concept: In real trading, strategies may involve multiple assets like stocks, futures, and options simultaneously. Different assets have different trading attributes: *   Stocks: Usually 1 lot = 100 shares, fully paid trading. *   Futures: Have Contract Multiplier (e.g., 1 point = $300) and Margin Ratio (e.g., buy contract with 10% funds).</p> <p>This example demonstrates how to use <code>InstrumentConfig</code> to configure special attributes for futures and mix trade stocks and futures in the same strategy.</p> <pre><code>import akquant as aq\nfrom akquant import InstrumentConfig\nimport pandas as pd\nimport numpy as np\n\n# 1. Prepare data (Mock data)\ndef create_dummy_data(symbol, start_date, n_bars, price=100.0):\n    dates = pd.date_range(start_date, periods=n_bars, freq=\"B\")\n    np.random.seed(42)\n    changes = np.random.randn(n_bars)\n    prices = price + np.cumsum(changes)\n\n    df = pd.DataFrame({\n        \"open\": prices, \"high\": prices + 1, \"low\": prices - 1, \"close\": prices,\n        \"volume\": 1000, \"symbol\": symbol\n    }, index=dates)\n    return df\n\nclass TestStrategy(aq.Strategy):\n    def __init__(self):\n        self.count = 0\n\n    def on_bar(self, bar: aq.Bar):\n        # Simple logic: Buy stock and future respectively on first two bars\n        if self.count &lt; 2:\n            print(f\"[{bar.timestamp}] Buying {bar.symbol}\")\n            self.buy(bar.symbol, 1)\n        self.count += 1\n\n# 2. Generate data\ndf_stock = create_dummy_data(\"STOCK_A\", \"2023-01-01\", 100, 100.0)\ndf_future = create_dummy_data(\"FUTURE_B\", \"2023-01-01\", 100, 3500.0)\ndata = {\"STOCK_A\": df_stock, \"FUTURE_B\": df_future}\n\n# 3. Configure futures parameters\n# Tell backtest engine: FUTURE_B is a future, multiplier 300, margin 10%\nfuture_config = InstrumentConfig(\n    symbol=\"FUTURE_B\",\n    asset_type=\"FUTURES\",\n    multiplier=300, # Index future multiplier\n    margin_ratio=0.1 # 10% Margin\n)\n\n# 4. Run\nrun_backtest(\n    data=data,\n    strategy=TestStrategy,\n    instruments_config=[future_config]\n)\n</code></pre>"},{"location":"en/examples/#complex-orders","title":"4. Complex Orders &amp; Risk Control","text":"<p>Core Concept: Advanced trading often requires precise order management. *   Bracket Order: A combination of \"Entry + Stop Loss + Take Profit\". When you open a position (Entry), you immediately set a \"Stop Loss\" and \"Take Profit\" order for this position, bracketing the price like a pair of brackets. *   OCO (One-Cancels-Other): Refers to the relationship between the \"Stop Loss\" and \"Take Profit\" orders. If price rises and triggers Take Profit, the Stop Loss order should be automatically cancelled (since the position is closed, no need to stop loss anymore), and vice versa.</p> <p>Although AKQuant's core matching engine does not natively support OCO order types yet, you can easily implement these advanced logic via strategy callback functions (<code>on_trade</code>, <code>on_order</code>).</p>"},{"location":"en/examples/#41-oco-and-bracket-order-implementation","title":"4.1 OCO and Bracket Order Implementation","text":"<p>Logic Flow: 1.  Entry: Strategy sends an open position signal. 2.  Trade Callback (<code>on_trade</code>): Once entry order is filled, immediately send two closing orders:     *   Stop Loss: Sell if price drops to X (protect principal).     *   Take Profit: Sell if price rises to Y (lock in profit). 3.  Subsequent Trades:     *   If Stop Loss filled -&gt; Immediately cancel Take Profit.     *   If Take Profit filled -&gt; Immediately cancel Stop Loss.</p> <pre><code>def on_trade(self, trade):\n    # 1. Entry order filled -&gt; Immediately place SL and TP\n    if trade.order_id == self.entry_order_id:\n        # Place Stop Loss (Stop Market: Sell at market price after trigger)\n        self.stop_loss_id = self.sell(\n            trade.symbol, trade.quantity,\n            trigger_price=trade.price * 0.98, # Stop Price (Cost - 2%)\n            price=None # None means Market Sell after trigger\n        )\n\n        # Place Take Profit (Limit Sell: Sell at specified price)\n        self.take_profit_id = self.sell(\n            trade.symbol, trade.quantity,\n            price=trade.price * 1.05 # Take Profit Price (Cost + 5%)\n        )\n\n    # 2. Stop Loss filled -&gt; Cancel Take Profit\n    # We have exited with stop loss, cancel the previous take profit order\n    elif trade.order_id == self.stop_loss_id:\n        self.cancel_order(self.take_profit_id)\n\n    # 3. Take Profit filled -&gt; Cancel Stop Loss\n    # We have exited with profit, cancel the previous stop loss order\n    elif trade.order_id == self.take_profit_id:\n        self.cancel_order(self.stop_loss_id)\n</code></pre> <p>Parameter Optimization</p> <p>The <code>stop_loss_pct</code> and <code>take_profit_pct</code> parameters of this strategy can be optimized via grid search using <code>akquant.run_optimization</code>.</p> <pre><code>from akquant import run_optimization\nfrom examples.complex_orders import BracketStrategy\n\nparam_grid = {\n    \"stop_loss_pct\": [0.01, 0.02, 0.03],\n    \"take_profit_pct\": [0.03, 0.05, 0.08]\n}\n\nresults = run_optimization(BracketStrategy, param_grid, data=df)\n</code></pre> <p>Please refer to examples/complex_orders.py for the full code.</p> <p>Note: Methods <code>buy</code> / <code>sell</code> / <code>stop_buy</code> / <code>stop_sell</code> all return a unique <code>order_id</code> (str). You can use this ID to precisely track the status of each order in <code>on_trade</code> and <code>on_order</code> callbacks.</p>"},{"location":"en/installation/","title":"Installation Guide","text":""},{"location":"en/installation/#prerequisites","title":"Prerequisites","text":"<p>Before installing <code>AKQuant</code>, please ensure your system meets the following requirements:</p> <ul> <li>Python: Version &gt;= 3.10.</li> <li>Rust: If compiling from source, install the latest stable version of Rust. Install Rust</li> <li>OS: macOS, Linux, Windows.</li> </ul>"},{"location":"en/installation/#installation-methods","title":"Installation Methods","text":""},{"location":"en/installation/#1-install-from-pypi-recommended","title":"1. Install from PyPI (Recommended)","text":"<p><code>AKQuant</code> is now available on PyPI. You can install the pre-compiled wheel (no Rust required) via:</p> <pre><code>pip install akquant\n</code></pre>"},{"location":"en/installation/#2-install-from-source-development-mode","title":"2. Install from Source (Development Mode)","text":"<p>If you wish to contribute to development or use the latest features, you can install from source.</p> <p>First, clone the repository:</p> <pre><code>git clone https://github.com/yourusername/akquant.git\ncd akquant\n</code></pre> <p>Create and activate a virtual environment (optional but recommended):</p> <pre><code>python3 -m venv .venv\nsource .venv/bin/activate  # macOS/Linux\n# .venv\\Scripts\\activate   # Windows\n</code></pre> <p>Install the build tool <code>maturin</code>:</p> <pre><code>pip install maturin\n</code></pre> <p>Build and install into the current environment:</p> <pre><code>maturin develop\n</code></pre> <p>Or build a release version (for optimized performance):</p> <pre><code>maturin develop --release\n</code></pre>"},{"location":"en/installation/#verify-installation","title":"Verify Installation","text":"<p>After installation, you can import <code>akquant</code> in Python to verify:</p> <pre><code>import akquant\nprint(akquant.__version__)\n</code></pre> <p>If no errors occur, the installation was successful.</p>"},{"location":"en/llm_guide/","title":"LLM-Assisted Programming Guide","text":"<p>This document aims to help users build efficient Prompts to automatically generate AKQuant strategy code using ChatGPT, Claude, or other Large Language Models (LLMs).</p>"},{"location":"en/llm_guide/#1-core-prompt-templates-basic-strategy","title":"1. Core Prompt Templates (Basic Strategy)","text":"<p>You can copy the following content directly to the large model as a \"System Prompt\" or the beginning of a conversation, allowing the model to quickly understand AKQuant's coding standards.</p> <pre><code>You are an expert quantitative developer using the **AKQuant** framework (a high-performance Python/Rust backtesting engine).\nYour task is to write trading strategies or backtest scripts based on user requirements.\n\n### AKQuant Coding Rules\n\n1.  **Strategy Structure**:\n    *   Inherit from `akquant.Strategy`.\n    *   **Note**: Calling `super().__init__()` is **optional** (Strategy uses `__new__` for initialization), but harmless if called.\n    *   Define parameters in `__init__`.\n    *   **Subscribe (Optional but Recommended)**: Call `self.subscribe(symbol)` in `on_start` to explicitly declare interest. If omitted in backtest, it will be inferred from data.\n    *   Implement trading logic in `on_bar(self, bar: Bar)`.\n\n2.  **Data Access**:\n    *   **Setup (Recommended)**:\n        *   **Static**: `warmup_period = N` (Class Attribute).\n        *   **Dynamic**: `self.warmup_period = N` in `__init__` (Instance Attribute).\n        *   **Auto**: The framework will try to infer N via AST if you use standard indicators (e.g. `SMA(30)`).\n    *   **Setup (Legacy)**: Call `self.set_history_depth(N)` in `on_start`.\n    *   Current bar: `bar.close`, `bar.open`, `bar.high`, `bar.low`, `bar.volume`, `bar.timestamp_str` (Formatted time string).\n    *   History: `self.get_history(count=N, symbol=bar.symbol, field=\"close\")` returns a numpy array.\n    *   **Check Data Sufficiency**: Always check `if len(history) &lt; N: return` before calculating indicators.\n\n3.  **Trading API**:\n    *   Buy: `self.buy(symbol, quantity, price=None)`. `price=None` means Market Order.\n    *   Sell: `self.sell(symbol, quantity, price=None)`.\n    *   Position: `self.get_position(symbol)` returns float (0 if no position).\n    *   Target: `self.order_target_percent(target, symbol)` or `self.order_target_value(target, symbol)`.\n\n4.  **Indicators**:\n    *   Prefer using `akquant.indicators` (e.g., `SMA`, `RSI`) registered in `on_start`.\n    *   Example: `self.register_indicator(\"sma\", SMA(20))` -&gt; access via `self.sma.value`.\n\n5.  **Backtest Execution**:\n    *   Use `akquant.run_backtest` with direct arguments for simplicity.\n    *   Example: `run_backtest(data=df, strategy=MyStrat, cash=100_000.0, warmup_period=50)`.\n    *   **Execution Mode**: Default is `ExecutionMode.NextOpen` (trade on next bar open). Set `execution_mode=ExecutionMode.CurrentClose` to trade on current bar close.\n    *   Timezone: Default is \"Asia/Shanghai\".\n\n### Example Strategy (Reference)\n\n```python\nfrom akquant import Strategy, Bar\nimport numpy as np\n\nclass MovingAverageStrategy(Strategy):\n    # Declarative Warmup (Static Default)\n    warmup_period = 30\n\n    def __init__(self, fast_window=10, slow_window=20):\n        # super().__init__() is optional here\n        self.fast_window = fast_window\n        self.slow_window = slow_window\n\n        # Dynamic Warmup (Overrides Class Attribute)\n        # Useful when windows are parameters\n        self.warmup_period = slow_window + 10\n\n    def on_start(self):\n        # self.subscribe(\"600000\") # Optional in backtest if data provided\n        # self.set_history_depth(self.slow_window + 10) # No longer needed if warmup_period is set\n        # Alternatively, you can pass `warmup_period` to `run_backtest` function.\n        pass\n\n    def on_bar(self, bar: Bar):\n        # 1. Get History\n        closes = self.get_history(self.slow_window + 1, bar.symbol, \"close\")\n        if len(closes) &lt; self.slow_window + 1:\n            return\n\n        # 2. Calculate Indicators\n        fast_ma = np.mean(closes[-self.fast_window:])\n        slow_ma = np.mean(closes[-self.slow_window:])\n\n        # 3. Trading Logic\n        pos = self.get_position(bar.symbol)\n\n        if fast_ma &gt; slow_ma and pos == 0:\n            self.buy(bar.symbol, 1000)\n        elif fast_ma &lt; slow_ma and pos &gt; 0:\n            self.sell(bar.symbol, pos)\n```\n</code></pre>"},{"location":"en/llm_guide/#2-core-prompt-templates-ml-strategy","title":"2. Core Prompt Templates (ML Strategy)","text":"<p>If the user needs to generate a machine learning strategy, please use this template.</p> <pre><code>### AKQuant ML Strategy Rules\n\n1.  **Framework**: Use `akquant.ml` which provides `QuantModel`, `SklearnAdapter`, and `PyTorchAdapter`.\n2.  **Workflow**:\n    *   Initialize model in `__init__` (e.g., `self.model = SklearnAdapter(...)`).\n    *   Configure validation via `self.model.set_validation(method='walk_forward', ...)` to enable auto-retraining.\n    *   Implement `prepare_features(self, df)` to generate X, y for **training**.\n    *   In `on_bar`, perform **inference** using manual feature extraction (or carefully reused logic) and `self.model.predict(X)`.\n3.  **Data Handling**:\n    *   **Training**: The framework calls `prepare_features` automatically during rolling windows. `df` contains historical bars. You must return `(X, y)` where `y` is aligned with `X`. Typically, `y` is shifted (future return), so you must drop the last row of `X` and `y` to remove NaNs.\n    *   **Inference**: In `on_bar`, you need features for the *current* moment to predict the *next* step. You cannot use `prepare_features` directly if it drops the last row. You should manually construct `X_curr` from `self.get_history_df`.\n\n### Example ML Strategy (Reference)\n\n```python\nfrom akquant import Strategy, Bar\nfrom akquant.ml import SklearnAdapter\nfrom sklearn.linear_model import LogisticRegression\nimport pandas as pd\nimport numpy as np\n\nclass MLStrategy(Strategy):\n    def __init__(self):\n        # 1. Initialize Adapter\n        self.model = SklearnAdapter(LogisticRegression())\n\n        # 2. Configure Walk-Forward (Auto-Training)\n        self.model.set_validation(\n            method='walk_forward',\n            train_window=200, # Train on last 200 bars\n            rolling_step=50,  # Retrain every 50 bars\n            frequency='1d',\n            incremental=False, # Set True to use partial_fit (faster)\n            verbose=True      # Print training logs\n        )\n        # Ensure history depth covers training window\n        self.set_history_depth(250)\n\n    def prepare_features(self, df: pd.DataFrame):\n        \"\"\"Called by framework for TRAINING data preparation\"\"\"\n        X = pd.DataFrame()\n        X['ret1'] = df['close'].pct_change()\n        X['ret2'] = df['close'].pct_change(2)\n        X = X.fillna(0)\n\n        # Label: Next period return &gt; 0\n        future_ret = df['close'].pct_change().shift(-1)\n        y = (future_ret &gt; 0).astype(int)\n\n        # Align X and y (Drop last row where y is NaN)\n        return X.iloc[:-1], y.iloc[:-1]\n\n    def on_bar(self, bar: Bar):\n        # Wait for initial training\n        if self._bar_count &lt; 200:\n            return\n\n        # 3. Inference (Real-time)\n        # Get recent history to construct current features\n        hist_df = self.get_history_df(5)\n\n        # Manual Feature Extraction (Must match prepare_features logic)\n        curr_ret1 = (bar.close - hist_df['close'].iloc[-2]) / hist_df['close'].iloc[-2]\n        curr_ret2 = (bar.close - hist_df['close'].iloc[-3]) / hist_df['close'].iloc[-3]\n\n        X_curr = pd.DataFrame([[curr_ret1, curr_ret2]], columns=['ret1', 'ret2'])\n        X_curr = X_curr.fillna(0)\n\n        try:\n            # Predict\n            pred = self.model.predict(X_curr)[0] # SklearnAdapter returns proba for class 1 or label\n\n            if pred &gt; 0.55:\n                self.buy(bar.symbol, 100)\n            elif pred &lt; 0.45:\n                self.sell(bar.symbol, 100)\n        except:\n            pass # Model might not be ready\n```\n</code></pre>"},{"location":"en/llm_guide/#3-common-scenario-prompt-examples","title":"3. Common Scenario Prompt Examples","text":""},{"location":"en/llm_guide/#scenario-a-writing-a-dual-moving-average-strategy","title":"Scenario A: Writing a Dual Moving Average Strategy","text":"<p>User Query:</p> <p>Please help me write an AKQuant strategy using 5-day and 20-day moving averages, buying on golden cross and selling on death cross, for the symbol \"AAPL\".</p> <p>Recommended Supplement:</p> <p>(Paste the Core Prompt above at the beginning, or as a system prompt)</p>"},{"location":"en/llm_guide/#scenario-b-writing-a-backtest-run-script","title":"Scenario B: Writing a Backtest Run Script","text":"<p>User Query:</p> <p>I already have the <code>MyStrategy</code> class, please help me write a script to run the backtest, using pandas DataFrame for data, and the time range is the full year of 2023.</p> <p>Expected Code Generated by Model:</p> <pre><code>import pandas as pd\nfrom akquant import run_backtest, BacktestConfig\n\n# 1. Prepare Data (Mock Data for example)\n# AKQuant requires columns: timestamp, open, high, low, close, volume, symbol\ndates = pd.date_range(\"2023-01-01\", \"2023-12-31\", freq=\"D\")\ndf = pd.DataFrame({\n    \"timestamp\": dates,\n    \"open\": 100.0,\n    \"high\": 105.0,\n    \"low\": 95.0,\n    \"close\": 102.0,\n    \"volume\": 10000.0,\n    \"symbol\": \"AAPL\"\n})\n\n# 2. Configure and Run Backtest (Simpler Approach)\n# Pass arguments directly, no need to build complex Config objects\nresult = run_backtest(\n    data=df,               # Supports DataFrame, Dict[str, DataFrame] or CSV path\n    strategy=MyStrategy,   # Strategy class\n    strategy_params={\"fast_window\": 5, \"slow_window\": 20}, # Strategy parameters\n    cash=100_000.0,        # Initial cash\n    commission=0.0003,     # Commission rate\n    show_progress=True     # Show progress bar\n)\n\n# 3. View Results\nprint(result)\nresult.plot() # Visualization\n</code></pre>"},{"location":"en/llm_guide/#4-precautions-negative-constraints-for-llm","title":"4. Precautions (Negative Constraints for LLM)","text":"<p>When using large models, the following hallucinations may occur, which can be explicitly prohibited in the Prompt:</p> <ol> <li>About <code>super().__init__()</code>: AKQuant's <code>Strategy</code> uses the <code>__new__</code> hook for initialization. Although calling <code>super().__init__</code> is safe (no-op), it is not required in this framework.</li> <li>Prohibit <code>context.portfolio</code> legacy usage: Although internally supported, it is recommended to use top-level APIs like <code>self.get_position()</code>.</li> <li>Note <code>get_history</code> return value: It returns <code>numpy.ndarray</code>, not <code>pandas.Series</code> (unless <code>get_history_df</code> is used). Performing operations directly on <code>ndarray</code> offers higher performance.</li> <li>Feature Consistency in ML Strategies: During training, <code>prepare_features</code> usually <code>shift(-1)</code> causing the last row to be invalid and dropped; however, during <code>on_bar</code> prediction, we need to calculate features using the current latest market data. Reusing <code>prepare_features</code> directly may lead to prediction failure (as it thinks that is the \"last row\" and drops it), or requires special parameter control. It is recommended to explicitly calculate current features in <code>on_bar</code>.</li> </ol>"},{"location":"en/llm_guide/#5-realtime-data-processing-realtime-ctp","title":"5. Realtime Data Processing (Realtime / CTP)","text":"<p>AKQuant provides the <code>LiveRunner</code> class to simplify the startup process for live/simulation trading.</p> <p>Prompt Example:</p> <p>I need to write a CTP live trading startup script, aggregating 1-minute K-lines, and automatically stopping after running for 1 hour.</p> <p>Expected Code Snippet:</p> <pre><code>from akquant.live import LiveRunner\nfrom akquant import AssetType, Instrument\n\n# 1. Define Instrument\ninstruments = [\n    Instrument(symbol=\"rb2505\", asset_type=AssetType.Futures, multiplier=10.0, margin_ratio=0.1, tick_size=1.0)\n]\n\n# 2. Create Runner\nrunner = LiveRunner(\n    strategy_cls=MyStrategy,\n    instruments=instruments,\n    md_front=\"tcp://182.254.243.31:40011\",\n    use_aggregator=True  # Key parameter\n)\n\n# 3. Run (Supports auto-stop duration)\n# show_progress=False is recommended in live trading to avoid progress bar interfering with logs\nrunner.run(cash=500_000, show_progress=False, duration=\"1h\")\n</code></pre>"},{"location":"en/llm_guide/#mode-selection-use_aggregator","title":"Mode Selection (<code>use_aggregator</code>)","text":"<ul> <li><code>use_aggregator=True</code> (Default):<ul> <li>Enables built-in Rust high-performance aggregator (<code>BarAggregator</code>).</li> <li>Strategy <code>on_bar</code> triggers every 1 minute (Standard OHLCV).</li> <li>Suitable for trend following, technical indicator strategies.</li> </ul> </li> <li><code>use_aggregator=False</code>:<ul> <li>Tick-as-Bar Mode. The gateway directly encapsulates every Tick received into a Bar and pushes it.</li> <li>Strategy <code>on_bar</code> frequency is extremely high (same as Tick frequency).</li> <li>Suitable for high-frequency strategies, market making, or testing data connections.</li> </ul> </li> </ul>"},{"location":"en/llm_guide/#key-differences-explained","title":"Key Differences Explained","text":"<ul> <li>Gateway Layer (<code>on_tick</code>): Responsible for receiving raw Tick data from external interfaces (e.g., CTP, Binance).</li> <li>Strategy Layer (<code>on_bar</code>): The core entry point for strategy logic.<ul> <li>Regardless of whether the data source is aggregated minute bars or Tick snapshots, the strategy always receives data via <code>on_bar</code>.</li> <li>The AKQuant engine standardizes the data flow, so the strategy does not need to know if the upstream is Tick or Bar, it only needs to process <code>Bar</code> objects.</li> </ul> </li> </ul>"},{"location":"en/ml_guide/","title":"Machine Learning &amp; Walk-forward Training Guide (ML Guide)","text":"<p>AKQuant includes a high-performance machine learning training framework designed specifically for quantitative trading. It solves the common \"future function\" leakage problem in traditional frameworks and provides out-of-the-box support for Walk-forward Validation.</p>"},{"location":"en/ml_guide/#core-design-philosophy","title":"Core Design Philosophy","text":""},{"location":"en/ml_guide/#1-separation-of-signal-and-action","title":"1. Separation of Signal and Action","text":"<p>A common mistake for beginners is to let the model directly output \"Buy/Sell\" instructions. In AKQuant, we decouple this process:</p> <ul> <li>Model Layer: Only responsible for predicting future probabilities or values (Signal) based on historical data. It does not know how much money is in the account or what the current market risk is.</li> <li>Strategy Layer: Receives the Signal from the model, combines it with risk control rules, capital management, and market status, and finally makes trading decisions (Action).</li> </ul>"},{"location":"en/ml_guide/#2-adapter-pattern","title":"2. Adapter Pattern","text":"<p>To unify the distinct programming paradigms of Scikit-learn (traditional ML) and PyTorch (deep learning), we introduced an adapter layer:</p> <ul> <li>SklearnAdapter: Adapts XGBoost, LightGBM, RandomForest, etc.</li> <li>PyTorchAdapter: Adapts deep networks like LSTM, Transformer, automatically handling DataLoader and training loops.</li> </ul> <p>Users only need to interface with the unified <code>QuantModel</code> interface.</p>"},{"location":"en/ml_guide/#3-walk-forward-validation","title":"3. Walk-forward Validation","text":"<p>On time-series data, random K-Fold cross-validation is incorrect because it uses future data to predict the past. The correct approach is Walk-forward:</p> <ol> <li>Window 1: Train on 2020 data, predict 2021 Q1.</li> <li>Window 2: Train on 2020 Q2 - 2021 Q1 data, predict 2021 Q2.</li> <li>... Move forward like a rolling wheel.</li> </ol>"},{"location":"en/ml_guide/#quick-start","title":"Quick Start","text":""},{"location":"en/ml_guide/#1-define-strategy","title":"1. Define Strategy","text":"<p>You need to inherit from <code>Strategy</code> and implement the <code>prepare_features</code> method.</p> <pre><code>from akquant.strategy import Strategy\nfrom akquant.ml import SklearnAdapter\nfrom sklearn.linear_model import LogisticRegression\nimport pandas as pd\n\nclass MyMLStrategy(Strategy):\n    def __init__(self):\n\n        # 1. Initialize Model\n        # You can use any sklearn-compatible model here, such as RandomForest, XGBoost\n        self.model = SklearnAdapter(LogisticRegression())\n\n        # 2. Configure Walk-forward Validation\n        # The framework automatically handles data splitting, model retraining, and parameter freezing\n        self.model.set_validation(\n            method='walk_forward',\n            train_window='1y',   # Use past 1 year of data for training each time\n            rolling_step='3m',   # Retrain every 3 months\n            frequency='1d',      # Data frequency (used for parsing time strings)\n            verbose=True         # Print training logs\n        )\n\n        # Ensure historical data length is sufficient\n        self.set_history_depth(300)\n\n    def prepare_features(self, df: pd.DataFrame):\n        \"\"\"\n        [Must Implement] Feature Engineering Logic\n\n        :param df: Raw OHLCV data (DataFrame)\n        :return: (X, y) tuple\n        \"\"\"\n        # Simple Example: Use returns as features\n        X = pd.DataFrame()\n        X['ret1'] = df['close'].pct_change()\n        X['ret2'] = df['close'].pct_change(2)\n        X = X.fillna(0)\n\n        # Construct Label y (Predict next period's movement)\n        # shift(-1) moves future returns to the current row as label\n        future_ret = df['close'].pct_change().shift(-1)\n        y = (future_ret &gt; 0).astype(int)\n\n        # Note: The framework only handles slicing raw data df by time window, not feature/label alignment\n        # Since shift(-1) causes the last row of y to be NaN, it must be manually removed\n        # Otherwise sklearn/pytorch training will fail\n        return X.iloc[:-1], y.iloc[:-1]\n\n    def on_bar(self, bar):\n        # 3. Real-time Prediction &amp; Trading\n        # Check if model is ready (first 1 year of data used for cold start training)\n        if self._bar_count &lt; 250:\n            return\n\n        # Get recent data for feature extraction\n        hist_df = self.get_history_df(5)\n\n        # For demonstration, manually construct current features (consistent with prepare_features logic)\n        curr_ret1 = (bar.close - hist_df['close'].iloc[-2]) / hist_df['close'].iloc[-2]\n        curr_ret2 = (bar.close - hist_df['close'].iloc[-3]) / hist_df['close'].iloc[-3]\n\n        X_curr = pd.DataFrame([[curr_ret1, curr_ret2]], columns=['ret1', 'ret2'])\n        X_curr = X_curr.fillna(0)\n\n        try:\n            # Get prediction signal (probability)\n            # For binary classification, returns probability of Class 1 (Up)\n            signal = self.model.predict(X_curr)[0]\n\n            # Place orders combining risk control rules\n            if signal &gt; 0.6:\n                self.buy(bar.symbol, 100)\n            elif signal &lt; 0.4:\n                self.sell(bar.symbol, 100)\n\n        except Exception:\n            # Model might not have completed initial training\n            pass\n</code></pre>"},{"location":"en/ml_guide/#2-run-backtest","title":"2. Run Backtest","text":"<pre><code>from akquant.backtest import run_backtest\n\nrun_backtest(\n    strategy=MyMLStrategy,\n    symbol=\"600000\",\n    start_date=\"20200101\",\n    end_date=\"20231231\",\n    cash=100000.0\n)\n</code></pre>"},{"location":"en/ml_guide/#api-reference","title":"API Reference","text":""},{"location":"en/ml_guide/#modelset_validation","title":"<code>model.set_validation</code>","text":"<p>Configures the model's validation and training method.</p> <pre><code>def set_validation(\n    self,\n    method: str = 'walk_forward',\n    train_window: str | int = '1y',\n    test_window: str | int = '3m',\n    rolling_step: str | int = '3m',\n    frequency: str = '1d',\n    incremental: bool = False,\n    verbose: bool = False\n)\n</code></pre> <ul> <li><code>method</code>: Currently only supports <code>'walk_forward'</code>.</li> <li><code>train_window</code>: Training window length. Supports <code>'1y'</code> (1 year), <code>'6m'</code> (6 months), <code>'50d'</code> (50 days) or integer (number of Bars).</li> <li><code>rolling_step</code>: Rolling step size, i.e., how often to retrain the model.</li> <li><code>frequency</code>: Data frequency, used to correctly convert time strings to Bar counts (e.g., under '1d', 1y=252 bars).</li> <li><code>incremental</code>: Whether to use incremental learning (continue from last training) or retrain from scratch. Default is <code>False</code>.</li> <li><code>verbose</code>: Whether to print training logs, default is <code>False</code>.</li> </ul>"},{"location":"en/ml_guide/#strategyprepare_features","title":"<code>strategy.prepare_features</code>","text":"<p>Callback function that must be implemented by the user for feature engineering.</p> <pre><code>def prepare_features(self, df: pd.DataFrame, mode: str = \"training\") -&gt; Tuple[Any, Any]\n</code></pre> <ul> <li>Input:<ul> <li><code>df</code>: Raw dataframe from <code>get_rolling_data</code>.</li> <li><code>mode</code>: <code>\"training\"</code> or <code>\"inference\"</code>.</li> </ul> </li> <li>Output:<ul> <li>If <code>mode=\"training\"</code>, return <code>(X, y)</code>.</li> <li>If <code>mode=\"inference\"</code>, return <code>X</code> (usually the last row) or <code>(X, None)</code>.</li> </ul> </li> <li>Note: This is a pure function and should not rely on external state. It will be used in both training and prediction stages.</li> </ul>"},{"location":"en/ml_guide/#deep-learning-support-pytorch","title":"Deep Learning Support (PyTorch)","text":"<p>Using <code>PyTorchAdapter</code>, you can easily integrate deep learning models:</p> <pre><code>from akquant.ml import PyTorchAdapter\nimport torch.nn as nn\nimport torch.optim as optim\n\n# Define Network\nclass SimpleNet(nn.Module):\n    def __init__(self):\n        super().__init__()\n        self.fc = nn.Sequential(\n            nn.Linear(10, 32),\n            nn.ReLU(),\n            nn.Linear(32, 1),\n            nn.Sigmoid()\n        )\n\n    def forward(self, x):\n        return self.fc(x)\n\n# Use in Strategy\nself.model = PyTorchAdapter(\n    network=SimpleNet(),\n    criterion=nn.BCELoss(),\n    optimizer_cls=optim.Adam,\n    lr=0.001,\n    epochs=20,\n    batch_size=64,\n    device='cuda'  # Supports GPU acceleration\n)\n</code></pre>"},{"location":"en/py_guide/","title":"Python for Finance 101","text":"<p>Many beginners feel overwhelmed by code. Don't worry! In AKQuant, you don't need to be a computer scientist. Mastering just the core 20% of syntax covers 80% of strategy development needs.</p> <p>This guide will teach you Python strictly from a Financial Trading perspective.</p>"},{"location":"en/py_guide/#1-variables-data-types-defining-assets","title":"1. Variables &amp; Data Types: Defining Assets","text":"<p>In Python, variables are like labeled boxes used to store data.</p>"},{"location":"en/py_guide/#basic-variables","title":"Basic Variables","text":"<ul> <li>int: For volume, lot size.</li> <li>float: For price, returns.</li> <li>str: For ticker symbols.</li> </ul> <pre><code># Define variables\nsymbol = \"AAPL\"        # Ticker (String)\nprice = 150.5          # Current Price (Float)\nvolume = 100           # Buy Quantity (Integer)\nis_holding = True      # Position Status (Boolean)\n\n# Print them out\nprint(f\"Trading {symbol}, Price: {price}\")\n</code></pre>"},{"location":"en/py_guide/#lists-a-sequence-of-prices","title":"Lists: A Sequence of Prices","text":"<p>Imagine a candlestick chart. The closing prices of the last 5 days form a list.</p> <pre><code># Closing prices of last 5 days\ncloses = [150.1, 152.0, 149.5, 153.0, 155.0]\n\n# Access data\nprint(closes[0])   # 1st day price (Python counts from 0!) -&gt; 150.1\nprint(closes[-1])  # Last day price (Latest) -&gt; 155.0\nprint(closes[:3])  # First 3 days -&gt; [150.1, 152.0, 149.5]\n\n# Calculate Average\navg_price = sum(closes) / len(closes)\nprint(f\"5-day Average: {avg_price}\")\n</code></pre>"},{"location":"en/py_guide/#dictionaries-your-portfolio","title":"Dictionaries: Your Portfolio","text":"<p>A dictionary is like a ledger. Left side is the Name (Key), right side is the Value.</p> <pre><code># Current Portfolio: Ticker -&gt; Shares\nportfolio = {\n    \"AAPL\": 100,\n    \"TSLA\": 50,\n    \"GOOG\": 0\n}\n\n# Check holdings\nprint(portfolio[\"AAPL\"]) # -&gt; 100\n\n# Update holdings\nportfolio[\"TSLA\"] += 10  # Add 10 shares\n</code></pre>"},{"location":"en/py_guide/#2-logic-control-the-core-of-decision","title":"2. Logic Control: The Core of Decision","text":"<p>A trading strategy is essentially a set of <code>if...else</code> statements: If X happens, do Y.</p>"},{"location":"en/py_guide/#ifelse-statements","title":"If/Else Statements","text":"<p>This is the \"trigger\" of your strategy.</p> <pre><code>ma5 = 155.0  # Short-term MA\nma20 = 150.0 # Long-term MA\ncash = 5000  # Available Cash\n\n# Golden Cross Logic\nif ma5 &gt; ma20:\n    print(\"Signal: Golden Cross!\")\n    if cash &gt; 1000:\n        print(\"Cash sufficient, executing BUY!\")\n    else:\n        print(\"Insufficient funds.\")\nelse:\n    print(\"No signal, hold.\")\n</code></pre>"},{"location":"en/py_guide/#loops","title":"Loops","text":"<p>Backtesting is basically a big loop, iterating through historical data day by day.</p> <pre><code># Mock Backtest: Iterate through daily prices\nprices = [100, 110, 90, 120, 130]\n\nfor p in prices:\n    if p &gt; 120:\n        print(f\"Price {p} broke 120, take profit!\")\n    else:\n        print(f\"Price {p} is normal.\")\n</code></pre>"},{"location":"en/py_guide/#3-pandas-crash-course-the-quant-tool","title":"3. Pandas Crash Course: The Quant Tool","text":"<p>In AKQuant, 99% of data (like <code>history_data</code>) is in <code>DataFrame</code> format. Think of it as a Supercharged Excel.</p>"},{"location":"en/py_guide/#dataframe-structure","title":"DataFrame Structure","text":"<p>A DataFrame has Index (Rows, usually Time) and Columns (e.g., Open/Close).</p> <pre><code>import pandas as pd\n\n# Mock OHLCV Table\ndata = {\n    \"close\": [100, 101, 102, 101, 103],\n    \"volume\": [1000, 1500, 2000, 1200, 3000]\n}\ndf = pd.DataFrame(data)\n\n# 1. Get a whole column (Series)\nprint(df[\"close\"])\n\n# 2. Calculate Indicators (Vectorized, very fast)\n# Calculate mean of close prices\nma_price = df[\"close\"].mean()\n\n# 3. Get the latest row\nlast_bar = df.iloc[-1]\nprint(f\"Latest Close: {last_bar['close']}\")\n</code></pre>"},{"location":"en/py_guide/#4-classes-objects-understanding-strategy-templates","title":"4. Classes &amp; Objects: Understanding Strategy Templates","text":"<p>When writing a strategy, you see <code>class MyStrategy(Strategy):</code>. What does it mean?</p> <ul> <li>Class: The Blueprint. Defines what the strategy looks like.</li> <li>Object: The Instance. Built from the blueprint when backtesting runs.</li> <li>self: Represents The Strategy Instance Itself.<ul> <li><code>self.buy()</code>: I want to buy.</li> <li><code>self.cash</code>: My cash.</li> <li><code>self.position</code>: My position.</li> </ul> </li> </ul> <pre><code>class MyStrategy:\n    def __init__(self, initial_cash):\n        # Init: Runs once when strategy starts\n        self.cash = initial_cash\n        self.name = \"MA Strategy\"\n\n    def on_bar(self, price):\n        # Runs on every bar close\n        if price &lt; 100:\n            self.buy()\n\n    def buy(self):\n        self.cash -= 100\n        print(f\"{self.name} Executed BUY. Cash left: {self.cash}\")\n\n# Use Strategy\nstrategy = MyStrategy(1000) # Create Instance\nstrategy.on_bar(99)         # Trigger BUY\n</code></pre>"},{"location":"en/py_guide/#5-summary-akquant-cheat-sheet","title":"5. Summary: AKQuant Cheat Sheet","text":"<p>Here are the most common Python snippets you'll use in AKQuant:</p> Scenario Python Code Meaning Get Data <code>hist = self.history_data(n=20)</code> Get last 20 bars (DataFrame) Calc MA <code>ma = hist['close'].mean()</code> Calculate average of close prices Latest Price <code>current_price = bar.close</code> Get current bar's close price Signal <code>if ma_short &gt; ma_long:</code> If Short MA &gt; Long MA Check Pos <code>pos = self.get_position(bar.symbol)</code> How many shares do I hold? Order <code>self.buy(bar.symbol, 100)</code> Buy 100 shares <p>Master these, and you are ready to write your first strategy! Go to Quant Guide to practice.</p>"},{"location":"en/quant_guide/","title":"Quantitative Trading Guide for Beginners (Zero to Hero)","text":"<p>Welcome to the world of quantitative trading! This guide is designed for beginners to systematically master the process of developing quantitative strategies using the AKQuant framework, from theoretical concepts to practical coding.</p>"},{"location":"en/quant_guide/#0-why-choose-quant-quant-vs-discretionary","title":"0. Why Choose Quant? (Quant vs. Discretionary)","text":"<p>The investment world is mainly divided into two camps: Discretionary Trading and Quantitative Trading.</p> <ul> <li>Discretionary Trading is like an Art. Traders rely on personal experience, intuition, and qualitative analysis (e.g., news, macro policies) to make decisions. Buffett and Soros are masters of this.</li> <li>Quantitative Trading is a Science. It uses mathematical models and computer programs to find probabilistic advantages from massive historical data and executes them strictly. Simons (Medallion Fund) is the representative of quant.</li> </ul>"},{"location":"en/quant_guide/#core-comparison","title":"Core Comparison","text":"Dimension Discretionary Trading Quantitative Trading Basis Experience, intuition, news, qualitative analysis Data, statistical models, code logic Execution Vulnerable to emotions (Greed/Fear) Automated execution, cold and disciplined (100%) Coverage Limited human energy (dozens of stocks) Monitors thousands of stocks/markets simultaneously Verifiability Hard to verify (\"feelings\" can't be backtested) Highly verifiable (via historical backtesting) Cons Hard to replicate, unstable state, prone to errors Model decay risk, may lag in \"Black Swan\" events <p>Reasons to Choose Quant: If you don't want to stare at the screen with heart palpitations every day, if you believe data beats intuition, and if you want to build a \"money-making machine\" that works for you long-term via code, then quantitative trading is for you.</p>"},{"location":"en/quant_guide/#1-basic-concepts-the-awakening-of-trader-k","title":"1. Basic Concepts: The Awakening of Trader K","text":"<p>To help you understand quantitative trading intuitively, let's tell the story of a trader named \"K\". Through his journey, we will unlock the core concepts of quant trading.</p>"},{"location":"en/quant_guide/#act-1-slave-to-emotions-vs-machine-discipline","title":"Act 1: Slave to Emotions vs. Machine Discipline","text":"<p>Story: K used to be a typical manual trader. He stared at the screen every day, his mood fluctuating with the red and green candles. *   10:00 AM, price skyrockets: \"Buy now! Or I'll miss out!\" -&gt; Result: Bought at the peak. *   2:00 PM, price dives: \"It's over! Sell everything!\" -&gt; Result: Sold at the bottom. At the end of the day, K was exhausted and lost money. He realized his biggest enemy was not the market, but Greed and Fear.</p> <p>Quant Perspective: The first advantage of quantitative trading is Discipline. We write trading logic into code (i.e., Strategy) and let the computer execute it automatically. Machines have no emotions; they don't get excited by surges or panic during crashes. They coldly execute: \"If A happens, do B\".</p>"},{"location":"en/quant_guide/#act-2-the-mysterious-time-machine-backtesting","title":"Act 2: The Mysterious \"Time Machine\" (Backtesting)","text":"<p>Story: K summarized a rule: \"I noticed that every time the price drops for three consecutive days, it bounces back on the fourth day.\" He wanted to bet real money on this rule but was unsure: \"Did this rule work in the 2018 bear market? How about the 2020 bull market?\" He wished for a time machine to go back and simulate trading with this rule to see how much he could make.</p> <p>Quant Perspective: This time machine is Backtesting. Backtesting is the process of verifying a trading strategy using historical data. *   Input: Your strategy logic (e.g., \"Buy after 3 down days\"). *   Data: Historical OHLCV data (Open, High, Low, Close, Volume). *   Output: Your final return and max loss if you had traded this way.</p>"},{"location":"en/quant_guide/#act-3-a-lesson-on-survival-risk-management","title":"Act 3: A Lesson on \"Survival\" (Risk Management)","text":"<p>Story: K once got lucky, went all-in on a stock, and doubled his money in a month. Thinking he was a genius, he borrowed money to leverage up and went all-in again. Then a \"Black Swan\" event hit, and the price halved. K not only lost his profits but also his principal. A quant veteran told him: \"In this market, surviving is more important than making money fast.\"</p> <p>Quant Perspective: This is Risk Management. In quant reports, we look not only at how much you made (Return) but also at how much risk you took. *   Max Drawdown: The largest decline from a historical peak. A -50% Max Drawdown means your assets could be cut in half. *   Sharpe Ratio: A metric for cost-effectiveness. How much excess return you get per unit of risk.</p>"},{"location":"en/quant_guide/#act-4-the-trap-of-carving-a-boat-to-find-a-sword-overfitting","title":"Act 4: The Trap of \"Carving a Boat to Find a Sword\" (Overfitting)","text":"<p>Story: K learned to code and tried to find a perfect curve. He tweaked parameters endlessly and finally created a strategy with a 500% return last year! He excitedly started live trading, only to lose 10% in a week. It turned out his code implicitly said: \"If date is Jan 5, 2023, buy\". He memorized the answers to last year's exam, but this year's questions changed.</p> <p>Quant Perspective: This is called Overfitting. The strategy only memorized the noise in historical data and didn't grasp the true market laws. Excellent quant strategies should be simple in logic and universally applicable, not hard-coded to history.</p>"},{"location":"en/quant_guide/#15-core-data-format-ohlcv","title":"1.5 Core Data Format (OHLCV)","text":"<p>Back to the technical side, the most basic data unit in quantitative trading is the Bar (or Candle), which typically contains: *   Open: Opening price *   High: Highest price *   Low: Lowest price *   Close: Closing price *   Volume: Trading volume</p>"},{"location":"en/quant_guide/#2-preparation-and-installation","title":"2. Preparation and Installation","text":""},{"location":"en/quant_guide/#21-install-akquant","title":"2.1 Install AKQuant","text":"<p>Ensure your computer has Python 3.8 or later installed. Open your terminal (or CMD) and run:</p> <pre><code>pip install akquant\n</code></pre>"},{"location":"en/quant_guide/#22-verify-installation","title":"2.2 Verify Installation","text":"<p>Create a file named <code>check_env.py</code>, enter the following code, and run it:</p> <pre><code>import akquant\nprint(f\"AKQuant version: {akquant.__version__}\")\nprint(\"Installation successful!\")\n</code></pre>"},{"location":"en/quant_guide/#3-hands-on-developing-your-first-strategy-dual-moving-average","title":"3. Hands-on: Developing Your First Strategy (Dual Moving Average)","text":"<p>We will implement a classic Dual Moving Average Strategy. *   Buy Signal (Golden Cross): Short-term MA (e.g., 5-day) crosses above Long-term MA (e.g., 20-day). *   Sell Signal (Death Cross): Short-term MA crosses below Long-term MA.</p>"},{"location":"en/quant_guide/#31-complete-code-example","title":"3.1 Complete Code Example","text":"<p>Create a file named <code>first_strategy.py</code>:</p> <pre><code>import pandas as pd\nimport numpy as np\nfrom akquant import Strategy, run_backtest\n\nclass DualMovingAverageStrategy(Strategy):\n    def __init__(self):\n        # Define parameters: Short window 5, Long window 20\n        self.short_window = 5\n        self.long_window = 20\n\n    def on_bar(self, bar):\n        # Get historical closing prices\n        # history_data returns a DataFrame\n        hist = self.history_data(n=self.long_window + 1)\n\n        # If data is insufficient to calculate MA, return immediately\n        if len(hist) &lt; self.long_window:\n            return\n\n        # Calculate Short and Long MA\n        closes = hist['close'].values\n        ma_short = np.mean(closes[-self.short_window:])\n        ma_long = np.mean(closes[-self.long_window:])\n\n        # Get previous MA values (to detect crossover)\n        prev_ma_short = np.mean(closes[-self.short_window-1 : -1])\n        prev_ma_long = np.mean(closes[-self.long_window-1 : -1])\n\n        # Get current position\n        position = self.get_position(bar.symbol)\n\n        # Trading Logic\n        # 1. Golden Cross: Short MA crosses above Long MA, and no position -&gt; Buy\n        if prev_ma_short &lt;= prev_ma_long and ma_short &gt; ma_long:\n            if position == 0:\n                self.buy(bar.symbol, 100) # Buy 100 shares\n                print(f\"[{bar.datetime}] Buy {bar.symbol} @ {bar.close:.2f}\")\n\n        # 2. Death Cross: Short MA crosses below Long MA, and holding position -&gt; Sell\n        elif prev_ma_short &gt;= prev_ma_long and ma_short &lt; ma_long:\n            if position &gt; 0:\n                self.sell(bar.symbol, 100) # Sell 100 shares\n                print(f\"[{bar.datetime}] Sell {bar.symbol} @ {bar.close:.2f}\")\n\n# ------------------------------\n# Prepare Mock Data and Run\n# ------------------------------\nif __name__ == \"__main__\":\n    # Generate mock data\n    dates = pd.date_range(start=\"2023-01-01\", end=\"2023-12-31\")\n    price = 100 + np.cumsum(np.random.randn(len(dates))) # Random walk\n\n    df = pd.DataFrame({\n        \"date\": dates,\n        \"open\": price, \"high\": price + 1, \"low\": price - 1, \"close\": price,\n        \"volume\": 10000,\n        \"symbol\": \"DEMO\"\n    })\n\n    # Run Backtest\n    print(\"Starting backtest...\")\n    result = run_backtest(\n        strategy_class=DualMovingAverageStrategy,\n        data=df,\n        initial_capital=10000.0 # Initial capital 10k\n    )\n\n    # Print summary\n    print(\"\\nBacktest finished!\")\n    print(f\"Final Value: {result.final_value:.2f}\")\n    print(f\"Total Return: {result.total_return * 100:.2f}%\")\n</code></pre>"},{"location":"en/quant_guide/#32-advanced-how-to-get-real-data","title":"3.2 Advanced: How to Get Real Data?","text":"<p>The example above uses mock data. In practice, you need real stock data. We recommend using open-source libraries like <code>yfinance</code> (Global data) or <code>AKShare</code> (Chinese market data).</p> <p>Example: Get Apple (AAPL) data using yfinance</p> <pre><code>pip install yfinance\n</code></pre> <pre><code>import yfinance as yf\n\n# Download data\ndf = yf.download(\"AAPL\", start=\"2022-01-01\", end=\"2023-12-31\")\n\n# Data cleaning: yfinance columns are Capitalized, AKQuant needs lowercase\ndf.columns = [c.lower() for c in df.columns]\ndf['symbol'] = \"AAPL\" # Add symbol column\n\n# Pass directly to run_backtest\nresult = run_backtest(\n    strategy_class=DualMovingAverageStrategy,\n    data=df,\n    initial_capital=10000.0\n)\n</code></pre>"},{"location":"en/quant_guide/#4-understanding-backtest-reports-key-metrics","title":"4. Understanding Backtest Reports: Key Metrics","text":"<p>After running a backtest, AKQuant outputs several metrics. Here is what they mean:</p> Metric Meaning &amp; Interpretation Total Return How much profit/loss the strategy made relative to the initial capital. Annualized Return The expected return if the strategy runs for a year. Useful for comparing strategies of different durations. Max Drawdown The largest peak-to-trough decline. A key risk metric. E.g., -20% means you could lose 20% in the worst-case scenario. Sharpe Ratio Measures risk-adjusted return. How much excess return you get per unit of risk. &gt;1 is good, &gt;2 is excellent. Win Rate Percentage of profitable trades. High win rate doesn't guarantee high profit (you could make small profits but huge losses)."},{"location":"en/quant_guide/#5-common-issues-and-debugging-tips","title":"5. Common Issues and Debugging Tips","text":"<p>Here are common pitfalls for beginners:</p>"},{"location":"en/quant_guide/#51-insufficient-data-indexerror-nan","title":"5.1 Insufficient Data (IndexError / NaN)","text":"<ul> <li>Symptom: <code>IndexError</code> or MA calculation results in <code>NaN</code>.</li> <li>Cause: Calculating a 20-day MA requires at least 20 days of history. At the start of the backtest, data is accumulating.</li> <li>Solution: Check data length at the beginning of <code>on_bar</code>:     <pre><code>if len(self.history_data(n=20)) &lt; 20:\n    return\n</code></pre></li> </ul>"},{"location":"en/quant_guide/#52-look-ahead-bias","title":"5.2 Look-ahead Bias","text":"<ul> <li>Symptom: Unreasonably high returns (e.g., 1000% annualized).</li> <li>Cause: Using future data to generate signals. E.g., using tomorrow's close price when processing today's bar.</li> <li>Solution: Ensure you only use data up to the current bar. AKQuant's <code>history_data</code> is safe by default.</li> </ul>"},{"location":"en/quant_guide/#53-trades-not-executed","title":"5.3 Trades Not Executed","text":"<ul> <li>Symptom: Logs show buy signals, but position doesn't change.</li> <li>Cause: Insufficient cash (to buy 1 unit) or minimum trade size not met.</li> <li>Solution: Print <code>self.cash</code> to check available funds; verify if <code>self.buy</code> quantity is reasonable.</li> </ul>"},{"location":"en/quant_guide/#6-next-steps-learning-path","title":"6. Next Steps: Learning Path","text":"<p>Congratulations on completing the beginner guide! To become a more professional quant trader, follow this path:</p>"},{"location":"en/quant_guide/#61-skill-tree-order","title":"6.1 Skill Tree Order","text":"<ol> <li>Python Mastery: Master <code>pandas</code> and <code>numpy</code>. Quant trading is 80% data processing, and these are your best weapons.</li> <li>Classic Strategies:<ul> <li>Turtle Trading: Learn how to build a complete trend-following system.</li> <li>Grid Trading: Learn automated arbitrage in oscillating markets.</li> <li>Multi-Factor: Learn the stock selection logic used by institutions.</li> </ul> </li> <li>Risk Management: Deep dive into Kelly Criterion, volatility targeting, etc.</li> <li>Machine Learning: Try predicting prices or volatility using ML models (see ML Guide).</li> </ol>"},{"location":"en/quant_guide/#62-recommended-resources","title":"6.2 Recommended Resources","text":"<ul> <li>Books: \"Inside the Black Box\", \"Way of the Turtle\", \"Python for Finance\".</li> <li>Practice: Read code in Examples, try modifying parameters, and observe result changes.</li> </ul> <p>Hope this guide helps you start your quantitative journey! For advanced features, please refer to the API Reference.</p>"},{"location":"en/quickstart/","title":"Quick Start","text":"<p>Welcome to AKQuant! Let's get the simplest strategy running as fast as possible.</p>"},{"location":"en/quickstart/#1-installation","title":"1. Installation","text":"<p>Open your terminal and run:</p> <pre><code>pip install akquant\n</code></pre>"},{"location":"en/quickstart/#2-minimal-example-buy-and-hold","title":"2. Minimal Example: Buy and Hold","text":"<p>Copy the code below into <code>quickstart.py</code> and run it. This strategy is very simple: Buy 100 shares on the first day and hold them forever.</p> <pre><code>import pandas as pd\nfrom akquant import Strategy, run_backtest\n\n# 1. Define Strategy\nclass BuyAndHold(Strategy):\n    def on_bar(self, bar):\n        # If no position, buy 100 shares\n        if self.get_position(bar.symbol) == 0:\n            print(f\"[{bar.timestamp_str}] Buy {bar.symbol}\")\n            self.buy(bar.symbol, 100)\n\n# 2. Prepare Data (Generating simple mock data here)\ndates = pd.date_range(\"2023-01-01\", periods=100)\ndf = pd.DataFrame({\n    \"date\": dates,\n    \"open\": 10.0, \"high\": 11.0, \"low\": 9.0, \"close\": 10.0, # Assuming price stays flat\n    \"volume\": 1000,\n    \"symbol\": \"DEMO\"\n})\n\n# 3. Run Backtest\nprint(\"Starting backtest...\")\nresult = run_backtest(\n    data=df,\n    strategy=BuyAndHold,\n    cash=10000.0\n)\n\n# 4. View Results\nprint(result)\n</code></pre> <p>In the output, you will see core metrics like <code>total_return</code> and <code>max_drawdown</code>.</p>"},{"location":"en/quickstart/#3-advanced-learning","title":"3. Advanced Learning","text":"<p>Too simple? Want to learn how to write real quantitative strategies (like Dual Moving Average, MACD, etc.)?</p> <p>\ud83d\udc49 Please read Tutorial: Writing Your First Strategy</p> <p>This tutorial will cover:</p> <ul> <li>How to get historical data (<code>get_history</code>)</li> <li>How to calculate technical indicators (MA, RSI)</li> <li>How to implement stop-loss and take-profit</li> </ul>"},{"location":"en/strategy_guide/","title":"Strategy Guide","text":"<p>This document aims to help strategy developers quickly master how to write strategies in AKQuant.</p>"},{"location":"en/strategy_guide/#1-core-concepts-glossary","title":"1. Core Concepts (Glossary)","text":"<p>For those new to quantitative trading, here are some basic terms:</p> <ul> <li>Bar (Candlestick): Contains market data for a specific time period (e.g., 1 minute, 1 day), primarily including 5 data points:<ul> <li>Open: Opening price</li> <li>High: Highest price</li> <li>Low: Lowest price</li> <li>Close: Closing price</li> <li>Volume: Trading volume</li> </ul> </li> <li>Strategy: Your trading robot. Its core job is to continuously watch the market (<code>on_bar</code>) and then decide whether to <code>buy</code> or <code>sell</code>.</li> <li>Context: The robot's \"notebook\" and \"toolbox\". It records how much cash and how many positions are currently held, and provides tools for placing orders.</li> <li>Position: The quantity of stocks or futures you currently hold. A positive number indicates a long position (buying to hold), and a negative number indicates a short position (selling borrowed securities).</li> <li>Backtest: Historical simulation. Testing your strategy using past data to see how much money it would have made if executed in the past.</li> </ul>"},{"location":"en/strategy_guide/#2-strategy-lifecycle","title":"2. Strategy Lifecycle","text":"<p>A strategy goes through the following stages from start to finish:</p> <ul> <li><code>__init__</code>: Python object initialization, suitable for defining parameters.</li> <li><code>on_start</code>: Called when the strategy starts. You must use <code>self.subscribe()</code> here to subscribe to data, and you can also register indicators here.</li> <li><code>on_bar</code>: Triggered when each Bar closes (core trading logic).</li> <li><code>on_tick</code>: Triggered when each Tick arrives (high-frequency/order book strategies).</li> <li><code>on_order</code>: Triggered when order status changes (e.g., Submitted, Filled, Cancelled).</li> <li><code>on_trade</code>: Triggered when a trade execution report is received.</li> <li><code>on_timer</code>: Called when a timer triggers (needs manual registration).</li> <li><code>on_stop</code>: Called when the strategy stops, suitable for resource cleanup or result statistics (refer to Backtrader <code>stop</code> / Nautilus <code>on_stop</code>).</li> <li><code>on_train_signal</code>: Triggered for rolling training signals (only in ML mode).</li> </ul>"},{"location":"en/strategy_guide/#style-selection","title":"2. Choosing a Strategy Style","text":"<p>AKQuant provides two styles of strategy development interfaces:</p> Feature Class-based Style (Recommended) Function-based Style Definition Inherit from <code>akquant.Strategy</code> Define <code>initialize</code> and <code>on_bar</code> functions Scenarios Complex strategies, need to maintain internal state, production Rapid prototyping, migrating Zipline/Backtrader strategies Structure Object-oriented, good logic encapsulation Script-like, simple and intuitive API Call <code>self.buy()</code>, <code>self.ctx</code> <code>ctx.buy()</code>, pass <code>ctx</code> as parameter"},{"location":"en/strategy_guide/#class-based","title":"3. Writing Class-based Strategies","text":"<p>This is the recommended way to write strategies in AKQuant, offering a clear structure and easy extensibility.</p> <pre><code>from akquant import Strategy, Bar\nimport numpy as np\n\nclass MyStrategy(Strategy):\n    def __init__(self, ma_window=20):\n        # Note: The Strategy class uses __new__ for initialization, subclasses do not need to call super().__init__()\n        self.ma_window = ma_window\n\n    def on_start(self):\n        # Explicitly subscribe to data\n        self.subscribe(\"600000\")\n\n    def on_bar(self, bar: Bar):\n        # 1. Get historical data (Online mode)\n        # Get the last N closing prices\n        history = self.get_history(count=self.ma_window, symbol=bar.symbol, field=\"close\")\n\n        # Check if data is sufficient\n        if len(history) &lt; self.ma_window:\n            return\n\n        # Calculate Moving Average\n        ma_value = np.mean(history)\n\n        # 2. Trading Logic\n        # Get current position\n        pos = self.get_position(bar.symbol)\n\n        if bar.close &gt; ma_value and pos == 0:\n            self.buy(symbol=bar.symbol, quantity=100)\n        elif bar.close &lt; ma_value and pos &gt; 0:\n            self.sell(symbol=bar.symbol, quantity=100)\n</code></pre>"},{"location":"en/strategy_guide/#4-orders-execution","title":"4. Orders &amp; Execution","text":""},{"location":"en/strategy_guide/#41-order-lifecycle","title":"4.1 Order Lifecycle","text":"<p>In AKQuant, order status transitions are as follows:</p> <ol> <li>New: Order object is created.</li> <li>Submitted: Order has been sent to the exchange/simulation matching engine.</li> <li>Accepted: (Live mode) Exchange confirms receipt of the order.</li> <li>Filled: Order is fully filled.<ul> <li>PartiallyFilled: Partially filled (currently unified as Filled status code, check <code>filled_quantity</code>).</li> </ul> </li> <li>Cancelled: Order has been cancelled.</li> <li>Rejected: Order rejected by risk control or exchange (e.g., insufficient funds, exceeding price limits).</li> </ol>"},{"location":"en/strategy_guide/#42-common-trading-commands","title":"4.2 Common Trading Commands","text":"<ul> <li>Market Order:     <pre><code>self.buy(symbol=\"AAPL\", quantity=100) # Market Buy\nself.sell(symbol=\"AAPL\", quantity=100) # Market Sell\n</code></pre></li> <li>Limit Order:     Executes at a specified price, only when the market price is at or better than the specified price.     <pre><code>self.buy(symbol=\"AAPL\", quantity=100, price=150.0) # Limit Buy at 150\n</code></pre></li> <li>Stop Order:     Converts to a market order when the market price touches the trigger price (<code>trigger_price</code>).     <pre><code># Stop Sell (Market) when price drops below 140\nself.stop_sell(symbol=\"AAPL\", quantity=100, trigger_price=140.0)\n</code></pre></li> <li>Target Orders:     Automatically calculates buy/sell quantities to adjust the position to a target value.     <pre><code># Adjust position to 50% of total assets\nself.order_target_percent(target_percent=0.5, symbol=\"AAPL\", price=None)\n\n# Adjust holding to 1000 shares (Buy 1000 if 0, Sell 1000 if 2000)\nself.order_target_value(target_value=1000 * price, symbol=\"AAPL\") # Note: API does not support target_share directly yet, simulate with value\n</code></pre></li> </ul>"},{"location":"en/strategy_guide/#43-execution-modes","title":"4.3 Execution Modes","text":"<p>Set via <code>engine.set_execution_mode(mode)</code> (or pass <code>execution_mode</code> parameter in <code>run_backtest</code>):</p> <ul> <li>NextOpen (Default): Signals are matched at the Open of the next Bar. This is a more rigorous backtesting method, aligning with live trading logic (place order after today's close, match at tomorrow's open).</li> <li>CurrentClose: Signals are matched immediately at the Close of the current Bar. Suitable for special strategies using closing prices for settlement, or scenarios where next-day data is unavailable.</li> </ul>"},{"location":"en/strategy_guide/#callbacks","title":"4.4 Event Callbacks","text":"<p>AKQuant provides a callback mechanism similar to Backtrader for tracking order status and trade records.</p>"},{"location":"en/strategy_guide/#441-order-status-callback-on_order","title":"4.4.1 Order Status Callback (<code>on_order</code>)","text":"<p>Triggered when order status changes (e.g., from <code>New</code> to <code>Submitted</code>, or to <code>Filled</code>).</p> <pre><code>from akquant import OrderStatus\n\ndef on_order(self, order):\n    if order.status == OrderStatus.Filled:\n        print(f\"Order Filled: {order.symbol} Side: {order.side} Qty: {order.filled_quantity}\")\n    elif order.status == OrderStatus.Cancelled:\n        print(f\"Order Cancelled: {order.id}\")\n</code></pre>"},{"location":"en/strategy_guide/#442-trade-execution-callback-on_trade","title":"4.4.2 Trade Execution Callback (<code>on_trade</code>)","text":"<p>Triggered when a real trade occurs. Unlike <code>on_order</code>, <code>on_trade</code> contains specific execution price, quantity, and commission information.</p> <pre><code>def on_trade(self, trade):\n    print(f\"Trade Execution: {trade.symbol} Price: {trade.price} Qty: {trade.quantity} Comm: {trade.commission}\")\n</code></pre>"},{"location":"en/strategy_guide/#5-risk-management","title":"5. Risk Management","text":"<p>AKQuant has a built-in Rust-level risk manager that can simulate exchange or broker risk control rules during backtesting.</p> <pre><code>from akquant import RiskConfig\n\n# Set after Engine initialization\nrisk_config = RiskConfig()\nrisk_config.active = True\nrisk_config.max_order_value = 1_000_000.0  # Max 1 million per order\nrisk_config.max_position_size = 5000       # Max 5000 shares per symbol\nrisk_config.restricted_list = [\"ST_STOCK\"] # Blacklist (Symbol)\n\nengine.risk_manager.config = risk_config # Apply config\n</code></pre> <p>If an order violates risk rules, functions like <code>self.buy()</code> will return <code>None</code> or the generated order status will be directly <code>Rejected</code>, and the reason will be recorded in the logs.</p>"},{"location":"en/strategy_guide/#indicatorset","title":"6. Using High-Performance Indicators","text":"<p>AKQuant includes commonly used technical indicators built into the Rust layer. They use Incremental Calculation to avoid repeated full recalculations, resulting in extremely high performance.</p> <p>Supported Indicators: <code>SMA</code>, <code>EMA</code>, <code>MACD</code>, <code>RSI</code>, <code>BollingerBands</code>, <code>ATR</code>.</p>"},{"location":"en/strategy_guide/#61-registration-and-usage","title":"6.1 Registration and Usage","text":"<pre><code>from akquant import Strategy\nfrom akquant.indicators import SMA, RSI\n\nclass IndicatorStrategy(Strategy):\n    def on_start(self):\n        self.subscribe(\"AAPL\")\n\n        # Register indicator: Automatically handles data updates\n        # Parameter: period=20\n        self.register_indicator(\"sma20\", SMA(20))\n\n        # Register RSI\n        self.register_indicator(\"rsi14\", RSI(14))\n\n    def on_bar(self, bar):\n        # Access indicator values directly\n        # Note: If indicator is not ready (insufficient data), value might be None\n        sma_val = self.sma20.value\n        rsi_val = self.rsi14.value\n\n        if sma_val is None or rsi_val is None:\n            return\n\n        if bar.close &gt; sma_val and rsi_val &lt; 30:\n            self.buy(bar.symbol, 100)\n</code></pre>"},{"location":"en/strategy_guide/#7-strategy-cookbook","title":"7. Strategy Cookbook","text":""},{"location":"en/strategy_guide/#71-trailing-stop","title":"7.1 Trailing Stop","text":"<pre><code>class TrailingStopStrategy(Strategy):\n    def __init__(self):\n        self.highest_price = 0.0\n        self.trailing_percent = 0.05 # 5% trailing stop\n\n    def on_bar(self, bar):\n        pos = self.get_position(bar.symbol)\n\n        if pos &gt; 0:\n            # Update highest price\n            self.highest_price = max(self.highest_price, bar.high)\n\n            # Check drawdown\n            drawdown = (self.highest_price - bar.close) / self.highest_price\n            if drawdown &gt; self.trailing_percent:\n                print(f\"Trailing Stop Triggered: High {self.highest_price}, Current {bar.close}\")\n                self.close_position(bar.symbol)\n                self.highest_price = 0.0 # Reset\n        else:\n            # Entry logic (Example)\n            if bar.close &gt; 100:\n                self.buy(bar.symbol, 100)\n                self.highest_price = bar.close # Initialize highest price\n</code></pre>"},{"location":"en/strategy_guide/#72-intraday-exit","title":"7.2 Intraday Exit","text":"<pre><code>class IntradayStrategy(Strategy):\n    def on_bar(self, bar):\n        # Assuming bar.timestamp is nanosecond timestamp\n        # Convert to datetime (requires import datetime)\n        dt = datetime.fromtimestamp(bar.timestamp / 1e9)\n\n        # Force exit at 14:55 daily\n        if dt.hour == 14 and dt.minute &gt;= 55:\n            if self.get_position(bar.symbol) != 0:\n                self.close_position(bar.symbol)\n            return\n\n        # Other trading logic...\n</code></pre>"},{"location":"en/strategy_guide/#multi-asset","title":"7.3 Multi-Asset Rotation","text":"<pre><code>class RotationStrategy(Strategy):\n    def on_bar(self, bar):\n        # Note: on_bar is triggered for each symbol\n        # If cross-sectional comparison is needed, it is recommended to process in on_timer or after collecting all bars\n        # This shows simple independent processing\n        pass\n\n    def on_timer(self, payload):\n        # Assume a daily timer is registered\n        # Get current prices of all subscribed symbols\n        scores = {}\n        for symbol in self.ctx.portfolio.positions.keys(): # Example only, actually should iterate over watchlist\n             hist = self.get_history(20, symbol)\n             scores[symbol] = hist[-1] / hist[0] # 20-day momentum\n\n        # Sort and rebalance...\n</code></pre>"},{"location":"en/strategy_guide/#8-mixed-asset-backtesting-configuration","title":"8. Mixed Asset Backtesting Configuration","text":"<p>AKQuant supports mixed trading of multiple assets such as stocks, futures, and options within the same strategy. Different assets usually have different attributes (e.g., contract multiplier, margin ratio, tick size).</p> <p>Using <code>InstrumentConfig</code> allows you to conveniently configure these attributes for each instrument.</p>"},{"location":"en/strategy_guide/#81-configuration-steps","title":"8.1 Configuration Steps","text":"<ol> <li>Prepare Data: Prepare data (DataFrame or CSV) for each instrument.</li> <li>Create Config: Use <code>InstrumentConfig</code> to define parameters for non-stock assets.</li> <li>Run Backtest: Pass the configuration to the <code>instruments_config</code> parameter of <code>run_backtest</code>.</li> </ol>"},{"location":"en/strategy_guide/#82-configuration-example","title":"8.2 Configuration Example","text":"<p>Suppose we want to backtest a portfolio containing \"Stock A\" and \"Stock Index Futures IF\":</p> <pre><code>from akquant import InstrumentConfig, run_backtest\n\n# 1. Define Futures Configuration\nfuture_config = InstrumentConfig(\n    symbol=\"IF2301\",          # Instrument Symbol\n    asset_type=\"FUTURES\",     # Asset Type: STOCK, FUTURES, OPTION\n    multiplier=300.0,         # Contract Multiplier (300 per point)\n    margin_ratio=0.1,         # Margin Ratio (10%)\n    tick_size=0.2             # Tick Size\n)\n\n# 2. Run Backtest\n# Note: Unconfigured instruments (e.g., STOCK_A) will use default parameters (Stock, Multiplier 1, Margin 100%)\nrun_backtest(\n    data=data_dict,\n    strategy=MyStrategy,\n    instruments_config=[future_config], # Pass config list\n    # ...\n)\n</code></pre> <p>For detailed code, please refer to the Mixed Asset Backtest Example.</p>"},{"location":"en/timezone/","title":"Timezone Handling Guide","text":"<p>AKQuant is a backtesting framework supporting multiple markets and instruments. To ensure precise alignment of time series, the framework's core uses UTC timestamps (nanoseconds) uniformly. However, when dealing with specific markets (such as China A-shares), correct timezone settings are crucial for data alignment and log readability.</p> <p>This document guides you on how to correctly handle data timezones, backtest configurations, and time conversions in strategies.</p>"},{"location":"en/timezone/#1-core-principles","title":"1. Core Principles","text":"<ol> <li>Internal UTC: All interactions between the engine's core (<code>Rust</code>) and the Python layer are based on UTC timestamps.</li> <li>Input Auto-Conversion: For user-passed DataFrame data, AKQuant automatically converts it to UTC storage based on the configured <code>timezone</code>.</li> <li>Output Localization: When backtest results and logs are displayed, they are converted back to the user-configured <code>timezone</code> (default is <code>Asia/Shanghai</code>).</li> </ol>"},{"location":"en/timezone/#2-data-preparation-and-timezones","title":"2. Data Preparation and Timezones","text":"<p>When preparing backtest data (DataFrame), you have two options:</p>"},{"location":"en/timezone/#method-a-use-naive-datetime-recommended","title":"Method A: Use Naive Datetime - Recommended","text":"<p>If your data is local time (e.g., Beijing Time) and has no timezone information (tz-naive), you only need to specify <code>timezone=\"Asia/Shanghai\"</code> in the backtest configuration. AKQuant will automatically assume these data belong to that timezone and perform the conversion.</p> <p>Example: Constructing A-share 1-minute bar data</p> <pre><code>import pandas as pd\nfrom datetime import timedelta\n\n# Generate naive time series (default is Beijing Time)\n# Example: 2023-01-01 09:31:00\nrng = pd.date_range(\n    start=\"2023-01-01 09:31\",\n    end=\"2023-01-01 11:30\",\n    freq=\"1min\"\n)\n\n# Create DataFrame\n# Index must be datetime type\ndf = pd.DataFrame({\n    \"open\": 10.0, \"high\": 11.0, \"low\": 9.0, \"close\": 10.5, \"volume\": 1000\n}, index=rng)\n\n# At this point, df.index.tz is None\n</code></pre>"},{"location":"en/timezone/#method-b-use-aware-datetime","title":"Method B: Use Aware Datetime","text":"<p>If your data already has timezone information (e.g., data obtained from certain APIs), AKQuant will convert it directly to UTC. Please ensure the timezone information is correct.</p> <pre><code># Time series with timezone\nrng = pd.date_range(\n    start=\"2023-01-01 09:31\",\n    periods=100,\n    freq=\"1min\",\n    tz=\"Asia/Shanghai\"  # Explicitly specify timezone\n)\n</code></pre>"},{"location":"en/timezone/#important-timestamp-setting-for-daily-data","title":"Important: Timestamp Setting for Daily Data","text":"<p>For daily data (1D), to correctly align with minute data (1m) in backtesting (avoiding look-ahead bias), it is strongly recommended to set the daily timestamp to the closing time of the day (15:00 for A-shares).</p> <ul> <li>If set to 00:00, daily data might \"appear\" before the minute data of the day, or cause confusion during alignment.</li> <li>Setting to 15:00 ensures the daily Bar is completed only after the day's trading ends.</li> </ul> <pre><code># Daily data index example\nts_daily = pd.Timestamp(\"2023-01-01 15:00:00\")  # Beijing Time 15:00\n</code></pre>"},{"location":"en/timezone/#3-backtest-configuration","title":"3. Backtest Configuration","text":"<p>Specify the default timezone for backtesting via the <code>timezone</code> parameter during <code>run_backtest</code> or <code>BacktestEngine</code> initialization.</p> <pre><code>from akquant.backtest import run_backtest\n\nresults = run_backtest(\n    data=data_feed,\n    strategy=MyStrategy,\n    timezone=\"Asia/Shanghai\",  # Specify as Shanghai time\n    # ...\n)\n</code></pre>"},{"location":"en/timezone/#4-time-processing-in-strategies","title":"4. Time Processing in Strategies","text":"<p>In the strategy's <code>on_bar</code> callback, <code>bar.timestamp</code> is an integer (int64) representing the UTC nanosecond timestamp. If you need to print the current time in logs or make logical decisions based on time (e.g., trade only in the afternoon), you need to convert it to local time.</p>"},{"location":"en/timezone/#method-2-use-strategy-helper-methods-recommended","title":"Method 2: Use Strategy Helper Methods (Recommended)","text":"<p>AKQuant provides convenient helper methods in the <code>Strategy</code> base class, automatically converting using the configured timezone.</p> <p>```python class MyStrategy(Strategy):     def on_bar(self, bar: Bar):         # 1. Get local time object (pd.Timestamp)         ts = self.to_local_time(bar.timestamp)</p> <pre><code>    # 2. Directly get formatted string (default \"%Y-%m-%d %H:%M:%S\")\n    ts_str = self.format_time(bar.timestamp)\n</code></pre>"},{"location":"en/tutorial/","title":"Tutorial: Writing Your First Strategy","text":"<p>This tutorial will guide you step-by-step through writing a classic Dual Moving Average Strategy. This is often the \"Hello World\" for quantitative traders.</p> <p>We will cover the entire process from data preparation and strategy writing to backtest analysis.</p>"},{"location":"en/tutorial/#1-strategy-logic","title":"1. Strategy Logic","text":"<p>The logic of the Dual Moving Average strategy is very intuitive:</p> <ul> <li>Golden Cross: When the short-term moving average (e.g., 10-day MA) crosses above the long-term moving average (e.g., 30-day MA), the trend is considered upward, so Buy.</li> <li>Death Cross: When the short-term moving average crosses below the long-term moving average, the trend is considered downward, so Sell.</li> </ul>"},{"location":"en/tutorial/#2-complete-code","title":"2. Complete Code","text":"<p>For your convenience, we have put all the code in one file. You can copy the following code into <code>my_first_strategy.py</code> and run it.</p> <pre><code>import pandas as pd\nimport numpy as np\nfrom akquant import Strategy, run_backtest\n\n# --------------------------\n# Step 1: Prepare Data\n# --------------------------\n# In a real scenario, you would use pd.read_csv(\"stock_data.csv\")\n# Here, we generate some mock data for demonstration purposes\ndef generate_mock_data():\n    dates = pd.date_range(start=\"2023-01-01\", end=\"2023-12-31\")\n    n = len(dates)\n\n    # Generate a random walk\n    np.random.seed(42) # Fix random seed for consistent results\n    returns = np.random.normal(0.0005, 0.02, n)\n    price = 100 * np.cumprod(1 + returns)\n\n    # Construct DataFrame\n    df = pd.DataFrame({\n        \"date\": dates,\n        \"open\": price,\n        \"high\": price * 1.01,\n        \"low\": price * 0.99,\n        \"close\": price,\n        \"volume\": 10000,\n        \"symbol\": \"AAPL\" # Assuming this is Apple stock\n    })\n    return df\n\n# --------------------------\n# Step 2: Write Strategy\n# --------------------------\nclass DualMAStrategy(Strategy):\n    \"\"\"\n    Inherits from akquant.Strategy, which is the base class for all strategies.\n    \"\"\"\n\n    # New (Recommended): Declarative setting of history warmup period\n    # The framework will automatically handle set_history_depth for you, no need to call manually in on_start\n    # Priority: Dynamic property (self.warmup_period) &gt; Class property (warmup_period) &gt; AST inference\n    warmup_period = 40 # 30-day MA + 10 safety margin\n\n    def __init__(self, fast_window=10, slow_window=30):\n        # Define strategy parameters: fast and slow window sizes\n        self.fast_window = fast_window\n        self.slow_window = slow_window\n\n        # Advanced tip: Dynamic warmup period\n        # If window sizes are passed dynamically, it's recommended to override warmup_period here\n        self.warmup_period = slow_window + 10\n\n    def on_start(self):\n        \"\"\"\n        Executed once when the strategy starts.\n        Tell the system which stocks we want to watch here.\n        \"\"\"\n        print(\"Strategy starting...\")\n        self.subscribe(\"AAPL\")\n\n        # Method 1 (Recommended): Use warmup_period (supports Class/Instance property / AST inference)\n        # Method 2 (Legacy): Manually call self.set_history_depth(self.slow_window + 10)\n\n        # Since we have configured warmup_period, no action is needed here\n        # The framework automatically takes max(warmup_period, ast_inferred_value, run_backtest_history_depth)\n\n    def on_bar(self, bar):\n        \"\"\"\n        Core logic: Triggered every time a bar closes.\n        The bar parameter contains current market data (bar.close, bar.high, etc.).\n        \"\"\"\n\n        # 1. Get historical closing prices\n        # get_history returns a numpy array containing the last N days of data\n        closes = self.get_history(count=self.slow_window, symbol=bar.symbol, field=\"close\")\n\n        # If not enough data to calculate the long MA (e.g., first few days of backtest), return immediately\n        if len(closes) &lt; self.slow_window:\n            return\n\n        # 2. Calculate Moving Averages\n        # Use numpy to calculate mean\n        fast_ma = np.mean(closes[-self.fast_window:]) # Average of the last fast_window data points\n        slow_ma = np.mean(closes[-self.slow_window:]) # Average of the last slow_window data points\n\n        # 3. Get Current Position\n        # Returns 0 if no position, 1000 if holding 1000 shares\n        position = self.get_position(bar.symbol)\n\n        # 4. Trading Signal Judgment\n        # Golden Cross: Short-term &gt; Long-term, and currently empty position -&gt; Buy\n        if fast_ma &gt; slow_ma and position == 0:\n            print(f\"[{bar.timestamp_str}] Golden Cross Buy! Price: {bar.close:.2f}\")\n            self.buy(symbol=bar.symbol, quantity=1000)\n\n        # Death Cross: Short-term &lt; Long-term, and currently holding position -&gt; Sell\n        elif fast_ma &lt; slow_ma and position &gt; 0:\n            print(f\"[{bar.timestamp_str}] Death Cross Sell! Price: {bar.close:.2f}\")\n            self.sell(symbol=bar.symbol, quantity=position) # Sell all holdings\n\n# --------------------------\n# Step 3: Run Backtest\n# --------------------------\nif __name__ == \"__main__\":\n    # 1. Get Data\n    df = generate_mock_data()\n\n    # 2. Run Backtest\n    print(\"Starting backtest...\")\n    result = run_backtest(\n        data=df,\n        strategy=DualMAStrategy, # Pass our strategy class\n        strategy_params={\"fast_window\": 10, \"slow_window\": 30}, # Adjust parameters\n        cash=100_000.0,    # Initial capital 100k\n        commission=0.0003  # Commission 0.03%\n    )\n\n    # 3. Print Results\n    print(\"\\n\" + \"=\"*30)\n    print(result) # Print detailed performance report\n    print(\"=\"*30)\n</code></pre>"},{"location":"en/tutorial/#3-code-detailed-analysis","title":"3. Code Detailed Analysis","text":""},{"location":"en/tutorial/#31-strategy-structure","title":"3.1 Strategy Structure","text":"<p>Every AKQuant strategy is a Python class inheriting from <code>Strategy</code>. You need to focus on three main methods:</p> <ul> <li><code>__init__</code>: Set strategy parameters (e.g., moving average periods).</li> <li><code>on_start</code>: Initialization work.<ul> <li>Data Warmup (New Recommended): Set <code>warmup_period</code>.<ul> <li>Static Setting: Class attribute <code>warmup_period = 40</code>.</li> <li>Dynamic Setting: <code>self.warmup_period = slow_window + 10</code> in <code>__init__</code>.</li> <li>Auto Inference: If code contains <code>SMA(30)</code>, the framework will also try to infer automatically (AST).</li> </ul> </li> <li>Data Warmup (Legacy Compatible): Call <code>self.set_history_depth(40)</code>. If not set, <code>get_history</code> will raise an error.</li> </ul> </li> <li><code>on_bar</code>: This is an infinite loop where the system passes every K-line to you in chronological order. You make decisions here: buy or sell?</li> </ul>"},{"location":"en/tutorial/#32-getting-data","title":"3.2 Getting Data","text":"<ul> <li><code>bar.close</code>: Closing price of the current K-line.</li> <li><code>self.get_history(N, symbol, \"close\")</code>: Get an array of closing prices for the past N days. This is the most efficient way to access data.</li> </ul>"},{"location":"en/tutorial/#33-placing-orders","title":"3.3 Placing Orders","text":"<ul> <li><code>self.buy(symbol, quantity)</code>: Send a buy order. Defaults to a market order (executes at current price).</li> <li><code>self.sell(symbol, quantity)</code>: Send a sell order.</li> </ul>"},{"location":"en/tutorial/#4-frequently-asked-questions-faq","title":"4. Frequently Asked Questions (FAQ)","text":"<p>Q: Why does the program error with <code>RuntimeError: History tracking is not enabled</code>? A: This is because you called <code>get_history</code> but did not set the historical data depth. Please ensure you set the <code>warmup_period</code> attribute in the strategy class (recommended), or call <code>self.set_history_depth()</code> in <code>on_start</code>. The system defaults to not enabling history caching for performance, so it must be explicitly enabled.</p> <p>Q: Why does <code>get_history</code> return a lot of <code>NaN</code>? A: This usually happens at the beginning of the backtest. For example, if you set depth=30 but call <code>get_history(30)</code> on the 5th day. At this time, there is insufficient data, so the system automatically pads with <code>NaN</code> to ensure the returned array length is consistent. It is recommended to check <code>if len(closes) &lt; N: return</code> at the beginning of <code>on_bar</code>.</p> <p>Q: What is <code>sharpe_ratio</code> in the backtest results? A: Sharpe Ratio, a metric measuring the cost-effectiveness of a strategy. Greater than 1 is usually considered okay, and greater than 2 is considered excellent.</p> <p>Q: How do I switch to my own data? A: Just replace <code>data=df</code> with your own DataFrame. Ensure your DataFrame contains columns: <code>date</code>, <code>open</code>, <code>high</code>, <code>low</code>, <code>close</code>, <code>volume</code>, <code>symbol</code>.</p>"},{"location":"en/tutorial/#5-advanced-parameter-optimization","title":"5. Advanced: Parameter Optimization","text":"<p>In actual development, we often need to find the optimal parameters for a strategy (e.g., is 10/30 better for moving averages, or 5/20?). AKQuant provides built-in grid search tools.</p> <pre><code>from akquant import run_optimization\n\n# Define parameter grid\nparam_grid = {\n    \"fast_window\": range(5, 30, 5),   # [5, 10, 15, 20, 25]\n    \"slow_window\": range(20, 60, 10), # [20, 30, 40, 50]\n}\n\n# Run optimization\nresults_df = run_optimization(\n    strategy=DualMAStrategy,\n    param_grid=param_grid,\n    data=df,\n    cash=100_000.0,\n    commission=0.0003,\n    sort_by=\"total_return\", # Sort by return\n    ascending=False\n)\n\n# Print top 5\nprint(results_df.head(5))\n</code></pre> <p><code>run_optimization</code> will automatically utilize multi-core CPUs to accelerate backtesting in parallel and return a DataFrame containing all parameter combinations and corresponding performance metrics.</p>"}]}